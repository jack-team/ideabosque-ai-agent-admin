import{b as _,A as L,u as m,j as e,n as J,h as ee,o as Y,al as z,ak as te,y as ne,S as oe,Y as se,V as ae,X as re,am as de,_ as A,$ as q,F as B,U as ie,a8 as ce,a9 as le,aa as _e,ab as me,an as ue,Q as pe,Z as he,ad as xe,ac as ye,ae as fe,af as ve,ag as je,ah as ge,ai as be}from"./libs-CxhqsusD.js";/* empty css              */import{c as H}from"./index-CONfLKmC.js";import{b as R,d as Ne,T as I,u as U,a as we,c as Se}from"./index-BIx9Le_D.js";import"./index-C4u-YTo0.js";import{g as Te,a as Ce,b as ke,t as Ee,c as Pe}from"./index-wQU1KYCR.js";import{S as $e}from"./index-sIVXsceN.js";import"./workflow-Cy4gCUZY.js";import"./request-DCRxv3nq.js";import"./index-8_jSenGp.js";const Fe=n=>{const{uiComponents:t}=n,o=t.reduce((s,r)=>({...s,[r.tag_name]:r.tag_name}),{});return{type:"ui",title:"UI",icon:"KubernetesOutlined",desc:"The UI components within the AI assistant can be used as a data source to obtain data.",modalWidth:420,formSchema:[{name:"name",valueType:"select",title:"Component",valueEnum:o,rules:[{required:!0,message:"Please select Component"}]},{dependencys:[{name:"name",values:Object.keys(o),renders:[{title:"Text",name:"text",tooltip:"Description information of the selection component."}]},...t.map(s=>({name:"name",values:[s.tag_name],renders:s.parameters.map(r=>({title:r.name,name:r.parameter,tooltip:"Description information of the selection component.",rules:[{required:!0}]}))}))]}]}},Me=()=>({type:"step",icon:"StepForwardOutlined",title:"Step",modalWidth:420,desc:"Execute the corresponding process according to the different branches created.",formSchema:[{title:"Name",name:"name",rules:[{required:!0}]},{title:"Description",name:"description",rules:[{required:!0}]},{name:"conditions",valueType:"formList",fieldProps:{creatorButtonProps:{creatorButtonText:"Add condition"}},columns:[{valueType:"group",columns:[{title:"Condition",name:"condition",fieldProps:{placeholder:"Please enter a condition"},width:"md",rules:[{required:!0}]}]}]}]}),Ae=()=>({type:"prompt",title:"Prompt",icon:"SendOutlined",modalWidth:420,desc:"Prompt the AI what to do or say.",formSchema:[{title:"Type",name:"type",valueType:"radio",valueEnum:{prompt:"Prompt",text:"Text"},initialValue:"prompt",rules:[{required:!0}]},{dependencys:[{name:"type",values:["text"],renders:[{title:"Text",name:"text",rules:[{required:!0}]}]},{name:"type",values:["prompt"],renders:[{title:"Prompt",name:"prompt",rules:[{required:!0}]}]}]}]}),qe=()=>({type:"branch",icon:"BranchesOutlined",title:"Branch",modalWidth:420,desc:"Execute the corresponding process according to the different branches created.",formSchema:[{title:"Name",name:"name",rules:[{required:!0}]},{title:"Text",name:"text",rules:[{required:!0}]},{name:"conditions",valueType:"formList",fieldProps:{creatorButtonProps:{creatorButtonText:"Add condition"}},columns:[{valueType:"group",columns:[{title:"Condition",name:"condition",fieldProps:{placeholder:"Please enter a condition"},width:"md",rules:[{required:!0}]}]}]}]}),Ie=n=>{const{mcpServers:t}=n;return{type:"action",icon:"FunctionOutlined",title:"Action",modalWidth:420,desc:"Obtain or process data by calling backend interfaces or methods.",formSchema:[{title:"Type",name:"type",valueType:"select",valueEnum:t.reduce((s,r)=>[...s,...r.tools],[]).reduce((s,r)=>({...s,[r.name]:r.description}),{}),rules:[{required:!0}]},{title:"Text",name:"text",rules:[{required:!0}]}]}},Oe=()=>({type:"transform",icon:"BlockOutlined",title:"Transform",modalWidth:420,desc:"Convert the input data",formSchema:[{title:"Type",name:"type",valueType:"select",valueEnum:{summarize:"summarize",full_content:"full_content",structure_input:"structure_input"},rules:[{required:!0}]},{name:"attrs",valueType:"formList",fieldProps:{creatorButtonProps:{creatorButtonText:"Add attr"}},columns:[{valueType:"group",columns:[{title:"Attribute",name:"attr",fieldProps:{placeholder:"Please enter a Attribute"},width:"md",rules:[{required:!0}]}]}]}]}),We=n=>[Fe,Me,Ae,Ie,qe,Oe].map(t=>t(n)),X=_.createContext({}),S=()=>_.useContext(X),Be="_edit_step_modal_v2k9j_1",Re="_flow_work_v2k9j_16",K={edit_step_modal:Be,flow_work:Re},De=n=>{const{message:t}=L.useApp(),[o]=R(),{modal:a}=L.useApp(),s=_.useRef(null),{uiComponents:r=[],mcpServers:c=[]}=S(),l=m(()=>s.current.getData()),i=m(()=>{var h;const d=l();if(!d.edges.length){t.error("The current flowchart is not completed.");return}(h=n.onSave)==null||h.call(n,d),o()}),u=m(()=>{a.confirm({rootClassName:"shopify",title:"Are you sure you want to leave?",content:"The data on this page will be lost after leaving.",okButtonProps:{className:"shopify"},cancelButtonProps:{className:"shopify"},okText:"Yes",onOk:()=>o()})});return Ne(async()=>Promise.reject()),e.jsx(J,{title:n.title,onBack:u,className:"shopify full-screen",extra:[e.jsx($e,{type:"primary",onClick:i,children:"Save"})],children:e.jsx(ee,{className:"shopify full-content",children:e.jsx("div",{className:K.flow_work,children:e.jsx(Ut,{role:"child",ref:s,initialEdges:n.edges,initialNodes:n.nodes,uiComponents:r,mcpServers:c})})})})},Le=n=>{const{trigger:t,modal:o,...a}=n;return e.jsx(I,{centered:!0,modal:o,width:"100vw",closable:!1,hasFooter:!1,trigger:t,className:K.edit_step_modal,children:e.jsx(De,{...a})})},O={target:"Target",source:"Source"},He=[{title:"Connection setting",valueType:"group",columns:[{title:"Enable",valueType:"switch",initialValue:!0,dataIndex:"connectionEnable"},{valueType:"dependency",name:["connectionEnable"],columns:({connectionEnable:n})=>{const t=[];return n&&t.push({title:"Types",valueType:"select",valueEnum:O,dataIndex:"connectionTypes",fieldProps:{mode:"multiple"},initialValue:Object.keys(O)}),t}}]}],Ve=n=>{const[t]=Y.useForm(),[o]=R();return U(async()=>{var s;const a=await t.validateFields();(s=n.onSave)==null||s.call(n,a),o()}),e.jsx("div",{style:{padding:"24px 0 0 0"},children:e.jsx(z,{form:t,layout:"horizontal",columns:He,submitter:!1,initialValues:n.formData})})},Ye="_dynamic_form_1eu5x_1",ze={dynamic_form:Ye},Z=n=>{const{schemas:t=[],formData:o}=n,[a]=Y.useForm(),[s]=R(),r=_.useMemo(()=>t.map(Te),[t]),c=_.useMemo(()=>Ce(t),[t]),l=_.useMemo(()=>ke(t),[t]);return U(async()=>{var u;let i=await a.validateFields();i=Ee(i,l,c),await((u=n.onSubmit)==null?void 0:u.call(n,{formData:i})),s()}),e.jsx("div",{className:ze.dynamic_form,children:e.jsx(z,{form:a,submitter:!1,columns:r,initialValues:o})})},Ue="_tool_bar_container_122m1_1",Xe="_tool_bar_action_122m1_5",C={tool_bar_container:Ue,tool_bar_action:Xe},Ke=n=>{var b;const{data:t}=n,o=t.values,{nodeType:a,formData:s,autoOpenStepCanvas:r=!0}=o,{role:c,deleteNode:l,updateNodeData:i}=S(),[u]=we(),d=m(async p=>{i(n.id,Object.assign(t,p))}),h=m(async p=>{t.values=Object.assign(t.values,p),d(t)}),v=m(async p=>{d(p)}),j=m(p=>{t.values.stepRealData=p,d(t)}),g=m(()=>{c==="parent"&&a==="step"&&r&&(o.autoOpenStepCanvas=!1,requestAnimationFrame(()=>{u.openModal(),d(t)}))}),T=te("ai-node-tool-bar",C.tool_bar_container);return ne(g),e.jsx("div",{className:T,children:e.jsxs(oe,{size:12,children:[e.jsx("div",{className:C.tool_bar_action,onClick:()=>l(n.id),children:e.jsx(se,{})}),c==="parent"&&e.jsx(Le,{...o.stepRealData,modal:u,title:(b=s.name)==null?void 0:b.value,onSave:j,trigger:e.jsx("div",{className:C.tool_bar_action,children:e.jsx(ae,{})})}),e.jsx(I,{title:"Edit Node",okText:"Save",width:n.editModalWidth,trigger:e.jsx("div",{className:C.tool_bar_action,children:e.jsx(re,{})}),children:e.jsx(Z,{...n,onSubmit:h})}),e.jsx(I,{title:"Settings",okText:"Save",trigger:e.jsx("div",{className:C.tool_bar_action,children:e.jsx(de,{})}),children:e.jsx(Ve,{formData:n.data,onSave:v})})]})})},Ze=n=>{const{connectionEnable:t=!0,connectionTypes:o=Object.keys(O)}=n.data,a=o.includes("target"),s=o.includes("source");return e.jsxs(_.Fragment,{children:[t&&a&&e.jsx("div",{className:"flow_handle_left",children:e.jsx(A,{type:"target",position:q.Left,className:"flow_handle",isConnectable:n.isConnectable})}),t&&s&&e.jsxs("div",{className:"flow_handle_right",children:[e.jsx(A,{type:"source",position:q.Right,className:"flow_handle",isConnectable:n.isConnectable}),e.jsx(B,{})]})]})},Qe="_node_layout_wrapper_xpd8g_1",Ge="_tool_bar_xpd8g_13",Je="_node_layout_xpd8g_1",et="_node_layout_body_xpd8g_29",$={node_layout_wrapper:Qe,tool_bar:Ge,node_layout:Je,node_layout_body:et};function P(n){const{data:t,children:o,handler:a=!0}=n,s=t.values,r=s.nodeType,{schemas:c=[]}=S(),l=_.useMemo(()=>Pe(s.formData),[s.formData]),i=_.useMemo(()=>c.find(d=>d.type===r),[c]),u=()=>{const d=e.jsx(Ze,{...n});if(a===!0)return d;if(typeof a=="function")return(a==null?void 0:a(l))??d};return e.jsxs("div",{className:$.node_layout_wrapper,children:[e.jsx("div",{className:$.tool_bar,children:e.jsx(Ke,{id:n.id,data:t,formData:l,schemas:i==null?void 0:i.formSchema,editModalWidth:i==null?void 0:i.modalWidth})}),e.jsxs("div",{className:$.node_layout,children:[e.jsx("div",{className:$.node_layout_body,children:o==null?void 0:o(l)}),u()]})]})}const tt="_ui_node_ciuuw_1",nt="_ui_node_header_ciuuw_1",ot="_ui_node_body_ciuuw_7",st="_ui_node_text_ciuuw_10",F={ui_node:tt,ui_node_header:nt,ui_node_body:ot,ui_node_text:st},at=n=>e.jsx(P,{...n,children:t=>e.jsxs("div",{className:F.ui_node,children:[e.jsx("div",{className:F.ui_node_header,children:t.name}),e.jsx("div",{className:F.ui_node_body,children:e.jsx("div",{className:F.ui_node_text,children:t.text})})]})}),rt="_action_node_14v0w_1",dt="_action_node_header_14v0w_1",it="_action_node_body_14v0w_7",ct="_action_node_text_14v0w_10",k={action_node:rt,action_node_header:dt,action_node_body:it,action_node_text:ct},lt=n=>e.jsx(P,{...n,children:t=>e.jsxs("div",{className:k.action_node,children:[e.jsx("div",{className:k.action_node_header,children:"Action Node"}),e.jsxs("div",{className:k.action_node_body,children:[e.jsx("div",{className:k.action_node_text,children:t.type}),e.jsx("div",{className:k.action_node_text,children:t.text})]})]})}),_t="_transform_node_1u43d_1",mt="_transform_node_header_1u43d_1",ut="_transform_node_body_1u43d_7",pt="_transform_node_text_1u43d_10",E={transform_node:_t,transform_node_header:mt,transform_node_body:ut,transform_node_text:pt},ht=n=>e.jsx(P,{...n,children:t=>e.jsxs("div",{className:E.transform_node,children:[e.jsx("div",{className:E.transform_node_header,children:"Transform Node"}),e.jsxs("div",{className:E.transform_node_body,children:[e.jsx("div",{className:E.transform_node_text,children:t.type}),e.jsx("div",{className:E.transform_node_text,children:t.text})]})]})}),xt="_step_node_1riik_1",yt="_step_node_header_1riik_1",ft="_step_node_body_1riik_7",vt="_step_node_text_1riik_11",jt="_conditions_1riik_19",gt="_condition_handle_1riik_25",w={step_node:xt,step_node_header:yt,step_node_body:ft,step_node_text:vt,conditions:jt,condition_handle:gt},bt=n=>{const{conditions:t=[],isConnectable:o}=n,{connectionEnable:a=!0,connectionTypes:s=Object.keys(O)}=n.data,r=s.includes("target"),c=s.includes("source");return e.jsxs(_.Fragment,{children:[a&&r&&e.jsx("div",{className:"flow_handle_left",children:e.jsx(A,{type:"target",position:q.Left,className:"flow_handle",isConnectable:o})}),a&&c&&e.jsx("div",{className:w.conditions,children:t.map((l,i)=>e.jsxs("div",{className:w.condition_handle,children:[e.jsx("span",{children:l.condition}),e.jsxs("div",{className:"flow_handle_right",children:[e.jsx(A,{type:"source",id:l.condition,position:q.Right,className:"flow_handle",isConnectable:o}),e.jsx(B,{})]})]},`key_${l.condition}_${i}`))})]})},V=n=>e.jsx(P,{...n,handler:t=>{const o=t.conditions;if(o!=null&&o.length)return e.jsx(bt,{...n,conditions:t.conditions})},children:t=>e.jsxs("div",{className:w.step_node,children:[e.jsx("div",{className:w.step_node_header,children:t.name}),e.jsx("div",{className:w.step_node_body,children:e.jsx("div",{className:w.step_node_text,children:t.text||t.description})})]})}),Nt="_prompt_node_syq2g_1",wt="_prompt_node_header_syq2g_1",St="_prompt_node_body_syq2g_7",Tt="_prompt_node_text_syq2g_10",M={prompt_node:Nt,prompt_node_header:wt,prompt_node_body:St,prompt_node_text:Tt},Ct={text:"Text",prompt:"Prompt"},kt=n=>e.jsx(P,{...n,children:t=>e.jsxs("div",{className:M.prompt_node,children:[e.jsxs("div",{className:M.prompt_node_header,children:[Ct[t.type]," Node"]}),e.jsx("div",{className:M.prompt_node_body,children:e.jsx("div",{className:M.prompt_node_text,children:t.text||t.prompt})})]})}),Et={ui:at,action:lt,transform:ht,step:V,branch:V,prompt:kt},Pt=n=>{const{stroke:t}=n;return e.jsx("defs",{children:e.jsx("marker",{id:n.id,refX:"0",refY:"0",markerWidth:"12.5",markerHeight:"12.5",viewBox:"-10 -10 20 20",markerUnits:"strokeWidth",orient:"auto-start-reverse",style:{stroke:t,fill:t,strokeWidth:1},children:e.jsx("polyline",{strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})})})},$t="_del_btn_7471i_1",Ft={del_btn:$t},Mt=n=>{const{id:t,selected:o,sourceX:a,sourceY:s,targetX:r,targetY:c,sourcePosition:l,targetPosition:i}=n,{setEdges:u}=ie(),[d,h,v]=ce({sourceX:a,sourceY:s,targetX:r,targetY:c}),j=_.useMemo(()=>`translate(-50%, -50%) 
      translate(${h}px,${v}px)`,[h,v]),g=o?"#f40":"#0143EC",T=m(()=>{u(b=>b.filter(p=>p.id!==t))});return e.jsxs(_.Fragment,{children:[e.jsx(Pt,{stroke:g,id:t}),e.jsx(le,{sourceX:a,sourceY:s,targetX:r,targetY:c,markerEnd:`url(#${t})`,sourcePosition:l,targetPosition:i,style:{stroke:g,strokeWidth:2}}),e.jsx(_e,{children:o?e.jsx("div",{style:{transform:j},onClick:T,className:Ft.del_btn,children:e.jsx(me,{})}):null})]})},At={"step-edge":Mt},qt=n=>{const{fromX:t,fromY:o,toX:a,toY:s}=n;return e.jsxs("g",{children:[e.jsx("path",{fill:"none",stroke:"#0143EC",strokeWidth:2,className:"animated",d:`M${t},${o} C ${t} ${s} ${t} ${s} ${a},${s}`}),e.jsx("circle",{cx:a,cy:s,fill:"#fff",r:3,stroke:"#0143EC",strokeWidth:2})]})},It="_nodes_1mo0o_1",Ot="_node_item_1mo0o_4",Wt="_node_icon_1mo0o_14",Bt="_node_item_body_1mo0o_17",Rt="_node_title_1mo0o_25",Dt="_node_desc_1mo0o_30",N={nodes:It,node_item:Ot,node_icon:Wt,node_item_body:Bt,node_title:Rt,node_desc:Dt},Lt=n=>{const{onNodeClick:t}=n,{role:o,schemas:a=[]}=S(),s=_.useMemo(()=>a.filter(r=>o==="parent"?r.type==="step":r.type!=="step"),[o,a]);return e.jsx("div",{className:N.nodes,children:s.map(r=>{const c=ue[r.icon];return e.jsx(I,{title:`Add ${r.title} Node`,width:r.modalWidth,destroyOnHidden:!0,okText:"Add Node",trigger:e.jsxs("div",{className:N.node_item,children:[e.jsx("div",{className:N.node_icon,children:e.jsx(c,{})}),e.jsxs("div",{className:N.node_item_body,children:[e.jsx("div",{className:N.node_title,children:r.title}),e.jsx("div",{className:N.node_desc,children:r.desc})]})]}),children:e.jsx(Z,{schemas:r.formSchema,onSubmit:async l=>{const i=r.type;t==null||t({...l,nodeType:i})}})},r.type)})})},Ht=n=>{const{open:t,trigger:o,onClose:a}=Se(n.trigger),s=m(r=>{var c;a(),(c=n.onChange)==null||c.call(n,r)});return e.jsxs(_.Fragment,{children:[e.jsx(pe,{open:t,width:320,destroyOnHidden:!0,title:n.title,onClose:a,rootClassName:"shopify",children:e.jsx(Lt,{onNodeClick:s})}),o]})},Vt="_add_btn_z3xq6_1",Yt={add_btn:Vt},zt=()=>{const{insertNodes:n}=S(),t=m(o=>{const{nodeType:a}=o,s=`${a}_${he()}`;n([{id:s,type:a,data:{values:o},position:{x:0,y:0}}])});return e.jsx(Ht,{title:"What triggers this workflow?",onChange:t,trigger:e.jsx("div",{className:Yt.add_btn,children:e.jsx(B,{})})})},Ut=_.forwardRef((n,t)=>{const{role:o="parent",initialNodes:a=[],initialEdges:s=[],mcpServers:r=[],uiComponents:c=[]}=n,{uiComponents:l=c,mcpServers:i=r}=S(),u=_.useMemo(()=>We({uiComponents:l,mcpServers:i}),[l,i]),[d,h,v]=xe(a),[j,g,T]=ye(s),b=j.map(f=>({...f,type:"step-edge"})),p=m(f=>{for(const y of f){if(d.length){const x=d.map(W=>W.position.x);y.position.x=Math.max(...x)+280}else{const x=y.data;x.connectionTypes||(x.connectionTypes=["source"])}d.push(y)}h([...d])}),D=m((f,y)=>{const x=d.findIndex(W=>W.id===f);x>-1&&(d[x].data=y,h(H(d)))}),Q=m(f=>{const y=d.findIndex(x=>x.id===f);y>-1&&(d.splice(y,1),h([...d]))}),G=m(f=>{g(y=>fe(f,y).map(x=>x))});return _.useImperativeHandle(t,()=>({getData:()=>H({nodes:d,edges:j})})),e.jsx(X.Provider,{value:{role:o,schemas:u,mcpServers:i,uiComponents:l,insertNodes:p,deleteNode:Q,updateNodeData:D},children:e.jsx("div",{className:"ai_work_flow",children:e.jsx(ve,{children:e.jsxs(je,{fitView:!0,nodes:d,edges:b,minZoom:.5,deleteKeyCode:null,edgeTypes:At,nodeTypes:Et,onConnect:G,onNodesChange:v,onEdgesChange:T,connectionLineComponent:qt,children:[e.jsx(ge,{size:2,color:"#ccc",bgColor:"#f6f6f6"}),e.jsx(zt,{}),e.jsx(be,{})]})})})})});export{Ut as default};
