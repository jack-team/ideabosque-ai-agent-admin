import{j as e,o as T,K as O,b as i,Q as Z,U as k,u as f,S as Q,V as J,X as ee,Y as te,Z as w,_ as q,$,a0 as oe,a1 as se,a2 as ne,a3 as re,W as I,p as M,v as A,a4 as ae,a5 as ce,a6 as U,w as de,f as ie,g as W,a7 as le,a8 as ue,a9 as me,aa as he,ab as pe,ac as _e,ad as xe,ae as ge,af as je,ag as fe,ah as Ne,ai as ve,m as be,n as ye}from"./libs-CxhqsusD.js";import{c as Ce}from"./index-CONfLKmC.js";/* empty css              */import{b as Ie,u as we,T as Fe,c as Pe}from"./index-BIx9Le_D.js";import"./index-C4u-YTo0.js";import"./index-sIVXsceN.js";const Se="_atom_node_16gqu_1",ke="_atom_icon_16gqu_11",De="_atom_content_16gqu_16",Ee="_atom_title_16gqu_19",Te="_atom_desc_16gqu_25",N={atom_node:Se,atom_icon:ke,atom_content:De,atom_title:Ee,atom_desc:Te},R=t=>{const{Icon:o,...n}=t;return e.jsxs("div",{onClick:t.onClick,className:N.atom_node,children:[e.jsx("div",{className:N.atom_icon,children:e.jsx(o,{})}),e.jsxs("div",{className:N.atom_content,children:[e.jsx("div",{className:N.atom_title,children:n.title}),e.jsx("div",{className:N.atom_desc,children:n.desc})]})]})},qe="_form_svv3s_1",$e={form:qe},We=t=>{var r;const{onSubmit:o}=t,[n]=Ie(),[s]=T.useForm();return we(async()=>{const a=await(s==null?void 0:s.validateFields());a&&await o(a),n()}),e.jsx(T,{form:s,submitter:!1,className:$e.form,initialValues:t.formData,children:(r=t.children)==null?void 0:r.call(t,s)})},z=t=>{const{children:o,onSubmit:n,formData:s,...r}=t;return e.jsx(Fe,{...r,children:e.jsx(We,{formData:s,onSubmit:n,children:o})})},Re=t=>{const o=O(),{closeDrawer:n,onChange:s,triggerId:r}=t;return e.jsx(i.Fragment,{children:V.filter(a=>a.limit!==void 0?o.filter(d=>d.type===a.type).length<a.limit:!0).map(a=>{const{type:c,Component:d,...h}=a,x=d.Icon,j=d.Form,p=async(_={})=>{n(),s==null||s({nodeType:c,triggerId:r,formData:_})};return j?e.jsx(z,{okText:"Add Node",onSubmit:p,width:d.modalWdith,title:`Add ${h.title} Node`,children:_=>e.jsx(j,{form:_}),trigger:e.jsx(R,{...h,Icon:x})},c):i.createElement(R,{...h,Icon:x,key:c,onClick:p})})})},Le=t=>{const{children:o,...n}=t,{open:s,trigger:r,onClose:a}=Pe(o);return e.jsxs(e.Fragment,{children:[r,e.jsx(Z,{open:s,destroyOnHidden:!0,onClose:a,rootClassName:"shopify",title:"What triggers this workflow?",children:e.jsx(Re,{...n,closeDrawer:a})})]})},Me="default_source_handle",L="default_target_handle",Ae={id:"start-id",type:"start-node",data:{formData:{}},position:{x:0,y:0}},Ue="_wrapper_8y734_4",ze="_tools_8y734_4",Be="_tool_item_8y734_15",Ge="_inner_8y734_26",He="_content_8y734_34",Ke="_handle_8y734_38",Ve="_handle_source_8y734_39",Xe="_branch_8y734_59",Ye="_branch_item_8y734_59",m={wrapper:Ue,tools:ze,tool_item:Be,inner:Ge,content:He,handle:Ke,handle_source:Ve,branch:Xe,branch_item:Ye},Oe=t=>{const{nodeId:o,tools:n}=t,{editForm:s}=n,{setNodes:r}=k(),a=f(()=>{r(c=>c.filter(d=>d.id!==o))});return e.jsxs(Q,{children:[e.jsx("div",{className:m.tool_item,children:e.jsx(J,{})}),!!s&&e.jsx(z,{okText:"Save",destroyOnHidden:!0,width:s.width,formData:s.formData,title:s.title||"Edit Node",trigger:e.jsx("div",{className:m.tool_item,children:e.jsx(ee,{})}),onSubmit:async()=>{},children:c=>e.jsx(s.Component,{form:c})}),e.jsx("div",{onClick:a,className:m.tool_item,children:e.jsx(te,{})})]})},D=t=>{const{tools:o,nodeProps:n,branch:s=[],enableHandle:r}=t,a=n.id,c=(r==null?void 0:r.source)??!0,d=(r==null?void 0:r.target)??!0,{addEdges:h,addNodes:x,getNodes:j}=k(),p=f(()=>{var E;const u=j().find(Y=>Y.id===a);let g=(u==null?void 0:u.position.x)||0;const X=(u==null?void 0:u.position.y)||0;return g=g+(((E=u==null?void 0:u.measured)==null?void 0:E.width)||0)+80,{x:g,y:X}}),_=f(l=>{const u=l.triggerId,g=w();x({id:g,data:l,type:l.nodeType,position:p()}),h({id:w(),source:a,target:g,sourceHandle:u,targetHandle:L})}),y=l=>e.jsx(Le,{triggerId:l,onChange:_,children:e.jsx(q,{id:l,type:"source",position:$.Right,className:m.handle_source})}),C=()=>s.length?e.jsx("div",{className:m.branch,children:s.map(l=>e.jsxs("div",{className:m.branch_item,children:[e.jsx("div",{className:m.branch_label,children:l.label}),y(l.id)]},l.id))}):y(Me);return e.jsxs("div",{className:m.wrapper,children:[e.jsx("div",{className:m.tools,children:!!o&&e.jsx(Oe,{nodeId:a,tools:o})}),e.jsxs("div",{className:m.inner,children:[d&&e.jsx(q,{type:"target",id:L,position:$.Left,className:m.handle,isConnectableStart:!1}),e.jsx("div",{className:m.content,children:t.children}),c&&C()]})]})},B=i.createContext({});var Ze=se();const Qe=oe(Ze),Je=(t,o={})=>{const n=i.useRef(w()),s=i.useRef({}),r=(Qe.isEqual(s.current,o)||(s.current=o,n.current=w()),n.current);i.useEffect(t,[r])},F=()=>i.useContext(B),et=()=>{const t=re();console.log(t);const{cacheNodeDatas:o}=F();return t.map(n=>o[n.source]).filter(Boolean)},tt=t=>{const o=ne(),n=t(),{saveCacheNodeDatas:s}=F();Je(()=>{n&&s(o,{data:n})},[n])},ot=t=>{const{inputParams:o=[]}=t;return e.jsx(i.Fragment,{children:o.map(n=>{const s=n.options,r={label:n.label,name:n.value,rules:[{required:n.required}]};return e.jsx(i.Fragment,{children:s!=null&&s.length?e.jsx(M,{...r,options:s}):e.jsx(I,{...r})},n.value)})})},G=()=>{const{uiComponents:t=[]}=F();return e.jsxs(i.Fragment,{children:[e.jsx(M,{label:"Component",name:"componentId",options:t,fieldProps:{fieldNames:{value:"componentId",label:"componentName"}},rules:[{required:!0}]}),e.jsx(A,{label:"Description",name:"description"}),e.jsx(ae,{name:["componentId"],children:({componentId:o})=>{const n=t.find(s=>s.componentId===o);return e.jsx(ot,{inputParams:n==null?void 0:n.input})}})]})},st="_node_1j9c9_1",nt="_component_1j9c9_1",rt="_description_1j9c9_6",P={node:st,component:nt,description:rt},v=t=>{const{formData:o}=t.data,{uiComponents:n=[]}=F(),s=n.find(r=>r.componentId===o.componentId);return tt(()=>s),e.jsx(D,{nodeProps:t,tools:{editForm:{formData:o,width:v.modalWdith,title:"Edit Ui node",Component:G}},children:e.jsxs("div",{className:P.node,children:[e.jsx("div",{className:P.component,children:s==null?void 0:s.componentName}),e.jsx("div",{className:P.description,children:o.description})]})})};v.Form=G;v.modalWdith=450;v.Icon=ce;const at="_container_12b9h_1",ct="_icon_12b9h_7",dt="_text_12b9h_12",S={container:at,icon:ct,text:dt},H=t=>e.jsx(D,{nodeProps:t,enableHandle:{target:!1},children:e.jsxs("div",{className:S.container,children:[e.jsx("div",{className:S.icon,children:e.jsx(U,{})}),e.jsx("div",{className:S.text,children:"Start"})]})});H.Icon=U;const K=()=>e.jsxs(i.Fragment,{children:[e.jsx(I,{name:"name",label:"Name",rules:[{required:!0}]}),e.jsx(A,{label:"Description",name:"description"}),e.jsx(de,{label:"Condition",name:"branch",children:e.jsxs(ie,{gutter:16,children:[e.jsx(W,{span:12,children:e.jsx(I,{label:"Label",name:"label",rules:[{required:!0}]})}),e.jsx(W,{span:12,children:e.jsx(I,{label:"Value",name:"value",rules:[{required:!0}]})})]})})]}),b=t=>{const{formData:o}=t.data,n=et();return console.log(n),e.jsx(D,{nodeProps:t,tools:{editForm:{formData:o,width:b.modalWdith,title:"Edit Branch node",Component:K}},children:e.jsx("div",{children:"Branch"})})};b.Form=K;b.modalWdith=400;b.Icon=le;const V=[{limit:1,type:"start-node",title:"Start",desc:"The starting node of a workflow.",Component:H},{type:"ui-node",title:"UI",desc:"The UI components within the AI assistant can be used as a data source to obtain data.",Component:v},{type:"brach-node",title:"Branch",desc:"Execute the corresponding process according to the different branches created.",Component:b}],it=t=>{const{stroke:o}=t;return e.jsx("defs",{children:e.jsx("marker",{id:t.id,refX:"0",refY:"0",markerWidth:"12.5",markerHeight:"12.5",viewBox:"-10 -10 20 20",markerUnits:"strokeWidth",orient:"auto-start-reverse",style:{stroke:o,fill:o,strokeWidth:1},children:e.jsx("polyline",{strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})})})},lt="_del_btn_7471i_1",ut={del_btn:lt},mt=t=>{const{id:o,selected:n,sourceX:s,sourceY:r,targetX:a,targetY:c,sourcePosition:d,targetPosition:h}=t,{setEdges:x}=k(),[j,p,_]=ue({sourceX:s,sourceY:r,targetX:a,targetY:c}),y=i.useMemo(()=>`translate(-50%, -50%) 
      translate(${p}px,${_}px)`,[p,_]),C=n?"#f40":"#0143EC",l=f(()=>{x(u=>u.filter(g=>g.id!==o))});return e.jsxs(i.Fragment,{children:[e.jsx(it,{stroke:C,id:o}),e.jsx(me,{sourceX:s,sourceY:r,targetX:a,targetY:c,markerEnd:`url(#${o})`,sourcePosition:d,targetPosition:h,style:{stroke:C,strokeWidth:2}}),e.jsx(he,{children:n?e.jsx("div",{style:{transform:y},onClick:l,className:ut.del_btn,children:e.jsx(pe,{})}):null})]})},ht={"step-edge":mt},pt=V.reduce((t,o)=>({...t,[o.type]:o.Component}),{}),_t=t=>{const{defaultNodes:o=[]}=t,n=i.useMemo(()=>o.length?o:[Ce(Ae)],[o]),[s,r,a]=_e([]),[c,d,h]=xe(n),x=s.map(p=>({...p,type:"step-edge"})),j=f(p=>r(_=>ge(p,_)));return e.jsx(je,{children:e.jsxs(fe,{minZoom:.5,nodes:c,edges:x,edgeTypes:ht,nodeTypes:pt,deleteKeyCode:null,onConnect:j,onNodesChange:h,onEdgesChange:a,fitView:!0,children:[e.jsx(Ne,{size:2,color:"#ccc",bgColor:"#f6f6f6"}),e.jsx(ve,{})]})})},xt=t=>{const{children:o,...n}=t,[s,r]=be({}),a=f((d,h)=>{r({...s,[d]:h})}),c={...n,saveCacheNodeDatas:a,cacheNodeDatas:s};return e.jsx(B.Provider,{value:c,children:o})},gt=t=>e.jsx(xt,{...t,children:e.jsx(_t,{})}),jt=[{componentId:"36258109583875916493",componentName:"Google Place",componentTag:"GooglePlace",componentType:"external_integration",input:[{label:"Google ApiKey",value:"googleApiKey",required:!0},{label:"Keyword",value:"keyword",required:!0}],output:[{label:"Place uuid",value:"place_uuid"}]},{componentId:"04131904947542049485",componentName:"Wizard Group",componentTag:"WizardGroup",componentType:"wizard_group",input:[{label:"Wizard GroupUuid",value:"wizard_group_uuid",required:!0},{label:"Keyword",value:"keyword",required:!0}],output:[{label:"All required responses",value:"all_required_responses"}]}],It=()=>e.jsx(ye,{className:"shopify full-screen",children:e.jsx(gt,{uiComponents:jt})});export{It as default};
