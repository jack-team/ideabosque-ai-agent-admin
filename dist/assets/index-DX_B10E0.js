import{y as f,A as k,h as p,b as z,j as e,W as m,z as x,J as h,w as B,x as P,P as A,S as y,D,L as S,B as I}from"./libs-NYaGYdqa.js";import{f as g}from"./index-CD538xby.js";import{T as w}from"./index-DSjh7nxU.js";import{I as j}from"./index-CCG6JdoO.js";import{b as T,u as b}from"./hooks-Dep68YsA.js";import{b as F,c as N,e as C}from"./wizard-CZUEWCOW.js";import{k as E}from"./useFetchData-DwlIBHXS.js";import{W}from"./map-BPCwAIgA.js";import"./index-CXsHAlaF.js";import"./generate-CrLfPIAK.js";import"./workflow-DZG1gzQi.js";import"./enum-Ct7sVdAK.js";const v=r=>{if(!r)return;const{elements:s,...i}=r,o=s.map(n=>n.element_uuid);return{...i,elementUuids:o}},L=r=>({...r,updatedBy:"Admin"}),U=r=>{const{formData:s}=r,[i]=f.useForm(),{message:o}=k.useApp(),[n]=T(),l=E(),a=p(()=>{i.setFieldsValue(v(s))});return z.useEffect(()=>{s&&a()},[s]),b(async()=>{var d;const t=await i.validateFields(),c=L(t);try{await F(c),n(),(d=r.onSuccess)==null||d.call(r),o.success(`UI Block ${s?"updated":"created"} successfully.`)}catch{o.error(`Failed to ${s?"update":"create"} UI Block.`)}}),e.jsxs(f,{form:i,submitter:!1,style:{padding:"24px 0 0 0"},children:[e.jsx(m,{hidden:!0,name:"wizardUuid"}),e.jsx(m,{label:"UI Block name",name:"wizardTitle",rules:[{required:!0}]}),e.jsx(x,{label:"UI Block Type",name:"wizardType",valueEnum:W,rules:[{required:!0}]}),e.jsx(h,{label:"UI Block description",name:"wizardDescription",fieldProps:{rows:8},rules:[{required:!0}]}),e.jsx(m,{label:"Priority",name:"priority",fieldProps:{type:"number"},rules:[{required:!0}]}),e.jsx(x,{label:"Elements",name:"elementUuids",mode:"multiple",options:l.options,fieldProps:{maxTagCount:1,loading:l.loading}}),e.jsx(h,{label:"Form Schema",name:"formSchema",fieldProps:{rows:8}})]})},X=()=>{const{modal:r,message:s}=k.useApp(),i=B(),o=z.useRef(null),n=p(()=>{var a;(a=o.current)==null||a.reload()}),l=p(a=>{r.confirm({title:"Are you sure you want to delete?",okText:"Delete",okButtonProps:{danger:!0,className:"shopify"},cancelButtonProps:{className:"shopify gray"},onOk:async()=>{try{await N({wizardUuid:a.wizardUuid}),n(),s.success("Deletion successful.")}catch(t){return s.success("Deletion failed."),Promise.reject(t)}}})});return e.jsx(P,{title:"UI Blocks",onBack:()=>i(-1),extra:e.jsxs(y,{size:16,children:[e.jsx(I,{className:"shopify gray",onClick:()=>i("/elements"),children:"Elements"}),e.jsx(w,{width:600,className:"shopify",title:"Create new UI Block",trigger:e.jsx(I,{className:"shopify",type:"primary",children:"Create new UI Block"}),children:e.jsx(U,{})})]}),children:e.jsx(A,{actionRef:o,search:!1,options:!1,scroll:{x:"max-content"},rowKey:"wizardUuid",className:"shopify",request:async a=>{const{current:t,pageSize:c,...d}=a,{wizardList:u}=await C({limit:c,pageNumber:t,...d});return{total:u.total,data:u.wizardList}},columns:[{title:"UI Block Name",dataIndex:"wizardTitle"},{title:"UI Block UUID",dataIndex:"wizardUuid",hideInSearch:!0},{title:"Priority",dataIndex:"priority",hideInSearch:!0},{title:"Create at",dataIndex:"createdAt",hideInSearch:!0,render:(a,t)=>g(t.createdAt)},{title:"Last updated",dataIndex:"updatedAt",hideInSearch:!0,render:(a,t)=>g(t.updatedAt)},{width:"120px",key:"action",title:"Action",align:"center",fixed:"right",hideInSearch:!0,render:(a,t)=>e.jsxs(y,{children:[e.jsx(w,{width:600,destroyOnHidden:!0,className:"shopify",title:"UI Block  Details",trigger:e.jsx(j,{icon:D}),children:e.jsx(U,{formData:t,onSuccess:n})}),e.jsx(j,{icon:S,onClick:()=>l(t)})]})}]})})};export{X as default};
