import{y as j,A as q,G as N,w as A,H as U,v as y,f,b as L,j as e,x as W,W as l,n as h,o,z as x,J as v,K as k,S as B}from"./libs-BaOSQqCJ.js";import{f as E,i as M}from"./workflow-T_8sSeQK.js";import{a as V,b as R}from"./useFetchData-CeKsxI82.js";import{S as z}from"./index-DebROj1t.js";import"./index-CePQT19d.js";import{S as O}from"./index-BHduNzk7.js";import{a as G}from"./const-DP1vyTQS.js";import"./generate-CrCzx0rs.js";import"./wizard-D1rTLV8D.js";import"./enum-Ct7sVdAK.js";const S="__",H=s=>{const a=s.mcpServers.map(r=>r.mcp_server_uuid),n=s.uiComponents.map(r=>[r.ui_component_uuid,r.ui_component_type].join(S));return{...s,mcpServers:a,uiComponents:n}},J=s=>{const a=s.mcpServers||[],n=s.uiComponents||[],r=a.map(i=>({mcp_server_uuid:i})),c=n.map(i=>{const[u,m]=i.split(S);return{ui_component_uuid:u,ui_component_type:m}});return{...s,mcpServers:r,uiComponents:c,updatedBy:"admin"}},K="_wrapper_ytw7y_1",I="_form_ytw7y_4",Q="_form_list_ytw7y_11",_={wrapper:K,form:I,form_list:Q},ne=()=>{const[s]=j.useForm(),{message:a}=q.useApp(),{state:n}=N(),r=A(),{uid:c,vid:i}=U(),[u,m]=y(!1),{options:g,loading:T}=V(),{options:w,loading:b}=R(),[t,P]=y(n),C=f(async()=>{const{promptTemplate:p}=await E({promptUuid:c,promptVersionUuid:i});P(p)}),D=f(()=>{const p=H(t);s.setFieldsValue(p)}),F=f(async()=>{const p=await s.validateFields();try{m(!0);const d=J(p);await M(d),a.success("Template saved successfully.")}catch(d){a.error(d.message)}finally{m(!1)}});return L.useEffect(()=>{t?D():C()},[t]),e.jsx(z,{loading:!t,children:e.jsx(W,{title:t==null?void 0:t.promptName,className:"shopify full-screen",onBack:()=>r(-1),extra:e.jsx(B,{children:e.jsx(O,{type:"primary",loading:u,disabled:!t,onClick:F,children:"Save"})}),children:e.jsx("div",{className:_.wrapper,children:e.jsxs(j,{form:s,submitter:!1,className:_.form,children:[e.jsx(l,{hidden:!0,name:"promptUuid"}),e.jsxs(h,{gutter:16,children:[e.jsx(o,{span:24,children:e.jsx(l,{label:"Template Name",name:"promptName",rules:[{required:!0}]})}),e.jsx(o,{span:24,children:e.jsx(x,{label:"Type",name:"promptType",valueEnum:G,rules:[{required:!0}]})}),e.jsx(o,{span:24,children:e.jsx(x,{label:"Mcp Servers",name:"mcpServers",mode:"multiple",options:w,rules:[{required:!0}],fieldProps:{loading:b}})}),e.jsx(o,{span:24,children:e.jsx(x,{label:"Ui Components",name:"uiComponents",mode:"multiple",options:g,rules:[{required:!0}],fieldProps:{loading:T}})})]}),e.jsx(v,{label:"Template Description",name:"promptDescription",fieldProps:{rows:12},rules:[{required:!0}]}),e.jsx(v,{label:"Template Context",name:"templateContext",fieldProps:{rows:12},rules:[{required:!0}]}),e.jsx(k,{label:"Variables",name:"variables",className:_.form_list,children:e.jsxs(h,{gutter:16,children:[e.jsx(o,{span:12,children:e.jsx(l,{name:"name",placeholder:"Variable Name",rules:[{required:!0}]})}),e.jsx(o,{span:12,children:e.jsx(l,{name:"data_type",placeholder:"Data type",rules:[{required:!0}]})})]})})]})})})})};export{ne as default};
