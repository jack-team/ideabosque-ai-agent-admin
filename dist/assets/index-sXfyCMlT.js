import{b as u,u as x,z as L,D as O,F as A,G as Ee,H as te,q as K,j as t,S as ke,J as De,K as $e,L as Pe,Q as We,U as ne,V as se,W as y,s as E,x as S,X,Y as qe,Z as oe,y as R,h as Y,i as F,_ as Ae,$ as Re,a0 as Me,a1 as Be,a2 as He,a3 as Le,a4 as Ue,a5 as Ve,a6 as Oe,a7 as Xe,a8 as re,a9 as Ye,aa as ze,ab as Je,ac as Ge,ad as Ze,ae as Ke,af as Qe,M as et,ag as ae,o as z,ah as tt,ai as nt,k as st,A as ot,w as rt,aj as at,p as ct}from"./libs-WQIapg8s.js";import{k as lt,j as it}from"./workflow-CLg8ntmy.js";import{c as Q}from"./index-DQJCvDF_.js";import{T as dt,u as ut}from"./index-BGNMSpcd.js";import{S as mt}from"./index-D9lBcUPo.js";import{b as pt,u as ht}from"./hooks-S-v_XTx9.js";import{S as ce}from"./index-CBw2xBsv.js";import{S as xt}from"./index-uWqjchGm.js";import"./generate-lzB-bYh5.js";function le(e){return[u.useRef(e).current]}function ie(e,n){const o=n(),s=x(()=>{!e||!o||Object.keys(o).forEach(r=>{e[r]=o[r]})});u.useEffect(s,[o,s])}const J="default_source_handle",G="default_target_handle",U="start-id",ft={id:U,type:"start",data:{formData:{}},position:{x:0,y:0}},de=e=>{const n=new Map;for(const o of e){const s=o.source,r=n.get(s)||[];n.set(s,[...r,o])}return n},_t=(e,n="")=>({id:L(),source:e,target:n,sourceHandle:J,targetHandle:G}),jt=e=>{const n=[];for(const o of e){n.push(o);const s=o.target;e.find(r=>r.source===s)||n.push(_t(s))}return n};function gt(e){e=jt(e);const n=e.find(a=>a.source===U);if(!n)return e;const o=de(e),s=[n];let r=n.target;const c=a=>o.get(a)||[];for(;c(r).length;){const[a]=c(r);s.push(a),r=a.target;const l=c(r).filter(i=>i.id!==a.id);o.set(r,l)}for(const a of e)s.some(l=>l.id===a.id)||s.push(a);return s.filter(a=>a.source!==U)}const bt=e=>[...de(e)].map(([o,s])=>{const[r]=s,c=r.target,a={id:o};let l=[];return s.forEach(i=>{const d=i.target,m=i.sourceHandle;m===J?a.nextStep=d:l.push({condition:m,nextStep:d})}),l.length?a.conditions=l:a.nextStep=c,a});function Z(e){const n=new Map,o=e.nodes||[],s=e.edges||[];for(const l of o)n.set(l.id,l);const r=gt(s),c=bt(r),a=l=>n.get(l);return c.map(l=>{const i=a(l.id),d=i==null?void 0:i.data,{branch:m,...f}={...d==null?void 0:d.formData},p={...l,type:i==null?void 0:i.type,formData:f};if(m!=null&&m.length){const h=l.conditions||[];p.conditions=m.map(_=>{const g=_.value,N=h.find(M=>M.condition===g);return{label:_.label,condition:_.value,nextStep:N==null?void 0:N.nextStep}})}return d!=null&&d.details&&(p.details=Z(d==null?void 0:d.details)),p})}const yt=e=>{var r;const n=[],s=Z(e).filter(c=>!c.nextStep);for(const c of s)(r=c.conditions)!=null&&r.length&&c.conditions.forEach(a=>{a.nextStep||n.push({label:a.label,value:a.condition})});return n},ue=u.createContext({}),me=u.createContext({}),Nt=()=>le({getData:()=>null}),pe=()=>le({getData:()=>null}),b=()=>u.useContext(ue),he=()=>u.useContext(me),xe=()=>{const e=O(),{openDetail:n}=b(),{addEdges:o,addNodes:s,getNodes:r}=A(),c=x(()=>{var f;const i=r().find(p=>p.id===e);let d=(i==null?void 0:i.position.x)||0;const m=(i==null?void 0:i.position.y)||0;return d=d+(((f=i==null?void 0:i.measured)==null?void 0:f.width)||0)+80,{x:d,y:m}});return[x(l=>{const i=L(),d=l.triggerId,m=l.nodeType;s({id:i,data:l,type:m,position:c()}),e&&o({id:L(),source:e,target:i,sourceHandle:d,targetHandle:G}),m==="step"&&n(i)})]},vt=()=>{const{detailId:e}=b();return te().find(o=>o.id===e)},wt=()=>{const e=vt();return e==null?void 0:e.data};function Ct(){const e=O(),n=Ee(e);return n==null?void 0:n.data}function w(){const e=Ct();return e==null?void 0:e.formData}const Ft="_form_svv3s_1",St={form:Ft},Tt=e=>{var r;const{onSubmit:n}=e,[o]=pt(),[s]=K.useForm();return ht(async()=>{const c=await(s==null?void 0:s.validateFields());c&&await n(c),o()}),t.jsx(K,{form:s,submitter:!1,className:St.form,initialValues:e.formData,children:(r=e.children)==null?void 0:r.call(e,s)})},fe=e=>{const{children:n,onSubmit:o,formData:s,...r}=e;return t.jsx(dt,{...r,children:t.jsx(Tt,{formData:s,onSubmit:o,children:n})})},It="_wrapper_fmhpg_4",Et="_tools_fmhpg_4",kt="_tool_item_fmhpg_15",Dt="_inner_fmhpg_26",$t="_content_fmhpg_34",Pt="_handle_fmhpg_38",Wt="_handle_source_fmhpg_39",qt="_branch_fmhpg_59",At="_branch_item_fmhpg_63",Rt="_branch_label_fmhpg_71",j={wrapper:It,tools:Et,tool_item:kt,inner:Dt,content:$t,handle:Pt,handle_source:Wt,branch:qt,branch_item:At,branch_label:Rt},Mt=e=>{const{nodeId:n,tools:o}=e,{editForm:s}=o,{top:r}=he(),{openDetail:c}=b(),{setNodes:a,updateNodeData:l}=A(),i=w(),d=x(()=>{a(h=>h.filter(_=>_.id!==n))}),m=x(async h=>{l(n,{formData:h})}),f=x(()=>{c(n)}),p=h=>s?t.jsx(fe,{centered:!0,okText:"Save",destroyOnHidden:!0,trigger:h,formData:i,width:s.width,onSubmit:m,title:s.title||"Edit Node",children:_=>t.jsx(s.Component,{form:_})}):null;return t.jsxs(ke,{size:16,children:[r&&t.jsx("div",{onClick:f,className:j.tool_item,children:t.jsx(De,{})}),p(t.jsx("div",{className:j.tool_item,children:t.jsx(Pe,{})})),t.jsx("div",{onClick:d,className:j.tool_item,children:t.jsx($e,{})})]})},Bt="_atom_node_fh105_1",Ht="_atom_icon_fh105_11",Lt="_atom_content_fh105_21",Ut="_atom_title_fh105_24",Vt="_atom_desc_fh105_30",I={atom_node:Bt,atom_icon:Ht,atom_content:Lt,atom_title:Ut,atom_desc:Vt},ee=e=>{const{Icon:n,...o}=e;return t.jsxs("div",{onClick:e.onClick,className:I.atom_node,children:[t.jsx("div",{className:I.atom_icon,children:t.jsx(n,{})}),t.jsxs("div",{className:I.atom_content,children:[t.jsx("div",{className:I.atom_title,children:o.title}),t.jsx("div",{className:I.atom_desc,children:o.desc})]})]})},Ot=e=>{const{triggerId:n,onChange:o,closeDrawer:s}=e,r=te(),{top:c}=he();return t.jsx(u.Fragment,{children:Fe.filter(a=>a.limit!==void 0?r.filter(i=>i.type===a.type).length<a.limit:c?a.top:!a.top).map(a=>{const{type:l,Component:i,...d}=a,m=i.Icon,f=i.Form,p=async(h={})=>{s(),o==null||o({nodeType:l,triggerId:n,formData:h})};return f?t.jsx(fe,{centered:!0,okText:"Add Node",onSubmit:p,width:i.modalWdith,title:`Add ${d.title} Node`,children:h=>t.jsx(f,{form:h}),trigger:t.jsx(ee,{...d,Icon:m})},l):u.createElement(ee,{...d,Icon:m,key:l,onClick:p})})})},_e=e=>{const{children:n,...o}=e,{open:s,trigger:r,onClose:c}=ut(n);return t.jsxs(t.Fragment,{children:[r,t.jsx(We,{open:s,destroyOnHidden:!0,onClose:c,rootClassName:"shopify",title:"What triggers this workflow?",children:t.jsx(Ot,{...o,closeDrawer:c})})]})},Xt=e=>{const{branch:n=[]}=e,o=s=>t.jsx(_e,{triggerId:s,onChange:e.onChange,children:t.jsx(ne,{id:s,type:"source",position:se.Right,className:j.handle_source})});return n.length?t.jsx("div",{className:j.branch,children:n.map(s=>t.jsxs("div",{className:j.branch_item,children:[t.jsx("div",{className:j.branch_label,children:s.label}),o(s.value)]},s.value))}):o(J)},C=e=>{const{tools:n,branch:o=[],enableHandle:s}=e,{source:r=!0,target:c=!0}=s||{},a=O(),[l]=xe();return t.jsxs("div",{className:j.wrapper,children:[t.jsx("div",{className:j.tools,children:!!n&&a&&t.jsx(Mt,{nodeId:a,tools:n})}),t.jsxs("div",{className:j.inner,children:[c&&t.jsx(ne,{type:"target",id:G,position:se.Left,className:j.handle,isConnectableStart:!1}),t.jsx("div",{className:j.content,children:e.children}),r&&t.jsx(Xt,{branch:o,onChange:l})]})]})},Yt="_title_1tfkx_1",zt="_description_1tfkx_6",B={title:Yt,description:zt},T=e=>t.jsxs("div",{className:B.node_desc,children:[t.jsx("div",{className:B.title,children:e.title}),t.jsx("div",{className:B.description,children:e.desc})]}),Jt=e=>{const{inputParams:n=[]}=e;return n.map(o=>{const s=o.options,r={label:o.label,name:o.name,disabled:o.disabled,readonly:o.readonly,initialValue:o.initialValue,rules:[{required:o.required}]};return t.jsx(u.Fragment,{children:s!=null&&s.length?t.jsx(E,{...r,options:s}):t.jsx(y,{...r})},o.name)})},je=()=>{const{uiComponents:e=[]}=b(),n=e.map(o=>({label:o.componentName,value:o.componentTag}));return t.jsxs(u.Fragment,{children:[t.jsx(E,{label:"Component",name:"name",options:n,rules:[{required:!0}]}),t.jsx(S,{label:"Text",name:"text",rules:[{required:!0}]}),t.jsx(X,{name:["name"],children:({name:o})=>{const s=e.find(r=>r.componentTag===o);return t.jsx(Jt,{inputParams:s==null?void 0:s.input})}})]})},k=()=>{const e=w(),{uiComponents:n=[]}=b(),o=n.find(s=>s.componentTag===(e==null?void 0:e.name));return t.jsx(C,{tools:{editForm:{Component:je,title:"Edit Ui node",width:k.modalWdith}},children:t.jsx(T,{title:o==null?void 0:o.componentName,desc:e==null?void 0:e.text})})};k.Form=je;k.modalWdith=400;k.Icon=qe;const Gt="_container_12b9h_1",Zt="_icon_12b9h_7",Kt="_text_12b9h_12",H={container:Gt,icon:Zt,text:Kt},ge=()=>t.jsx(C,{enableHandle:{target:!1},children:t.jsxs("div",{className:H.container,children:[t.jsx("div",{className:H.icon,children:t.jsx(oe,{})}),t.jsx("div",{className:H.text,children:"Start"})]})});ge.Icon=oe;const be=()=>t.jsxs(u.Fragment,{children:[t.jsx(y,{name:"name",label:"Name",rules:[{required:!0}]}),t.jsx(S,{label:"Text",name:"text",rules:[{required:!1}]}),t.jsx(R,{label:"Condition",name:"branch",children:t.jsxs(Y,{gutter:16,children:[t.jsx(F,{span:12,children:t.jsx(y,{label:"Label",name:"label",rules:[{required:!0}]})}),t.jsx(F,{span:12,children:t.jsx(y,{label:"Value",name:"value",rules:[{required:!0}]})})]})})]}),D=()=>{const e=w();return t.jsx(C,{branch:e==null?void 0:e.branch,tools:{editForm:{width:D.modalWdith,title:"Edit Branch node",Component:be}},children:t.jsx(T,{title:e==null?void 0:e.name,desc:e==null?void 0:e.text})})};D.Form=be;D.modalWdith=400;D.Icon=Ae;var ye=(e=>(e.Prompt="prompt",e.Text="text",e))(ye||{});const V={prompt:"Prompt",text:"Text"},Ne=()=>t.jsxs(u.Fragment,{children:[t.jsx(Re.Group,{label:"Type",name:"type",initialValue:ye.Prompt,valueEnum:V,rules:[{required:!0}]}),t.jsx(X,{name:["type"],children:({type:e})=>e?t.jsx(S,{label:V[e],name:"text",rules:[{required:!0}]}):null})]}),$=()=>{const e=w(),n=e==null?void 0:e.type;return t.jsx(C,{tools:{editForm:{width:$.modalWdith,title:"Edit Prompt node",Component:Ne}},children:t.jsx(T,{title:n&&V[n],desc:e==null?void 0:e.text})})};$.Form=Ne;$.modalWdith=360;$.Icon=Me;const ve=()=>{const{actions:e=[],transformTools:n}=b(),o=u.useMemo(()=>e.map(s=>({value:s.name,label:s.description})),[e]);return t.jsxs(u.Fragment,{children:[t.jsx(E,{label:"Action",name:"type",options:o,rules:[{required:!0}]}),t.jsx(S,{label:"Text",name:"text",rules:[{required:!1}]}),t.jsx(X,{name:["type"],children:({type:s})=>s?t.jsxs(u.Fragment,{children:[t.jsx(Be,{children:"Transform"}),t.jsx(E,{label:"Type",name:["transform","type"],options:n,rules:[{required:!0}]}),t.jsx(R,{name:"attrs",required:!0,label:"Attributes",creatorButtonProps:{creatorButtonText:"Add Attribute"},children:t.jsx(y,{name:"attr",width:"md",rules:[{required:!0}]})})]}):null})]})},P=()=>{const{actions:e=[]}=b(),n=w(),o=u.useMemo(()=>e.find(s=>(n==null?void 0:n.type)===s.name),[e,n==null?void 0:n.type]);return t.jsx(C,{tools:{editForm:{Component:ve,title:"Edit Action node",width:P.modalWdith}},children:t.jsx(T,{title:o==null?void 0:o.name,desc:n==null?void 0:n.text})})};P.Form=ve;P.modalWdith=400;P.Icon=He;const we=()=>{const{transformTools:e=[]}=b();return t.jsxs(u.Fragment,{children:[t.jsx(E,{options:e,label:"Type",name:"type",rules:[{required:!0}]}),t.jsx(S,{label:"Text",name:"text",rules:[{required:!0}]}),t.jsx(R,{name:"attrs",label:"Attributes",creatorButtonProps:{creatorButtonText:"Add Attribute"},children:t.jsxs(Y,{gutter:16,children:[t.jsx(F,{span:12,children:t.jsx(y,{label:"From",name:"from",rules:[{required:!0}]})}),t.jsx(F,{span:12,children:t.jsx(y,{label:"To",name:"to",rules:[{required:!0}]})})]})})]})},W=()=>{const{transformTools:e=[]}=b(),n=w(),o=u.useMemo(()=>e.find(s=>s.value===(n==null?void 0:n.type)),[e,n==null?void 0:n.type]);return t.jsx(C,{tools:{editForm:{width:W.modalWdith,title:"Edit Transform node",Component:we}},children:t.jsx(T,{title:o==null?void 0:o.label,desc:n==null?void 0:n.text})})};W.Form=we;W.modalWdith=450;W.Icon=Le;const Ce=()=>t.jsxs(u.Fragment,{children:[t.jsx(y,{label:"Name",name:"name",rules:[{required:!0}]}),t.jsx(S,{label:"Description",name:"description",rules:[{required:!1}]}),t.jsx(R,{label:"Condition",name:"branch",children:t.jsxs(Y,{gutter:16,children:[t.jsx(F,{span:12,children:t.jsx(y,{label:"Label",name:"label",rules:[{required:!0}]})}),t.jsx(F,{span:12,children:t.jsx(y,{label:"Value",name:"value",rules:[{required:!0}]})})]})})]}),q=()=>{const e=w();return t.jsx(C,{branch:e==null?void 0:e.branch,tools:{editForm:{Component:Ce,title:"Edit Step node",width:q.modalWdith}},children:t.jsx(T,{title:e==null?void 0:e.name,desc:e==null?void 0:e.description})})};q.Form=Ce;q.modalWdith=380;q.Icon=Ue;const Fe=[{limit:1,top:!0,type:"start",title:"Start",desc:"The starting node of a workflow.",Component:ge},{top:!0,type:"step",title:"Step",desc:"Execute the corresponding process according to the different branches created.",Component:q},{type:"ui",title:"UI",desc:"The UI components within the AI assistant can be used as a data source to obtain data.",Component:k},{type:"branch",title:"Branch",desc:"Execute the corresponding process according to the different branches created.",Component:D},{type:"prompt",title:"Prompt",desc:"Prompt the AI what to do or say.",Component:$},{type:"action",title:"Action",desc:"Execute the corresponding process according to the different branches created.",Component:P},{type:"transform",title:"Transform",desc:"Convert the input data.",Component:W}],Qt=e=>{const{stroke:n}=e;return t.jsx("defs",{children:t.jsx("marker",{id:e.id,refX:"0",refY:"0",markerWidth:"12.5",markerHeight:"12.5",viewBox:"-10 -10 20 20",markerUnits:"strokeWidth",orient:"auto-start-reverse",style:{stroke:n,fill:n,strokeWidth:1},children:t.jsx("polyline",{strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})})})},en="_del_btn_7471i_1",tn={del_btn:en},nn=e=>{const{id:n,selected:o,sourceX:s,sourceY:r,targetX:c,targetY:a,sourcePosition:l,targetPosition:i}=e,{setEdges:d}=A(),[m,f,p]=Ve({sourceX:s,sourceY:r,targetX:c,targetY:a}),h=u.useMemo(()=>`translate(-50%, -50%) 
      translate(${f}px,${p}px)`,[f,p]),_=o?"#f40":"#0143EC",g=x(()=>{d(N=>N.filter(M=>M.id!==n))});return t.jsxs(u.Fragment,{children:[t.jsx(Qt,{stroke:_,id:n}),t.jsx(Oe,{sourceX:s,sourceY:r,targetX:c,targetY:a,markerEnd:`url(#${n})`,sourcePosition:l,targetPosition:i,style:{stroke:_,strokeWidth:2}}),t.jsx(Xe,{children:o?t.jsx("div",{style:{transform:h},onClick:g,className:tn.del_btn,children:t.jsx(re,{})}):null})]})},sn={"step-edge":nn},on="_add_button_1ocve_1",rn={add_button:on},an=()=>{const[e]=xe();return t.jsx(_e,{onChange:e,children:t.jsx("div",{className:rn.add_button,children:t.jsx(Ye,{})})})},cn=e=>{const{fromX:n,fromY:o,toX:s,toY:r}=e,c=(n+s)/2,a=`M${n},${o} H${c} V${r} H${s}`;return t.jsxs("g",{children:[t.jsx("path",{fill:"none",stroke:"#0143EC",strokeWidth:2,className:"animated",d:a}),t.jsx("circle",{cx:s,cy:r,fill:"#fff",r:3,stroke:"#0143EC",strokeWidth:2})]})},ln=Fe.reduce((e,n)=>({...e,[n.type]:n.Component}),{}),Se=e=>{const{canvas:n,top:o=!0,defaultNodes:s=[],defaultEdges:r=[]}=e,c=u.useMemo(()=>s.length?s:[Q(ft)],[s]),[a,l,i]=ze(r),[d,m,f]=Je(c),p=a.map(g=>({...g,type:"step-edge"})),h=x(g=>l(N=>Ge(g,N))),_=x(()=>Q({edges:a,nodes:d,_v_:1}));return ie(n,()=>({getData:_})),t.jsx(me,{value:{top:o},children:t.jsxs(Ze,{fitView:!0,minZoom:.5,nodes:d,edges:p,edgeTypes:sn,nodeTypes:ln,onConnect:h,onNodesChange:f,onEdgesChange:i,onBeforeDelete:async g=>!g.nodes.length,connectionLineComponent:cn,children:[t.jsx(Ke,{size:2,color:"#ccc",bgColor:"#f6f6f6"}),t.jsx(Qe,{}),t.jsx(an,{})]})})},dn="_detail_1hmmw_1",un="_show_1hmmw_14",mn="_layer_1hmmw_19",pn="_layer_content_1hmmw_25",hn="_layer_header_1hmmw_28",xn="_close_btn_1hmmw_33",fn="_title_1hmmw_46",v={detail:dn,show:un,layer:mn,layer_content:pn,layer_header:hn,close_btn:xn,title:fn},_n=()=>{var p;const e=wt(),[n]=pe(),{updateNodeData:o}=A(),[s,r]=et.useModal(),{closeDetail:c,detailId:a}=b(),l=e==null?void 0:e.details,i=l==null?void 0:l.nodes,d=l==null?void 0:l.edges,m=x(()=>{const h=n.getData(),_=yt(h),g={...e==null?void 0:e.formData,branch:_};o(a,{details:h,formData:g}),c()}),f=x(()=>{s.confirm({title:"Are you sure you want to leave?",content:"The data on this page will be lost after leaving.",okText:"Yes",okButtonProps:{className:"shopify"},cancelButtonProps:{className:"shopify"},onOk:c})});return t.jsxs("div",{className:v.layer,children:[t.jsxs("div",{className:v.layer_header,children:[t.jsx("div",{onClick:f,className:v.close_btn,children:t.jsx(re,{})}),t.jsx("div",{className:v.title,children:(p=e==null?void 0:e.formData)==null?void 0:p.name}),t.jsx(ce,{type:"primary",onClick:m,children:"Save"})]}),t.jsx("div",{className:v.layer_content,children:t.jsx(ae,{children:t.jsx(Se,{top:!1,canvas:n,defaultNodes:i,defaultEdges:d})})}),r]})},jn=()=>{const{detailId:e}=b(),[n,o]=z(!1),s=x(()=>o(!0)),r=x(()=>o(!1));tt(()=>{e?s():setTimeout(r,400)},[e]);const c=nt(v.detail,!!e&&v.show);return t.jsx("div",{className:c,children:n&&t.jsx(_n,{})})},gn=e=>{const{children:n,...o}=e,[s,r]=z(),c=x(l=>{r(l)}),a=x(()=>{r(void 0)});return t.jsx(ue.Provider,{value:{...o,detailId:s,openDetail:c,closeDetail:a},children:n})},bn=e=>{const[n]=pe(),o=x(()=>{const s=n.getData();return{realDetails:s,assembleData:Z(s)}});return ie(e.flow,()=>({getData:o})),t.jsx(ae,{children:t.jsxs(gn,{...e,children:[t.jsx(Se,{...e,canvas:n}),t.jsx(jn,{})]})})},yn=(e={})=>Object.keys(e).reduce((n,o)=>{var r,c;let s=(r=e[o])==null?void 0:r.value;if(o==="conditions"){o="branch";const a=s;s=(c=a==null?void 0:a.map)==null?void 0:c.call(a,l=>({label:l.condition,value:l.condition}))}return{...n,[o]:s}},{}),Te=e=>{if(e!=null&&e._v_)return e;let n=(e==null?void 0:e.nodes)||[];return n=n.map(o=>{var r;const s=(r=o==null?void 0:o.data)==null?void 0:r.values;return{...o,data:{nodeType:s==null?void 0:s.nodeType,formData:yn(s==null?void 0:s.formData),details:Te(s==null?void 0:s.stepRealData)}}}),{...e,nodes:n}},Nn=e=>e.map(n=>({componentName:n.tag_name,componentTag:n.tag_name,componentId:n.ui_component_uuid,componentType:n.ui_component_type,input:n.parameters.map(o=>{let s=o.parameter;return s&&(s=`{${s}}`),{required:!0,label:o.name,name:o.name,initialValue:s}})})),vn=e=>e.reduce((o,s)=>[...o,...s.tools],[]).map(o=>({name:o.name,description:o.description})),wn=()=>[{label:"Summarize",value:"summarize"},{label:"Full content",value:"full_content"},{label:"Structure input",value:"structure_input"}],Cn="_loading_1cv3a_1",Fn="_container_1cv3a_7",Ie={loading:Cn,container:Fn},Sn=e=>{const{promptTemplate:n,flowRelationship:o}=e.detail,s=vn(n.mcp_servers),r=wn(),c=Nn(n.ui_components),a=u.useMemo(()=>{const l=o?JSON.parse(o):{};return Te(l)},[o,c]);return t.jsx(st,{className:"shopify full-content",children:t.jsx("div",{className:Ie.container,children:t.jsx(bn,{flow:e.flow,actions:s,uiComponents:c,transformTools:r,defaultEdges:a.edges,defaultNodes:a.nodes})})})};function An(){var i;const{message:e}=ot.useApp(),[n]=Nt(),o=rt(),[s,r]=z(!1),{data:c}=at(async()=>(await lt({flowSnippetUuid:o.uid,flowSnippetVersionUuid:o.vid})).flowSnippet),a=(i=c==null?void 0:c.promptTemplate)==null?void 0:i.prompt_uuid,l=x(async()=>{const d=n.getData();r(!0),await it({...c,promptUuid:a,flowContext:JSON.stringify(d.assembleData),flowRelationship:JSON.stringify(d.realDetails)}),e.success("Workflow saved successfully"),r(!1)});return t.jsx(ct,{title:c==null?void 0:c.flowName,className:"shopify full-screen",loading:!c&&t.jsx("div",{className:Ie.loading,children:t.jsx(mt,{size:36})}),extra:c?t.jsx(ce,{type:"primary",className:"shopify",onClick:l,children:"Save"}):null,children:t.jsx(xt,{loading:s,children:!!c&&t.jsx(Sn,{flow:n,detail:c})})})}export{An as default};
