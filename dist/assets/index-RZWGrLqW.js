import{m as A,u as h,ai as x,ak as L,j as e,P as C,al as q,aj as P,B as F,o as I,b as U,h as y,p as _,v as j,am as B,n as M,d as E,S as R,a7 as z}from"./libs-Clw9C49h.js";import{c as Y}from"./index-CyTaOGOS.js";import{T as b}from"./index-g0lC1wlR.js";import{p as N}from"./index-D3QcqB_5.js";import{u as O}from"./hooks-V0qdfiJ4.js";import{g as k,i as T}from"./agent-BmW5UuWT.js";import{g as W}from"./llm-C7Zm3VEz.js";import"./index-DxFRfNm6.js";import"./request-BPdAPW8d.js";import"./generate-C1aCBGPy.js";const H=u=>{const[r,s]=A(!1),t=h(async()=>{const{agentList:n}=await k({limit:5,pageNumber:1,agentUuid:u.agentUuid});return{total:n.total,data:n.agentList}}),a=h(async n=>{n.documentSource.data_source_name;try{x.success("Deleted successfully.")}catch{x.error("Deleted failed.")}});return L(t),e.jsx(C,{rowKey:"agentVersionUuid",search:!1,toolBarRender:!1,request:t,className:"shopify",columns:[{dataIndex:"agentVersionUuid",title:"Agent Version Uuid"},{dataIndex:"status",title:"Status",render:(n,i,f,o)=>{var d;const c=((d=o==null?void 0:o.pageInfo)==null?void 0:d.total)||0,l=i.status==="active",m=l&&c<=1;return e.jsx(q,{checked:l,disabled:m,loading:r,onChange:async g=>{s(!0);try{await T({updatedBy:i.updatedBy,agentUuid:i.agentUuid,agentVersionUuid:i.agentVersionUuid,status:g?"active":"inactive"}),o==null||o.reload()}catch(p){console.error(p)}finally{s(!1)}}})}},{width:70,dataIndex:"action",title:"Action",render:(n,i)=>e.jsx(P,{okText:"Delete",okType:"danger",title:"Are you sure you want to delete this version?",onConfirm:()=>a(i),children:e.jsx(F,{danger:!0,type:"link",disabled:i.status==="active",children:"Delete"})})}]})},S=u=>JSON.stringify(u,null,2),J=()=>{const[u,r]=A([]),[s,t]=A(!0),a=h(async()=>{const{llmList:n}=await W({pageNumber:1,limit:1e3}),f=((n==null?void 0:n.llmList)||[]).map(o=>({label:o.llmName,value:S({llmName:o.llmName,llmProvider:o.llmProvider})}));r(f),t(!1)});return L(a),[u,s]},K="_container_1wk1t_1",$={container:K},w=u=>{const{insert:r=!0,formData:s,onSuccess:t}=u,[a]=I.useForm(),[n,i]=J(),f=U.useMemo(()=>{if(!s)return;let c=s.llm,l=s.functions,m=s.configuration,d=s.functionConfiguration;return c&&(c=S({llmName:c.llm_name,llmProvider:c.llm_provider})),l&&(l=S(l)),m&&(m=S(m)),d&&(d=S(d)),{...s,llm:c,functions:l,configuration:m,functionConfiguration:d,status:s.status==="active"}},[s]),o=h(async()=>{const c=await a.validateFields();let{llm:l,status:m,functions:d,configuration:g,functionConfiguration:p,...V}=c;l&&(l=N(l)),d&&(d=N(d)),g&&(g=N(g)),p&&(p=N(p));try{const v={...V,...l,functions:d,configuration:g,status:m?"active":"inactive",functionConfiguration:p,updatedBy:"admin"};await T(v),t==null||t(),x.success(`${r?"Created":"Updated"} successfully.`)}catch(v){return x.error(`${r?"Creation":"Updated"} failed.`),Promise.reject(v)}});return O(o),e.jsx("div",{className:$.container,children:e.jsxs(I,{form:a,submitter:!1,labelAlign:"left",layout:"horizontal",initialValues:f,labelCol:{flex:"160px"},children:[e.jsxs(y,{className:"shopify",children:[e.jsx(_,{label:"Llm",name:"llm",options:n,fieldProps:{loading:i},rules:[{required:!0}]}),!r&&e.jsx(_,{readonly:!0,name:"agentUuid",label:"Agent Uuid",rules:[{required:!0}]}),e.jsx(j,{label:"Agent Name",name:"agentName",rules:[{required:!0}]}),e.jsx(j,{label:"Instructions",name:"instructions",fieldProps:{cols:6},rules:[{required:!0}]}),e.jsx(B,{label:"Status",name:"status"})]}),e.jsx(y,{title:"Configuration",className:"shopify",children:e.jsx(j,{name:"configuration"})}),e.jsx(y,{title:"Function Configuration",className:"shopify",children:e.jsx(j,{name:"functionConfiguration"})}),e.jsx(y,{title:"Functions",className:"shopify",children:e.jsx(j,{name:"functions"})}),!r&&e.jsx(y,{title:"Versions",className:"shopify",children:e.jsx(H,{agentUuid:s==null?void 0:s.agentUuid})})]})})},D=600,re=()=>{const u=U.useRef(null),r=h(()=>{var t;(t=u.current)==null||t.reload()}),s=h(async t=>{try{r(),x.success("Deleted successfully.")}catch{x.error("Deleted failed.")}});return e.jsx(M,{className:"shopify",children:e.jsx(C,{options:!1,actionRef:u,className:"shopify",rowKey:"agentVersionUuid",search:{labelWidth:"auto",optionRender:(t,a,n)=>n.map(i=>U.cloneElement(i,{className:"shopify"}))},scroll:{x:"max-content"},request:async t=>{const{pageSize:a,current:n,...i}=t,{agentList:f}=await k({...i,limit:a,pageNumber:n,statuses:["active"]});return{total:f.total,data:f.agentList}},toolbar:{actions:[e.jsx(b,{okText:"Save",title:"Add Agent",width:D,trigger:e.jsx(F,{type:"primary",children:"Add",className:"shopify",icon:e.jsx(z,{})}),children:e.jsx(w,{onSuccess:r})},"add")]},columns:[{title:"Agent Name",dataIndex:"agentName",hideInSearch:!1},{title:"Agent Uuid",dataIndex:"agentUuid",hideInSearch:!1},{title:"Status",dataIndex:"status",hideInSearch:!0},{title:"Llm Provider",dataIndex:"llm_provider",hideInSearch:!0,render:(t,a)=>a.llm.llm_provider},{title:"Llm Name",dataIndex:"llm_name",hideInSearch:!0,render:(t,a)=>a.llm.llm_name},{title:"Updated At",dataIndex:"updatedAt",hideInSearch:!0,render:(t,a)=>E(a.updatedAt).format("YYYY/MM/DD HH:mm:ss")},{title:"Updated By",dataIndex:"updatedBy",hideInSearch:!0},{fixed:"right",width:100,title:"Actions",dataIndex:"actions",hideInSearch:!0,render:(t,a)=>e.jsxs(R,{size:16,children:[e.jsx(b,{okText:"Save",width:D,title:"Edit Agent",trigger:e.jsx("a",{children:"Edit"}),children:e.jsx(w,{insert:!1,onSuccess:r,formData:Y(a)})},"add"),e.jsx(P,{okText:"Delete",okType:"danger",title:"Are you sure you want to delete it?",onConfirm:()=>s(a.questionUuid),children:e.jsx("a",{className:"danger",children:"Delete"})})]})}]})})};export{re as default};
