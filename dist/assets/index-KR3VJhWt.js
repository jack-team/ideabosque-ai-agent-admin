import{q as u,A as f,j as e,W as w,s as x,b as k,u as y,P as A,T as v,S as C,t as F,p as N}from"./libs-DKvGRd2v.js";import{f as m}from"./index-hLuO1L00.js";import{T as h}from"./index-BVeCJB01.js";import{S as d}from"./index-O1RFasQ-.js";import{g as S,h as T,j as U}from"./workflow-v4leCDxK.js";import{S as b}from"./index-BFNJ2dAV.js";import{c as P,d as W}from"./useFetchData-D6kGbjfh.js";import{b as V,u as g}from"./hooks-D-cV3eAe.js";import{S as c}from"./enum-Ct7sVdAK.js";import"./generate-DahBUJdW.js";import"./wizard-Dw4k91bU.js";const O=s=>{const{formData:o}=s,[i]=u.useForm(),{message:r}=f.useApp(),[a]=V();g(async()=>{var p;const l=await i.validateFields();try{await S({...l,status:c.Active,updatedBy:"Admin"}),a(),(p=s.onSuccess)==null||p.call(s),r.success("The version has been applied successfully.")}catch{r.error("The version application failed.")}});const{data:t,loading:n}=P({statuses:[c.Active],flowSnippetUuid:o==null?void 0:o.flowSnippetUuid}),j=t==null?void 0:t.map(l=>({label:`${l.flowSnippetVersionUuid}(${l.flowName})`,value:l.flowSnippetVersionUuid}));return e.jsx(b,{loading:n,children:e.jsxs(u,{form:i,initialValues:o,submitter:!1,style:{padding:"24px 0 0 0"},children:[e.jsx(w,{hidden:!0,name:"flowSnippetUuid"}),e.jsx(x,{label:"Versions",name:"flowSnippetVersionUuid",options:j,fieldProps:{loading:n},rules:[{required:!0}]})]})})},_=s=>{const{modal:o}=f.useApp(),i=k.useRef(null),r=y(async a=>{o.confirm({rootClassName:"shopify",okButtonProps:{className:"shopify"},cancelButtonProps:{className:"shopify"},title:"Are you sure you want to delete this record?",onOk:async()=>{var t;await T(a),(t=i.current)==null||t.reload()}})});return e.jsx(A,{className:"shopify",options:!1,search:!1,actionRef:i,rowKey:"flowSnippetUuid",pagination:{pageSize:10},request:async()=>{const{flowSnippetList:a}=await U({pageNumber:1,limit:100,statuses:[c.Active]});return{total:a.total,data:a.flowSnippetList}},columns:[{title:"Workflow",dataIndex:"flowName"},{title:"Status",dataIndex:"status",render:(a,t)=>e.jsx(v,{children:t.status})},{title:"Create at",dataIndex:"createdAt",render:(a,t)=>m(t.createdAt)},{title:"Update at",dataIndex:"updatedAt",render:(a,t)=>m(t.updatedAt)},{key:"action",title:"Action",width:"160px",render:(a,t)=>e.jsxs(C,{children:[e.jsx(d,{size:"small",type:"primary",onClick:()=>{var n;return(n=s.onEdit)==null?void 0:n.call(s,t,"edit")},children:"Edit"}),e.jsx(h,{width:400,title:"Versions",destroyOnHidden:!0,okText:"Apply",trigger:e.jsx(d,{size:"small",children:"Versions"}),children:e.jsx(O,{formData:t})}),e.jsx(d,{danger:!0,size:"small",children:"Delete",onClick:()=>r(t)})]})}]})},q="_form_19wg4_1",B={form:q},E=s=>{const[o]=u.useForm(),{options:i,loading:r}=W();return g(async()=>{var n;const a=await o.validateFields(),{insertUpdateFlowSnippet:t}=await S({...a,updatedBy:"admin",flowContext:JSON.stringify({}),flowRelationship:JSON.stringify({})});(n=s.onSuccess)==null||n.call(s,t.flowSnippet)}),e.jsxs(u,{form:o,submitter:!1,className:B.form,children:[e.jsx(w,{label:"Workflow name",name:"flowName",rules:[{required:!0}]}),e.jsx(x,{label:"Template",name:"promptUuid",options:i,fieldProps:{loading:r},rules:[{required:!0}]})]})},X=()=>{const s=F(),o=y((i,r="new")=>{const{flowSnippetUuid:a,flowSnippetVersionUuid:t}=i;s(`/agent-workflows/detail/${a}/${t}?type=${r}`)});return e.jsx(N,{title:"Agent workflows",className:"shopify",extra:[e.jsx(d,{onClick:()=>s("/workflow-templates"),children:"Template Management"},"mange"),e.jsx(h,{width:400,destroyOnHidden:!0,title:"Create workflow",okText:"Create",trigger:e.jsx(d,{type:"primary",children:"Create workflow"}),children:e.jsx(E,{onSuccess:o})},"add")],children:e.jsx(_,{onEdit:o})})};export{X as default};
