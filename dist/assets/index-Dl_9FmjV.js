import{b as f,f as _,Q as Y,U as H,V as W,X as ke,Y as te,y as K,j as t,S as De,Z as $e,_ as Pe,$ as Ae,a0 as Re,a1 as ne,a2 as se,W as b,z as E,J as S,a3 as B,a4 as We,a5 as oe,K as q,n as re,o as M,a6 as Be,a7 as qe,a8 as Me,a9 as He,aa as Le,ab as Ve,ac as Ue,ad as Oe,ae as Xe,af as Ye,ag as ze,ah as Je,ai as Ge,aj as Ze,ak as Ke,al as Qe,am as et,an as tt,M as nt,ao as st,ap as ae,v as z,h as ot,aq as rt,p as at,A as ct,u as lt,H as it,e as dt,x as ut}from"./libs-D2z24ZcL.js";import{k as mt,g as pt}from"./workflow-Da-NFQV9.js";import{c as U}from"./index-Yq6-F7Ao.js";import{T as ht,u as xt}from"./index-CNaEO231.js";import{S as ft}from"./index-LAeRrPH_.js";import{b as _t,u as gt}from"./hooks-Cw9rG_sE.js";import{S as ce}from"./index-DhcjGQGn.js";import{S as jt}from"./index-CvIJyi1H.js";import{I as bt}from"./index-QK4s8deF.js";import"./generate-CER24DcL.js";function le(e){return[f.useRef(e).current]}function ie(e,n){const s=n(),o=_(()=>{!e||!s||Object.keys(s).forEach(a=>{e[a]=s[a]})});f.useEffect(o,[s,o])}const J="default_source_handle",G="default_target_handle",O="start-id",yt={id:O,type:"start",data:{formData:{}},position:{x:0,y:0}},de=f.createContext({}),ue=f.createContext({}),Nt=()=>le({getData:()=>null}),me=()=>le({getData:()=>null}),y=()=>f.useContext(de),pe=()=>f.useContext(ue),he=()=>{const e=Y(),{openDetail:n}=y(),{addEdges:s,addNodes:o,getNodes:a}=H(),c=_(()=>{var u;const i=a().find(p=>p.id===e);let d=(i==null?void 0:i.position.x)||0;const m=(i==null?void 0:i.position.y)||0;return d=d+(((u=i==null?void 0:i.measured)==null?void 0:u.width)||0)+80,{x:d,y:m}});return[_(l=>{const i=W(),d=l.triggerId,m=l.nodeType;o({id:i,data:l,type:m,position:c()}),e&&s({id:W(),source:e,target:i,sourceHandle:d,targetHandle:G}),m==="step"&&n(i)})]},vt=()=>{const{detailId:e}=y();return te().find(s=>s.id===e)},wt=()=>{const e=vt();return e==null?void 0:e.data};function Ct(){const e=Y(),n=ke(e);return n==null?void 0:n.data}function w(){const e=Ct();return e==null?void 0:e.formData}const St="_form_svv3s_1",Ft={form:St},It=e=>{var a;const{onSubmit:n}=e,[s]=_t(),[o]=K.useForm();return gt(async()=>{const c=await(o==null?void 0:o.validateFields());c&&await n(c),s()}),t.jsx(K,{form:o,submitter:!1,className:Ft.form,initialValues:e.formData,children:(a=e.children)==null?void 0:a.call(e,o)})},xe=e=>{const{children:n,onSubmit:s,formData:o,...a}=e;return t.jsx(ht,{...a,children:t.jsx(It,{formData:o,onSubmit:s,children:n})})},Tt="_wrapper_fmhpg_4",Et="_tools_fmhpg_4",kt="_tool_item_fmhpg_15",Dt="_inner_fmhpg_26",$t="_content_fmhpg_34",Pt="_handle_fmhpg_38",At="_handle_source_fmhpg_39",Rt="_branch_fmhpg_59",Wt="_branch_item_fmhpg_63",Bt="_branch_label_fmhpg_71",j={wrapper:Tt,tools:Et,tool_item:kt,inner:Dt,content:$t,handle:Pt,handle_source:At,branch:Rt,branch_item:Wt,branch_label:Bt},qt=e=>{const{nodeId:n,tools:s}=e,{editForm:o}=s,{top:a}=pe(),{openDetail:c}=y(),{setNodes:r,updateNodeData:l}=H(),i=w(),d=_(()=>{r(h=>h.filter(x=>x.id!==n))}),m=_(async h=>{l(n,{formData:h})}),u=_(()=>{c(n)}),p=h=>o?t.jsx(xe,{centered:!0,okText:"Save",destroyOnHidden:!0,trigger:h,formData:i,width:o.width,onSubmit:m,title:o.title||"Edit Node",children:x=>t.jsx(o.Component,{form:x})}):null;return t.jsxs(De,{size:16,children:[a&&t.jsx("div",{onClick:u,className:j.tool_item,children:t.jsx($e,{})}),p(t.jsx("div",{className:j.tool_item,children:t.jsx(Ae,{})})),t.jsx("div",{onClick:d,className:j.tool_item,children:t.jsx(Pe,{})})]})},Mt="_atom_node_fh105_1",Ht="_atom_icon_fh105_11",Lt="_atom_content_fh105_21",Vt="_atom_title_fh105_24",Ut="_atom_desc_fh105_30",T={atom_node:Mt,atom_icon:Ht,atom_content:Lt,atom_title:Vt,atom_desc:Ut},Q=e=>{const{Icon:n,...s}=e;return t.jsxs("div",{onClick:e.onClick,className:T.atom_node,children:[t.jsx("div",{className:T.atom_icon,children:t.jsx(n,{})}),t.jsxs("div",{className:T.atom_content,children:[t.jsx("div",{className:T.atom_title,children:s.title}),t.jsx("div",{className:T.atom_desc,children:s.desc})]})]})},Ot=e=>{const{triggerId:n,onChange:s,closeDrawer:o}=e,a=te(),{top:c}=pe();return t.jsx(f.Fragment,{children:Ce.filter(r=>r.limit!==void 0?a.filter(i=>i.type===r.type).length<r.limit:c?r.top:!r.top).map(r=>{const{type:l,Component:i,...d}=r,m=i.Icon,u=i.Form,p=async(h={})=>{o(),s==null||s({nodeType:l,triggerId:n,formData:h})};return u?t.jsx(xe,{centered:!0,okText:"Add Node",onSubmit:p,width:i.modalWdith,title:`Add ${d.title} Node`,children:h=>t.jsx(u,{form:h}),trigger:t.jsx(Q,{...d,Icon:m})},l):f.createElement(Q,{...d,Icon:m,key:l,onClick:p})})})},fe=e=>{const{children:n,...s}=e,{open:o,trigger:a,onClose:c}=xt(n);return t.jsxs(t.Fragment,{children:[a,t.jsx(Re,{open:o,destroyOnHidden:!0,onClose:c,rootClassName:"shopify",title:"What triggers this workflow?",children:t.jsx(Ot,{...s,closeDrawer:c})})]})},ee=e=>{const{id:n,onChange:s}=e;return t.jsx(fe,{triggerId:n,onChange:s,children:t.jsx(ne,{id:n,type:"source",position:se.Right,className:j.handle_source})})},Xt=e=>{const{branch:n=[],onChange:s}=e;return n.length?t.jsx("div",{className:j.branch,children:n.map(o=>t.jsxs("div",{className:j.branch_item,children:[t.jsx("div",{className:j.branch_label,children:o.label}),t.jsx(ee,{id:o.id,onChange:s})]},o.id))}):t.jsx(ee,{id:J,onChange:s})},C=e=>{const{tools:n,branch:s=[],enableHandle:o}=e,{source:a=!0,target:c=!0}=o||{},r=Y(),[l]=he();return t.jsxs("div",{className:j.wrapper,children:[t.jsx("div",{className:j.tools,children:!!n&&r&&t.jsx(qt,{nodeId:r,tools:n})}),t.jsxs("div",{className:j.inner,children:[c&&t.jsx(ne,{type:"target",id:G,position:se.Left,className:j.handle,isConnectableStart:!1}),t.jsx("div",{className:j.content,children:e.children}),a&&t.jsx(Xt,{branch:s,onChange:l})]})]})},Yt="_title_1tfkx_1",zt="_description_1tfkx_6",L={title:Yt,description:zt},F=e=>t.jsxs("div",{className:L.node_desc,children:[t.jsx("div",{className:L.title,children:e.title}),t.jsx("div",{className:L.description,children:e.desc})]}),Jt=e=>{const{inputParams:n=[]}=e;return n.map(s=>{const o=s.options,a={label:s.label,name:s.name,disabled:s.disabled,readonly:s.readonly,initialValue:s.initialValue,rules:[{required:s.required}]};return t.jsx(f.Fragment,{children:o!=null&&o.length?t.jsx(E,{...a,options:o}):t.jsx(b,{...a})},s.name)})},_e=e=>{const{uiComponents:n=[]}=y(),s=n.map(c=>({label:c.componentName,value:c.componentTag})),o=c=>n.find(r=>r.componentTag===c),a=_(c=>{var i,d;const r=o(c),l=(i=r==null?void 0:r.input)==null?void 0:i.reduce((m,u)=>({...m,[u.name]:u.initialValue}),{});(d=e.form)==null||d.setFieldsValue(l)});return t.jsxs(f.Fragment,{children:[t.jsx(E,{label:"Component",name:"name",options:s,rules:[{required:!0}],fieldProps:{onChange:a}}),t.jsx(S,{label:"Text",name:"text",rules:[{required:!0}]}),t.jsx(B,{name:["name"],children:({name:c})=>{const r=n.find(l=>l.componentTag===c);return t.jsx(Jt,{inputParams:r==null?void 0:r.input})}})]})},k=()=>{const e=w(),{uiComponents:n=[]}=y(),s=n.find(o=>o.componentTag===(e==null?void 0:e.name));return t.jsx(C,{tools:{editForm:{Component:_e,title:"Edit Ui node",width:k.modalWdith}},children:t.jsx(F,{title:s==null?void 0:s.componentName,desc:e==null?void 0:e.text})})};k.Form=_e;k.modalWdith=400;k.Icon=We;const Gt="_container_12b9h_1",Zt="_icon_12b9h_7",Kt="_text_12b9h_12",V={container:Gt,icon:Zt,text:Kt},ge=()=>t.jsx(C,{enableHandle:{target:!1},children:t.jsxs("div",{className:V.container,children:[t.jsx("div",{className:V.icon,children:t.jsx(oe,{})}),t.jsx("div",{className:V.text,children:"Start"})]})});ge.Icon=oe;const je=()=>{const e=f.useRef(void 0);return t.jsxs(f.Fragment,{children:[t.jsx(b,{name:"name",label:"Name",rules:[{required:!0}]}),t.jsx(S,{label:"Text",name:"text",rules:[{required:!1}]}),t.jsxs(q,{label:"Condition",name:"branch",copyIconProps:!1,actionRef:e,actionGuard:{beforeAddRow:()=>{var s;const n=W();return(s=e.current)==null||s.add({id:n}),!1}},children:[t.jsx(b,{name:"id",hidden:!0}),t.jsxs(re,{gutter:16,children:[t.jsx(M,{span:12,children:t.jsx(b,{label:"Label",name:"label",rules:[{required:!0}]})}),t.jsx(M,{span:12,children:t.jsx(b,{label:"Value",name:"value",rules:[{required:!0}]})})]})]})]})},D=()=>{const e=w();return t.jsx(C,{branch:e==null?void 0:e.branch,tools:{editForm:{width:D.modalWdith,title:"Edit Branch node",Component:je}},children:t.jsx(F,{title:e==null?void 0:e.name,desc:e==null?void 0:e.text})})};D.Form=je;D.modalWdith=400;D.Icon=Be;var be=(e=>(e.Prompt="prompt",e.Text="text",e))(be||{});const X={prompt:"Prompt",text:"Text"},ye=()=>t.jsxs(f.Fragment,{children:[t.jsx(qe.Group,{label:"Type",name:"type",initialValue:be.Prompt,valueEnum:X,rules:[{required:!0}]}),t.jsx(B,{name:["type"],children:({type:e})=>e?t.jsx(S,{label:X[e],name:"text",rules:[{required:!0}]}):null})]}),$=()=>{const e=w(),n=e==null?void 0:e.type;return t.jsx(C,{tools:{editForm:{width:$.modalWdith,title:"Edit Prompt node",Component:ye}},children:t.jsx(F,{title:n&&X[n],desc:e==null?void 0:e.text})})};$.Form=ye;$.modalWdith=360;$.Icon=Me;const Ne=()=>{const{actions:e=[],transformTools:n}=y(),s=f.useMemo(()=>e.map(a=>({value:a.name,label:a.description})),[e]),o=a=>n==null?void 0:n.find(c=>c.value===a);return t.jsxs(f.Fragment,{children:[t.jsx(E,{label:"Action",name:"type",options:s,rules:[{required:!0}]}),t.jsx(S,{label:"Text",name:"text",rules:[{required:!1}]}),t.jsx(B,{name:["type"],children:({type:a})=>a?t.jsxs(f.Fragment,{children:[t.jsx(He,{children:"Transform"}),t.jsx(q,{name:"transform",alwaysShowItemLabel:!0,className:"custom_form_list",creatorButtonProps:{creatorButtonText:"Add Transform"},children:(c,r,l)=>t.jsxs(t.Fragment,{children:[t.jsx(E,{label:"Type",name:"type",options:n,rules:[{required:!0}],fieldProps:{onChange(i){const d=o(i);l.setCurrentRowData({attrs:[],value:d==null?void 0:d.subValue})}}}),t.jsx(b,{hidden:!0,name:"value"}),t.jsx(B,{name:["attrs"],children:({attrs:i=[]})=>{const d=l.getCurrentRowData(),m=o(d.type),u=(m==null?void 0:m.maxAttrs)??100,p=i.length>=u;return t.jsx(q,{name:"attrs",label:"Attributes",alwaysShowItemLabel:!0,className:"custom_form_list",creatorButtonProps:{disabled:p,creatorButtonText:"Add Attribute"},children:t.jsx(b,{name:"attr",label:"Attribute",rules:[{required:!0}]})})}})]})})]}):null})]})},P=()=>{const{actions:e=[]}=y(),n=w(),s=f.useMemo(()=>e.find(o=>(n==null?void 0:n.type)===o.name),[e,n==null?void 0:n.type]);return t.jsx(C,{tools:{editForm:{Component:Ne,title:"Edit Action node",width:P.modalWdith}},children:t.jsx(F,{title:s==null?void 0:s.name,desc:n==null?void 0:n.text})})};P.Form=Ne;P.modalWdith=540;P.Icon=Le;const ve=()=>{const{transformTools:e=[]}=y();return t.jsxs(f.Fragment,{children:[t.jsx(E,{options:e,label:"Type",name:"type",rules:[{required:!0}]}),t.jsx(S,{label:"Text",name:"text",rules:[{required:!0}]}),t.jsx(q,{name:"attrs",label:"Attributes",creatorButtonProps:{creatorButtonText:"Add Attribute"},children:t.jsxs(re,{gutter:16,children:[t.jsx(M,{span:12,children:t.jsx(b,{label:"From",name:"from",rules:[{required:!0}]})}),t.jsx(M,{span:12,children:t.jsx(b,{label:"To",name:"to",rules:[{required:!0}]})})]})})]})},A=()=>{const{transformTools:e=[]}=y(),n=w(),s=f.useMemo(()=>e.find(o=>o.value===(n==null?void 0:n.type)),[e,n==null?void 0:n.type]);return t.jsx(C,{tools:{editForm:{width:A.modalWdith,title:"Edit Transform node",Component:ve}},children:t.jsx(F,{title:s==null?void 0:s.label,desc:n==null?void 0:n.text})})};A.Form=ve;A.modalWdith=450;A.Icon=Ve;const we=()=>t.jsxs(f.Fragment,{children:[t.jsx(b,{label:"Name",name:"name",rules:[{required:!0}]}),t.jsx(S,{label:"Description",name:"description",rules:[{required:!1}]}),t.jsx(b,{name:"branch",hidden:!0})]}),R=()=>{const e=w();return t.jsx(C,{branch:e==null?void 0:e.branch,tools:{editForm:{Component:we,title:"Edit Step node",width:R.modalWdith}},children:t.jsx(F,{title:e==null?void 0:e.name,desc:e==null?void 0:e.description})})};R.Form=we;R.modalWdith=380;R.Icon=Ue;const Ce=[{limit:1,top:!0,type:"start",title:"Start",desc:"The starting node of a workflow.",Component:ge},{top:!0,type:"step",title:"Step",desc:"Execute the corresponding process according to the different branches created.",Component:R},{type:"ui",title:"UI",desc:"The UI components within the AI assistant can be used as a data source to obtain data.",Component:k},{type:"branch",title:"Branch",desc:"Execute the corresponding process according to the different branches created.",Component:D},{type:"message",title:"Prompt",desc:"Prompt the AI what to do or say.",Component:$},{type:"action",title:"Action",desc:"Execute the corresponding process according to the different branches created.",Component:P},{type:"transform",title:"Transform",desc:"Convert the input data.",Component:A}],Qt=e=>{const{stroke:n}=e;return t.jsx("defs",{children:t.jsx("marker",{id:e.id,refX:"0",refY:"0",markerWidth:"12.5",markerHeight:"12.5",viewBox:"-10 -10 20 20",markerUnits:"strokeWidth",orient:"auto-start-reverse",style:{stroke:n,fill:n,strokeWidth:1},children:t.jsx("polyline",{strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})})})},en="_del_btn_7471i_1",tn={del_btn:en},nn=e=>{const{id:n,selected:s,sourceX:o,sourceY:a,targetX:c,targetY:r,sourcePosition:l,targetPosition:i}=e,{setEdges:d}=H(),[m,u,p]=Oe({sourceX:o,sourceY:a,targetX:c,targetY:r}),h=f.useMemo(()=>`translate(-50%, -50%) 
      translate(${u}px,${p}px)`,[u,p]),x=s?"#f40":"#0143EC",g=_(()=>{d(N=>N.filter(I=>I.id!==n))});return t.jsxs(f.Fragment,{children:[t.jsx(Qt,{stroke:x,id:n}),t.jsx(Xe,{sourceX:o,sourceY:a,targetX:c,targetY:r,markerEnd:`url(#${n})`,sourcePosition:l,targetPosition:i,style:{stroke:x,strokeWidth:2}}),t.jsx(Ye,{children:s?t.jsx("div",{style:{transform:h},onClick:g,className:tn.del_btn,children:t.jsx(ze,{})}):null})]})},sn={"step-edge":nn},on="_add_button_1ocve_1",rn={add_button:on},an=()=>{const[e]=he();return t.jsx(fe,{onChange:e,children:t.jsx("div",{className:rn.add_button,children:t.jsx(Je,{})})})},cn=e=>{const{fromX:n,fromY:s,toX:o,toY:a}=e,c=(n+o)/2,r=`M${n},${s} H${c} V${a} H${o}`;return t.jsxs("g",{children:[t.jsx("path",{fill:"none",stroke:"#0143EC",strokeWidth:2,className:"animated",d:r}),t.jsx("circle",{cx:o,cy:a,fill:"#fff",r:3,stroke:"#0143EC",strokeWidth:2})]})},ln=Ce.reduce((e,n)=>({...e,[n.type]:n.Component}),{}),Se=e=>{const{canvas:n,top:s=!0,defaultNodes:o=[],defaultEdges:a=[]}=e,c=f.useMemo(()=>o.length?o:[U(yt)],[o]),[r,l,i]=Ge(a),[d,m,u]=Ze(c),p=r.map(g=>({...g,type:"step-edge"})),h=_(g=>l(N=>Ke(g,N))),x=_(()=>U({edges:r,nodes:d,_v_:1}));return ie(n,()=>({getData:x})),t.jsx(ue,{value:{top:s},children:t.jsxs(Qe,{fitView:!0,minZoom:.5,nodes:d,edges:p,edgeTypes:sn,nodeTypes:ln,onConnect:h,onNodesChange:u,onEdgesChange:i,onBeforeDelete:async g=>!g.nodes.length,connectionLineComponent:cn,children:[t.jsx(et,{size:2,color:"#ccc",bgColor:"#f6f6f6"}),t.jsx(tt,{}),t.jsx(an,{})]})})},Fe=e=>{const n=new Map;for(const s of e){const o=s.source,a=n.get(o)||[];n.set(o,[...a,s])}return n},dn=(e,n="")=>({id:W(),source:e,target:n,sourceHandle:J,targetHandle:G}),un=e=>{const n=[];for(const s of e){n.push(s);const o=s.target;e.find(a=>a.source===o)||n.push(dn(o))}return n};function mn(e){e=un(e);const n=e.find(r=>r.source===O);if(!n)return e;const s=Fe(e),o=[n];let a=n.target;const c=r=>s.get(r)||[];for(;c(a).length;){const[r]=c(a);o.push(r),a=r.target;const l=c(a).filter(i=>i.id!==r.id);s.set(a,l)}for(const r of e)o.some(l=>l.id===r.id)||o.push(r);return o.filter(r=>r.source!==O)}const pn=(e,n)=>[...Fe(e)].map(([o,a])=>{const[c]=a,r=c.target,l=n(c.source);let i=[];const d={id:o,node:l},m=u=>{var h,x;return(((x=(h=l==null?void 0:l.data)==null?void 0:h.formData)==null?void 0:x.branch)||[]).find(g=>g.id===u)};return a.forEach(u=>{const p=u.target,h=u.sourceHandle;if(h===J)d.nextStep=p;else if(l){const x=m(h);x&&i.push({id:x.id,label:x.label,condition:x.value,nextStep:p})}}),i.length?d.conditions=i:d.nextStep=r,d});function Z(e,n=[]){const s=new Map,o=e.nodes||[],a=e.edges||[];for(const i of o)s.set(i.id,i);const c=i=>s.get(i),r=mn(a);return pn(r,c).map(i=>{const{node:d,...m}=i,u=d==null?void 0:d.data,{branch:p,...h}={...u==null?void 0:u.formData},x={...U(m),type:d==null?void 0:d.type,formData:h};if(p!=null&&p.length){const g=i.conditions||n;x.conditions=p.map(N=>{const I=g.find(Ee=>Ee.id===N.id);return{id:N.id,label:N.label,condition:N.value,nextStep:I==null?void 0:I.nextStep}})}return u!=null&&u.details&&(x.details=Z(u==null?void 0:u.details,x.conditions)),x})}const hn=e=>{var a;const n=[],o=Z(e).filter(c=>!c.nextStep);for(const c of o)(a=c.conditions)!=null&&a.length&&c.conditions.forEach(r=>{r.nextStep||n.push({id:r.id,label:r.label,value:r.condition})});return n},xn="_detail_1b2w4_1",fn="_show_1b2w4_14",_n="_layer_1b2w4_19",gn="_layer_content_1b2w4_25",jn="_layer_header_1b2w4_28",bn="_close_btn_1b2w4_35",yn="_title_1b2w4_38",v={detail:xn,show:fn,layer:_n,layer_content:gn,layer_header:jn,close_btn:bn,title:yn},Nn=()=>{var p;const e=wt(),[n]=me(),{updateNodeData:s}=H(),[o,a]=nt.useModal(),{closeDetail:c,detailId:r}=y(),l=e==null?void 0:e.details,i=l==null?void 0:l.nodes,d=l==null?void 0:l.edges,m=_(()=>{const h=n.getData(),x=hn(h),g={...e==null?void 0:e.formData,branch:x};s(r,{details:h,formData:g}),c()}),u=_(()=>{o.confirm({title:"Are you sure you want to leave?",content:"The data on this page will be lost after leaving.",okText:"Yes",okButtonProps:{className:"shopify"},cancelButtonProps:{className:"shopify"},onOk:c})});return t.jsxs("div",{className:v.layer,children:[t.jsxs("div",{className:v.layer_header,children:[t.jsx(bt,{children:"Back",icon:st,onClick:u,className:v.close_btn}),t.jsx("div",{className:v.title,children:(p=e==null?void 0:e.formData)==null?void 0:p.name}),t.jsx(ce,{type:"primary",onClick:m,children:"Save"})]}),t.jsx("div",{className:v.layer_content,children:t.jsx(ae,{children:t.jsx(Se,{top:!1,canvas:n,defaultNodes:i,defaultEdges:d})})}),a]})},vn=()=>{const{detailId:e}=y(),[n,s]=z(!1),o=_(()=>s(!0)),a=_(()=>s(!1));ot(()=>{e?o():setTimeout(a,400)},[e]);const c=rt(v.detail,!!e&&v.show);return t.jsx("div",{className:c,children:n&&t.jsx(Nn,{})})},wn=e=>{const{children:n,...s}=e,[o,a]=z(),c=_(l=>{a(l)}),r=_(()=>{a(void 0)});return t.jsx(de.Provider,{value:{...s,detailId:o,openDetail:c,closeDetail:r},children:n})},Cn=e=>{const[n]=me(),s=_(()=>{const o=n.getData();return{realDetails:o,assembleData:Z(o)}});return ie(e.flow,()=>({getData:s})),t.jsx(ae,{children:t.jsxs(wn,{...e,children:[t.jsx(Se,{...e,canvas:n}),t.jsx(vn,{})]})})},Sn=(e={})=>Object.keys(e).reduce((n,s)=>{var a,c;let o=(a=e[s])==null?void 0:a.value;if(s==="conditions"){s="branch";const r=o;o=(c=r==null?void 0:r.map)==null?void 0:c.call(r,l=>({label:l.condition,value:l.condition}))}return{...n,[s]:o}},{}),Ie=e=>{if(e!=null&&e._v_)return e;let n=(e==null?void 0:e.nodes)||[];return n=n.map(s=>{var a;const o=(a=s==null?void 0:s.data)==null?void 0:a.values;return{...s,data:{nodeType:o==null?void 0:o.nodeType,formData:Sn(o==null?void 0:o.formData),details:Ie(o==null?void 0:o.stepRealData)}}}),{...e,nodes:n}},Fn=e=>e.map(n=>{const s=[...n.parameters,{name:"waitFor",parameter:n.wait_for}];return console.log(n),{componentName:n.tag_name,componentTag:n.tag_name,componentId:n.ui_component_uuid,componentType:n.ui_component_type,input:s.map(o=>{let a=o.parameter;return a&&(a=`{${a}}`),{required:!0,label:o.name,name:o.name,initialValue:a}})}}),In=e=>e.reduce((s,o)=>[...s,...o.tools],[]).map(s=>({name:s.name,description:s.description})),Tn=()=>[{label:"Summarize",value:"summarize",maxAttrs:1},{label:"Full content",value:"full_content",maxAttrs:1},{label:"Structure input",value:"structure_input",subValue:"data_collect_dataset"}],En="_loading_1cv3a_1",kn="_container_1cv3a_7",Te={loading:En,container:kn},Dn=e=>{const{promptTemplate:n,flowRelationship:s}=e.detail;console.log(n);const o=In(n.mcp_servers),a=Tn(),c=Fn(n.ui_components),r=f.useMemo(()=>{const l=s?JSON.parse(s):{};return Ie(l)},[s,c]);return t.jsx(at,{className:"shopify full-content",children:t.jsx("div",{className:Te.container,children:t.jsx(Cn,{flow:e.flow,actions:o,uiComponents:c,transformTools:a,defaultEdges:r.edges,defaultNodes:r.nodes})})})};function Vn(){var d;const{message:e}=ct.useApp(),[n]=Nt(),[s]=lt(),o=it(),[a,c]=z(!1),{data:r}=dt(async()=>(await mt({flowSnippetUuid:o.uid,flowSnippetVersionUuid:o.vid})).flowSnippet),l=(d=r==null?void 0:r.promptTemplate)==null?void 0:d.prompt_uuid,i=_(async()=>{const m=n.getData();console.log(m);const{flowSnippetVersionUuid:u,...p}=r,h=s.get("type"),x={};h==="new"&&(x.flowSnippetVersionUuid=u),await pt({...p,...x,promptUuid:l,flowContext:JSON.stringify(m.assembleData),flowRelationship:JSON.stringify(m.realDetails)}),e.success("Workflow saved successfully"),c(!1)});return t.jsx(ut,{title:r==null?void 0:r.flowName,className:"shopify full-screen",loading:!r&&t.jsx("div",{className:Te.loading,children:t.jsx(ft,{size:36})}),extra:r?t.jsx(ce,{type:"primary",className:"shopify",onClick:i,children:"Save"}):null,children:t.jsx(jt,{loading:a,children:!!r&&t.jsx(Dn,{flow:n,detail:r})})})}export{Vn as default};
