import{v as j,A as F,z as q,D as N,s as h,e as f,b as A,j as e,t as U,W as l,l as y,m as o,w as x,F as S,G as L,S as W}from"./libs-CZ9azTWP.js";import{f as E,i as M}from"./workflow-AomR6_A5.js";import{a as V,b as k}from"./useFetchData-DhPorz9K.js";import{S as z}from"./index-DXeQc5BJ.js";import"./index-4w9JELLy.js";import{S as B}from"./index-D8jLKQFW.js";import{a as R}from"./const-DP1vyTQS.js";import"./generate-fRrcnwPE.js";import"./index-BO-i8_LU.js";import"./wizard-BJSNmDHY.js";import"./enum-Ct7sVdAK.js";const b="__",O=s=>{const a=s.mcpServers.map(r=>r.mcp_server_uuid),n=s.uiComponents.map(r=>[r.ui_component_uuid,r.ui_component_type].join(b));return{...s,mcpServers:a,uiComponents:n}},G=s=>{const a=s.mcpServers||[],n=s.uiComponents||[],r=a.map(p=>({mcp_server_uuid:p})),c=n.map(p=>{const[m,u]=p.split(b);return{ui_component_uuid:m,ui_component_type:u}});return{...s,mcpServers:r,uiComponents:c,updatedBy:"admin"}},H="_wrapper_ytw7y_1",I="_form_ytw7y_4",J="_form_list_ytw7y_11",_={wrapper:H,form:I,form_list:J},oe=()=>{const[s]=j.useForm(),{message:a}=F.useApp(),{state:n}=q(),{uid:r,vid:c}=N(),[p,m]=h(!1),{options:u,loading:v}=V(),{options:T,loading:g}=k(),[t,w]=h(n),C=f(async()=>{const{promptTemplate:i}=await E({promptUuid:r,promptVersionUuid:c});w(i)}),P=f(()=>{const i=O(t);s.setFieldsValue(i)}),D=f(async()=>{const i=await s.validateFields();try{m(!0);const d=G(i);await M(d),a.success("Template saved successfully.")}catch(d){a.error(d.message)}finally{m(!1)}});return A.useEffect(()=>{t?P():C()},[t]),e.jsx(z,{loading:!t,children:e.jsx(U,{title:t==null?void 0:t.promptName,className:"shopify full-screen",extra:e.jsx(W,{children:e.jsx(B,{type:"primary",loading:p,disabled:!t,onClick:D,children:"Save"})}),children:e.jsx("div",{className:_.wrapper,children:e.jsxs(j,{form:s,submitter:!1,layout:"horizontal",labelAlign:"left",className:_.form,labelCol:{flex:"180px"},children:[e.jsx(l,{hidden:!0,name:"promptUuid"}),e.jsxs(y,{gutter:16,children:[e.jsx(o,{span:24,children:e.jsx(l,{label:"Template Name",name:"promptName",rules:[{required:!0}]})}),e.jsx(o,{span:24,children:e.jsx(x,{label:"Type",name:"promptType",valueEnum:R,rules:[{required:!0}]})}),e.jsx(o,{span:24,children:e.jsx(x,{label:"Mcp Servers",name:"mcpServers",mode:"multiple",options:T,rules:[{required:!0}],fieldProps:{loading:g}})}),e.jsx(o,{span:24,children:e.jsx(x,{label:"Ui Components",name:"uiComponents",mode:"multiple",options:u,rules:[{required:!0}],fieldProps:{loading:v}})})]}),e.jsx(S,{label:"Template Description",name:"promptDescription",fieldProps:{rows:12},rules:[{required:!0}]}),e.jsx(S,{label:"Template Context",name:"templateContext",fieldProps:{rows:12},rules:[{required:!0}]}),e.jsx(L,{label:"Variables",name:"variables",className:_.form_list,children:e.jsxs(y,{gutter:16,children:[e.jsx(o,{span:12,children:e.jsx(l,{name:"name",placeholder:"Variable Name",rules:[{required:!0}]})}),e.jsx(o,{span:12,children:e.jsx(l,{name:"data_type",placeholder:"Data type",rules:[{required:!0}]})})]})})]})})})})};export{oe as default};
