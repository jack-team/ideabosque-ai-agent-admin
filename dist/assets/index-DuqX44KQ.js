import{b as m,u as _,z as L,D as O,F as A,G as Ee,H as te,q as K,j as t,S as ke,J as De,K as $e,L as Pe,Q as We,U as ne,V as se,W as y,s as E,x as F,X,Y as qe,Z as oe,y as R,h as Y,i as S,_ as Ae,$ as Re,a0 as Me,a1 as Be,a2 as He,a3 as Le,a4 as Ue,a5 as Ve,a6 as Oe,a7 as Xe,a8 as re,a9 as Ye,aa as ze,ab as Je,ac as Ge,ad as Ze,ae as Ke,af as Qe,M as et,ag as ae,o as z,ah as tt,ai as nt,k as st,A as ot,aj as rt,w as at,ak as ct,p as lt}from"./libs-ChT4hEeZ.js";import{k as it,g as dt}from"./workflow-D-zbS7FU.js";import{c as Q}from"./index-DN4UYkoj.js";import{T as ut,u as mt}from"./index-Lurxt14A.js";import{S as pt}from"./index-CRzCV8gh.js";import{b as ht,u as xt}from"./hooks-PXMSJGZu.js";import{S as ce}from"./index-DIMjatY4.js";import{S as ft}from"./index-CbDiQ6FV.js";import"./generate-BfFboeQH.js";function le(e){return[m.useRef(e).current]}function ie(e,n){const o=n(),s=_(()=>{!e||!o||Object.keys(o).forEach(a=>{e[a]=o[a]})});m.useEffect(s,[o,s])}const J="default_source_handle",G="default_target_handle",U="start-id",_t={id:U,type:"start",data:{formData:{}},position:{x:0,y:0}},de=e=>{const n=new Map;for(const o of e){const s=o.source,a=n.get(s)||[];n.set(s,[...a,o])}return n},gt=(e,n="")=>({id:L(),source:e,target:n,sourceHandle:J,targetHandle:G}),jt=e=>{const n=[];for(const o of e){n.push(o);const s=o.target;e.find(a=>a.source===s)||n.push(gt(s))}return n};function bt(e){e=jt(e);const n=e.find(r=>r.source===U);if(!n)return e;const o=de(e),s=[n];let a=n.target;const l=r=>o.get(r)||[];for(;l(a).length;){const[r]=l(a);s.push(r),a=r.target;const c=l(a).filter(i=>i.id!==r.id);o.set(a,c)}for(const r of e)s.some(c=>c.id===r.id)||s.push(r);return s.filter(r=>r.source!==U)}const yt=e=>[...de(e)].map(([o,s])=>{const[a]=s,l=a.target,r={id:o};let c=[];return s.forEach(i=>{const d=i.target,u=i.sourceHandle;u===J?r.nextStep=d:c.push({condition:u,nextStep:d})}),c.length?r.conditions=c:r.nextStep=l,r});function Z(e){const n=new Map,o=e.nodes||[],s=e.edges||[];for(const c of o)n.set(c.id,c);const a=bt(s),l=yt(a),r=c=>n.get(c);return l.map(c=>{const i=r(c.id),d=i==null?void 0:i.data,{branch:u,...x}={...d==null?void 0:d.formData},p={...c,type:i==null?void 0:i.type,formData:x};if(u!=null&&u.length){const h=c.conditions||[];p.conditions=u.map(f=>{const j=f.value,N=h.find(M=>M.condition===j);return{label:f.label,condition:f.value,nextStep:N==null?void 0:N.nextStep}})}return d!=null&&d.details&&(p.details=Z(d==null?void 0:d.details)),p})}const Nt=e=>{var a;const n=[],s=Z(e).filter(l=>!l.nextStep);for(const l of s)(a=l.conditions)!=null&&a.length&&l.conditions.forEach(r=>{r.nextStep||n.push({label:r.label,value:r.condition})});return n},ue=m.createContext({}),me=m.createContext({}),vt=()=>le({getData:()=>null}),pe=()=>le({getData:()=>null}),b=()=>m.useContext(ue),he=()=>m.useContext(me),xe=()=>{const e=O(),{openDetail:n}=b(),{addEdges:o,addNodes:s,getNodes:a}=A(),l=_(()=>{var x;const i=a().find(p=>p.id===e);let d=(i==null?void 0:i.position.x)||0;const u=(i==null?void 0:i.position.y)||0;return d=d+(((x=i==null?void 0:i.measured)==null?void 0:x.width)||0)+80,{x:d,y:u}});return[_(c=>{const i=L(),d=c.triggerId,u=c.nodeType;s({id:i,data:c,type:u,position:l()}),e&&o({id:L(),source:e,target:i,sourceHandle:d,targetHandle:G}),u==="step"&&n(i)})]},wt=()=>{const{detailId:e}=b();return te().find(o=>o.id===e)},Ct=()=>{const e=wt();return e==null?void 0:e.data};function St(){const e=O(),n=Ee(e);return n==null?void 0:n.data}function w(){const e=St();return e==null?void 0:e.formData}const Ft="_form_svv3s_1",Tt={form:Ft},It=e=>{var a;const{onSubmit:n}=e,[o]=ht(),[s]=K.useForm();return xt(async()=>{const l=await(s==null?void 0:s.validateFields());l&&await n(l),o()}),t.jsx(K,{form:s,submitter:!1,className:Tt.form,initialValues:e.formData,children:(a=e.children)==null?void 0:a.call(e,s)})},fe=e=>{const{children:n,onSubmit:o,formData:s,...a}=e;return t.jsx(ut,{...a,children:t.jsx(It,{formData:s,onSubmit:o,children:n})})},Et="_wrapper_fmhpg_4",kt="_tools_fmhpg_4",Dt="_tool_item_fmhpg_15",$t="_inner_fmhpg_26",Pt="_content_fmhpg_34",Wt="_handle_fmhpg_38",qt="_handle_source_fmhpg_39",At="_branch_fmhpg_59",Rt="_branch_item_fmhpg_63",Mt="_branch_label_fmhpg_71",g={wrapper:Et,tools:kt,tool_item:Dt,inner:$t,content:Pt,handle:Wt,handle_source:qt,branch:At,branch_item:Rt,branch_label:Mt},Bt=e=>{const{nodeId:n,tools:o}=e,{editForm:s}=o,{top:a}=he(),{openDetail:l}=b(),{setNodes:r,updateNodeData:c}=A(),i=w(),d=_(()=>{r(h=>h.filter(f=>f.id!==n))}),u=_(async h=>{c(n,{formData:h})}),x=_(()=>{l(n)}),p=h=>s?t.jsx(fe,{centered:!0,okText:"Save",destroyOnHidden:!0,trigger:h,formData:i,width:s.width,onSubmit:u,title:s.title||"Edit Node",children:f=>t.jsx(s.Component,{form:f})}):null;return t.jsxs(ke,{size:16,children:[a&&t.jsx("div",{onClick:x,className:g.tool_item,children:t.jsx(De,{})}),p(t.jsx("div",{className:g.tool_item,children:t.jsx(Pe,{})})),t.jsx("div",{onClick:d,className:g.tool_item,children:t.jsx($e,{})})]})},Ht="_atom_node_fh105_1",Lt="_atom_icon_fh105_11",Ut="_atom_content_fh105_21",Vt="_atom_title_fh105_24",Ot="_atom_desc_fh105_30",I={atom_node:Ht,atom_icon:Lt,atom_content:Ut,atom_title:Vt,atom_desc:Ot},ee=e=>{const{Icon:n,...o}=e;return t.jsxs("div",{onClick:e.onClick,className:I.atom_node,children:[t.jsx("div",{className:I.atom_icon,children:t.jsx(n,{})}),t.jsxs("div",{className:I.atom_content,children:[t.jsx("div",{className:I.atom_title,children:o.title}),t.jsx("div",{className:I.atom_desc,children:o.desc})]})]})},Xt=e=>{const{triggerId:n,onChange:o,closeDrawer:s}=e,a=te(),{top:l}=he();return t.jsx(m.Fragment,{children:Se.filter(r=>r.limit!==void 0?a.filter(i=>i.type===r.type).length<r.limit:l?r.top:!r.top).map(r=>{const{type:c,Component:i,...d}=r,u=i.Icon,x=i.Form,p=async(h={})=>{s(),o==null||o({nodeType:c,triggerId:n,formData:h})};return x?t.jsx(fe,{centered:!0,okText:"Add Node",onSubmit:p,width:i.modalWdith,title:`Add ${d.title} Node`,children:h=>t.jsx(x,{form:h}),trigger:t.jsx(ee,{...d,Icon:u})},c):m.createElement(ee,{...d,Icon:u,key:c,onClick:p})})})},_e=e=>{const{children:n,...o}=e,{open:s,trigger:a,onClose:l}=mt(n);return t.jsxs(t.Fragment,{children:[a,t.jsx(We,{open:s,destroyOnHidden:!0,onClose:l,rootClassName:"shopify",title:"What triggers this workflow?",children:t.jsx(Xt,{...o,closeDrawer:l})})]})},Yt=e=>{const{branch:n=[]}=e,o=s=>t.jsx(_e,{triggerId:s,onChange:e.onChange,children:t.jsx(ne,{id:s,type:"source",position:se.Right,className:g.handle_source})});return n.length?t.jsx("div",{className:g.branch,children:n.map(s=>t.jsxs("div",{className:g.branch_item,children:[t.jsx("div",{className:g.branch_label,children:s.label}),o(s.value)]},s.value))}):o(J)},C=e=>{const{tools:n,branch:o=[],enableHandle:s}=e,{source:a=!0,target:l=!0}=s||{},r=O(),[c]=xe();return t.jsxs("div",{className:g.wrapper,children:[t.jsx("div",{className:g.tools,children:!!n&&r&&t.jsx(Bt,{nodeId:r,tools:n})}),t.jsxs("div",{className:g.inner,children:[l&&t.jsx(ne,{type:"target",id:G,position:se.Left,className:g.handle,isConnectableStart:!1}),t.jsx("div",{className:g.content,children:e.children}),a&&t.jsx(Yt,{branch:o,onChange:c})]})]})},zt="_title_1tfkx_1",Jt="_description_1tfkx_6",B={title:zt,description:Jt},T=e=>t.jsxs("div",{className:B.node_desc,children:[t.jsx("div",{className:B.title,children:e.title}),t.jsx("div",{className:B.description,children:e.desc})]}),Gt=e=>{const{inputParams:n=[]}=e;return n.map(o=>{const s=o.options,a={label:o.label,name:o.name,disabled:o.disabled,readonly:o.readonly,initialValue:o.initialValue,rules:[{required:o.required}]};return t.jsx(m.Fragment,{children:s!=null&&s.length?t.jsx(E,{...a,options:s}):t.jsx(y,{...a})},o.name)})},ge=()=>{const{uiComponents:e=[]}=b(),n=e.map(o=>({label:o.componentName,value:o.componentTag}));return t.jsxs(m.Fragment,{children:[t.jsx(E,{label:"Component",name:"name",options:n,rules:[{required:!0}]}),t.jsx(F,{label:"Text",name:"text",rules:[{required:!0}]}),t.jsx(X,{name:["name"],children:({name:o})=>{const s=e.find(a=>a.componentTag===o);return t.jsx(Gt,{inputParams:s==null?void 0:s.input})}})]})},k=()=>{const e=w(),{uiComponents:n=[]}=b(),o=n.find(s=>s.componentTag===(e==null?void 0:e.name));return t.jsx(C,{tools:{editForm:{Component:ge,title:"Edit Ui node",width:k.modalWdith}},children:t.jsx(T,{title:o==null?void 0:o.componentName,desc:e==null?void 0:e.text})})};k.Form=ge;k.modalWdith=400;k.Icon=qe;const Zt="_container_12b9h_1",Kt="_icon_12b9h_7",Qt="_text_12b9h_12",H={container:Zt,icon:Kt,text:Qt},je=()=>t.jsx(C,{enableHandle:{target:!1},children:t.jsxs("div",{className:H.container,children:[t.jsx("div",{className:H.icon,children:t.jsx(oe,{})}),t.jsx("div",{className:H.text,children:"Start"})]})});je.Icon=oe;const be=()=>t.jsxs(m.Fragment,{children:[t.jsx(y,{name:"name",label:"Name",rules:[{required:!0}]}),t.jsx(F,{label:"Text",name:"text",rules:[{required:!1}]}),t.jsx(R,{label:"Condition",name:"branch",children:t.jsxs(Y,{gutter:16,children:[t.jsx(S,{span:12,children:t.jsx(y,{label:"Label",name:"label",rules:[{required:!0}]})}),t.jsx(S,{span:12,children:t.jsx(y,{label:"Value",name:"value",rules:[{required:!0}]})})]})})]}),D=()=>{const e=w();return t.jsx(C,{branch:e==null?void 0:e.branch,tools:{editForm:{width:D.modalWdith,title:"Edit Branch node",Component:be}},children:t.jsx(T,{title:e==null?void 0:e.name,desc:e==null?void 0:e.text})})};D.Form=be;D.modalWdith=400;D.Icon=Ae;var ye=(e=>(e.Prompt="prompt",e.Text="text",e))(ye||{});const V={prompt:"Prompt",text:"Text"},Ne=()=>t.jsxs(m.Fragment,{children:[t.jsx(Re.Group,{label:"Type",name:"type",initialValue:ye.Prompt,valueEnum:V,rules:[{required:!0}]}),t.jsx(X,{name:["type"],children:({type:e})=>e?t.jsx(F,{label:V[e],name:"text",rules:[{required:!0}]}):null})]}),$=()=>{const e=w(),n=e==null?void 0:e.type;return t.jsx(C,{tools:{editForm:{width:$.modalWdith,title:"Edit Prompt node",Component:Ne}},children:t.jsx(T,{title:n&&V[n],desc:e==null?void 0:e.text})})};$.Form=Ne;$.modalWdith=360;$.Icon=Me;const ve=()=>{const{actions:e=[],transformTools:n}=b(),o=m.useMemo(()=>e.map(s=>({value:s.name,label:s.description})),[e]);return t.jsxs(m.Fragment,{children:[t.jsx(E,{label:"Action",name:"type",options:o,rules:[{required:!0}]}),t.jsx(F,{label:"Text",name:"text",rules:[{required:!1}]}),t.jsx(X,{name:["type"],children:({type:s})=>s?t.jsxs(m.Fragment,{children:[t.jsx(Be,{children:"Transform"}),t.jsx(E,{label:"Type",name:["transform","type"],options:n,rules:[{required:!0}]}),t.jsx(R,{name:"attrs",required:!0,label:"Attributes",creatorButtonProps:{creatorButtonText:"Add Attribute"},children:t.jsx(y,{name:"attr",width:"md",rules:[{required:!0}]})})]}):null})]})},P=()=>{const{actions:e=[]}=b(),n=w(),o=m.useMemo(()=>e.find(s=>(n==null?void 0:n.type)===s.name),[e,n==null?void 0:n.type]);return t.jsx(C,{tools:{editForm:{Component:ve,title:"Edit Action node",width:P.modalWdith}},children:t.jsx(T,{title:o==null?void 0:o.name,desc:n==null?void 0:n.text})})};P.Form=ve;P.modalWdith=400;P.Icon=He;const we=()=>{const{transformTools:e=[]}=b();return t.jsxs(m.Fragment,{children:[t.jsx(E,{options:e,label:"Type",name:"type",rules:[{required:!0}]}),t.jsx(F,{label:"Text",name:"text",rules:[{required:!0}]}),t.jsx(R,{name:"attrs",label:"Attributes",creatorButtonProps:{creatorButtonText:"Add Attribute"},children:t.jsxs(Y,{gutter:16,children:[t.jsx(S,{span:12,children:t.jsx(y,{label:"From",name:"from",rules:[{required:!0}]})}),t.jsx(S,{span:12,children:t.jsx(y,{label:"To",name:"to",rules:[{required:!0}]})})]})})]})},W=()=>{const{transformTools:e=[]}=b(),n=w(),o=m.useMemo(()=>e.find(s=>s.value===(n==null?void 0:n.type)),[e,n==null?void 0:n.type]);return t.jsx(C,{tools:{editForm:{width:W.modalWdith,title:"Edit Transform node",Component:we}},children:t.jsx(T,{title:o==null?void 0:o.label,desc:n==null?void 0:n.text})})};W.Form=we;W.modalWdith=450;W.Icon=Le;const Ce=()=>t.jsxs(m.Fragment,{children:[t.jsx(y,{label:"Name",name:"name",rules:[{required:!0}]}),t.jsx(F,{label:"Description",name:"description",rules:[{required:!1}]}),t.jsx(R,{label:"Condition",name:"branch",children:t.jsxs(Y,{gutter:16,children:[t.jsx(S,{span:12,children:t.jsx(y,{label:"Label",name:"label",rules:[{required:!0}]})}),t.jsx(S,{span:12,children:t.jsx(y,{label:"Value",name:"value",rules:[{required:!0}]})})]})})]}),q=()=>{const e=w();return t.jsx(C,{branch:e==null?void 0:e.branch,tools:{editForm:{Component:Ce,title:"Edit Step node",width:q.modalWdith}},children:t.jsx(T,{title:e==null?void 0:e.name,desc:e==null?void 0:e.description})})};q.Form=Ce;q.modalWdith=380;q.Icon=Ue;const Se=[{limit:1,top:!0,type:"start",title:"Start",desc:"The starting node of a workflow.",Component:je},{top:!0,type:"step",title:"Step",desc:"Execute the corresponding process according to the different branches created.",Component:q},{type:"ui",title:"UI",desc:"The UI components within the AI assistant can be used as a data source to obtain data.",Component:k},{type:"branch",title:"Branch",desc:"Execute the corresponding process according to the different branches created.",Component:D},{type:"prompt",title:"Prompt",desc:"Prompt the AI what to do or say.",Component:$},{type:"action",title:"Action",desc:"Execute the corresponding process according to the different branches created.",Component:P},{type:"transform",title:"Transform",desc:"Convert the input data.",Component:W}],en=e=>{const{stroke:n}=e;return t.jsx("defs",{children:t.jsx("marker",{id:e.id,refX:"0",refY:"0",markerWidth:"12.5",markerHeight:"12.5",viewBox:"-10 -10 20 20",markerUnits:"strokeWidth",orient:"auto-start-reverse",style:{stroke:n,fill:n,strokeWidth:1},children:t.jsx("polyline",{strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})})})},tn="_del_btn_7471i_1",nn={del_btn:tn},sn=e=>{const{id:n,selected:o,sourceX:s,sourceY:a,targetX:l,targetY:r,sourcePosition:c,targetPosition:i}=e,{setEdges:d}=A(),[u,x,p]=Ve({sourceX:s,sourceY:a,targetX:l,targetY:r}),h=m.useMemo(()=>`translate(-50%, -50%) 
      translate(${x}px,${p}px)`,[x,p]),f=o?"#f40":"#0143EC",j=_(()=>{d(N=>N.filter(M=>M.id!==n))});return t.jsxs(m.Fragment,{children:[t.jsx(en,{stroke:f,id:n}),t.jsx(Oe,{sourceX:s,sourceY:a,targetX:l,targetY:r,markerEnd:`url(#${n})`,sourcePosition:c,targetPosition:i,style:{stroke:f,strokeWidth:2}}),t.jsx(Xe,{children:o?t.jsx("div",{style:{transform:h},onClick:j,className:nn.del_btn,children:t.jsx(re,{})}):null})]})},on={"step-edge":sn},rn="_add_button_1ocve_1",an={add_button:rn},cn=()=>{const[e]=xe();return t.jsx(_e,{onChange:e,children:t.jsx("div",{className:an.add_button,children:t.jsx(Ye,{})})})},ln=e=>{const{fromX:n,fromY:o,toX:s,toY:a}=e,l=(n+s)/2,r=`M${n},${o} H${l} V${a} H${s}`;return t.jsxs("g",{children:[t.jsx("path",{fill:"none",stroke:"#0143EC",strokeWidth:2,className:"animated",d:r}),t.jsx("circle",{cx:s,cy:a,fill:"#fff",r:3,stroke:"#0143EC",strokeWidth:2})]})},dn=Se.reduce((e,n)=>({...e,[n.type]:n.Component}),{}),Fe=e=>{const{canvas:n,top:o=!0,defaultNodes:s=[],defaultEdges:a=[]}=e,l=m.useMemo(()=>s.length?s:[Q(_t)],[s]),[r,c,i]=ze(a),[d,u,x]=Je(l),p=r.map(j=>({...j,type:"step-edge"})),h=_(j=>c(N=>Ge(j,N))),f=_(()=>Q({edges:r,nodes:d,_v_:1}));return ie(n,()=>({getData:f})),t.jsx(me,{value:{top:o},children:t.jsxs(Ze,{fitView:!0,minZoom:.5,nodes:d,edges:p,edgeTypes:on,nodeTypes:dn,onConnect:h,onNodesChange:x,onEdgesChange:i,onBeforeDelete:async j=>!j.nodes.length,connectionLineComponent:ln,children:[t.jsx(Ke,{size:2,color:"#ccc",bgColor:"#f6f6f6"}),t.jsx(Qe,{}),t.jsx(cn,{})]})})},un="_detail_1hmmw_1",mn="_show_1hmmw_14",pn="_layer_1hmmw_19",hn="_layer_content_1hmmw_25",xn="_layer_header_1hmmw_28",fn="_close_btn_1hmmw_33",_n="_title_1hmmw_46",v={detail:un,show:mn,layer:pn,layer_content:hn,layer_header:xn,close_btn:fn,title:_n},gn=()=>{var p;const e=Ct(),[n]=pe(),{updateNodeData:o}=A(),[s,a]=et.useModal(),{closeDetail:l,detailId:r}=b(),c=e==null?void 0:e.details,i=c==null?void 0:c.nodes,d=c==null?void 0:c.edges,u=_(()=>{const h=n.getData(),f=Nt(h),j={...e==null?void 0:e.formData,branch:f};o(r,{details:h,formData:j}),l()}),x=_(()=>{s.confirm({title:"Are you sure you want to leave?",content:"The data on this page will be lost after leaving.",okText:"Yes",okButtonProps:{className:"shopify"},cancelButtonProps:{className:"shopify"},onOk:l})});return t.jsxs("div",{className:v.layer,children:[t.jsxs("div",{className:v.layer_header,children:[t.jsx("div",{onClick:x,className:v.close_btn,children:t.jsx(re,{})}),t.jsx("div",{className:v.title,children:(p=e==null?void 0:e.formData)==null?void 0:p.name}),t.jsx(ce,{type:"primary",onClick:u,children:"Save"})]}),t.jsx("div",{className:v.layer_content,children:t.jsx(ae,{children:t.jsx(Fe,{top:!1,canvas:n,defaultNodes:i,defaultEdges:d})})}),a]})},jn=()=>{const{detailId:e}=b(),[n,o]=z(!1),s=_(()=>o(!0)),a=_(()=>o(!1));tt(()=>{e?s():setTimeout(a,400)},[e]);const l=nt(v.detail,!!e&&v.show);return t.jsx("div",{className:l,children:n&&t.jsx(gn,{})})},bn=e=>{const{children:n,...o}=e,[s,a]=z(),l=_(c=>{a(c)}),r=_(()=>{a(void 0)});return t.jsx(ue.Provider,{value:{...o,detailId:s,openDetail:l,closeDetail:r},children:n})},yn=e=>{const[n]=pe(),o=_(()=>{const s=n.getData();return{realDetails:s,assembleData:Z(s)}});return ie(e.flow,()=>({getData:o})),t.jsx(ae,{children:t.jsxs(bn,{...e,children:[t.jsx(Fe,{...e,canvas:n}),t.jsx(jn,{})]})})},Nn=(e={})=>Object.keys(e).reduce((n,o)=>{var a,l;let s=(a=e[o])==null?void 0:a.value;if(o==="conditions"){o="branch";const r=s;s=(l=r==null?void 0:r.map)==null?void 0:l.call(r,c=>({label:c.condition,value:c.condition}))}return{...n,[o]:s}},{}),Te=e=>{if(e!=null&&e._v_)return e;let n=(e==null?void 0:e.nodes)||[];return n=n.map(o=>{var a;const s=(a=o==null?void 0:o.data)==null?void 0:a.values;return{...o,data:{nodeType:s==null?void 0:s.nodeType,formData:Nn(s==null?void 0:s.formData),details:Te(s==null?void 0:s.stepRealData)}}}),{...e,nodes:n}},vn=e=>e.map(n=>({componentName:n.tag_name,componentTag:n.tag_name,componentId:n.ui_component_uuid,componentType:n.ui_component_type,input:n.parameters.map(o=>{let s=o.parameter;return s&&(s=`{${s}}`),{required:!0,label:o.name,name:o.name,initialValue:s}})})),wn=e=>e.reduce((o,s)=>[...o,...s.tools],[]).map(o=>({name:o.name,description:o.description})),Cn=()=>[{label:"Summarize",value:"summarize"},{label:"Full content",value:"full_content"},{label:"Structure input",value:"structure_input"}],Sn="_loading_1cv3a_1",Fn="_container_1cv3a_7",Ie={loading:Sn,container:Fn},Tn=e=>{const{promptTemplate:n,flowRelationship:o}=e.detail,s=wn(n.mcp_servers),a=Cn(),l=vn(n.ui_components),r=m.useMemo(()=>{const c=o?JSON.parse(o):{};return Te(c)},[o,l]);return t.jsx(st,{className:"shopify full-content",children:t.jsx("div",{className:Ie.container,children:t.jsx(yn,{flow:e.flow,actions:s,uiComponents:l,transformTools:a,defaultEdges:r.edges,defaultNodes:r.nodes})})})};function Rn(){var d;const{message:e}=ot.useApp(),[n]=vt(),[o]=rt(),s=at(),[a,l]=z(!1),{data:r}=ct(async()=>(await it({flowSnippetUuid:s.uid,flowSnippetVersionUuid:s.vid})).flowSnippet),c=(d=r==null?void 0:r.promptTemplate)==null?void 0:d.prompt_uuid,i=_(async()=>{const u=n.getData();l(!0);const{flowSnippetVersionUuid:x,...p}=r,h=o.get("type"),f={};h==="new"&&(f.flowSnippetVersionUuid=x),await dt({...p,...f,promptUuid:c,flowContext:JSON.stringify(u.assembleData),flowRelationship:JSON.stringify(u.realDetails)}),e.success("Workflow saved successfully"),l(!1)});return t.jsx(lt,{title:r==null?void 0:r.flowName,className:"shopify full-screen",loading:!r&&t.jsx("div",{className:Ie.loading,children:t.jsx(pt,{size:36})}),extra:r?t.jsx(ce,{type:"primary",className:"shopify",onClick:i,children:"Save"}):null,children:t.jsx(ft,{loading:a,children:!!r&&t.jsx(Tn,{flow:n,detail:r})})})}export{Rn as default};
