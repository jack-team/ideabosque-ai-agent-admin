import{q as j,A as F,v as q,w as N,o as h,u as f,b as A,j as e,p as U,W as m,h as y,i as o,s as x,x as S,y as L,S as W}from"./libs-ChT4hEeZ.js";import{f as E,i as M}from"./workflow-D-zbS7FU.js";import{a as V,b as k}from"./useFetchData-jhf_de0x.js";import{S as B}from"./index-CbDiQ6FV.js";import"./index-CRzCV8gh.js";import{S as R}from"./index-DIMjatY4.js";import{a as z}from"./const-DP1vyTQS.js";import"./generate-BfFboeQH.js";import"./wizard-DNvM4GDM.js";import"./enum-Ct7sVdAK.js";const b="__",O=s=>{const a=s.mcpServers.map(r=>r.mcp_server_uuid),n=s.uiComponents.map(r=>[r.ui_component_uuid,r.ui_component_type].join(b));return{...s,mcpServers:a,uiComponents:n}},G=s=>{const a=s.mcpServers||[],n=s.uiComponents||[],r=a.map(p=>({mcp_server_uuid:p})),c=n.map(p=>{const[l,u]=p.split(b);return{ui_component_uuid:l,ui_component_type:u}});return{...s,mcpServers:r,uiComponents:c,updatedBy:"admin"}},H="_wrapper_ytw7y_1",I="_form_ytw7y_4",J="_form_list_ytw7y_11",_={wrapper:H,form:I,form_list:J},ae=()=>{const[s]=j.useForm(),{message:a}=F.useApp(),{state:n}=q(),{uid:r,vid:c}=N(),[p,l]=h(!1),{options:u,loading:v}=V(),{options:T,loading:g}=k(),[t,w]=h(n),C=f(async()=>{const{promptTemplate:i}=await E({promptUuid:r,promptVersionUuid:c});w(i)}),P=f(()=>{const i=O(t);s.setFieldsValue(i)}),D=f(async()=>{const i=await s.validateFields();try{l(!0);const d=G(i);await M(d),a.success("Template saved successfully.")}catch(d){a.error(d.message)}finally{l(!1)}});return A.useEffect(()=>{t?P():C()},[t]),e.jsx(B,{loading:!t,children:e.jsx(U,{title:t==null?void 0:t.promptName,className:"shopify full-screen",extra:e.jsx(W,{children:e.jsx(R,{type:"primary",loading:p,disabled:!t,onClick:D,children:"Save"})}),children:e.jsx("div",{className:_.wrapper,children:e.jsxs(j,{form:s,submitter:!1,layout:"horizontal",labelAlign:"left",className:_.form,labelCol:{flex:"180px"},children:[e.jsx(m,{hidden:!0,name:"promptUuid"}),e.jsxs(y,{gutter:16,children:[e.jsx(o,{span:24,children:e.jsx(m,{label:"Template Name",name:"promptName",rules:[{required:!0}]})}),e.jsx(o,{span:24,children:e.jsx(x,{label:"Type",name:"promptType",valueEnum:z,rules:[{required:!0}]})}),e.jsx(o,{span:24,children:e.jsx(x,{label:"Mcp Servers",name:"mcpServers",mode:"multiple",options:T,rules:[{required:!0}],fieldProps:{loading:g}})}),e.jsx(o,{span:24,children:e.jsx(x,{label:"Ui Components",name:"uiComponents",mode:"multiple",options:u,rules:[{required:!0}],fieldProps:{loading:v}})})]}),e.jsx(S,{label:"Template Description",name:"promptDescription",fieldProps:{rows:12},rules:[{required:!0}]}),e.jsx(S,{label:"Template Context",name:"templateContext",fieldProps:{rows:12},rules:[{required:!0}]}),e.jsx(L,{label:"Variables",name:"variables",className:_.form_list,children:e.jsxs(y,{gutter:16,children:[e.jsx(o,{span:12,children:e.jsx(m,{name:"name",placeholder:"Variable Name",rules:[{required:!0}]})}),e.jsx(o,{span:12,children:e.jsx(m,{name:"data_type",placeholder:"Data type",rules:[{required:!0}]})})]})})]})})})})};export{ae as default};
