const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-OA4ygSLe.js","assets/libs-C65raxhD.js","assets/index-Dfix4K0A.js","assets/index-CqkYvDSZ.js","assets/index-CFiK8WbN.js","assets/index-Dg9TDopJ.css","assets/index-BmuJcdsb.js","assets/workflow-Cw9nkl8g.js","assets/request-DncSvQ2C.js","assets/index-tMld6ZHS.js","assets/index-BqDEZf5_.css","assets/index-v6ouLxXC.css"])))=>i.map(i=>d[i]);
import{b as g,u as v,j as l,h as T,A as O,t as C,m as S,y as A,n as I}from"./libs-C65raxhD.js";import{j as P,k}from"./workflow-Cw9nkl8g.js";import{S as j,_ as z}from"./index-CFiK8WbN.js";import{S as F}from"./index-BmuJcdsb.js";import{S as V}from"./index-tMld6ZHS.js";import{c as h}from"./index-Dfix4K0A.js";const w=e=>{const r=e.valueType,t=e.dependencys||[],n={valueType:r,width:e.width,title:e.title,tooltip:e.tooltip,dataIndex:e.name,valueEnum:e.valueEnum,fieldProps:e.fieldProps,initialValue:e.initialValue,formItemProps:{rules:e.rules}};return e.columns&&(n.columns=e.columns.map(w)),t.length&&(n.valueType="dependency",n.name=t.map(s=>s.name),n.columns=s=>t.filter(({name:i,values:a=[]})=>a.find(c=>c===s[i])).reduce((i,a)=>{const c=a.renders||[];return[...i,...c.map(w)]},[])),n},W=(e,r={})=>(e.forEach(t=>{var n;t.valueEnum&&(r=Object.assign(r,t.valueEnum)),(n=t.dependencys)==null||n.forEach(s=>{W(s.renders,r)})}),r),M=(e,r=[])=>(e.forEach(t=>{const n=t.dependencys||[],s=t.valueType||"text";n.length?n.forEach(o=>{M(o.renders,r)}):r.push({type:s,name:t.name})}),r),U=(e={})=>(e=h(e),Object.keys(e).reduce((r,t)=>({...r,[t]:e[t].value}),{})),$=(e,r,t)=>(Object.keys(e).map(n=>{const s=r.find(c=>c.name===n),o=e[n],i=(s==null?void 0:s.type)||"text",a={_type_:i,value:o};i==="select"&&(a.label=t[o]),e[n]=a}),e),_=(e,r,t)=>{var y;const n=e.id,s=e.data.values,o=U(s.formData),i=r.filter(u=>u.source===n),{conditions:a=[],...c}=o,d={id:n,type:s.nodeType};return s.stepRealData&&(d.detail=s.stepRealData),a.length?d.conditions=a.map(u=>{var m,f;let p=(m=i.find(x=>x.sourceHandle===u.condition))==null?void 0:m.target;return!p&&(t!=null&&t.conditions)&&(p=(f=t.conditions.find(x=>x.condition===u.condition))==null?void 0:f.nextStep),{...u,nextStep:p}}):(d.formData=c,d.nextStep=((y=i[0])==null?void 0:y.target)||(t==null?void 0:t.nextStep)),d},H="_loading_1cv3a_1",J="_container_1cv3a_7",N={loading:H,container:J},B=g.lazy(()=>z(()=>import("./index-OA4ygSLe.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),L=g.forwardRef((e,r)=>{const{detail:t}=e,n=g.useRef(null),s=t.promptTemplate,o=g.useMemo(()=>JSON.parse(t.flowRelationship??"{}"),[t.flowRelationship]),i=v(()=>{var p;const a=(p=n.current)==null?void 0:p.getData(),{nodes:c=[],edges:d=[]}=h(a);return{flowContext:c.map(m=>_(m,d)).map(m=>{const{detail:f,...x}=m,D=(f==null?void 0:f.nodes)||[],E=(f==null?void 0:f.edges)||[],R=D.map(b=>_(b,E,m));return{...x,details:R}}),flowRelationship:a}});return g.useImperativeHandle(r,()=>({getData:i})),l.jsx(T,{className:"shopify full-content",children:l.jsx("div",{className:N.container,children:l.jsx(g.Suspense,{fallback:l.jsx("div",{className:"lazy-loading",children:l.jsx(j,{size:48})}),children:l.jsx(B,{ref:n,initialNodes:o.nodes,initialEdges:o.edges,mcpServers:s.mcp_servers,uiComponents:s.ui_components})})})})});function q(){var y;const{message:e}=O.useApp(),r=C(),t=g.useRef(null),[n,s]=S(!1),[o,i]=S(),a=(y=o==null?void 0:o.promptTemplate)==null?void 0:y.prompt_uuid,c=v(async()=>{const u=await k({flowSnippetUuid:r.uid,flowSnippetVersionUuid:r.vid});i(u.flowSnippet)}),d=v(async()=>{var p;const u=(p=t.current)==null?void 0:p.getData();s(!0),await P({...o,promptUuid:a,flowContext:JSON.stringify(u.flowContext),flowRelationship:JSON.stringify(u.flowRelationship)}),e.success("Workflow saved successfully"),s(!1)});return A(c),l.jsx(I,{title:o==null?void 0:o.flowName,className:"shopify full-screen",loading:!o&&l.jsx("div",{className:N.loading,children:l.jsx(j,{size:36})}),extra:o?l.jsx(F,{type:"primary",className:"shopify",onClick:d,children:"Save"}):null,children:l.jsx(V,{loading:n,children:o?l.jsx(L,{ref:t,detail:o}):null})})}const ee=Object.freeze(Object.defineProperty({__proto__:null,default:q},Symbol.toStringTag,{value:"Module"}));export{W as a,M as b,U as c,w as g,ee as i,$ as t};
