import{b as f,f as _,Q as J,U as H,V as R,X as De,Y as se,y as ee,j as t,S as Pe,Z as $e,L as Ae,D as We,_ as ze,$ as oe,a0 as re,W as b,z as E,J as S,a1 as q,a2 as Be,a3 as ae,K as M,n as ce,o as L,a4 as Re,a5 as qe,a6 as Me,a7 as Le,a8 as He,a9 as Ve,aa as Ue,ab as Ye,ac as Oe,ad as Xe,ae as Je,af as Ge,ag as Ze,ah as Ke,ai as Qe,aj as et,ak as tt,al as nt,M as st,am as ot,an as ie,v as G,h as rt,ao as at,p as ct,A as it,u as lt,H as dt,w as ut,e as mt,x as pt,i as ht}from"./libs-BaOSQqCJ.js";import{k as xt,g as ft}from"./workflow-BW4XbuDQ.js";import{c as Y}from"./index-Bnn3z9vJ.js";import{I as z}from"./index-CjwgjA-6.js";import{T as _t,u as gt}from"./index-CiYCRc8I.js";import{S as jt}from"./index-CVj_4ApK.js";import{b as bt,u as yt}from"./hooks-D7SSpzGD.js";import{S as le}from"./index-BrXlwoYR.js";import{S as Nt}from"./index-xvScoOdp.js";import"./generate-CoI0_eDN.js";function de(e){return[f.useRef(e).current]}function ue(e,n){const s=n(),o=_(()=>{!e||!s||Object.keys(s).forEach(r=>{e[r]=s[r]})});f.useEffect(o,[s,o])}const Z="default_source_handle",K="default_target_handle",O="start-id",vt={id:O,type:"start",data:{formData:{}},position:{x:0,y:0}},me=f.createContext({}),pe=f.createContext({}),wt=()=>de({getData:()=>null}),he=()=>de({getData:()=>null}),y=()=>f.useContext(me),xe=()=>f.useContext(pe),fe=()=>{const e=J(),{openDetail:n}=y(),{addEdges:s,addNodes:o,getNodes:r}=H(),i=_(()=>{var u;const l=r().find(m=>m.id===e);let d=(l==null?void 0:l.position.x)||0;const h=(l==null?void 0:l.position.y)||0;return d=d+(((u=l==null?void 0:l.measured)==null?void 0:u.width)||0)+80,{x:d,y:h}});return[_(c=>{const l=R(),d=c.triggerId,h=c.nodeType;o({id:l,data:c,type:h,position:i()}),e&&s({id:R(),source:e,target:l,sourceHandle:d,targetHandle:K}),h==="step"&&n(l)})]},Ct=()=>{const{detailId:e}=y();return se().find(s=>s.id===e)},St=()=>{const e=Ct();return e==null?void 0:e.data};function It(){const e=J(),n=De(e);return n==null?void 0:n.data}function w(){const e=It();return e==null?void 0:e.formData}const Ft="_form_svv3s_1",Tt={form:Ft},Et=e=>{var r;const{onSubmit:n}=e,[s]=bt(),[o]=ee.useForm();return yt(async()=>{const i=await(o==null?void 0:o.validateFields());i&&await n(i),s()}),t.jsx(ee,{form:o,submitter:!1,className:Tt.form,initialValues:e.formData,children:(r=e.children)==null?void 0:r.call(e,o)})},_e=e=>{const{children:n,onSubmit:s,formData:o,...r}=e;return t.jsx(_t,{...r,children:t.jsx(Et,{formData:o,onSubmit:s,children:n})})},kt=e=>{const{nodeId:n,tools:s}=e,{editForm:o}=s,{top:r}=xe(),{openDetail:i}=y(),{setNodes:a,updateNodeData:c}=H(),l=w(),d=_(()=>{a(p=>p.filter(x=>x.id!==n))}),h=_(async p=>{c(n,{formData:p})}),u=_(()=>{i(n)}),m=p=>o?t.jsx(_e,{centered:!0,okText:"Save",destroyOnHidden:!0,trigger:p,formData:l,width:o.width,onSubmit:h,title:o.title||"Edit Node",children:x=>t.jsx(o.Component,{form:x})}):null;return t.jsxs(Pe,{size:16,children:[r&&t.jsx(z,{icon:$e,onClick:u}),m(t.jsx(z,{icon:We})),t.jsx(z,{icon:Ae,onClick:d})]})},Dt="_atom_node_fh105_1",Pt="_atom_icon_fh105_11",$t="_atom_content_fh105_21",At="_atom_title_fh105_24",Wt="_atom_desc_fh105_30",T={atom_node:Dt,atom_icon:Pt,atom_content:$t,atom_title:At,atom_desc:Wt},te=e=>{const{Icon:n,...s}=e;return t.jsxs("div",{onClick:e.onClick,className:T.atom_node,children:[t.jsx("div",{className:T.atom_icon,children:t.jsx(n,{})}),t.jsxs("div",{className:T.atom_content,children:[t.jsx("div",{className:T.atom_title,children:s.title}),t.jsx("div",{className:T.atom_desc,children:s.desc})]})]})},zt=e=>{const{triggerId:n,onChange:s,closeDrawer:o}=e,r=se(),{top:i}=xe();return t.jsx(f.Fragment,{children:Ie.filter(a=>a.limit!==void 0?r.filter(l=>l.type===a.type).length<a.limit:i?a.top:!a.top).map(a=>{const{type:c,Component:l,...d}=a,h=l.Icon,u=l.Form,m=async(p={})=>{o(),s==null||s({nodeType:c,triggerId:n,formData:p})};return u?t.jsx(_e,{centered:!0,okText:"Add Node",onSubmit:m,width:l.modalWdith,title:`Add ${d.title} Node`,children:p=>t.jsx(u,{form:p}),trigger:t.jsx(te,{...d,Icon:h})},c):f.createElement(te,{...d,Icon:h,key:c,onClick:m})})})},ge=e=>{const{children:n,...s}=e,{open:o,trigger:r,onClose:i}=gt(n);return t.jsxs(t.Fragment,{children:[r,t.jsx(ze,{open:o,destroyOnHidden:!0,onClose:i,rootClassName:"shopify",title:"What triggers this workflow?",children:t.jsx(zt,{...s,closeDrawer:i})})]})},Bt="_wrapper_zt6zj_4",Rt="_tools_zt6zj_4",qt="_inner_zt6zj_15",Mt="_content_zt6zj_23",Lt="_handle_zt6zj_27",Ht="_handle_source_zt6zj_28",Vt="_branch_zt6zj_48",Ut="_branch_item_zt6zj_52",Yt="_branch_label_zt6zj_60",N={wrapper:Bt,tools:Rt,inner:qt,content:Mt,handle:Lt,handle_source:Ht,branch:Vt,branch_item:Ut,branch_label:Yt},ne=e=>{const{id:n,onChange:s}=e;return t.jsx(ge,{triggerId:n,onChange:s,children:t.jsx(oe,{id:n,type:"source",position:re.Right,className:N.handle_source})})},Ot=e=>{const{branch:n=[],onChange:s}=e;return n.length?t.jsx("div",{className:N.branch,children:n.map(o=>t.jsxs("div",{className:N.branch_item,children:[t.jsx("div",{className:N.branch_label,children:o.label}),t.jsx(ne,{id:o.id,onChange:s})]},o.id))}):t.jsx(ne,{id:Z,onChange:s})},C=e=>{const{tools:n,branch:s=[],enableHandle:o}=e,{source:r=!0,target:i=!0}=o||{},a=J(),[c]=fe();return t.jsxs("div",{className:N.wrapper,children:[t.jsx("div",{className:N.tools,children:!!n&&a&&t.jsx(kt,{nodeId:a,tools:n})}),t.jsxs("div",{className:N.inner,children:[i&&t.jsx(oe,{type:"target",id:K,position:re.Left,className:N.handle,isConnectableStart:!1}),t.jsx("div",{className:N.content,children:e.children}),r&&t.jsx(Ot,{branch:s,onChange:c})]})]})},Xt="_title_1tfkx_1",Jt="_description_1tfkx_6",V={title:Xt,description:Jt},I=e=>t.jsxs("div",{className:V.node_desc,children:[t.jsx("div",{className:V.title,children:e.title}),t.jsx("div",{className:V.description,children:e.desc})]}),Gt=e=>{const{inputParams:n=[]}=e;return n.map(s=>{const o=s.options,r={label:s.label,name:s.name,disabled:s.disabled,readonly:s.readonly,initialValue:s.initialValue,rules:[{required:s.required}]};return t.jsx(f.Fragment,{children:o!=null&&o.length?t.jsx(E,{...r,options:o}):t.jsx(b,{...r})},s.name)})},je=e=>{const{uiComponents:n=[]}=y(),s=n.map(i=>({label:i.componentName,value:i.componentTag})),o=i=>n.find(a=>a.componentTag===i),r=_(i=>{var l,d;const a=o(i),c=(l=a==null?void 0:a.input)==null?void 0:l.reduce((h,u)=>({...h,[u.name]:u.initialValue}),{});(d=e.form)==null||d.setFieldsValue(c)});return t.jsxs(f.Fragment,{children:[t.jsx(E,{label:"Component",name:"name",options:s,rules:[{required:!0}],fieldProps:{onChange:r}}),t.jsx(S,{label:"Text",name:"text",rules:[{required:!0}]}),t.jsx(q,{name:["name"],children:({name:i})=>{const a=n.find(c=>c.componentTag===i);return t.jsx(Gt,{inputParams:a==null?void 0:a.input})}})]})},k=()=>{const e=w(),{uiComponents:n=[]}=y(),s=n.find(o=>o.componentTag===(e==null?void 0:e.name));return t.jsx(C,{tools:{editForm:{Component:je,title:"Edit Ui node",width:k.modalWdith}},children:t.jsx(I,{title:s==null?void 0:s.componentName,desc:e==null?void 0:e.text})})};k.Form=je;k.modalWdith=560;k.Icon=Be;const Zt="_container_12b9h_1",Kt="_icon_12b9h_7",Qt="_text_12b9h_12",U={container:Zt,icon:Kt,text:Qt},be=()=>t.jsx(C,{enableHandle:{target:!1},children:t.jsxs("div",{className:U.container,children:[t.jsx("div",{className:U.icon,children:t.jsx(ae,{})}),t.jsx("div",{className:U.text,children:"Start"})]})});be.Icon=ae;const ye=()=>{const e=f.useRef(void 0);return t.jsxs(f.Fragment,{children:[t.jsx(b,{name:"name",label:"Name",rules:[{required:!0}]}),t.jsx(S,{label:"Text",name:"text",rules:[{required:!1}]}),t.jsxs(M,{label:"Condition",name:"branch",copyIconProps:!1,actionRef:e,alwaysShowItemLabel:!0,className:"custom_form_list",actionGuard:{beforeAddRow:()=>{var s;const n=R();return(s=e.current)==null||s.add({id:n}),!1}},children:[t.jsx(b,{name:"id",hidden:!0}),t.jsxs(ce,{gutter:16,children:[t.jsx(L,{span:12,children:t.jsx(b,{label:"Label",name:"label",rules:[{required:!0}]})}),t.jsx(L,{span:12,children:t.jsx(b,{label:"Value",name:"value",rules:[{required:!0}]})})]})]})]})},D=()=>{const e=w();return t.jsx(C,{branch:e==null?void 0:e.branch,tools:{editForm:{width:D.modalWdith,title:"Edit Branch node",Component:ye}},children:t.jsx(I,{title:e==null?void 0:e.name,desc:e==null?void 0:e.text})})};D.Form=ye;D.modalWdith=560;D.Icon=Re;var Ne=(e=>(e.Prompt="prompt",e.Text="text",e))(Ne||{});const X={prompt:"Prompt",text:"Text"},ve=()=>t.jsxs(f.Fragment,{children:[t.jsx(qe.Group,{label:"Type",name:"type",initialValue:Ne.Prompt,valueEnum:X,rules:[{required:!0}]}),t.jsx(q,{name:["type"],children:({type:e})=>e?t.jsx(S,{label:X[e],name:"text",rules:[{required:!0}]}):null})]}),P=()=>{const e=w(),n=e==null?void 0:e.type;return t.jsx(C,{tools:{editForm:{width:P.modalWdith,title:"Edit Prompt node",Component:ve}},children:t.jsx(I,{title:n&&X[n],desc:e==null?void 0:e.text})})};P.Form=ve;P.modalWdith=560;P.Icon=Me;const we=()=>{const{actions:e=[],transformTools:n}=y(),s=f.useMemo(()=>e.map(r=>({value:r.name,label:r.description})),[e]),o=r=>n==null?void 0:n.find(i=>i.value===r);return t.jsxs(f.Fragment,{children:[t.jsx(E,{label:"Action",name:"type",options:s,rules:[{required:!0}]}),t.jsx(S,{label:"Text",name:"text",rules:[{required:!1}]}),t.jsx(q,{name:["type"],children:({type:r})=>r?t.jsxs(f.Fragment,{children:[t.jsx(Le,{children:"Transform"}),t.jsx(M,{name:"transform",alwaysShowItemLabel:!0,className:"custom_form_list",creatorButtonProps:{creatorButtonText:"Add Transform"},children:(i,a,c)=>t.jsxs(t.Fragment,{children:[t.jsx(E,{label:"Type",name:"type",options:n,rules:[{required:!0}],fieldProps:{onChange(l){const d=o(l);c.setCurrentRowData({attrs:[],value:d==null?void 0:d.subValue})}}}),t.jsx(b,{hidden:!0,name:"value"}),t.jsx(q,{name:["attrs"],children:({attrs:l=[]})=>{const d=c.getCurrentRowData(),h=o(d.type),u=(h==null?void 0:h.maxAttrs)??100,m=l.length>=u;return t.jsx(M,{name:"attrs",label:"Attributes",alwaysShowItemLabel:!0,className:"custom_form_list",creatorButtonProps:{disabled:m,creatorButtonText:"Add Attribute"},children:t.jsx(b,{name:"attr",label:"Attribute",rules:[{required:!0}]})})}})]})})]}):null})]})},$=()=>{const{actions:e=[]}=y(),n=w(),s=f.useMemo(()=>e.find(o=>(n==null?void 0:n.type)===o.name),[e,n==null?void 0:n.type]);return t.jsx(C,{tools:{editForm:{Component:we,title:"Edit Action node",width:$.modalWdith}},children:t.jsx(I,{title:s==null?void 0:s.name,desc:n==null?void 0:n.text})})};$.Form=we;$.modalWdith=560;$.Icon=He;const Ce=()=>{const{transformTools:e=[]}=y();return t.jsxs(f.Fragment,{children:[t.jsx(E,{options:e,label:"Type",name:"type",rules:[{required:!0}]}),t.jsx(S,{label:"Text",name:"text",rules:[{required:!0}]}),t.jsx(M,{name:"attrs",label:"Attributes",creatorButtonProps:{creatorButtonText:"Add Attribute"},children:t.jsxs(ce,{gutter:16,children:[t.jsx(L,{span:12,children:t.jsx(b,{label:"From",name:"from",rules:[{required:!0}]})}),t.jsx(L,{span:12,children:t.jsx(b,{label:"To",name:"to",rules:[{required:!0}]})})]})})]})},A=()=>{const{transformTools:e=[]}=y(),n=w(),s=f.useMemo(()=>e.find(o=>o.value===(n==null?void 0:n.type)),[e,n==null?void 0:n.type]);return t.jsx(C,{tools:{editForm:{width:A.modalWdith,title:"Edit Transform node",Component:Ce}},children:t.jsx(I,{title:s==null?void 0:s.label,desc:n==null?void 0:n.text})})};A.Form=Ce;A.modalWdith=560;A.Icon=Ve;const Se=()=>t.jsxs(f.Fragment,{children:[t.jsx(b,{label:"Name",name:"name",rules:[{required:!0}]}),t.jsx(S,{label:"Description",name:"description",rules:[{required:!1}]}),t.jsx(b,{name:"branch",hidden:!0})]}),W=()=>{const e=w();return t.jsx(C,{branch:e==null?void 0:e.branch,tools:{editForm:{Component:Se,title:"Edit Step node",width:W.modalWdith}},children:t.jsx(I,{title:e==null?void 0:e.name,desc:e==null?void 0:e.description})})};W.Form=Se;W.modalWdith=560;W.Icon=Ue;const Ie=[{limit:1,top:!0,type:"start",title:"Start",desc:"The starting node of a workflow.",Component:be},{top:!0,type:"step",title:"Step",desc:"Execute the corresponding process according to the different branches created.",Component:W},{type:"ui",title:"UI",desc:"The UI components within the AI assistant can be used as a data source to obtain data.",Component:k},{type:"branch",title:"Branch",desc:"Execute the corresponding process according to the different branches created.",Component:D},{type:"message",title:"Prompt",desc:"Prompt the AI what to do or say.",Component:P},{type:"action",title:"Action",desc:"Execute the corresponding process according to the different branches created.",Component:$},{type:"transform",title:"Transform",desc:"Convert the input data.",Component:A}],en=e=>{const{stroke:n}=e;return t.jsx("defs",{children:t.jsx("marker",{id:e.id,refX:"0",refY:"0",markerWidth:"12.5",markerHeight:"12.5",viewBox:"-10 -10 20 20",markerUnits:"strokeWidth",orient:"auto-start-reverse",style:{stroke:n,fill:n,strokeWidth:1},children:t.jsx("polyline",{strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})})})},tn="_del_btn_1ph8o_1",nn={del_btn:tn},sn=e=>{const{id:n,selected:s,sourceX:o,sourceY:r,targetX:i,targetY:a,sourcePosition:c,targetPosition:l}=e,{setEdges:d}=H(),[h,u,m]=Ye({sourceX:o,sourceY:r,targetX:i,targetY:a}),p=f.useMemo(()=>`translate(-50%, -50%) 
      translate(${u}px,${m}px)`,[u,m]),x=s?"#f40":"#0143EC",g=_(()=>{d(j=>j.filter(F=>F.id!==n))});return t.jsxs(f.Fragment,{children:[t.jsx(en,{stroke:x,id:n}),t.jsx(Oe,{sourceX:o,sourceY:r,targetX:i,targetY:a,markerEnd:`url(#${n})`,sourcePosition:c,targetPosition:l,style:{stroke:x,strokeWidth:3}}),t.jsx(Xe,{children:s?t.jsx("div",{style:{transform:p},onClick:g,className:nn.del_btn,children:t.jsx(Je,{})}):null})]})},on={"step-edge":sn},rn="_add_button_cw4d1_1",an={add_button:rn},cn=()=>{const[e]=fe();return t.jsx(ge,{onChange:e,children:t.jsx("div",{className:an.add_button,children:t.jsx(Ge,{})})})},ln=e=>{const{fromX:n,fromY:s,toX:o,toY:r}=e,i=(n+o)/2,a=`M${n},${s} H${i} V${r} H${o}`;return t.jsxs("g",{children:[t.jsx("path",{fill:"none",d:a,strokeWidth:3,stroke:"#0143EC",className:"animated"}),t.jsx("circle",{cx:o,cy:r,fill:"#fff",r:3,stroke:"#0143EC",strokeWidth:3})]})},dn=Ie.reduce((e,n)=>({...e,[n.type]:n.Component}),{}),Fe=e=>{const{canvas:n,top:s=!0,defaultNodes:o=[],defaultEdges:r=[]}=e,i=f.useMemo(()=>o.length?o:[Y(vt)],[o]),[a,c,l]=Ze(r),[d,h,u]=Ke(i),m=a.map(g=>({...g,type:"step-edge"})),p=_(g=>c(j=>Qe(g,j))),x=_(()=>Y({edges:a,nodes:d,_v_:1}));return ue(n,()=>({getData:x})),t.jsx(pe,{value:{top:s},children:t.jsxs(et,{fitView:!0,minZoom:.5,nodes:d,edges:m,edgeTypes:on,nodeTypes:dn,onConnect:p,onNodesChange:u,onEdgesChange:l,onBeforeDelete:async g=>!g.nodes.length,connectionLineComponent:ln,children:[t.jsx(tt,{size:2,color:"#ccc",bgColor:"#f6f6f6"}),t.jsx(nt,{}),t.jsx(cn,{})]})})},Te=e=>{const n=new Map;for(const s of e){const o=s.source,r=n.get(o)||[];n.set(o,[...r,s])}return n},un=(e,n="")=>({id:R(),source:e,target:n,sourceHandle:Z,targetHandle:K}),mn=e=>{const n=[];for(const s of e){n.push(s);const o=s.target;e.find(r=>r.source===o)||n.push(un(o))}return n};function pn(e){e=mn(e);const n=e.find(a=>a.source===O);if(!n)return e;const s=Te(e),o=[n];let r=n.target;const i=a=>s.get(a)||[];for(;i(r).length;){const[a]=i(r);o.push(a),r=a.target;const c=i(r).filter(l=>l.id!==a.id);s.set(r,c)}for(const a of e)o.some(c=>c.id===a.id)||o.push(a);return o.filter(a=>a.source!==O)}const hn=(e,n)=>[...Te(e)].map(([o,r])=>{const[i]=r,a=i.target,c=n(i.source);let l=[];const d={id:o,node:c},h=u=>{var p,x;return(((x=(p=c==null?void 0:c.data)==null?void 0:p.formData)==null?void 0:x.branch)||[]).find(g=>g.id===u)};return r.forEach(u=>{const m=u.target,p=u.sourceHandle;if(p===Z)d.nextStep=m;else if(c){const x=h(p);x&&l.push({id:x.id,label:x.label,condition:x.value,nextStep:m})}}),l.length?d.conditions=l:d.nextStep=a,d});function Q(e,n=[]){const s=new Map,o=e.nodes||[],r=e.edges||[];for(const l of o)s.set(l.id,l);const i=l=>s.get(l),a=pn(r);return hn(a,i).map(l=>{const{node:d,...h}=l,u=d==null?void 0:d.data,{branch:m,...p}={...u==null?void 0:u.formData},x={...Y(h),type:d==null?void 0:d.type,formData:p};if(m!=null&&m.length){const g=l.conditions||n;x.conditions=m.map(j=>{const F=g.find(ke=>ke.id===j.id);return{id:j.id,label:j.label,condition:j.value,nextStep:F==null?void 0:F.nextStep}})}return u!=null&&u.details&&(x.details=Q(u==null?void 0:u.details,x.conditions)),x})}const xn=e=>{var r;const n=[],o=Q(e).filter(i=>!i.nextStep);for(const i of o)(r=i.conditions)!=null&&r.length&&i.conditions.forEach(a=>{a.nextStep||n.push({id:a.id,label:a.label,value:a.condition})});return n},fn="_detail_1b2w4_1",_n="_show_1b2w4_14",gn="_layer_1b2w4_19",jn="_layer_content_1b2w4_25",bn="_layer_header_1b2w4_28",yn="_close_btn_1b2w4_35",Nn="_title_1b2w4_38",v={detail:fn,show:_n,layer:gn,layer_content:jn,layer_header:bn,close_btn:yn,title:Nn},vn=()=>{var m;const e=St(),[n]=he(),{updateNodeData:s}=H(),[o,r]=st.useModal(),{closeDetail:i,detailId:a}=y(),c=e==null?void 0:e.details,l=c==null?void 0:c.nodes,d=c==null?void 0:c.edges,h=_(()=>{const p=n.getData(),x=xn(p),g={...e==null?void 0:e.formData,branch:x};s(a,{details:p,formData:g}),i()}),u=_(()=>{o.confirm({title:"Are you sure you want to leave?",content:"The data on this page will be lost after leaving.",okText:"Yes",okButtonProps:{className:"shopify"},cancelButtonProps:{className:"shopify gray"},onOk:i})});return t.jsxs("div",{className:v.layer,children:[t.jsxs("div",{className:v.layer_header,children:[t.jsx(z,{children:"Back",icon:ot,onClick:u,className:v.close_btn}),t.jsx("div",{className:v.title,children:(m=e==null?void 0:e.formData)==null?void 0:m.name}),t.jsx(le,{type:"primary",onClick:h,children:"Save"})]}),t.jsx("div",{className:v.layer_content,children:t.jsx(ie,{children:t.jsx(Fe,{top:!1,canvas:n,defaultNodes:l,defaultEdges:d})})}),r]})},wn=()=>{const{detailId:e}=y(),[n,s]=G(!1),o=_(()=>s(!0)),r=_(()=>s(!1));rt(()=>{e?o():setTimeout(r,400)},[e]);const i=at(v.detail,!!e&&v.show);return t.jsx("div",{className:i,children:n&&t.jsx(vn,{})})},Cn=e=>{const{children:n,...s}=e,[o,r]=G(),i=_(c=>{r(c)}),a=_(()=>{r(void 0)});return t.jsx(me.Provider,{value:{...s,detailId:o,openDetail:i,closeDetail:a},children:n})},Sn=e=>{const[n]=he(),s=_(()=>{const o=n.getData();return{realDetails:o,assembleData:Q(o)}});return ue(e.flow,()=>({getData:s})),t.jsx(ie,{children:t.jsxs(Cn,{...e,children:[t.jsx(Fe,{...e,canvas:n}),t.jsx(wn,{})]})})},In=(e={})=>Object.keys(e).reduce((n,s)=>{var r,i;let o=(r=e[s])==null?void 0:r.value;if(s==="conditions"){s="branch";const a=o;o=(i=a==null?void 0:a.map)==null?void 0:i.call(a,c=>({label:c.condition,value:c.condition}))}return{...n,[s]:o}},{}),Ee=e=>{if(e!=null&&e._v_)return e;let n=(e==null?void 0:e.nodes)||[];return n=n.map(s=>{var r;const o=(r=s==null?void 0:s.data)==null?void 0:r.values;return{...s,data:{nodeType:o==null?void 0:o.nodeType,formData:In(o==null?void 0:o.formData),details:Ee(o==null?void 0:o.stepRealData)}}}),{...e,nodes:n}},Fn=e=>e.map(n=>{const s=[...n.parameters,{name:"waitFor",parameter:n.wait_for}];return{componentName:n.tag_name,componentTag:n.tag_name,componentId:n.ui_component_uuid,componentType:n.ui_component_type,input:s.map(o=>{let r=o.parameter;return r&&(r=`{${r}}`),{required:!0,label:o.name,name:o.name,initialValue:r}})}}),Tn=e=>e.reduce((s,o)=>[...s,...o.tools],[]).map(s=>({name:s.name,description:s.description})),En=()=>[{label:"Summarize",value:"summarize",maxAttrs:1},{label:"Full content",value:"full_content",maxAttrs:1},{label:"Structure input",value:"structure_input",subValue:"data_collect_dataset"}],kn="_loading_1rv3u_1",Dn="_container_1rv3u_7",Pn="_page_title_1rv3u_12",$n="_update_time_1rv3u_15",B={loading:kn,container:Dn,page_title:Pn,update_time:$n},An=e=>{const{promptTemplate:n,flowRelationship:s}=e.detail,o=Tn(n.mcp_servers),r=En(),i=Fn(n.ui_components),a=f.useMemo(()=>{const c=s?JSON.parse(s):{};return Ee(c)},[s,i]);return t.jsx(ct,{className:"shopify full-content",children:t.jsx("div",{className:B.container,children:t.jsx(Sn,{flow:e.flow,actions:o,uiComponents:i,transformTools:r,defaultEdges:a.edges,defaultNodes:a.nodes})})})};function Yn(){var u;const{message:e}=it.useApp(),[n]=wt(),[s]=lt(),o=dt(),r=ut(),[i,a]=G(!1),{data:c}=mt(async()=>(await xt({flowSnippetUuid:o.uid,flowSnippetVersionUuid:o.vid})).flowSnippet),l=(u=c==null?void 0:c.promptTemplate)==null?void 0:u.prompt_uuid,d=_(async()=>{const m=n.getData(),{flowSnippetVersionUuid:p,...x}=c,g=s.get("type"),j={};g==="new"&&(j.flowSnippetVersionUuid=p),a(!0),await ft({...x,...j,promptUuid:l,flowContext:JSON.stringify(m.assembleData),flowRelationship:JSON.stringify(m.realDetails)}),e.success("Workflow saved successfully"),a(!1)}),h=()=>{if(!c)return"";const m=c.updatedAt;return`Last updated on ${ht(m).format("YYYY/MM/DD HH:mm:ss")}`};return t.jsx(pt,{title:t.jsxs("div",{className:B.page_title,children:[(c==null?void 0:c.flowName)||"Workflow Details",t.jsx("div",{className:B.update_time,children:h()})]}),className:"shopify full-screen",loading:!c&&t.jsx("div",{className:B.loading,children:t.jsx(jt,{size:36})}),onBack:()=>r(-1),extra:c?t.jsx(le,{type:"primary",className:"shopify",onClick:d,children:"Save"}):null,children:t.jsx(Nt,{loading:i,children:!!c&&t.jsx(An,{flow:n,detail:c})})})}export{Yn as default};
