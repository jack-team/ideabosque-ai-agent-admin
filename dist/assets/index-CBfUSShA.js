import{q as x,j as e,h as P,i as g,k as B,y as Q,b as D,a8 as Y,s as v,x as U,W as y,B as b,L as Z,A as L,X as q,t as ee,u as $,p as se,P as re,S as z}from"./libs-ChT4hEeZ.js";import{f as W}from"./index-CRzCV8gh.js";import{T}from"./index-Lurxt14A.js";import{e as te,f as ne,b as ae,i as R,g as ie,h as oe}from"./useFetchData-jhf_de0x.js";import{b as O,u as k}from"./hooks-PXMSJGZu.js";import{_ as H}from"./lodash-CsfmQsJK.js";import{c as le}from"./index-DN4UYkoj.js";import{T as ce,S as de}from"./map-BJxYnWC7.js";import{S as I}from"./enum-Ct7sVdAK.js";import"./index-DIMjatY4.js";import"./workflow-D-zbS7FU.js";import"./generate-BfFboeQH.js";import"./wizard-DNvM4GDM.js";const ue={type:"object",properties:{name:{type:"string"},description:{type:"string"},type:{type:"string",enum:["string","object"]}},required:["name","type","description"]},V=r=>{const t={...r.properties},a=r.required||[];return Object.keys(t).map(l=>{var m;const n=t[l];let d=n.items;const o=a.includes(l),s=(m=n.enum)==null?void 0:m.map(u=>({label:u,value:u})),i={label:l,name:l,required:o,type:n.type,minimum:n.minimum,maximum:n.maximum};if(n.definitions=r.definitions,d&&(d.definitions=r.definitions),"$ref"in n&&(d=ue),s&&(i.options=s),d){const u=V(d);i.items=u}if(n.description&&(i.tip=n.description),n.properties){const u=V(n);i.children=u}return i})};function me(r,t={}){const{min:a,max:l,allowDecimal:n}=t;if(!(n?/^\d+(\.\d+)?$/:/^\d+$/).test(r))return{success:!1,message:"Please enter a number"};const i=parseFloat(r);return a!==void 0&&i<a?{success:!1,message:`The input number cannot be less than ${a}.`}:l!==void 0&&i>l?{success:!1,message:`The input number cannot be greater than ${a}.`}:{success:!0,message:"Success."}}const pe=r=>{r=le(r);const t=a=>{Object.keys(a).forEach(l=>{const n=a[l];if(n!=null&&n.properties){const d=n.properties;a[l]=Object.keys(d).map(o=>{const s=d[o];return{name:o,type:s.type,description:s.description}});return}H.isObject(n)&&(H.isArray(n)?n.forEach(t):t(n))})};return t(r),r},fe="_wrapper_1w0rr_1",he="_schema_form_1w0rr_8",ge="_del_btn_1w0rr_11",M={wrapper:fe,schema_form:he,del_btn:ge},K=2,xe=r=>{const{schema:t,value:a}=r,[l]=x.useForm(),[n]=O(),d=V(t),o=(s,i=[],m,u)=>{const f=s.items||[],F=s.options||[],C=s.children||[],S=i.concat(s.name).filter(c=>c),A={name:S,label:s.label,tooltip:s.tip,rules:[{required:s.required}]},w=S.join("");if(f.length)return e.jsx(g,{span:24,children:e.jsx(x.Item,{children:e.jsx(B,{title:s.label,className:"shopify",children:e.jsx(Q,{name:s.name,alwaysShowItemLabel:!0,creatorButtonProps:{creatorButtonText:"Add item"},actionRender:()=>[],required:s.required,rules:[{validator(c,p,h){if(s.required&&!p.length){h("Please add item");return}h()}}],children:(c,p,h)=>e.jsxs(D.Fragment,{children:[e.jsx("div",{className:M.del_btn,onClick:()=>h.remove(p),children:e.jsx(Y,{})}),e.jsx(P,{gutter:16,children:f.map((j,J)=>o(j,[],f,J))})]})})})})},w);if(C.length)return e.jsx(g,{span:24,children:e.jsx(B,{title:s.label,className:"shopify",style:{marginBottom:24},children:e.jsx(P,{gutter:16,children:C.map((c,p)=>o(c,S,C,p))})})},w);const _=c=>{var p,h,j;return((p=c==null?void 0:c.children)==null?void 0:p.length)||((h=c==null?void 0:c.options)==null?void 0:h.length)||((j=c==null?void 0:c.items)==null?void 0:j.length)||(c==null?void 0:c.type)==="object"||(c==null?void 0:c.type)==="array"};let N=K;const E=m.length;if(!(m.findIndex(_)>-1))E%K!==0&&u===E-1&&(N=1);else{const c=m[u-1],p=m[u+1];(_(c)&&_(p)||_(c)&&!p||!c&&_(p))&&(N=1)}return F.length?e.jsx(g,{span:24,children:e.jsx(v,{...A,options:F})},w):s.type==="object"||s.type==="array"?e.jsx(g,{span:24,children:e.jsx(U,{...A})},w):e.jsx(g,{span:24/N,children:e.jsx(y,{...A,rules:[{validator(c,p,h){if(s.required&&!p){h("Please enter");return}if(s.type==="integer"){const j=me(p,{min:s.minimum,max:s.maximum});if(!j.success){h(j.message);return}}h()}}]})},w)};return k(async()=>{var i;const s=await l.validateFields();(i=r.onChange)==null||i.call(r,s),n()}),e.jsx(x,{form:l,submitter:!1,initialValues:pe({...a}),className:M.schema_form,children:e.jsx(P,{gutter:16,children:d.map((s,i)=>o(s,[],d,i))})})},je=r=>e.jsx("div",{className:M.wrapper,children:e.jsx(T,{width:640,title:"Edit Config",destroyOnHidden:!0,trigger:e.jsx(b,{icon:e.jsx(Z,{}),className:"shopify",children:"Edit Config"}),children:e.jsx(xe,{...r})})}),G="__",ye=r=>{if(!r)return;const{llm:t,flowSnippet:a,mcpServers:l,agentVersionUuid:n,...d}=r,o=[a==null?void 0:a.flow_snippet_uuid,a==null?void 0:a.flow_snippet_version_uuid].filter(i=>i).join(G),s=l.map(i=>i.mcp_server_uuid);return{...d,mcpServerUuids:s,flowSnippet:o,llmName:t==null?void 0:t.llm_name,llmProvider:t==null?void 0:t.llm_provider,configurationSchema:t==null?void 0:t.configuration_schema}},be=r=>{const{flowSnippet:t,...a}=r,[,l]=t.split(G);return{...a,flowSnippetVersionUuid:l,updatedBy:"Admin"}},X=r=>{const{formData:t}=r,a=te(),l=ne(),n=ae(),[d]=x.useForm(),{message:o}=L.useApp(),[s]=O(),i=D.useMemo(()=>ye(t),[t]);return k(async()=>{var f;const m=await d.validateFields(),u=be(m);try{await R(u),s(),(f=r.onSuccess)==null||f.call(r),o.success(`Agent ${t?"updated":"created"} successfully.`)}catch{o.error(`Failed to ${t?"updated":"created"} Agent.`)}}),e.jsxs(x,{form:d,submitter:!1,initialValues:i,style:{padding:"24px 0 0 0"},children:[e.jsx(y,{hidden:!0,name:"agentUuid"}),e.jsx(y,{hidden:!0,name:"configurationSchema"}),e.jsx(y,{label:"Agent Name",name:"agentName",rules:[{required:!0}]}),e.jsx(U,{label:"Agent Description",name:"agentDescription",rules:[{required:!0}]}),e.jsxs(P,{gutter:16,children:[e.jsx(g,{span:12,children:e.jsx(v,{label:"LLM Provider",name:"llmProvider",options:a.options,fieldProps:{loading:a.loading,onChange:(m,u)=>{if(!Array.isArray(u)){const f=u==null?void 0:u.realData;d.setFieldsValue({llmName:f==null?void 0:f.llmName,configurationSchema:f.configurationSchema})}}},rules:[{required:!0}]})}),e.jsx(g,{span:12,children:e.jsx(y,{name:"llmName",label:"LLM Name",disabled:!0,rules:[{required:!0}]})}),e.jsx(g,{span:12,children:e.jsx(v,{label:"Flow snippet",name:"flowSnippet",options:l.options,fieldProps:{loading:l.loading,onChange:(m,u)=>{if(u){const S=u.realData.promptTemplate.mcp_servers.map(A=>A.mcp_server_uuid);d.setFieldValue("mcpServerUuids",S)}else d.setFieldValue("mcpServerUuids",i==null?void 0:i.mcpServerUuids)}}})}),e.jsx(g,{span:12,children:e.jsx(y,{label:"Num of Messages",name:"numOfMessages",rules:[{required:!0}]})}),e.jsx(g,{span:12,children:e.jsx(v,{label:"Tool Call Role",name:"toolCallRole",valueEnum:ce,rules:[{required:!0}]})}),e.jsx(g,{span:12,children:e.jsx(q,{name:["flowSnippet"],children:({flowSnippet:m})=>e.jsx(v,{disabled:!!m,label:"MCP Servers",name:"mcpServerUuids",mode:"multiple",options:n.options,fieldProps:{maxTagCount:1,loading:n.loading},rules:[{required:!0}]})})})]}),e.jsx(q,{name:["configurationSchema"],children:({configurationSchema:m})=>m?e.jsx(x.Item,{name:"configuration",label:"Configuration",rules:[{required:!0}],children:e.jsx(je,{schema:m})}):null}),e.jsx(q,{name:["flowSnippet"],children:({flowSnippet:m})=>e.jsx(U,{disabled:!!m,label:"Instructions",name:"instructions",fieldProps:{rows:10}})})]})},ve=r=>{const{formData:t}=r,[a]=x.useForm(),{message:l}=L.useApp(),[n]=O();k(async()=>{var i;const s=await a.validateFields();try{await R({...s,status:I.Active,updatedBy:"Admin"}),n(),(i=r.onSuccess)==null||i.call(r),l.success("The version has been applied successfully.")}catch{l.error("The version application failed.")}});const{options:d,loading:o}=ie(t==null?void 0:t.agentUuid);return e.jsxs(x,{form:a,initialValues:t,submitter:!1,style:{padding:"24px 0 0 0"},children:[e.jsx(y,{hidden:!0,name:"agentUuid"}),e.jsx(v,{label:"Versions",name:"agentVersionUuid",options:d,fieldProps:{loading:o},rules:[{required:!0}]})]})},De=()=>{const{modal:r,message:t}=L.useApp(),a=ee(),l=D.useRef(null),n=$(()=>{var o;(o=l.current)==null||o.reload()}),d=$(o=>{r.confirm({title:"Are you sure you want to archive?",okText:"Archive",okButtonProps:{danger:!0,className:"shopify"},onOk:async()=>{try{await R({agentUuid:o.agentUuid,agentVersionUuid:o.agentVersionUuid,status:I.Inactive,updatedBy:"Admin"}),n(),t.success("Archiving succeeded")}catch{t.error("Archiving failed")}}})});return e.jsx(se,{title:"Agents",extra:e.jsxs(z,{size:16,children:[e.jsx(b,{className:"shopify",onClick:()=>a("/coordinations"),children:"Coordinations"}),e.jsx(T,{width:600,className:"shopify",title:"Create agent",trigger:e.jsx(b,{className:"shopify",type:"primary",children:"Create agent"}),children:e.jsx(X,{})})]}),children:e.jsx(re,{actionRef:l,search:{layout:"vertical"},options:!1,rowKey:"agentUuid",className:"shopify",request:async o=>{const{current:s,pageSize:i,...m}=o,{agentList:u}=await oe({limit:i,pageNumber:s,statuses:[I.Active],...m});return{total:u.total,data:u.agentList}},columns:[{title:"Agent UUID",dataIndex:"agentUuid"},{title:"Agent Name",dataIndex:"agentName"},{title:"Status",dataIndex:"status",valueEnum:de,hideInSearch:!0},{title:"Create at",dataIndex:"createdAt",hideInSearch:!0,render:(o,s)=>W(s.createdAt)},{title:"Update at",dataIndex:"updatedAt",hideInSearch:!0,render:(o,s)=>W(s.updatedAt)},{width:"220px",key:"action",title:"Action",align:"center",hideInSearch:!0,render:(o,s)=>e.jsxs(z,{children:[e.jsx(T,{width:600,destroyOnHidden:!0,className:"shopify",title:"Create agent",trigger:e.jsx(b,{size:"small",type:"primary",className:"shopify",children:"Edit"}),children:e.jsx(X,{formData:s,onSuccess:n})}),e.jsx(T,{width:400,title:"Versions",destroyOnHidden:!0,okText:"Apply",trigger:e.jsx(b,{size:"small",className:"shopify",children:"Versions"}),children:e.jsx(ve,{formData:s,onSuccess:n})}),e.jsx(b,{danger:!0,size:"small",className:"shopify",onClick:()=>d(s),children:"Archive"})]})}]})})};export{De as default};
