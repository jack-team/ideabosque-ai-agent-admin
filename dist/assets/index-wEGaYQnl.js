import{al as Q,am as Y,q as x,j as e,h as P,i as g,k as B,y as Z,b as L,a8 as ee,s as b,x as U,W as y,B as v,L as se,A as M,X as T,t as re,u as $,p as te,P as ne,S as z}from"./libs-WQIapg8s.js";import{f as W}from"./index-D9lBcUPo.js";import{T as q}from"./index-BGNMSpcd.js";import{d as ae,e as ie,b as oe,i as R,f as le,g as ce}from"./useFetchData-CwxNWJ31.js";import{b as E,u as O}from"./hooks-S-v_XTx9.js";import{c as de}from"./index-DQJCvDF_.js";import{T as ue,S as me}from"./map-BJxYnWC7.js";import{S as I}from"./enum-Ct7sVdAK.js";import"./index-CBw2xBsv.js";import"./workflow-CLg8ntmy.js";import"./generate-lzB-bYh5.js";import"./wizard-lFvE1YBO.js";var pe=Y();const H=Q(pe),he={type:"object",properties:{name:{type:"string"},description:{type:"string"},type:{type:"string",enum:["string","object"]}},required:["name","type","description"]},V=r=>{const t={...r.properties},a=r.required||[];return Object.keys(t).map(l=>{var m;const n=t[l];let d=n.items;const o=a.includes(l),s=(m=n.enum)==null?void 0:m.map(u=>({label:u,value:u})),i={label:l,name:l,required:o,type:n.type,minimum:n.minimum,maximum:n.maximum};if(n.definitions=r.definitions,d&&(d.definitions=r.definitions),"$ref"in n&&(d=he),s&&(i.options=s),d){const u=V(d);i.items=u}if(n.description&&(i.tip=n.description),n.properties){const u=V(n);i.children=u}return i})};function fe(r,t={}){const{min:a,max:l,allowDecimal:n}=t;if(!(n?/^\d+(\.\d+)?$/:/^\d+$/).test(r))return{success:!1,message:"Please enter a number"};const i=parseFloat(r);return a!==void 0&&i<a?{success:!1,message:`The input number cannot be less than ${a}.`}:l!==void 0&&i>l?{success:!1,message:`The input number cannot be greater than ${a}.`}:{success:!0,message:"Success."}}const ge=r=>{r=de(r);const t=a=>{Object.keys(a).forEach(l=>{const n=a[l];if(n!=null&&n.properties){const d=n.properties;a[l]=Object.keys(d).map(o=>{const s=d[o];return{name:o,type:s.type,description:s.description}});return}H.isObject(n)&&(H.isArray(n)?n.forEach(t):t(n))})};return t(r),r},xe="_wrapper_1w0rr_1",je="_schema_form_1w0rr_8",ye="_del_btn_1w0rr_11",D={wrapper:xe,schema_form:je,del_btn:ye},K=2,ve=r=>{const{schema:t,value:a}=r,[l]=x.useForm(),[n]=E(),d=V(t),o=(s,i=[],m,u)=>{const h=s.items||[],F=s.options||[],C=s.children||[],S=i.concat(s.name).filter(c=>c),A={name:S,label:s.label,tooltip:s.tip,rules:[{required:s.required}]},w=S.join("");if(h.length)return e.jsx(g,{span:24,children:e.jsx(x.Item,{children:e.jsx(B,{title:s.label,className:"shopify",children:e.jsx(Z,{name:s.name,alwaysShowItemLabel:!0,creatorButtonProps:{creatorButtonText:"Add item"},actionRender:()=>[],required:s.required,rules:[{validator(c,p,f){if(s.required&&!p.length){f("Please add item");return}f()}}],children:(c,p,f)=>e.jsxs(L.Fragment,{children:[e.jsx("div",{className:D.del_btn,onClick:()=>f.remove(p),children:e.jsx(ee,{})}),e.jsx(P,{gutter:16,children:h.map((j,J)=>o(j,[],h,J))})]})})})})},w);if(C.length)return e.jsx(g,{span:24,children:e.jsx(B,{title:s.label,className:"shopify",style:{marginBottom:24},children:e.jsx(P,{gutter:16,children:C.map((c,p)=>o(c,S,C,p))})})},w);const _=c=>{var p,f,j;return((p=c==null?void 0:c.children)==null?void 0:p.length)||((f=c==null?void 0:c.options)==null?void 0:f.length)||((j=c==null?void 0:c.items)==null?void 0:j.length)||(c==null?void 0:c.type)==="object"||(c==null?void 0:c.type)==="array"};let N=K;const k=m.length;if(!(m.findIndex(_)>-1))k%K!==0&&u===k-1&&(N=1);else{const c=m[u-1],p=m[u+1];(_(c)&&_(p)||_(c)&&!p||!c&&_(p))&&(N=1)}return F.length?e.jsx(g,{span:24,children:e.jsx(b,{...A,options:F})},w):s.type==="object"||s.type==="array"?e.jsx(g,{span:24,children:e.jsx(U,{...A})},w):e.jsx(g,{span:24/N,children:e.jsx(y,{...A,rules:[{validator(c,p,f){if(s.required&&!p){f("Please enter");return}if(s.type==="integer"){const j=fe(p,{min:s.minimum,max:s.maximum});if(!j.success){f(j.message);return}}f()}}]})},w)};return O(async()=>{var i;const s=await l.validateFields();(i=r.onChange)==null||i.call(r,s),n()}),e.jsx(x,{form:l,submitter:!1,initialValues:ge({...a}),className:D.schema_form,children:e.jsx(P,{gutter:16,children:d.map((s,i)=>o(s,[],d,i))})})},be=r=>e.jsx("div",{className:D.wrapper,children:e.jsx(q,{width:640,title:"Edit Config",destroyOnHidden:!0,trigger:e.jsx(v,{icon:e.jsx(se,{}),className:"shopify",children:"Edit Config"}),children:e.jsx(ve,{...r})})}),G="__",Se=r=>{if(!r)return;const{llm:t,flowSnippet:a,mcpServers:l,agentVersionUuid:n,...d}=r,o=[a==null?void 0:a.flow_snippet_uuid,a==null?void 0:a.flow_snippet_version_uuid].filter(i=>i).join(G),s=l.map(i=>i.mcp_server_uuid);return{...d,mcpServerUuids:s,flowSnippet:o,llmName:t==null?void 0:t.llm_name,llmProvider:t==null?void 0:t.llm_provider,configurationSchema:t==null?void 0:t.configuration_schema}},Ae=r=>{const{flowSnippet:t,...a}=r,[,l]=t.split(G);return{...a,flowSnippetVersionUuid:l,updatedBy:"Admin"}},X=r=>{const{formData:t}=r,a=ae(),l=ie(),n=oe(),[d]=x.useForm(),{message:o}=M.useApp(),[s]=E(),i=L.useMemo(()=>Se(t),[t]);return O(async()=>{var h;const m=await d.validateFields(),u=Ae(m);try{await R(u),s(),(h=r.onSuccess)==null||h.call(r),o.success(`Agent ${t?"updated":"created"} successfully.`)}catch{o.error(`Failed to ${t?"updated":"created"} Agent.`)}}),e.jsxs(x,{form:d,submitter:!1,initialValues:i,style:{padding:"24px 0 0 0"},children:[e.jsx(y,{hidden:!0,name:"agentUuid"}),e.jsx(y,{hidden:!0,name:"configurationSchema"}),e.jsx(y,{label:"Agent Name",name:"agentName",rules:[{required:!0}]}),e.jsx(U,{label:"Agent Description",name:"agentDescription",rules:[{required:!0}]}),e.jsxs(P,{gutter:16,children:[e.jsx(g,{span:12,children:e.jsx(b,{label:"LLM Provider",name:"llmProvider",options:a.options,fieldProps:{loading:a.loading,onChange:(m,u)=>{if(!Array.isArray(u)){const h=u==null?void 0:u.realData;d.setFieldsValue({llmName:h==null?void 0:h.llmName,configurationSchema:h.configurationSchema})}}},rules:[{required:!0}]})}),e.jsx(g,{span:12,children:e.jsx(y,{name:"llmName",label:"LLM Name",disabled:!0,rules:[{required:!0}]})}),e.jsx(g,{span:12,children:e.jsx(b,{label:"Flow snippet",name:"flowSnippet",options:l.options,fieldProps:{loading:l.loading,onChange:(m,u)=>{if(u){const S=u.realData.promptTemplate.mcp_servers.map(A=>A.mcp_server_uuid);d.setFieldValue("mcpServerUuids",S)}else d.setFieldValue("mcpServerUuids",i==null?void 0:i.mcpServerUuids)}}})}),e.jsx(g,{span:12,children:e.jsx(y,{label:"Num of Messages",name:"numOfMessages",rules:[{required:!0}]})}),e.jsx(g,{span:12,children:e.jsx(b,{label:"Tool Call Role",name:"toolCallRole",valueEnum:ue,rules:[{required:!0}]})}),e.jsx(g,{span:12,children:e.jsx(T,{name:["flowSnippet"],children:({flowSnippet:m})=>e.jsx(b,{disabled:!!m,label:"MCP Servers",name:"mcpServerUuids",mode:"multiple",options:n.options,fieldProps:{maxTagCount:1,loading:n.loading},rules:[{required:!0}]})})})]}),e.jsx(T,{name:["configurationSchema"],children:({configurationSchema:m})=>m?e.jsx(x.Item,{name:"configuration",label:"Configuration",rules:[{required:!0}],children:e.jsx(be,{schema:m})}):null}),e.jsx(T,{name:["flowSnippet"],children:({flowSnippet:m})=>e.jsx(U,{disabled:!!m,label:"Instructions",name:"instructions",fieldProps:{rows:10}})})]})},we=r=>{const{formData:t}=r,[a]=x.useForm(),{message:l}=M.useApp(),[n]=E();O(async()=>{var i;const s=await a.validateFields();try{await R({...s,status:I.Active,updatedBy:"Admin"}),n(),(i=r.onSuccess)==null||i.call(r),l.success("The version has been applied successfully.")}catch{l.error("The version application failed.")}});const{options:d,loading:o}=le(t==null?void 0:t.agentUuid);return e.jsxs(x,{form:a,initialValues:t,submitter:!1,style:{padding:"24px 0 0 0"},children:[e.jsx(y,{hidden:!0,name:"agentUuid"}),e.jsx(b,{label:"Versions",name:"agentVersionUuid",options:d,fieldProps:{loading:o},rules:[{required:!0}]})]})},Re=()=>{const{modal:r,message:t}=M.useApp(),a=re(),l=L.useRef(null),n=$(()=>{var o;(o=l.current)==null||o.reload()}),d=$(o=>{r.confirm({title:"Are you sure you want to archive?",okText:"Archive",okButtonProps:{danger:!0,className:"shopify"},onOk:async()=>{try{await R({agentUuid:o.agentUuid,agentVersionUuid:o.agentVersionUuid,status:I.Inactive,updatedBy:"Admin"}),n(),t.success("Archiving succeeded")}catch{t.error("Archiving failed")}}})});return e.jsx(te,{title:"Agents",extra:e.jsxs(z,{size:16,children:[e.jsx(v,{className:"shopify",onClick:()=>a("/coordinations"),children:"Coordinations"}),e.jsx(q,{width:600,className:"shopify",title:"Create agent",trigger:e.jsx(v,{className:"shopify",type:"primary",children:"Create agent"}),children:e.jsx(X,{})})]}),children:e.jsx(ne,{actionRef:l,search:{layout:"vertical"},options:!1,rowKey:"agentUuid",className:"shopify",request:async o=>{const{current:s,pageSize:i,...m}=o,{agentList:u}=await ce({limit:i,pageNumber:s,statuses:[I.Active],...m});return{total:u.total,data:u.agentList}},columns:[{title:"Agent UUID",dataIndex:"agentUuid"},{title:"Agent Name",dataIndex:"agentName"},{title:"Status",dataIndex:"status",valueEnum:me,hideInSearch:!0},{title:"Create at",dataIndex:"createdAt",hideInSearch:!0,render:(o,s)=>W(s.createdAt)},{title:"Update at",dataIndex:"updatedAt",hideInSearch:!0,render:(o,s)=>W(s.updatedAt)},{width:"220px",key:"action",title:"Action",align:"center",hideInSearch:!0,render:(o,s)=>e.jsxs(z,{children:[e.jsx(q,{width:600,destroyOnHidden:!0,className:"shopify",title:"Create agent",trigger:e.jsx(v,{size:"small",type:"primary",className:"shopify",children:"Edit"}),children:e.jsx(X,{formData:s,onSuccess:n})}),e.jsx(q,{width:400,title:"Versions",destroyOnHidden:!0,okText:"Apply",trigger:e.jsx(v,{size:"small",className:"shopify",children:"Versions"}),children:e.jsx(we,{formData:s,onSuccess:n})}),e.jsx(v,{danger:!0,size:"small",className:"shopify",onClick:()=>d(s),children:"Archive"})]})}]})})};export{Re as default};
