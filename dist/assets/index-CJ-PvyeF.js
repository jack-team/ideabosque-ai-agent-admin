import{b as m,A as W,u,j as e,n as z,h as K,z as Y,o as R,D as G,y as X,w as Z,S as J,F as ee,G as te,H as oe,J as ne,K as S,Q as k,U as A,V as se,X as ae,v as de,Y as re,Z as ie,_ as ce,$ as le,a0 as _e,a1 as ue,a2 as me}from"./libs-DVH06oKf.js";import{g as pe,a as he,b as xe,t as ye,c as fe,d as D}from"./index-BK69MqIB.js";import{b as I,c as je,T as E,u as U,a as ve,d as ge}from"./index-DHrhuTJB.js";import"./index-DI1MWXAu.js";import{S as Ne}from"./index-BQD2aveu.js";import"./workflow-DzDxRJlq.js";const L=m.createContext({}),O=()=>m.useContext(L),be="_edit_step_modal_v2k9j_1",we="_flow_work_v2k9j_16",H={edit_step_modal:be,flow_work:we},Te=o=>{const{message:t}=W.useApp(),[s]=I(),{modal:a}=W.useApp(),n=m.useRef(null),d=u(()=>n.current.getData()),r=u(()=>{var _;const l=d();if(!l.edges.length){t.error("The current flowchart is not completed.");return}(_=o.onSave)==null||_.call(o,l),s()}),i=u(()=>{a.confirm({rootClassName:"shopify",title:"Are you sure you want to leave?",content:"The data on this page will be lost after leaving.",okButtonProps:{className:"shopify"},cancelButtonProps:{className:"shopify"},okText:"Yes",onOk:()=>s()})});return je(async()=>Promise.reject()),e.jsx(z,{title:o.title,onBack:i,className:"shopify full-screen",extra:[e.jsx(Ne,{type:"primary",onClick:r,children:"Save"})],children:e.jsx(K,{className:"shopify full-content",children:e.jsx("div",{className:H.flow_work,children:e.jsx(St,{role:"child",ref:n,initialEdges:o.edges,initialNodes:o.nodes})})})})},Ce=o=>{const{trigger:t,modal:s,...a}=o;return e.jsx(E,{centered:!0,modal:s,width:"100vw",closable:!1,hasFooter:!1,trigger:t,className:H.edit_step_modal,children:e.jsx(Te,{...a})})},Se={style:{stroke:"#0143EC",strokeWidth:2},markerEnd:{color:"#0143EC",type:Y.ArrowClosed}},F={target:"Target",source:"Source"},ke=[{title:"Connection setting",valueType:"group",columns:[{title:"Enable",valueType:"switch",initialValue:!0,dataIndex:"connectionEnable"},{valueType:"dependency",name:["connectionEnable"],columns:({connectionEnable:o})=>{const t=[];return o&&t.push({title:"Types",valueType:"select",valueEnum:F,dataIndex:"connectionTypes",fieldProps:{mode:"multiple"},initialValue:Object.keys(F)}),t}}]}],Ee=o=>{const[t]=R.useForm(),[s]=I();return U(async()=>{var n;const a=await t.validateFields();(n=o.onSave)==null||n.call(o,a),s()}),e.jsx("div",{style:{padding:"24px 0 0 0"},children:e.jsx(G,{form:t,layout:"horizontal",columns:ke,submitter:!1,initialValues:o.formData})})},Fe="_dynamic_form_1eu5x_1",Pe={dynamic_form:Fe},V=o=>{const{schemas:t=[],formData:s}=o,[a]=R.useForm(),[n]=I(),d=m.useMemo(()=>t.map(pe),[t]),r=m.useMemo(()=>he(t),[t]),i=m.useMemo(()=>xe(t),[t]);return U(async()=>{var _;let l=await a.validateFields();l=ye(l,i,r),await((_=o.onSubmit)==null?void 0:_.call(o,{formData:l})),n()}),e.jsx("div",{className:Pe.dynamic_form,children:e.jsx(G,{form:a,submitter:!1,columns:d,initialValues:s})})},$e="_tool_bar_container_122m1_1",qe="_tool_bar_action_122m1_5",j={tool_bar_container:$e,tool_bar_action:qe},Me=o=>{var p;const{data:t}=o,s=t.values,{nodeType:a,formData:n,autoOpenStepCanvas:d=!0}=s,{role:r,deleteNode:i,updateNodeData:l}=O(),[_]=ve(),x=u(async c=>{l(o.id,Object.assign(t,c))}),P=u(async c=>{t.values=Object.assign(t.values,c),x(t)}),$=u(async c=>{x(c)}),q=u(c=>{t.values.stepRealData=c,x(t)}),M=u(()=>{r==="parent"&&a==="step"&&d&&(s.autoOpenStepCanvas=!1,requestAnimationFrame(()=>{_.openModal(),x(t)}))}),h=X("ai-node-tool-bar",j.tool_bar_container);return Z(M),e.jsx("div",{className:h,children:e.jsxs(J,{size:12,children:[e.jsx("div",{className:j.tool_bar_action,onClick:()=>i(o.id),children:e.jsx(ee,{})}),r==="parent"&&e.jsx(Ce,{...s.stepRealData,modal:_,title:(p=n.name)==null?void 0:p.value,onSave:q,trigger:e.jsx("div",{className:j.tool_bar_action,children:e.jsx(te,{})})}),e.jsx(E,{title:"Edit Node",okText:"Save",width:o.editModalWidth,trigger:e.jsx("div",{className:j.tool_bar_action,children:e.jsx(oe,{})}),children:e.jsx(V,{...o,onSubmit:P})}),e.jsx(E,{title:"Settings",okText:"Save",trigger:e.jsx("div",{className:j.tool_bar_action,children:e.jsx(ne,{})}),children:e.jsx(Ee,{formData:o.data,onSave:$})})]})})},Ae=o=>{const{connectionEnable:t=!0,connectionTypes:s=Object.keys(F)}=o.data,a=s.includes("target"),n=s.includes("source");return e.jsxs(m.Fragment,{children:[t&&a&&e.jsx("div",{className:"flow_handle_left",children:e.jsx(S,{type:"target",position:k.Left,className:"flow_handle",isConnectable:o.isConnectable})}),t&&n&&e.jsxs("div",{className:"flow_handle_right",children:[e.jsx(S,{type:"source",position:k.Right,className:"flow_handle",isConnectable:o.isConnectable}),e.jsx(A,{})]})]})},Q=[{type:"step",icon:"StepForwardOutlined",title:"Step",modalWidth:420,desc:"Execute the corresponding process according to the different branches created.",formSchema:[{title:"Name",name:"name",rules:[{required:!0}]},{title:"Description",name:"description",rules:[{required:!0}]},{name:"conditions",valueType:"formList",fieldProps:{creatorButtonProps:{creatorButtonText:"Add condition"}},columns:[{valueType:"group",columns:[{title:"Condition",name:"condition",fieldProps:{placeholder:"Please enter a condition"},width:"md",rules:[{required:!0}]}]}]}]},{type:"prompt",title:"Prompt",icon:"SendOutlined",modalWidth:420,desc:"Prompt the AI what to do or say.",formSchema:[{title:"Type",name:"type",valueType:"radio",valueEnum:{prompt:"Prompt",text:"Text"},initialValue:"prompt",rules:[{required:!0}]},{dependencys:[{name:"type",values:["text"],renders:[{title:"Text",name:"text",rules:[{required:!0}]}]},{name:"type",values:["prompt"],renders:[{title:"Prompt",name:"prompt",rules:[{required:!0}]}]}]}]},{type:"ui",title:"UI",icon:"KubernetesOutlined",desc:"The UI components within the AI assistant can be used as a data source to obtain data.",modalWidth:420,formSchema:[{valueType:"select",title:"Component",name:"name",rules:[{required:!0,message:"Please select Component"}],valueEnum:{UploadFile:"Upload File",GooglePlace:"Google Place",QuestionGroup:"Question Group"}},{dependencys:[{name:"name",values:["UploadFile","GooglePlace","QuestionGroup"],renders:[{title:"Text",name:"text",tooltip:"Description information of the selection component."},{title:"Wait For",name:"waitFor",tooltip:"Wait for the data output by the UI component.",rules:[{required:!0}]}]},{name:"name",values:["UploadFile"],renders:[{title:"Question",name:"question"},{title:"Contact uuid",name:"contactUuid",rules:[{required:!0}]}]},{name:"name",values:["GooglePlace"],renders:[{title:"Keyword",name:"keyword",tooltip:"The default search keywords for Google Place.",rules:[{required:!0}]},{title:"Google Api Key",name:"googleApiKey",rules:[{required:!0}]}]},{name:"name",values:["QuestionGroup"],renders:[{title:"Question Group uuid",name:"questionGroupUuid",rules:[{required:!0}]}]}]}]},{type:"branch",icon:"BranchesOutlined",title:"Branch",modalWidth:420,desc:"Execute the corresponding process according to the different branches created.",formSchema:[{title:"Name",name:"name",rules:[{required:!0}]},{title:"Text",name:"text",rules:[{required:!0}]},{name:"conditions",valueType:"formList",fieldProps:{creatorButtonProps:{creatorButtonText:"Add condition"}},columns:[{valueType:"group",columns:[{title:"Condition",name:"condition",fieldProps:{placeholder:"Please enter a condition"},width:"md",rules:[{required:!0}]}]}]}]},{type:"action",icon:"FunctionOutlined",title:"Action",modalWidth:420,desc:"Obtain or process data by calling backend interfaces or methods.",formSchema:[{title:"Type",name:"type",rules:[{required:!0}]},{title:"Text",name:"text",rules:[{required:!0}]}]},{type:"transform",icon:"BlockOutlined",title:"Transform",modalWidth:420,desc:"Convert the input data",formSchema:[{title:"Type",name:"type",rules:[{required:!0}]},{title:"Text",name:"text",rules:[{required:!0}]}]}],Ie="_node_layout_wrapper_xpd8g_1",Oe="_tool_bar_xpd8g_13",We="_node_layout_xpd8g_1",De="_node_layout_body_xpd8g_29",w={node_layout_wrapper:Ie,tool_bar:Oe,node_layout:We,node_layout_body:De};function N(o){const{data:t,children:s,handler:a=!0}=o,n=t.values,d=n.nodeType,r=m.useMemo(()=>fe(n.formData),[n.formData]),i=m.useMemo(()=>Q.find(_=>_.type===d),[d]),l=()=>{const _=e.jsx(Ae,{...o});if(a===!0)return _;if(typeof a=="function")return(a==null?void 0:a(r))??_};return e.jsxs("div",{className:w.node_layout_wrapper,children:[e.jsx("div",{className:w.tool_bar,children:e.jsx(Me,{id:o.id,data:t,formData:r,schemas:i==null?void 0:i.formSchema,editModalWidth:i==null?void 0:i.modalWidth})}),e.jsxs("div",{className:w.node_layout,children:[e.jsx("div",{className:w.node_layout_body,children:s==null?void 0:s(r)}),l()]})]})}const Be="_ui_node_ciuuw_1",Re="_ui_node_header_ciuuw_1",Ge="_ui_node_body_ciuuw_7",Ue="_ui_node_text_ciuuw_10",T={ui_node:Be,ui_node_header:Re,ui_node_body:Ge,ui_node_text:Ue},Le=o=>e.jsx(N,{...o,children:t=>e.jsxs("div",{className:T.ui_node,children:[e.jsx("div",{className:T.ui_node_header,children:t.name}),e.jsx("div",{className:T.ui_node_body,children:e.jsx("div",{className:T.ui_node_text,children:t.text})})]})}),He="_action_node_14v0w_1",Ve="_action_node_header_14v0w_1",Qe="_action_node_body_14v0w_7",ze="_action_node_text_14v0w_10",v={action_node:He,action_node_header:Ve,action_node_body:Qe,action_node_text:ze},Ke=o=>e.jsx(N,{...o,children:t=>e.jsxs("div",{className:v.action_node,children:[e.jsx("div",{className:v.action_node_header,children:"Action Node"}),e.jsxs("div",{className:v.action_node_body,children:[e.jsx("div",{className:v.action_node_text,children:t.type}),e.jsx("div",{className:v.action_node_text,children:t.text})]})]})}),Ye="_transform_node_1u43d_1",Xe="_transform_node_header_1u43d_1",Ze="_transform_node_body_1u43d_7",Je="_transform_node_text_1u43d_10",g={transform_node:Ye,transform_node_header:Xe,transform_node_body:Ze,transform_node_text:Je},et=o=>e.jsx(N,{...o,children:t=>e.jsxs("div",{className:g.transform_node,children:[e.jsx("div",{className:g.transform_node_header,children:"Transform Node"}),e.jsxs("div",{className:g.transform_node_body,children:[e.jsx("div",{className:g.transform_node_text,children:t.type}),e.jsx("div",{className:g.transform_node_text,children:t.text})]})]})}),tt="_step_node_1riik_1",ot="_step_node_header_1riik_1",nt="_step_node_body_1riik_7",st="_step_node_text_1riik_11",at="_conditions_1riik_19",dt="_condition_handle_1riik_25",f={step_node:tt,step_node_header:ot,step_node_body:nt,step_node_text:st,conditions:at,condition_handle:dt},rt=o=>{const{conditions:t=[],isConnectable:s}=o,{connectionEnable:a=!0,connectionTypes:n=Object.keys(F)}=o.data,d=n.includes("target"),r=n.includes("source");return e.jsxs(m.Fragment,{children:[a&&d&&e.jsx("div",{className:"flow_handle_left",children:e.jsx(S,{type:"target",position:k.Left,className:"flow_handle",isConnectable:s})}),a&&r&&e.jsx("div",{className:f.conditions,children:t.map((i,l)=>e.jsxs("div",{className:f.condition_handle,children:[e.jsx("span",{children:i.condition}),e.jsxs("div",{className:"flow_handle_right",children:[e.jsx(S,{type:"source",id:i.condition,position:k.Right,className:"flow_handle",isConnectable:s}),e.jsx(A,{})]})]},`key_${i.condition}_${l}`))})]})},B=o=>e.jsx(N,{...o,handler:t=>{const s=t.conditions;if(s!=null&&s.length)return e.jsx(rt,{...o,conditions:t.conditions})},children:t=>e.jsxs("div",{className:f.step_node,children:[e.jsx("div",{className:f.step_node_header,children:t.name}),e.jsx("div",{className:f.step_node_body,children:e.jsx("div",{className:f.step_node_text,children:t.text||t.description})})]})}),it="_prompt_node_syq2g_1",ct="_prompt_node_header_syq2g_1",lt="_prompt_node_body_syq2g_7",_t="_prompt_node_text_syq2g_10",C={prompt_node:it,prompt_node_header:ct,prompt_node_body:lt,prompt_node_text:_t},ut={text:"Text",prompt:"Prompt"},mt=o=>e.jsx(N,{...o,children:t=>e.jsxs("div",{className:C.prompt_node,children:[e.jsxs("div",{className:C.prompt_node_header,children:[ut[t.type]," Node"]}),e.jsx("div",{className:C.prompt_node_body,children:e.jsx("div",{className:C.prompt_node_text,children:t.text||t.prompt})})]})}),pt={ui:Le,action:Ke,transform:et,step:B,branch:B,prompt:mt},ht=o=>{const{fromX:t,fromY:s,toX:a,toY:n}=o;return e.jsxs("g",{children:[e.jsx("path",{fill:"none",stroke:"#0143EC",strokeWidth:2,className:"animated",d:`M${t},${s} C ${t} ${n} ${t} ${n} ${a},${n}`}),e.jsx("circle",{cx:a,cy:n,fill:"#fff",r:3,stroke:"#0143EC",strokeWidth:2})]})},xt="_nodes_1mo0o_1",yt="_node_item_1mo0o_4",ft="_node_icon_1mo0o_14",jt="_node_item_body_1mo0o_17",vt="_node_title_1mo0o_25",gt="_node_desc_1mo0o_30",y={nodes:xt,node_item:yt,node_icon:ft,node_item_body:jt,node_title:vt,node_desc:gt},Nt=o=>{const{onNodeClick:t}=o,{role:s}=O(),a=m.useMemo(()=>Q.filter(n=>s==="parent"?n.type==="step":n.type!=="step"),[s]);return e.jsx("div",{className:y.nodes,children:a.map(n=>{const d=se[n.icon];return e.jsx(E,{title:`Add ${n.title} Node`,width:n.modalWidth,destroyOnHidden:!0,okText:"Add Node",trigger:e.jsxs("div",{className:y.node_item,children:[e.jsx("div",{className:y.node_icon,children:e.jsx(d,{})}),e.jsxs("div",{className:y.node_item_body,children:[e.jsx("div",{className:y.node_title,children:n.title}),e.jsx("div",{className:y.node_desc,children:n.desc})]})]}),children:e.jsx(V,{schemas:n.formSchema,onSubmit:async r=>{const i=n.type;t==null||t({...r,nodeType:i})}})},n.type)})})},bt=o=>{const{open:t,trigger:s,onClose:a}=ge(o.trigger),n=u(d=>{var r;a(),(r=o.onChange)==null||r.call(o,d)});return e.jsxs(m.Fragment,{children:[e.jsx(ae,{open:t,width:320,destroyOnHidden:!0,title:o.title,onClose:a,rootClassName:"shopify",children:e.jsx(Nt,{onNodeClick:n})}),s]})},wt="_add_btn_z3xq6_1",Tt={add_btn:wt},Ct=()=>{const{insertNodes:o}=O(),t=u(s=>{const{nodeType:a}=s,n=`${a}_${de()}`;o([{id:n,type:a,data:{values:s},position:{x:0,y:0}}])});return e.jsx(bt,{title:"What triggers this workflow?",onChange:t,trigger:e.jsx("div",{className:Tt.add_btn,children:e.jsx(A,{})})})},St=m.forwardRef((o,t)=>{const{role:s="parent",initialNodes:a=[],initialEdges:n=[]}=o,[d,r,i]=re(a),[l,_,x]=ie(n),P=u(h=>{for(const p of h){if(d.length){const c=d.map(b=>b.position.x);p.position.x=Math.max(...c)+280}else{const c=p.data;c.connectionTypes||(c.connectionTypes=["source"])}d.push(p)}r([...d])}),$=u((h,p)=>{const c=d.findIndex(b=>b.id===h);c>-1&&(d[c].data=p,r(D(d)))}),q=u(h=>{const p=d.findIndex(c=>c.id===h);p>-1&&(d.splice(p,1),r([...d]))}),M=u(h=>{_(p=>ce(h,p).map(c=>({...c,...Se})))});return m.useImperativeHandle(t,()=>({getData:()=>D({nodes:d,edges:l})})),e.jsx(L.Provider,{value:{role:s,insertNodes:P,deleteNode:q,updateNodeData:$},children:e.jsx("div",{className:"ai_work_flow",children:e.jsx(le,{children:e.jsxs(_e,{fitView:!0,nodes:d,edges:l,minZoom:.5,nodeTypes:pt,onConnect:M,onNodesChange:i,onEdgesChange:x,connectionLineComponent:ht,children:[e.jsx(ue,{size:2,color:"#ccc",bgColor:"#f6f6f6"}),e.jsx(Ct,{}),e.jsx(me,{})]})})})})});export{St as default};
