import{m as T,u as n,b as t,w as N,a3 as O,a4 as L,a5 as U,j as r,M as z,y as I,k as q}from"./libs-DVH06oKf.js";import{T as w}from"./index-DI1MWXAu.js";import{S as E}from"./index-BQD2aveu.js";const A=s=>{const[e,o]=T(!1),a=n(()=>o(!0)),l=n(p=>{var u,i;a(),(i=(u=s.props).onClick)==null||i.call(u,p)}),f=n(()=>{o(!1)}),m=t.cloneElement(s,{onClick:l});return{open:e,onOpen:a,onClose:f,trigger:m}},h=()=>t.useContext(w),J=()=>[t.useRef({closeModal:()=>null,openModal:()=>null}).current],K=s=>{const{event:e}=h(),o=n(s);N(()=>e.on("ok",o)),O(()=>e.off("ok",o))},Q=s=>{const{event:e}=h(),o=n(s);N(()=>e.on("cancel",o)),O(()=>e.off("cancel",o))},V=()=>{const{closeModal:s}=h();return[s]},W=s=>{const{modal:e,okText:o,onOpen:a,onClose:l,trigger:f,className:m,rootClassName:p,hasFooter:u=!0,cancelText:i="Back",showCancel:S=!0,...M}=s,[d,k]=T(!1),{open:C,onClose:g,onOpen:b,trigger:P}=A(f),R=t.useMemo(()=>d?{...M,closable:!1}:M,[M,d]),y=t.useMemo(()=>new L,[]),j=n((c,x)=>y.listeners(c).map(B=>B(x))),F=n(async c=>{k(!0);try{await Promise.all(j("ok",c))}catch(x){console.error(x)}k(!1)}),v=n(async c=>{d||(await Promise.all(j("cancel",c)),g())});return t.useEffect(()=>{e&&(e.closeModal=g,e.openModal=b)},[e]),U(()=>{C?a==null||a():l==null||l()},[C]),r.jsxs(w.Provider,{value:{event:y,closeModal:g},children:[P,r.jsx(z,{...R,open:C,onCancel:v,rootClassName:I("shopify",p),className:m,footer:u?r.jsxs(t.Fragment,{children:[r.jsx(E,{type:"text",children:i,onClick:v,icon:r.jsx(q,{}),className:!S||d?"visb-hide":""}),r.jsx(E,{type:"primary",children:o,onClick:F})]}):null})]})};export{W as T,J as a,V as b,Q as c,A as d,K as u};
