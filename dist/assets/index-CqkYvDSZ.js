import{m as T,u as n,b as t,y as N,ac as O,ad as B,x as L,j as r,M as z,U as I,k as q}from"./libs-C65raxhD.js";import{T as S}from"./index-CFiK8WbN.js";import{S as E}from"./index-BmuJcdsb.js";const A=o=>{const[e,s]=T(!1),a=n(()=>s(!0)),d=n(p=>{var c,u;a(),(u=(c=o.props).onClick)==null||u.call(c,p)}),f=n(()=>{s(!1)}),m=t.cloneElement(o,{onClick:d});return{open:e,onOpen:a,onClose:f,trigger:m}},h=()=>t.useContext(S),J=()=>[t.useRef({closeModal:()=>null,openModal:()=>null}).current],K=o=>{const{event:e}=h(),s=n(o);N(()=>e.on("ok",s)),O(()=>e.off("ok",s))},Q=o=>{const{event:e}=h(),s=n(o);N(()=>e.on("cancel",s)),O(()=>e.off("cancel",s))},V=()=>{const{closeModal:o}=h();return[o]},W=o=>{const{modal:e,onOpen:s,onClose:a,trigger:d,className:f,rootClassName:m,okText:p="Save",hasFooter:c=!0,cancelText:u="Back",showCancel:b=!0,...M}=o,[i,k]=T(!1),{open:x,onClose:C,onOpen:w,trigger:P}=A(d),R=t.useMemo(()=>i?{...M,closable:!1}:M,[M,i]),v=t.useMemo(()=>new B,[]),y=n((l,g)=>v.listeners(l).map(U=>U(g))),F=n(async l=>{k(!0);try{await Promise.all(y("ok",l))}catch(g){console.error(g)}k(!1)}),j=n(async l=>{i||(await Promise.all(y("cancel",l)),C())});return t.useEffect(()=>{e&&(e.closeModal=C,e.openModal=w)},[e]),L(()=>{x?s==null||s():a==null||a()},[x]),r.jsxs(S.Provider,{value:{event:v,closeModal:C},children:[P,r.jsx(z,{...R,open:x,onCancel:j,rootClassName:I("shopify",m),className:f,footer:c?r.jsxs(t.Fragment,{children:[r.jsx(E,{type:"text",children:u,onClick:j,icon:r.jsx(q,{}),className:!b||i?"visb-hide":""}),r.jsx(E,{type:"primary",children:p,onClick:F})]}):null})]})};export{W as T,J as a,V as b,Q as c,A as d,K as u};
