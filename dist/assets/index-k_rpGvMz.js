import{b as h,e as _,H as U,J as q,K as A,L as De,Q as ne,v as Z,j as t,S as $e,U as Pe,V as We,X as Ae,Y as Re,Z as se,_ as oe,W as b,w as T,F as S,$ as O,a0 as qe,a1 as re,G as X,l as ae,m as R,a2 as Be,a3 as Me,a4 as He,a5 as Le,a6 as Ve,a7 as Ue,a8 as Oe,a9 as Xe,aa as Ye,ab as ze,ac as ce,ad as Ge,ae as Je,af as Ze,ag as Ke,ah as Qe,ai as et,aj as tt,M as nt,ak as le,s as Y,f as st,al as ot,n as rt,A as at,u as ct,D as lt,d as it,t as dt}from"./libs-CZ9azTWP.js";import{k as ut,g as mt}from"./workflow-BCRMZPof.js";import{c as K}from"./index-CpYUBmIE.js";import{T as pt,u as ht}from"./index-LqR22ykg.js";import{S as xt}from"./index-1JQ8SzD-.js";import{b as ft,u as _t}from"./hooks-CVF4ayDs.js";import{S as ie}from"./index-CoeBZIRU.js";import{S as gt}from"./index-B3Ktya6o.js";import"./generate-y9PIVPyp.js";function de(e){return[h.useRef(e).current]}function ue(e,n){const s=n(),o=_(()=>{!e||!s||Object.keys(s).forEach(a=>{e[a]=s[a]})});h.useEffect(o,[s,o])}const z="default_source_handle",G="default_target_handle",L="start-id",jt={id:L,type:"start",data:{formData:{}},position:{x:0,y:0}},me=h.createContext({}),pe=h.createContext({}),bt=()=>de({getData:()=>null}),he=()=>de({getData:()=>null}),y=()=>h.useContext(me),xe=()=>h.useContext(pe),fe=()=>{const e=U(),{openDetail:n}=y(),{addEdges:s,addNodes:o,getNodes:a}=q(),c=_(()=>{var p;const i=a().find(x=>x.id===e);let d=(i==null?void 0:i.position.x)||0;const u=(i==null?void 0:i.position.y)||0;return d=d+(((p=i==null?void 0:i.measured)==null?void 0:p.width)||0)+80,{x:d,y:u}});return[_(l=>{const i=A(),d=l.triggerId,u=l.nodeType;o({id:i,data:l,type:u,position:c()}),e&&s({id:A(),source:e,target:i,sourceHandle:d,targetHandle:G}),u==="step"&&n(i)})]},yt=()=>{const{detailId:e}=y();return ne().find(s=>s.id===e)},Nt=()=>{const e=yt();return e==null?void 0:e.data};function vt(){const e=U(),n=De(e);return n==null?void 0:n.data}function w(){const e=vt();return e==null?void 0:e.formData}const wt="_form_svv3s_1",Ct={form:wt},St=e=>{var a;const{onSubmit:n}=e,[s]=ft(),[o]=Z.useForm();return _t(async()=>{const c=await(o==null?void 0:o.validateFields());c&&await n(c),s()}),t.jsx(Z,{form:o,submitter:!1,className:Ct.form,initialValues:e.formData,children:(a=e.children)==null?void 0:a.call(e,o)})},_e=e=>{const{children:n,onSubmit:s,formData:o,...a}=e;return t.jsx(pt,{...a,children:t.jsx(St,{formData:o,onSubmit:s,children:n})})},Ft="_wrapper_fmhpg_4",It="_tools_fmhpg_4",Tt="_tool_item_fmhpg_15",Et="_inner_fmhpg_26",kt="_content_fmhpg_34",Dt="_handle_fmhpg_38",$t="_handle_source_fmhpg_39",Pt="_branch_fmhpg_59",Wt="_branch_item_fmhpg_63",At="_branch_label_fmhpg_71",j={wrapper:Ft,tools:It,tool_item:Tt,inner:Et,content:kt,handle:Dt,handle_source:$t,branch:Pt,branch_item:Wt,branch_label:At},Rt=e=>{const{nodeId:n,tools:s}=e,{editForm:o}=s,{top:a}=xe(),{openDetail:c}=y(),{setNodes:r,updateNodeData:l}=q(),i=w(),d=_(()=>{r(m=>m.filter(f=>f.id!==n))}),u=_(async m=>{l(n,{formData:m})}),p=_(()=>{c(n)}),x=m=>o?t.jsx(_e,{centered:!0,okText:"Save",destroyOnHidden:!0,trigger:m,formData:i,width:o.width,onSubmit:u,title:o.title||"Edit Node",children:f=>t.jsx(o.Component,{form:f})}):null;return t.jsxs($e,{size:16,children:[a&&t.jsx("div",{onClick:p,className:j.tool_item,children:t.jsx(Pe,{})}),x(t.jsx("div",{className:j.tool_item,children:t.jsx(Ae,{})})),t.jsx("div",{onClick:d,className:j.tool_item,children:t.jsx(We,{})})]})},qt="_atom_node_fh105_1",Bt="_atom_icon_fh105_11",Mt="_atom_content_fh105_21",Ht="_atom_title_fh105_24",Lt="_atom_desc_fh105_30",I={atom_node:qt,atom_icon:Bt,atom_content:Mt,atom_title:Ht,atom_desc:Lt},Q=e=>{const{Icon:n,...s}=e;return t.jsxs("div",{onClick:e.onClick,className:I.atom_node,children:[t.jsx("div",{className:I.atom_icon,children:t.jsx(n,{})}),t.jsxs("div",{className:I.atom_content,children:[t.jsx("div",{className:I.atom_title,children:s.title}),t.jsx("div",{className:I.atom_desc,children:s.desc})]})]})},Vt=e=>{const{triggerId:n,onChange:s,closeDrawer:o}=e,a=ne(),{top:c}=xe();return t.jsx(h.Fragment,{children:Fe.filter(r=>r.limit!==void 0?a.filter(i=>i.type===r.type).length<r.limit:c?r.top:!r.top).map(r=>{const{type:l,Component:i,...d}=r,u=i.Icon,p=i.Form,x=async(m={})=>{o(),s==null||s({nodeType:l,triggerId:n,formData:m})};return p?t.jsx(_e,{centered:!0,okText:"Add Node",onSubmit:x,width:i.modalWdith,title:`Add ${d.title} Node`,children:m=>t.jsx(p,{form:m}),trigger:t.jsx(Q,{...d,Icon:u})},l):h.createElement(Q,{...d,Icon:u,key:l,onClick:x})})})},ge=e=>{const{children:n,...s}=e,{open:o,trigger:a,onClose:c}=ht(n);return t.jsxs(t.Fragment,{children:[a,t.jsx(Re,{open:o,destroyOnHidden:!0,onClose:c,rootClassName:"shopify",title:"What triggers this workflow?",children:t.jsx(Vt,{...s,closeDrawer:c})})]})},ee=e=>{const{id:n,onChange:s}=e;return t.jsx(ge,{triggerId:n,onChange:s,children:t.jsx(se,{id:n,type:"source",position:oe.Right,className:j.handle_source})})},Ut=e=>{const{branch:n=[],onChange:s}=e;return n.length?t.jsx("div",{className:j.branch,children:n.map(o=>t.jsxs("div",{className:j.branch_item,children:[t.jsx("div",{className:j.branch_label,children:o.label}),t.jsx(ee,{id:o.id,onChange:s})]},o.id))}):t.jsx(ee,{id:z,onChange:s})},C=e=>{const{tools:n,branch:s=[],enableHandle:o}=e,{source:a=!0,target:c=!0}=o||{},r=U(),[l]=fe();return t.jsxs("div",{className:j.wrapper,children:[t.jsx("div",{className:j.tools,children:!!n&&r&&t.jsx(Rt,{nodeId:r,tools:n})}),t.jsxs("div",{className:j.inner,children:[c&&t.jsx(se,{type:"target",id:G,position:oe.Left,className:j.handle,isConnectableStart:!1}),t.jsx("div",{className:j.content,children:e.children}),a&&t.jsx(Ut,{branch:s,onChange:l})]})]})},Ot="_title_1tfkx_1",Xt="_description_1tfkx_6",M={title:Ot,description:Xt},F=e=>t.jsxs("div",{className:M.node_desc,children:[t.jsx("div",{className:M.title,children:e.title}),t.jsx("div",{className:M.description,children:e.desc})]}),Yt=e=>{const{inputParams:n=[]}=e;return n.map(s=>{const o=s.options,a={label:s.label,name:s.name,disabled:s.disabled,readonly:s.readonly,initialValue:s.initialValue,rules:[{required:s.required}]};return t.jsx(h.Fragment,{children:o!=null&&o.length?t.jsx(T,{...a,options:o}):t.jsx(b,{...a})},s.name)})},je=()=>{const{uiComponents:e=[]}=y(),n=e.map(s=>({label:s.componentName,value:s.componentTag}));return t.jsxs(h.Fragment,{children:[t.jsx(T,{label:"Component",name:"name",options:n,rules:[{required:!0}]}),t.jsx(S,{label:"Text",name:"text",rules:[{required:!0}]}),t.jsx(O,{name:["name"],children:({name:s})=>{const o=e.find(a=>a.componentTag===s);return t.jsx(Yt,{inputParams:o==null?void 0:o.input})}})]})},E=()=>{const e=w(),{uiComponents:n=[]}=y(),s=n.find(o=>o.componentTag===(e==null?void 0:e.name));return t.jsx(C,{tools:{editForm:{Component:je,title:"Edit Ui node",width:E.modalWdith}},children:t.jsx(F,{title:s==null?void 0:s.componentName,desc:e==null?void 0:e.text})})};E.Form=je;E.modalWdith=400;E.Icon=qe;const zt="_container_12b9h_1",Gt="_icon_12b9h_7",Jt="_text_12b9h_12",H={container:zt,icon:Gt,text:Jt},be=()=>t.jsx(C,{enableHandle:{target:!1},children:t.jsxs("div",{className:H.container,children:[t.jsx("div",{className:H.icon,children:t.jsx(re,{})}),t.jsx("div",{className:H.text,children:"Start"})]})});be.Icon=re;const ye=()=>{const e=h.useRef(void 0);return t.jsxs(h.Fragment,{children:[t.jsx(b,{name:"name",label:"Name",rules:[{required:!0}]}),t.jsx(S,{label:"Text",name:"text",rules:[{required:!1}]}),t.jsxs(X,{label:"Condition",name:"branch",copyIconProps:!1,actionRef:e,actionGuard:{beforeAddRow:()=>{var s;const n=A();return(s=e.current)==null||s.add({id:n}),!1}},children:[t.jsx(b,{name:"id",hidden:!0}),t.jsxs(ae,{gutter:16,children:[t.jsx(R,{span:12,children:t.jsx(b,{label:"Label",name:"label",rules:[{required:!0}]})}),t.jsx(R,{span:12,children:t.jsx(b,{label:"Value",name:"value",rules:[{required:!0}]})})]})]})]})},k=()=>{const e=w();return t.jsx(C,{branch:e==null?void 0:e.branch,tools:{editForm:{width:k.modalWdith,title:"Edit Branch node",Component:ye}},children:t.jsx(F,{title:e==null?void 0:e.name,desc:e==null?void 0:e.text})})};k.Form=ye;k.modalWdith=400;k.Icon=Be;var Ne=(e=>(e.Prompt="prompt",e.Text="text",e))(Ne||{});const V={prompt:"Prompt",text:"Text"},ve=()=>t.jsxs(h.Fragment,{children:[t.jsx(Me.Group,{label:"Type",name:"type",initialValue:Ne.Prompt,valueEnum:V,rules:[{required:!0}]}),t.jsx(O,{name:["type"],children:({type:e})=>e?t.jsx(S,{label:V[e],name:"text",rules:[{required:!0}]}):null})]}),D=()=>{const e=w(),n=e==null?void 0:e.type;return t.jsx(C,{tools:{editForm:{width:D.modalWdith,title:"Edit Prompt node",Component:ve}},children:t.jsx(F,{title:n&&V[n],desc:e==null?void 0:e.text})})};D.Form=ve;D.modalWdith=360;D.Icon=He;const te=["transform","value"],we=e=>{const{form:n}=e,{actions:s=[],transformTools:o}=y(),a=h.useMemo(()=>s.map(c=>({value:c.name,label:c.description})),[s]);return t.jsxs(h.Fragment,{children:[t.jsx(T,{label:"Action",name:"type",options:a,rules:[{required:!0}]}),t.jsx(S,{label:"Text",name:"text",rules:[{required:!1}]}),t.jsx(O,{name:["type"],children:({type:c})=>c?t.jsxs(h.Fragment,{children:[t.jsx(Le,{children:"Transform"}),t.jsx(T,{label:"Type",name:["transform","type"],options:o,rules:[{required:!1}],fieldProps:{onChange(r){const l=o==null?void 0:o.find(i=>i.value===r);n==null||n.setFieldValue(te,l==null?void 0:l.subValue)}}}),t.jsx(b,{hidden:!0,name:te}),t.jsx(X,{name:"attrs",label:"Attributes",creatorButtonProps:{creatorButtonText:"Add Attribute"},children:t.jsx(b,{name:"attr",width:"md",rules:[{required:!1}]})})]}):null})]})},$=()=>{const{actions:e=[]}=y(),n=w(),s=h.useMemo(()=>e.find(o=>(n==null?void 0:n.type)===o.name),[e,n==null?void 0:n.type]);return t.jsx(C,{tools:{editForm:{Component:we,title:"Edit Action node",width:$.modalWdith}},children:t.jsx(F,{title:s==null?void 0:s.name,desc:n==null?void 0:n.text})})};$.Form=we;$.modalWdith=400;$.Icon=Ve;const Ce=()=>{const{transformTools:e=[]}=y();return t.jsxs(h.Fragment,{children:[t.jsx(T,{options:e,label:"Type",name:"type",rules:[{required:!0}]}),t.jsx(S,{label:"Text",name:"text",rules:[{required:!0}]}),t.jsx(X,{name:"attrs",label:"Attributes",creatorButtonProps:{creatorButtonText:"Add Attribute"},children:t.jsxs(ae,{gutter:16,children:[t.jsx(R,{span:12,children:t.jsx(b,{label:"From",name:"from",rules:[{required:!0}]})}),t.jsx(R,{span:12,children:t.jsx(b,{label:"To",name:"to",rules:[{required:!0}]})})]})})]})},P=()=>{const{transformTools:e=[]}=y(),n=w(),s=h.useMemo(()=>e.find(o=>o.value===(n==null?void 0:n.type)),[e,n==null?void 0:n.type]);return t.jsx(C,{tools:{editForm:{width:P.modalWdith,title:"Edit Transform node",Component:Ce}},children:t.jsx(F,{title:s==null?void 0:s.label,desc:n==null?void 0:n.text})})};P.Form=Ce;P.modalWdith=450;P.Icon=Ue;const Se=()=>t.jsxs(h.Fragment,{children:[t.jsx(b,{label:"Name",name:"name",rules:[{required:!0}]}),t.jsx(S,{label:"Description",name:"description",rules:[{required:!1}]}),t.jsx(b,{name:"branch",hidden:!0})]}),W=()=>{const e=w();return t.jsx(C,{branch:e==null?void 0:e.branch,tools:{editForm:{Component:Se,title:"Edit Step node",width:W.modalWdith}},children:t.jsx(F,{title:e==null?void 0:e.name,desc:e==null?void 0:e.description})})};W.Form=Se;W.modalWdith=380;W.Icon=Oe;const Fe=[{limit:1,top:!0,type:"start",title:"Start",desc:"The starting node of a workflow.",Component:be},{top:!0,type:"step",title:"Step",desc:"Execute the corresponding process according to the different branches created.",Component:W},{type:"ui",title:"UI",desc:"The UI components within the AI assistant can be used as a data source to obtain data.",Component:E},{type:"branch",title:"Branch",desc:"Execute the corresponding process according to the different branches created.",Component:k},{type:"message",title:"Prompt",desc:"Prompt the AI what to do or say.",Component:D},{type:"action",title:"Action",desc:"Execute the corresponding process according to the different branches created.",Component:$},{type:"transform",title:"Transform",desc:"Convert the input data.",Component:P}],Zt=e=>{const{stroke:n}=e;return t.jsx("defs",{children:t.jsx("marker",{id:e.id,refX:"0",refY:"0",markerWidth:"12.5",markerHeight:"12.5",viewBox:"-10 -10 20 20",markerUnits:"strokeWidth",orient:"auto-start-reverse",style:{stroke:n,fill:n,strokeWidth:1},children:t.jsx("polyline",{strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})})})},Kt="_del_btn_7471i_1",Qt={del_btn:Kt},en=e=>{const{id:n,selected:s,sourceX:o,sourceY:a,targetX:c,targetY:r,sourcePosition:l,targetPosition:i}=e,{setEdges:d}=q(),[u,p,x]=Xe({sourceX:o,sourceY:a,targetX:c,targetY:r}),m=h.useMemo(()=>`translate(-50%, -50%) 
      translate(${p}px,${x}px)`,[p,x]),f=s?"#f40":"#0143EC",g=_(()=>{d(N=>N.filter(B=>B.id!==n))});return t.jsxs(h.Fragment,{children:[t.jsx(Zt,{stroke:f,id:n}),t.jsx(Ye,{sourceX:o,sourceY:a,targetX:c,targetY:r,markerEnd:`url(#${n})`,sourcePosition:l,targetPosition:i,style:{stroke:f,strokeWidth:2}}),t.jsx(ze,{children:s?t.jsx("div",{style:{transform:m},onClick:g,className:Qt.del_btn,children:t.jsx(ce,{})}):null})]})},tn={"step-edge":en},nn="_add_button_1ocve_1",sn={add_button:nn},on=()=>{const[e]=fe();return t.jsx(ge,{onChange:e,children:t.jsx("div",{className:sn.add_button,children:t.jsx(Ge,{})})})},rn=e=>{const{fromX:n,fromY:s,toX:o,toY:a}=e,c=(n+o)/2,r=`M${n},${s} H${c} V${a} H${o}`;return t.jsxs("g",{children:[t.jsx("path",{fill:"none",stroke:"#0143EC",strokeWidth:2,className:"animated",d:r}),t.jsx("circle",{cx:o,cy:a,fill:"#fff",r:3,stroke:"#0143EC",strokeWidth:2})]})},an=Fe.reduce((e,n)=>({...e,[n.type]:n.Component}),{}),Ie=e=>{const{canvas:n,top:s=!0,defaultNodes:o=[],defaultEdges:a=[]}=e,c=h.useMemo(()=>o.length?o:[K(jt)],[o]),[r,l,i]=Je(a),[d,u,p]=Ze(c),x=r.map(g=>({...g,type:"step-edge"})),m=_(g=>l(N=>Ke(g,N))),f=_(()=>K({edges:r,nodes:d,_v_:1}));return ue(n,()=>({getData:f})),t.jsx(pe,{value:{top:s},children:t.jsxs(Qe,{fitView:!0,minZoom:.5,nodes:d,edges:x,edgeTypes:tn,nodeTypes:an,onConnect:m,onNodesChange:p,onEdgesChange:i,onBeforeDelete:async g=>!g.nodes.length,connectionLineComponent:rn,children:[t.jsx(et,{size:2,color:"#ccc",bgColor:"#f6f6f6"}),t.jsx(tt,{}),t.jsx(on,{})]})})},Te=e=>{const n=new Map;for(const s of e){const o=s.source,a=n.get(o)||[];n.set(o,[...a,s])}return n},cn=(e,n="")=>({id:A(),source:e,target:n,sourceHandle:z,targetHandle:G}),ln=e=>{const n=[];for(const s of e){n.push(s);const o=s.target;e.find(a=>a.source===o)||n.push(cn(o))}return n};function dn(e){e=ln(e);const n=e.find(r=>r.source===L);if(!n)return e;const s=Te(e),o=[n];let a=n.target;const c=r=>s.get(r)||[];for(;c(a).length;){const[r]=c(a);o.push(r),a=r.target;const l=c(a).filter(i=>i.id!==r.id);s.set(a,l)}for(const r of e)o.some(l=>l.id===r.id)||o.push(r);return o.filter(r=>r.source!==L)}const un=e=>{var n,s;return((s=(n=e.data)==null?void 0:n.formData)==null?void 0:s.branch)||[]},mn=(e,n)=>[...Te(e)].map(([o,a])=>{const[c]=a,r=c.target,l={id:o};let i=[];return a.forEach(d=>{const u=d.target,p=d.sourceHandle,x=n(d.source);if(p===z)l.nextStep=u;else if(x){const m=un(x).find(f=>f.id===p);m&&i.push({id:m.id,label:m.label,condition:m.value,nextStep:u})}}),i.length?l.conditions=i:l.nextStep=r,l});function J(e,n=[]){const s=new Map,o=e.nodes||[],a=e.edges||[];for(const i of o)s.set(i.id,i);const c=i=>s.get(i),r=dn(a);return mn(r,c).map(i=>{const d=c(i.id),u=d==null?void 0:d.data,{branch:p,...x}={...u==null?void 0:u.formData},m={...i,type:d==null?void 0:d.type,formData:x};if(p!=null&&p.length){const f=i.conditions||n;m.conditions=p.map(g=>{const N=f.find(B=>B.id===g.id);return{id:g.id,label:g.label,condition:g.value,nextStep:N==null?void 0:N.nextStep}})}return u!=null&&u.details&&(m.details=J(u==null?void 0:u.details,m.conditions)),m})}const pn=e=>{var a;const n=[],o=J(e).filter(c=>!c.nextStep);for(const c of o)(a=c.conditions)!=null&&a.length&&c.conditions.forEach(r=>{r.nextStep||n.push({id:r.id,label:r.label,value:r.condition})});return n},hn="_detail_1hmmw_1",xn="_show_1hmmw_14",fn="_layer_1hmmw_19",_n="_layer_content_1hmmw_25",gn="_layer_header_1hmmw_28",jn="_close_btn_1hmmw_33",bn="_title_1hmmw_46",v={detail:hn,show:xn,layer:fn,layer_content:_n,layer_header:gn,close_btn:jn,title:bn},yn=()=>{var x;const e=Nt(),[n]=he(),{updateNodeData:s}=q(),[o,a]=nt.useModal(),{closeDetail:c,detailId:r}=y(),l=e==null?void 0:e.details,i=l==null?void 0:l.nodes,d=l==null?void 0:l.edges,u=_(()=>{const m=n.getData(),f=pn(m),g={...e==null?void 0:e.formData,branch:f};s(r,{details:m,formData:g}),c()}),p=_(()=>{o.confirm({title:"Are you sure you want to leave?",content:"The data on this page will be lost after leaving.",okText:"Yes",okButtonProps:{className:"shopify"},cancelButtonProps:{className:"shopify"},onOk:c})});return t.jsxs("div",{className:v.layer,children:[t.jsxs("div",{className:v.layer_header,children:[t.jsx("div",{onClick:p,className:v.close_btn,children:t.jsx(ce,{})}),t.jsx("div",{className:v.title,children:(x=e==null?void 0:e.formData)==null?void 0:x.name}),t.jsx(ie,{type:"primary",onClick:u,children:"Save"})]}),t.jsx("div",{className:v.layer_content,children:t.jsx(le,{children:t.jsx(Ie,{top:!1,canvas:n,defaultNodes:i,defaultEdges:d})})}),a]})},Nn=()=>{const{detailId:e}=y(),[n,s]=Y(!1),o=_(()=>s(!0)),a=_(()=>s(!1));st(()=>{e?o():setTimeout(a,400)},[e]);const c=ot(v.detail,!!e&&v.show);return t.jsx("div",{className:c,children:n&&t.jsx(yn,{})})},vn=e=>{const{children:n,...s}=e,[o,a]=Y(),c=_(l=>{a(l)}),r=_(()=>{a(void 0)});return t.jsx(me.Provider,{value:{...s,detailId:o,openDetail:c,closeDetail:r},children:n})},wn=e=>{const[n]=he(),s=_(()=>{const o=n.getData();return{realDetails:o,assembleData:J(o)}});return ue(e.flow,()=>({getData:s})),t.jsx(le,{children:t.jsxs(vn,{...e,children:[t.jsx(Ie,{...e,canvas:n}),t.jsx(Nn,{})]})})},Cn=(e={})=>Object.keys(e).reduce((n,s)=>{var a,c;let o=(a=e[s])==null?void 0:a.value;if(s==="conditions"){s="branch";const r=o;o=(c=r==null?void 0:r.map)==null?void 0:c.call(r,l=>({label:l.condition,value:l.condition}))}return{...n,[s]:o}},{}),Ee=e=>{if(e!=null&&e._v_)return e;let n=(e==null?void 0:e.nodes)||[];return n=n.map(s=>{var a;const o=(a=s==null?void 0:s.data)==null?void 0:a.values;return{...s,data:{nodeType:o==null?void 0:o.nodeType,formData:Cn(o==null?void 0:o.formData),details:Ee(o==null?void 0:o.stepRealData)}}}),{...e,nodes:n}},Sn=e=>e.map(n=>({componentName:n.tag_name,componentTag:n.tag_name,componentId:n.ui_component_uuid,componentType:n.ui_component_type,input:n.parameters.map(s=>{let o=s.parameter;return o&&(o=`{${o}}`),{required:!0,label:s.name,name:s.name,initialValue:o}})})),Fn=e=>e.reduce((s,o)=>[...s,...o.tools],[]).map(s=>({name:s.name,description:s.description})),In=()=>[{label:"Summarize",value:"summarize"},{label:"Full content",value:"full_content"},{label:"Structure input",value:"structure_input",subValue:"data_collect_dataset"}],Tn="_loading_1cv3a_1",En="_container_1cv3a_7",ke={loading:Tn,container:En},kn=e=>{const{promptTemplate:n,flowRelationship:s}=e.detail,o=Fn(n.mcp_servers),a=In(),c=Sn(n.ui_components),r=h.useMemo(()=>{const l=s?JSON.parse(s):{};return Ee(l)},[s,c]);return t.jsx(rt,{className:"shopify full-content",children:t.jsx("div",{className:ke.container,children:t.jsx(wn,{flow:e.flow,actions:o,uiComponents:c,transformTools:a,defaultEdges:r.edges,defaultNodes:r.nodes})})})};function Hn(){var d;const{message:e}=at.useApp(),[n]=bt(),[s]=ct(),o=lt(),[a,c]=Y(!1),{data:r}=it(async()=>(await ut({flowSnippetUuid:o.uid,flowSnippetVersionUuid:o.vid})).flowSnippet),l=(d=r==null?void 0:r.promptTemplate)==null?void 0:d.prompt_uuid,i=_(async()=>{const u=n.getData();console.log(u);const{flowSnippetVersionUuid:p,...x}=r,m=s.get("type"),f={};m==="new"&&(f.flowSnippetVersionUuid=p),await mt({...x,...f,promptUuid:l,flowContext:JSON.stringify(u.assembleData),flowRelationship:JSON.stringify(u.realDetails)}),e.success("Workflow saved successfully"),c(!1)});return t.jsx(dt,{title:r==null?void 0:r.flowName,className:"shopify full-screen",loading:!r&&t.jsx("div",{className:ke.loading,children:t.jsx(xt,{size:36})}),extra:r?t.jsx(ie,{type:"primary",className:"shopify",onClick:i,children:"Save"}):null,children:t.jsx(gt,{loading:a,children:!!r&&t.jsx(kn,{flow:n,detail:r})})})}export{Hn as default};
