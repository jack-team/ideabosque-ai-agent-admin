import{v as x,j as e,l as P,m as h,n as B,G as J,b as D,ac as Q,w as b,F as U,W as y,B as C,X as Y,A as L,$ as T,e as z,t as Z,P as ee,S as se,ao as re}from"./libs-Da1xhxe8.js";import"./index-cDxTFrDX.js";import{T as I}from"./index-azhqWN_S.js";import{f as $}from"./index-WkG41BTg.js";import{e as te,f as ne,b as ae,i as R,g as ie,h as oe}from"./useFetchData-D3rdYpaT.js";import{b as k,u as E}from"./hooks-DgQYNG5A.js";import{_ as W}from"./lodash-CVNXO-QW.js";import{c as le}from"./index-DZTv9VCO.js";import{T as ce,S as de}from"./map-BPCwAIgA.js";import{S as q}from"./enum-Ct7sVdAK.js";import{I as ue}from"./index-Cm1ycU0f.js";import me from"./index-00ai6cbV.js";import"./index-DOlX-KTV.js";import"./workflow-D4Fwjahs.js";import"./generate-BbxGqW4z.js";import"./wizard-BeYj1Z0w.js";import"./contactProfiles-xaivOmsI.js";const pe={type:"object",properties:{name:{type:"string"},description:{type:"string"},type:{type:"string",enum:["string","object"]}},required:["name","type","description"]},V=r=>{const t={...r.properties},i=r.required||[];return Object.keys(t).map(l=>{var u;const a=t[l];let n=a.items;const c=i.includes(l),s=(u=a.enum)==null?void 0:u.map(m=>({label:m,value:m})),o={label:l,name:l,required:c,type:a.type,minimum:a.minimum,maximum:a.maximum};if(a.definitions=r.definitions,n&&(n.definitions=r.definitions),"$ref"in a&&(n=pe),s&&(o.options=s),n){const m=V(n);o.items=m}if(a.description&&(o.tip=a.description),a.properties){const m=V(a);o.children=m}return o})};function fe(r,t={}){const{min:i,max:l,allowDecimal:a}=t;if(!(a?/^\d+(\.\d+)?$/:/^\d+$/).test(r))return{success:!1,message:"Please enter a number"};const o=parseFloat(r);return i!==void 0&&o<i?{success:!1,message:`The input number cannot be less than ${i}.`}:l!==void 0&&o>l?{success:!1,message:`The input number cannot be greater than ${i}.`}:{success:!0,message:"Success."}}const ge=r=>{r=le(r);const t=i=>{Object.keys(i).forEach(l=>{const a=i[l];if(a!=null&&a.properties){const n=a.properties;i[l]=Object.keys(n).map(c=>{const s=n[c];return{name:c,type:s.type,description:s.description}});return}W.isObject(a)&&(W.isArray(a)?a.forEach(t):t(a))})};return t(r),r},he="_wrapper_olkgz_1",xe="_schema_form_olkgz_8",je="_del_btn_olkgz_11",M={wrapper:he,schema_form:xe,del_btn:je},H=2,ye=r=>{const{schema:t,value:i}=r,[l]=x.useForm(),[a]=k(),n=V(t),c=(s,o=[],u,m)=>{const f=s.items||[],N=s.options||[],F=s.children||[],v=o.concat(s.name).filter(d=>d),S={name:v,label:s.label,tooltip:s.tip,rules:[{required:s.required}]},A=v.join("");if(f.length)return e.jsx(h,{span:24,children:e.jsx(x.Item,{children:e.jsx(B,{title:s.label,className:"shopify",children:e.jsx(J,{name:s.name,alwaysShowItemLabel:!0,creatorButtonProps:{creatorButtonText:"Add item"},actionRender:()=>[],required:s.required,rules:[{validator(d,p,g){if(s.required&&!p.length){g("Please add item");return}g()}}],children:(d,p,g)=>e.jsxs(D.Fragment,{children:[e.jsx("div",{className:M.del_btn,onClick:()=>g.remove(p),children:e.jsx(Q,{})}),e.jsx(P,{gutter:16,children:f.map((j,X)=>c(j,[],f,X))})]})})})})},A);if(F.length)return e.jsx(h,{span:24,children:e.jsx(B,{title:s.label,className:"shopify",style:{marginBottom:24},children:e.jsx(P,{gutter:16,children:F.map((d,p)=>c(d,v,F,p))})})},A);const _=d=>{var p,g,j;return((p=d==null?void 0:d.children)==null?void 0:p.length)||((g=d==null?void 0:d.options)==null?void 0:g.length)||((j=d==null?void 0:d.items)==null?void 0:j.length)||(d==null?void 0:d.type)==="object"||(d==null?void 0:d.type)==="array"};let w=H;const O=u.length;if(!(u.findIndex(_)>-1))O%H!==0&&m===O-1&&(w=1);else{const d=u[m-1],p=u[m+1];(_(d)&&_(p)||_(d)&&!p||!d&&_(p))&&(w=1)}return N.length?e.jsx(h,{span:24,children:e.jsx(b,{...S,options:N})},A):s.type==="object"||s.type==="array"?e.jsx(h,{span:24,children:e.jsx(U,{...S})},A):e.jsx(h,{span:24/w,children:e.jsx(y,{...S,rules:[{validator(d,p,g){if(s.required&&!p){g("Please enter");return}if(s.type==="integer"){const j=fe(p,{min:s.minimum,max:s.maximum});if(!j.success){g(j.message);return}}g()}}]})},A)};return E(async()=>{var o;const s=await l.validateFields();(o=r.onChange)==null||o.call(r,s),a()}),e.jsx(x,{form:l,submitter:!1,initialValues:ge({...i}),className:M.schema_form,children:e.jsx(P,{gutter:16,children:n.map((s,o)=>c(s,[],n,o))})})},be=r=>e.jsx("div",{className:M.wrapper,children:e.jsx(I,{width:640,title:"Edit Config",destroyOnHidden:!0,trigger:e.jsx(C,{icon:e.jsx(Y,{}),className:"shopify",children:"Edit Config"}),children:e.jsx(ye,{...r})})}),K="__",ve=r=>{if(!r)return;const{llm:t,flowSnippet:i,mcpServers:l,agentVersionUuid:a,...n}=r,c=[i==null?void 0:i.flow_snippet_uuid,i==null?void 0:i.flow_snippet_version_uuid].filter(o=>o).join(K),s=l.map(o=>o.mcp_server_uuid);return{...n,mcpServerUuids:s,flowSnippet:c,llmName:t==null?void 0:t.llm_name,llmProvider:t==null?void 0:t.llm_provider,configurationSchema:t==null?void 0:t.configuration_schema}},Se=r=>{const{flowSnippet:t,...i}=r,[,l]=t.split(K);return{...i,flowSnippetVersionUuid:l,updatedBy:"Admin"}},G=r=>{const{formData:t}=r,i=te(),l=ne(),a=ae(),[n]=x.useForm(),{message:c}=L.useApp(),[s]=k(),o=D.useMemo(()=>ve(t),[t]);return E(async()=>{var f;const u=await n.validateFields(),m=Se(u);try{await R(m),s(),(f=r.onSuccess)==null||f.call(r),c.success(`Agent ${t?"updated":"created"} successfully.`)}catch{c.error(`Failed to ${t?"updated":"created"} Agent.`)}}),e.jsxs(x,{form:n,submitter:!1,initialValues:o,style:{padding:"24px 0 0 0"},children:[e.jsx(y,{hidden:!0,name:"agentUuid"}),e.jsx(y,{hidden:!0,name:"configurationSchema"}),e.jsx(y,{label:"Agent Name",name:"agentName",rules:[{required:!0}]}),e.jsx(U,{label:"Agent Description",name:"agentDescription",rules:[{required:!0}]}),e.jsx(b,{label:"Tool Call Role",name:"toolCallRole",valueEnum:ce,rules:[{required:!0}]}),e.jsxs(P,{gutter:16,children:[e.jsx(h,{span:12,children:e.jsx(b,{label:"LLM Provider",name:"llmProvider",options:i.options,fieldProps:{loading:i.loading,onChange:(u,m)=>{if(!Array.isArray(m)){const f=m==null?void 0:m.realData;n.setFieldsValue({llmName:f==null?void 0:f.llmName,configurationSchema:f.configurationSchema})}}},rules:[{required:!0}]})}),e.jsx(h,{span:12,children:e.jsx(y,{name:"llmName",label:"LLM Name",disabled:!0,rules:[{required:!0}]})}),e.jsx(h,{span:12,children:e.jsx(b,{label:"Connected Workflows",name:"flowSnippet",options:l.options,fieldProps:{loading:l.loading,onChange:(u,m)=>{if(m){const v=m.realData.promptTemplate.mcp_servers.map(S=>S.mcp_server_uuid);n.setFieldValue("mcpServerUuids",v)}else n.setFieldValue("mcpServerUuids",o==null?void 0:o.mcpServerUuids)}}})}),e.jsx(h,{span:12,children:e.jsx(y,{label:"Num of Messages",name:"numOfMessages",rules:[{required:!0}]})})]}),e.jsx(T,{name:["flowSnippet"],children:({flowSnippet:u})=>e.jsx(U,{disabled:!!u,label:"Instructions",name:"instructions",fieldProps:{rows:10}})}),e.jsx(T,{name:["configurationSchema"],children:({configurationSchema:u})=>u?e.jsx(x.Item,{name:"configuration",label:"Configuration",rules:[{required:!0}],children:e.jsx(be,{schema:u})}):null}),e.jsx(T,{name:["flowSnippet"],children:({flowSnippet:u})=>e.jsx(b,{disabled:!!u,label:"MCP Servers",name:"mcpServerUuids",mode:"multiple",options:a.options,fieldProps:{maxTagCount:1,loading:a.loading},rules:[{required:!0}]})})]})},Ae=r=>{const{formData:t}=r,[i]=x.useForm(),{message:l}=L.useApp(),[a]=k();E(async()=>{var o;const s=await i.validateFields();try{await R({...s,status:q.Active,updatedBy:"Admin"}),a(),(o=r.onSuccess)==null||o.call(r),l.success("The version has been applied successfully.")}catch{l.error("The version application failed.")}});const{options:n,loading:c}=ie(t==null?void 0:t.agentUuid);return e.jsxs(x,{form:i,initialValues:t,submitter:!1,style:{padding:"24px 0 0 0"},children:[e.jsx(y,{hidden:!0,name:"agentUuid"}),e.jsx(b,{label:"Versions",name:"agentVersionUuid",options:n,fieldProps:{loading:c},rules:[{required:!0}]})]})},_e=()=>{const{modal:r,message:t}=L.useApp(),i=D.useRef(null),l=z(()=>{var n;(n=i.current)==null||n.reload()}),a=z(n=>{r.confirm({title:"Are you sure you want to archive?",okText:"Archive",okButtonProps:{danger:!0,className:"shopify"},onOk:async()=>{try{await R({agentUuid:n.agentUuid,agentVersionUuid:n.agentVersionUuid,status:q.Inactive,updatedBy:"Admin"}),l(),t.success("Archiving succeeded")}catch{t.error("Archiving failed")}}})});return e.jsx(Z,{title:"Agents",className:"shopify",extra:e.jsx(I,{width:620,className:"shopify",title:"Create agent",trigger:e.jsx(C,{className:"shopify",type:"primary",children:"Add agent"}),children:e.jsx(G,{})}),children:e.jsx(ee,{actionRef:i,search:!1,size:"small",options:!1,rowKey:"agentUuid",className:"shopify",pagination:{defaultPageSize:5},scroll:{x:"max-content"},request:async n=>{const{current:c,pageSize:s,...o}=n,{agentList:u}=await oe({limit:s,pageNumber:c,statuses:[q.Active],...o});return{total:u.total,data:u.agentList}},columns:[{title:"Agent Name",dataIndex:"agentName"},{title:"Agent UUID",dataIndex:"agentUuid"},{title:"Status",dataIndex:"status",valueEnum:de,hideInSearch:!0},{title:"Create at",dataIndex:"createdAt",hideInSearch:!0,render:(n,c)=>$(c.createdAt)},{title:"Update at",dataIndex:"updatedAt",hideInSearch:!0,render:(n,c)=>$(c.updatedAt)},{width:"240px",key:"action",title:"Action",align:"center",hideInSearch:!0,render:(n,c)=>e.jsxs(se,{children:[e.jsx(I,{width:620,destroyOnHidden:!0,className:"shopify",title:"Create agent",trigger:e.jsx(ue,{icon:re}),children:e.jsx(G,{formData:c,onSuccess:l})}),e.jsx(I,{width:400,title:"Versions",destroyOnHidden:!0,okText:"Apply",trigger:e.jsx(C,{size:"small",className:"shopify",children:"Versions"}),children:e.jsx(Ae,{formData:c,onSuccess:l})}),e.jsx(C,{danger:!0,size:"small",className:"shopify",onClick:()=>a(c),children:"Archive"})]})}]})})},ze=()=>e.jsxs("div",{children:[e.jsx(_e,{}),e.jsx(me,{})]});export{ze as default};
