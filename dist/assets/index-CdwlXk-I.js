import{b as m,f,J as k,K as O,L as M,Q as De,U as ne,w as K,j as t,S as $e,V as Pe,X as Re,Y as We,Z as Ae,_ as se,$ as oe,W as j,x as D,G as S,a0 as X,a1 as qe,a2 as re,H as B,m as Y,n as C,a3 as Me,a4 as Be,a5 as He,a6 as Le,a7 as Ve,a8 as Ue,a9 as Oe,aa as Xe,ab as Ye,ac as ze,ad as ae,ae as Ge,af as Je,ag as Ze,ah as Ke,ai as Qe,aj as et,ak as tt,M as nt,al as ce,t as z,h as st,am as ot,o as rt,A as at,u as ct,F as lt,e as it,v as dt}from"./libs-D5B5wwwg.js";import{k as ut,g as mt}from"./workflow-B8PrO1i8.js";import{c as Q}from"./index-BvUVULcg.js";import{T as pt,u as ht}from"./index-DxfRQvgU.js";import{S as xt}from"./index-CjBJILie.js";import{b as ft,u as _t}from"./hooks-By_cjNwK.js";import{S as le}from"./index-BvR2vCaW.js";import{S as gt}from"./index-JfDmPBEP.js";import"./generate-NHA9qDyO.js";function ie(e){return[m.useRef(e).current]}function de(e,n){const s=n(),o=f(()=>{!e||!s||Object.keys(s).forEach(a=>{e[a]=s[a]})});m.useEffect(o,[s,o])}const G="default_source_handle",J="default_target_handle",V="start-id",jt={id:V,type:"start",data:{formData:{}},position:{x:0,y:0}},ue=e=>{const n=new Map;for(const s of e){const o=s.source,a=n.get(o)||[];n.set(o,[...a,s])}return n},bt=(e,n="")=>({id:k(),source:e,target:n,sourceHandle:G,targetHandle:J}),yt=e=>{const n=[];for(const s of e){n.push(s);const o=s.target;e.find(a=>a.source===o)||n.push(bt(o))}return n};function Nt(e){e=yt(e);const n=e.find(r=>r.source===V);if(!n)return e;const s=ue(e),o=[n];let a=n.target;const c=r=>s.get(r)||[];for(;c(a).length;){const[r]=c(a);o.push(r),a=r.target;const l=c(a).filter(i=>i.id!==r.id);s.set(a,l)}for(const r of e)o.some(l=>l.id===r.id)||o.push(r);return o.filter(r=>r.source!==V)}const vt=e=>[...ue(e)].map(([s,o])=>{const[a]=o,c=a.target,r={id:s};let l=[];return o.forEach(i=>{const d=i.target,u=i.sourceHandle;u===G?r.nextStep=d:l.push({condition:u,nextStep:d})}),l.length?r.conditions=l:r.nextStep=c,r});function Z(e,n=[]){const s=new Map,o=e.nodes||[],a=e.edges||[];for(const i of o)s.set(i.id,i);const c=Nt(a),r=vt(c),l=i=>s.get(i);return r.map(i=>{const d=l(i.id),u=d==null?void 0:d.data,{branch:h,...x}={...u==null?void 0:u.formData},p={...i,type:d==null?void 0:d.type,formData:x};if(h!=null&&h.length){const _=i.conditions||n;p.conditions=h.map(g=>{const I=g.value,T=_.find(ke=>ke.condition===I);return{label:g.label,condition:g.value,nextStep:T==null?void 0:T.nextStep}})}return u!=null&&u.details&&(p.details=Z(u==null?void 0:u.details,p.conditions)),p})}const wt=e=>{var a;const n=[],o=Z(e).filter(c=>!c.nextStep);for(const c of o)(a=c.conditions)!=null&&a.length&&c.conditions.forEach(r=>{r.nextStep||n.push({label:r.label,value:r.condition})});return n},me=m.createContext({}),pe=m.createContext({}),Ct=()=>ie({getData:()=>null}),he=()=>ie({getData:()=>null}),y=()=>m.useContext(me),xe=()=>m.useContext(pe),fe=()=>{const e=O(),{openDetail:n}=y(),{addEdges:s,addNodes:o,getNodes:a}=M(),c=f(()=>{var h;const i=a().find(x=>x.id===e);let d=(i==null?void 0:i.position.x)||0;const u=(i==null?void 0:i.position.y)||0;return d=d+(((h=i==null?void 0:i.measured)==null?void 0:h.width)||0)+80,{x:d,y:u}});return[f(l=>{const i=k(),d=l.triggerId,u=l.nodeType;o({id:i,data:l,type:u,position:c()}),e&&s({id:k(),source:e,target:i,sourceHandle:d,targetHandle:J}),u==="step"&&n(i)})]},St=()=>{const{detailId:e}=y();return ne().find(s=>s.id===e)},Ft=()=>{const e=St();return e==null?void 0:e.data};function It(){const e=O(),n=De(e);return n==null?void 0:n.data}function v(){const e=It();return e==null?void 0:e.formData}const Tt="_form_svv3s_1",Et={form:Tt},kt=e=>{var a;const{onSubmit:n}=e,[s]=ft(),[o]=K.useForm();return _t(async()=>{const c=await(o==null?void 0:o.validateFields());c&&await n(c),s()}),t.jsx(K,{form:o,submitter:!1,className:Et.form,initialValues:e.formData,children:(a=e.children)==null?void 0:a.call(e,o)})},_e=e=>{const{children:n,onSubmit:s,formData:o,...a}=e;return t.jsx(pt,{...a,children:t.jsx(kt,{formData:o,onSubmit:s,children:n})})},Dt="_wrapper_fmhpg_4",$t="_tools_fmhpg_4",Pt="_tool_item_fmhpg_15",Rt="_inner_fmhpg_26",Wt="_content_fmhpg_34",At="_handle_fmhpg_38",qt="_handle_source_fmhpg_39",Mt="_branch_fmhpg_59",Bt="_branch_item_fmhpg_63",Ht="_branch_label_fmhpg_71",b={wrapper:Dt,tools:$t,tool_item:Pt,inner:Rt,content:Wt,handle:At,handle_source:qt,branch:Mt,branch_item:Bt,branch_label:Ht},Lt=e=>{const{nodeId:n,tools:s}=e,{editForm:o}=s,{top:a}=xe(),{openDetail:c}=y(),{setNodes:r,updateNodeData:l}=M(),i=v(),d=f(()=>{r(p=>p.filter(_=>_.id!==n))}),u=f(async p=>{l(n,{formData:p})}),h=f(()=>{c(n)}),x=p=>o?t.jsx(_e,{centered:!0,okText:"Save",destroyOnHidden:!0,trigger:p,formData:i,width:o.width,onSubmit:u,title:o.title||"Edit Node",children:_=>t.jsx(o.Component,{form:_})}):null;return t.jsxs($e,{size:16,children:[a&&t.jsx("div",{onClick:h,className:b.tool_item,children:t.jsx(Pe,{})}),x(t.jsx("div",{className:b.tool_item,children:t.jsx(We,{})})),t.jsx("div",{onClick:d,className:b.tool_item,children:t.jsx(Re,{})})]})},Vt="_atom_node_fh105_1",Ut="_atom_icon_fh105_11",Ot="_atom_content_fh105_21",Xt="_atom_title_fh105_24",Yt="_atom_desc_fh105_30",E={atom_node:Vt,atom_icon:Ut,atom_content:Ot,atom_title:Xt,atom_desc:Yt},ee=e=>{const{Icon:n,...s}=e;return t.jsxs("div",{onClick:e.onClick,className:E.atom_node,children:[t.jsx("div",{className:E.atom_icon,children:t.jsx(n,{})}),t.jsxs("div",{className:E.atom_content,children:[t.jsx("div",{className:E.atom_title,children:s.title}),t.jsx("div",{className:E.atom_desc,children:s.desc})]})]})},zt=e=>{const{triggerId:n,onChange:s,closeDrawer:o}=e,a=ne(),{top:c}=xe();return t.jsx(m.Fragment,{children:Fe.filter(r=>r.limit!==void 0?a.filter(i=>i.type===r.type).length<r.limit:c?r.top:!r.top).map(r=>{const{type:l,Component:i,...d}=r,u=i.Icon,h=i.Form,x=async(p={})=>{o(),s==null||s({nodeType:l,triggerId:n,formData:p})};return h?t.jsx(_e,{centered:!0,okText:"Add Node",onSubmit:x,width:i.modalWdith,title:`Add ${d.title} Node`,children:p=>t.jsx(h,{form:p}),trigger:t.jsx(ee,{...d,Icon:u})},l):m.createElement(ee,{...d,Icon:u,key:l,onClick:x})})})},ge=e=>{const{children:n,...s}=e,{open:o,trigger:a,onClose:c}=ht(n);return t.jsxs(t.Fragment,{children:[a,t.jsx(Ae,{open:o,destroyOnHidden:!0,onClose:c,rootClassName:"shopify",title:"What triggers this workflow?",children:t.jsx(zt,{...s,closeDrawer:c})})]})},Gt=e=>{const{branch:n=[]}=e,s=o=>t.jsx(ge,{triggerId:o,onChange:e.onChange,children:t.jsx(se,{id:o,type:"source",position:oe.Right,className:b.handle_source})});return n.length?t.jsx("div",{className:b.branch,children:n.map(o=>t.jsxs("div",{className:b.branch_item,children:[t.jsx("div",{className:b.branch_label,children:o.label}),s(o.value)]},o.value))}):s(G)},w=e=>{const{tools:n,branch:s=[],enableHandle:o}=e,{source:a=!0,target:c=!0}=o||{},r=O(),[l]=fe();return t.jsxs("div",{className:b.wrapper,children:[t.jsx("div",{className:b.tools,children:!!n&&r&&t.jsx(Lt,{nodeId:r,tools:n})}),t.jsxs("div",{className:b.inner,children:[c&&t.jsx(se,{type:"target",id:J,position:oe.Left,className:b.handle,isConnectableStart:!1}),t.jsx("div",{className:b.content,children:e.children}),a&&t.jsx(Gt,{branch:s,onChange:l})]})]})},Jt="_title_1tfkx_1",Zt="_description_1tfkx_6",H={title:Jt,description:Zt},F=e=>t.jsxs("div",{className:H.node_desc,children:[t.jsx("div",{className:H.title,children:e.title}),t.jsx("div",{className:H.description,children:e.desc})]}),Kt=e=>{const{inputParams:n=[]}=e;return n.map(s=>{const o=s.options,a={label:s.label,name:s.name,disabled:s.disabled,readonly:s.readonly,initialValue:s.initialValue,rules:[{required:s.required}]};return t.jsx(m.Fragment,{children:o!=null&&o.length?t.jsx(D,{...a,options:o}):t.jsx(j,{...a})},s.name)})},je=()=>{const{uiComponents:e=[]}=y(),n=e.map(s=>({label:s.componentName,value:s.componentTag}));return t.jsxs(m.Fragment,{children:[t.jsx(D,{label:"Component",name:"name",options:n,rules:[{required:!0}]}),t.jsx(S,{label:"Text",name:"text",rules:[{required:!0}]}),t.jsx(X,{name:["name"],children:({name:s})=>{const o=e.find(a=>a.componentTag===s);return t.jsx(Kt,{inputParams:o==null?void 0:o.input})}})]})},$=()=>{const e=v(),{uiComponents:n=[]}=y(),s=n.find(o=>o.componentTag===(e==null?void 0:e.name));return t.jsx(w,{tools:{editForm:{Component:je,title:"Edit Ui node",width:$.modalWdith}},children:t.jsx(F,{title:s==null?void 0:s.componentName,desc:e==null?void 0:e.text})})};$.Form=je;$.modalWdith=400;$.Icon=qe;const Qt="_container_12b9h_1",en="_icon_12b9h_7",tn="_text_12b9h_12",L={container:Qt,icon:en,text:tn},be=()=>t.jsx(w,{enableHandle:{target:!1},children:t.jsxs("div",{className:L.container,children:[t.jsx("div",{className:L.icon,children:t.jsx(re,{})}),t.jsx("div",{className:L.text,children:"Start"})]})});be.Icon=re;const ye=()=>{const e=m.useRef(void 0);return t.jsxs(m.Fragment,{children:[t.jsx(j,{name:"name",label:"Name",rules:[{required:!0}]}),t.jsx(S,{label:"Text",name:"text",rules:[{required:!1}]}),t.jsxs(B,{label:"Condition",name:"branch",actionRef:e,actionGuard:{beforeAddRow:()=>{var s;const n=k();return(s=e.current)==null||s.add({id:n}),!1}},children:[t.jsx(j,{name:"id"}),t.jsxs(Y,{gutter:16,children:[t.jsx(C,{span:12,children:t.jsx(j,{label:"Label",name:"label",rules:[{required:!0}]})}),t.jsx(C,{span:12,children:t.jsx(j,{label:"Value",name:"value",rules:[{required:!0}]})})]})]})]})},P=()=>{const e=v();return t.jsx(w,{branch:e==null?void 0:e.branch,tools:{editForm:{width:P.modalWdith,title:"Edit Branch node",Component:ye}},children:t.jsx(F,{title:e==null?void 0:e.name,desc:e==null?void 0:e.text})})};P.Form=ye;P.modalWdith=400;P.Icon=Me;var Ne=(e=>(e.Prompt="prompt",e.Text="text",e))(Ne||{});const U={prompt:"Prompt",text:"Text"},ve=()=>t.jsxs(m.Fragment,{children:[t.jsx(Be.Group,{label:"Type",name:"type",initialValue:Ne.Prompt,valueEnum:U,rules:[{required:!0}]}),t.jsx(X,{name:["type"],children:({type:e})=>e?t.jsx(S,{label:U[e],name:"text",rules:[{required:!0}]}):null})]}),R=()=>{const e=v(),n=e==null?void 0:e.type;return t.jsx(w,{tools:{editForm:{width:R.modalWdith,title:"Edit Prompt node",Component:ve}},children:t.jsx(F,{title:n&&U[n],desc:e==null?void 0:e.text})})};R.Form=ve;R.modalWdith=360;R.Icon=He;const te=["transform","value"],we=e=>{const{form:n}=e,{actions:s=[],transformTools:o}=y(),a=m.useMemo(()=>s.map(c=>({value:c.name,label:c.description})),[s]);return t.jsxs(m.Fragment,{children:[t.jsx(D,{label:"Action",name:"type",options:a,rules:[{required:!0}]}),t.jsx(S,{label:"Text",name:"text",rules:[{required:!1}]}),t.jsx(X,{name:["type"],children:({type:c})=>c?t.jsxs(m.Fragment,{children:[t.jsx(Le,{children:"Transform"}),t.jsx(D,{label:"Type",name:["transform","type"],options:o,rules:[{required:!1}],fieldProps:{onChange(r){const l=o==null?void 0:o.find(i=>i.value===r);n==null||n.setFieldValue(te,l==null?void 0:l.subValue)}}}),t.jsx(j,{hidden:!0,name:te}),t.jsx(B,{name:"attrs",label:"Attributes",creatorButtonProps:{creatorButtonText:"Add Attribute"},children:t.jsx(j,{name:"attr",width:"md",rules:[{required:!1}]})})]}):null})]})},W=()=>{const{actions:e=[]}=y(),n=v(),s=m.useMemo(()=>e.find(o=>(n==null?void 0:n.type)===o.name),[e,n==null?void 0:n.type]);return t.jsx(w,{tools:{editForm:{Component:we,title:"Edit Action node",width:W.modalWdith}},children:t.jsx(F,{title:s==null?void 0:s.name,desc:n==null?void 0:n.text})})};W.Form=we;W.modalWdith=400;W.Icon=Ve;const Ce=()=>{const{transformTools:e=[]}=y();return t.jsxs(m.Fragment,{children:[t.jsx(D,{options:e,label:"Type",name:"type",rules:[{required:!0}]}),t.jsx(S,{label:"Text",name:"text",rules:[{required:!0}]}),t.jsx(B,{name:"attrs",label:"Attributes",creatorButtonProps:{creatorButtonText:"Add Attribute"},children:t.jsxs(Y,{gutter:16,children:[t.jsx(C,{span:12,children:t.jsx(j,{label:"From",name:"from",rules:[{required:!0}]})}),t.jsx(C,{span:12,children:t.jsx(j,{label:"To",name:"to",rules:[{required:!0}]})})]})})]})},A=()=>{const{transformTools:e=[]}=y(),n=v(),s=m.useMemo(()=>e.find(o=>o.value===(n==null?void 0:n.type)),[e,n==null?void 0:n.type]);return t.jsx(w,{tools:{editForm:{width:A.modalWdith,title:"Edit Transform node",Component:Ce}},children:t.jsx(F,{title:s==null?void 0:s.label,desc:n==null?void 0:n.text})})};A.Form=Ce;A.modalWdith=450;A.Icon=Ue;const Se=()=>{const e=m.useRef(void 0);return t.jsxs(m.Fragment,{children:[t.jsx(j,{label:"Name",name:"name",rules:[{required:!0}]}),t.jsx(S,{label:"Description",name:"description",rules:[{required:!1}]}),t.jsxs(B,{label:"Condition",name:"branch",actionRef:e,actionGuard:{beforeAddRow:()=>{var s;const n=k();return(s=e.current)==null||s.add({id:n}),!1}},children:[t.jsx(j,{name:"id"}),t.jsxs(Y,{gutter:16,children:[t.jsx(C,{span:12,children:t.jsx(j,{label:"Label",name:"label",rules:[{required:!0}]})}),t.jsx(C,{span:12,children:t.jsx(j,{label:"Value",name:"value",rules:[{required:!0}]})})]})]})]})},q=()=>{const e=v();return t.jsx(w,{branch:e==null?void 0:e.branch,tools:{editForm:{Component:Se,title:"Edit Step node",width:q.modalWdith}},children:t.jsx(F,{title:e==null?void 0:e.name,desc:e==null?void 0:e.description})})};q.Form=Se;q.modalWdith=380;q.Icon=Oe;const Fe=[{limit:1,top:!0,type:"start",title:"Start",desc:"The starting node of a workflow.",Component:be},{top:!0,type:"step",title:"Step",desc:"Execute the corresponding process according to the different branches created.",Component:q},{type:"ui",title:"UI",desc:"The UI components within the AI assistant can be used as a data source to obtain data.",Component:$},{type:"branch",title:"Branch",desc:"Execute the corresponding process according to the different branches created.",Component:P},{type:"message",title:"Prompt",desc:"Prompt the AI what to do or say.",Component:R},{type:"action",title:"Action",desc:"Execute the corresponding process according to the different branches created.",Component:W},{type:"transform",title:"Transform",desc:"Convert the input data.",Component:A}],nn=e=>{const{stroke:n}=e;return t.jsx("defs",{children:t.jsx("marker",{id:e.id,refX:"0",refY:"0",markerWidth:"12.5",markerHeight:"12.5",viewBox:"-10 -10 20 20",markerUnits:"strokeWidth",orient:"auto-start-reverse",style:{stroke:n,fill:n,strokeWidth:1},children:t.jsx("polyline",{strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})})})},sn="_del_btn_7471i_1",on={del_btn:sn},rn=e=>{const{id:n,selected:s,sourceX:o,sourceY:a,targetX:c,targetY:r,sourcePosition:l,targetPosition:i}=e,{setEdges:d}=M(),[u,h,x]=Xe({sourceX:o,sourceY:a,targetX:c,targetY:r}),p=m.useMemo(()=>`translate(-50%, -50%) 
      translate(${h}px,${x}px)`,[h,x]),_=s?"#f40":"#0143EC",g=f(()=>{d(I=>I.filter(T=>T.id!==n))});return t.jsxs(m.Fragment,{children:[t.jsx(nn,{stroke:_,id:n}),t.jsx(Ye,{sourceX:o,sourceY:a,targetX:c,targetY:r,markerEnd:`url(#${n})`,sourcePosition:l,targetPosition:i,style:{stroke:_,strokeWidth:2}}),t.jsx(ze,{children:s?t.jsx("div",{style:{transform:p},onClick:g,className:on.del_btn,children:t.jsx(ae,{})}):null})]})},an={"step-edge":rn},cn="_add_button_1ocve_1",ln={add_button:cn},dn=()=>{const[e]=fe();return t.jsx(ge,{onChange:e,children:t.jsx("div",{className:ln.add_button,children:t.jsx(Ge,{})})})},un=e=>{const{fromX:n,fromY:s,toX:o,toY:a}=e,c=(n+o)/2,r=`M${n},${s} H${c} V${a} H${o}`;return t.jsxs("g",{children:[t.jsx("path",{fill:"none",stroke:"#0143EC",strokeWidth:2,className:"animated",d:r}),t.jsx("circle",{cx:o,cy:a,fill:"#fff",r:3,stroke:"#0143EC",strokeWidth:2})]})},mn=Fe.reduce((e,n)=>({...e,[n.type]:n.Component}),{}),Ie=e=>{const{canvas:n,top:s=!0,defaultNodes:o=[],defaultEdges:a=[]}=e,c=m.useMemo(()=>o.length?o:[Q(jt)],[o]),[r,l,i]=Je(a),[d,u,h]=Ze(c),x=r.map(g=>({...g,type:"step-edge"})),p=f(g=>l(I=>Ke(g,I))),_=f(()=>Q({edges:r,nodes:d,_v_:1}));return de(n,()=>({getData:_})),t.jsx(pe,{value:{top:s},children:t.jsxs(Qe,{fitView:!0,minZoom:.5,nodes:d,edges:x,edgeTypes:an,nodeTypes:mn,onConnect:p,onNodesChange:h,onEdgesChange:i,onBeforeDelete:async g=>!g.nodes.length,connectionLineComponent:un,children:[t.jsx(et,{size:2,color:"#ccc",bgColor:"#f6f6f6"}),t.jsx(tt,{}),t.jsx(dn,{})]})})},pn="_detail_1hmmw_1",hn="_show_1hmmw_14",xn="_layer_1hmmw_19",fn="_layer_content_1hmmw_25",_n="_layer_header_1hmmw_28",gn="_close_btn_1hmmw_33",jn="_title_1hmmw_46",N={detail:pn,show:hn,layer:xn,layer_content:fn,layer_header:_n,close_btn:gn,title:jn},bn=()=>{var x;const e=Ft(),[n]=he(),{updateNodeData:s}=M(),[o,a]=nt.useModal(),{closeDetail:c,detailId:r}=y(),l=e==null?void 0:e.details,i=l==null?void 0:l.nodes,d=l==null?void 0:l.edges,u=f(()=>{const p=n.getData(),_=wt(p),g={...e==null?void 0:e.formData,branch:_};s(r,{details:p,formData:g}),c()}),h=f(()=>{o.confirm({title:"Are you sure you want to leave?",content:"The data on this page will be lost after leaving.",okText:"Yes",okButtonProps:{className:"shopify"},cancelButtonProps:{className:"shopify"},onOk:c})});return t.jsxs("div",{className:N.layer,children:[t.jsxs("div",{className:N.layer_header,children:[t.jsx("div",{onClick:h,className:N.close_btn,children:t.jsx(ae,{})}),t.jsx("div",{className:N.title,children:(x=e==null?void 0:e.formData)==null?void 0:x.name}),t.jsx(le,{type:"primary",onClick:u,children:"Save"})]}),t.jsx("div",{className:N.layer_content,children:t.jsx(ce,{children:t.jsx(Ie,{top:!1,canvas:n,defaultNodes:i,defaultEdges:d})})}),a]})},yn=()=>{const{detailId:e}=y(),[n,s]=z(!1),o=f(()=>s(!0)),a=f(()=>s(!1));st(()=>{e?o():setTimeout(a,400)},[e]);const c=ot(N.detail,!!e&&N.show);return t.jsx("div",{className:c,children:n&&t.jsx(bn,{})})},Nn=e=>{const{children:n,...s}=e,[o,a]=z(),c=f(l=>{a(l)}),r=f(()=>{a(void 0)});return t.jsx(me.Provider,{value:{...s,detailId:o,openDetail:c,closeDetail:r},children:n})},vn=e=>{const[n]=he(),s=f(()=>{const o=n.getData();return{realDetails:o,assembleData:Z(o)}});return de(e.flow,()=>({getData:s})),t.jsx(ce,{children:t.jsxs(Nn,{...e,children:[t.jsx(Ie,{...e,canvas:n}),t.jsx(yn,{})]})})},wn=(e={})=>Object.keys(e).reduce((n,s)=>{var a,c;let o=(a=e[s])==null?void 0:a.value;if(s==="conditions"){s="branch";const r=o;o=(c=r==null?void 0:r.map)==null?void 0:c.call(r,l=>({label:l.condition,value:l.condition}))}return{...n,[s]:o}},{}),Te=e=>{if(e!=null&&e._v_)return e;let n=(e==null?void 0:e.nodes)||[];return n=n.map(s=>{var a;const o=(a=s==null?void 0:s.data)==null?void 0:a.values;return{...s,data:{nodeType:o==null?void 0:o.nodeType,formData:wn(o==null?void 0:o.formData),details:Te(o==null?void 0:o.stepRealData)}}}),{...e,nodes:n}},Cn=e=>e.map(n=>({componentName:n.tag_name,componentTag:n.tag_name,componentId:n.ui_component_uuid,componentType:n.ui_component_type,input:n.parameters.map(s=>{let o=s.parameter;return o&&(o=`{${o}}`),{required:!0,label:s.name,name:s.name,initialValue:o}})})),Sn=e=>e.reduce((s,o)=>[...s,...o.tools],[]).map(s=>({name:s.name,description:s.description})),Fn=()=>[{label:"Summarize",value:"summarize"},{label:"Full content",value:"full_content"},{label:"Structure input",value:"structure_input",subValue:"data_collect_dataset"}],In="_loading_1cv3a_1",Tn="_container_1cv3a_7",Ee={loading:In,container:Tn},En=e=>{const{promptTemplate:n,flowRelationship:s}=e.detail,o=Sn(n.mcp_servers),a=Fn(),c=Cn(n.ui_components),r=m.useMemo(()=>{const l=s?JSON.parse(s):{};return Te(l)},[s,c]);return t.jsx(rt,{className:"shopify full-content",children:t.jsx("div",{className:Ee.container,children:t.jsx(vn,{flow:e.flow,actions:o,uiComponents:c,transformTools:a,defaultEdges:r.edges,defaultNodes:r.nodes})})})};function Bn(){var d;const{message:e}=at.useApp(),[n]=Ct(),[s]=ct(),o=lt(),[a,c]=z(!1),{data:r}=it(async()=>(await ut({flowSnippetUuid:o.uid,flowSnippetVersionUuid:o.vid})).flowSnippet),l=(d=r==null?void 0:r.promptTemplate)==null?void 0:d.prompt_uuid,i=f(async()=>{const u=n.getData();console.log(u);const{flowSnippetVersionUuid:h,...x}=r,p=s.get("type"),_={};p==="new"&&(_.flowSnippetVersionUuid=h),await mt({...x,..._,promptUuid:l,flowContext:JSON.stringify(u.assembleData),flowRelationship:JSON.stringify(u.realDetails)}),e.success("Workflow saved successfully"),c(!1)});return t.jsx(dt,{title:r==null?void 0:r.flowName,className:"shopify full-screen",loading:!r&&t.jsx("div",{className:Ee.loading,children:t.jsx(xt,{size:36})}),extra:r?t.jsx(le,{type:"primary",className:"shopify",onClick:i,children:"Save"}):null,children:t.jsx(gt,{loading:a,children:!!r&&t.jsx(En,{flow:n,detail:r})})})}export{Bn as default};
