import{v as x,j as e,l as C,m as g,n as k,G as Y,b as R,ac as ee,w as b,F as U,W as y,B as v,X as se,A as D,$ as T,al as te,an as re,ao as $,x as ne,e as z,t as ae,P as ie,S as W}from"./libs-C3B0mh5y.js";import"./index-C2rjxokF.js";import{T as P}from"./index-Crygcb5j.js";import{f as H}from"./index-DWEM5X_k.js";import{e as oe,f as le,b as ce,i as L,g as de,h as ue}from"./useFetchData-CBMRYhOj.js";import{b as E,u as O}from"./hooks-B9oYRLOY.js";import{_ as Z}from"./lodash-x85gVsFl.js";import{c as me}from"./index-CwrYUok6.js";import{T as pe,S as he}from"./map-BJxYnWC7.js";import{S as q}from"./enum-Ct7sVdAK.js";import"./index-DkLb8OB3.js";import"./workflow-qJJaIAWw.js";import"./generate-MBXqf0UO.js";import"./wizard-CI4gmNY6.js";const fe={type:"object",properties:{name:{type:"string"},description:{type:"string"},type:{type:"string",enum:["string","object"]}},required:["name","type","description"]},M=t=>{const r={...t.properties},a=t.required||[];return Object.keys(r).map(o=>{var m;const n=r[o];let c=n.items;const l=a.includes(o),s=(m=n.enum)==null?void 0:m.map(u=>({label:u,value:u})),i={label:o,name:o,required:l,type:n.type,minimum:n.minimum,maximum:n.maximum};if(n.definitions=t.definitions,c&&(c.definitions=t.definitions),"$ref"in n&&(c=fe),s&&(i.options=s),c){const u=M(c);i.items=u}if(n.description&&(i.tip=n.description),n.properties){const u=M(n);i.children=u}return i})};function ge(t,r={}){const{min:a,max:o,allowDecimal:n}=r;if(!(n?/^\d+(\.\d+)?$/:/^\d+$/).test(t))return{success:!1,message:"Please enter a number"};const i=parseFloat(t);return a!==void 0&&i<a?{success:!1,message:`The input number cannot be less than ${a}.`}:o!==void 0&&i>o?{success:!1,message:`The input number cannot be greater than ${a}.`}:{success:!0,message:"Success."}}const xe=t=>{t=me(t);const r=a=>{Object.keys(a).forEach(o=>{const n=a[o];if(n!=null&&n.properties){const c=n.properties;a[o]=Object.keys(c).map(l=>{const s=c[l];return{name:l,type:s.type,description:s.description}});return}Z.isObject(n)&&(Z.isArray(n)?n.forEach(r):r(n))})};return r(t),t},je="_wrapper_1w0rr_1",ye="_schema_form_1w0rr_8",ve="_del_btn_1w0rr_11",V={wrapper:je,schema_form:ye,del_btn:ve},G=2,be=t=>{const{schema:r,value:a}=t,[o]=x.useForm(),[n]=E(),c=M(r),l=(s,i=[],m,u)=>{const h=s.items||[],F=s.options||[],I=s.children||[],S=i.concat(s.name).filter(d=>d),_={name:S,label:s.label,tooltip:s.tip,rules:[{required:s.required}]},A=S.join("");if(h.length)return e.jsx(g,{span:24,children:e.jsx(x.Item,{children:e.jsx(k,{title:s.label,className:"shopify",children:e.jsx(Y,{name:s.name,alwaysShowItemLabel:!0,creatorButtonProps:{creatorButtonText:"Add item"},actionRender:()=>[],required:s.required,rules:[{validator(d,p,f){if(s.required&&!p.length){f("Please add item");return}f()}}],children:(d,p,f)=>e.jsxs(R.Fragment,{children:[e.jsx("div",{className:V.del_btn,onClick:()=>f.remove(p),children:e.jsx(ee,{})}),e.jsx(C,{gutter:16,children:h.map((j,Q)=>l(j,[],h,Q))})]})})})})},A);if(I.length)return e.jsx(g,{span:24,children:e.jsx(k,{title:s.label,className:"shopify",style:{marginBottom:24},children:e.jsx(C,{gutter:16,children:I.map((d,p)=>l(d,S,I,p))})})},A);const w=d=>{var p,f,j;return((p=d==null?void 0:d.children)==null?void 0:p.length)||((f=d==null?void 0:d.options)==null?void 0:f.length)||((j=d==null?void 0:d.items)==null?void 0:j.length)||(d==null?void 0:d.type)==="object"||(d==null?void 0:d.type)==="array"};let N=G;const B=m.length;if(!(m.findIndex(w)>-1))B%G!==0&&u===B-1&&(N=1);else{const d=m[u-1],p=m[u+1];(w(d)&&w(p)||w(d)&&!p||!d&&w(p))&&(N=1)}return F.length?e.jsx(g,{span:24,children:e.jsx(b,{..._,options:F})},A):s.type==="object"||s.type==="array"?e.jsx(g,{span:24,children:e.jsx(U,{..._})},A):e.jsx(g,{span:24/N,children:e.jsx(y,{..._,rules:[{validator(d,p,f){if(s.required&&!p){f("Please enter");return}if(s.type==="integer"){const j=ge(p,{min:s.minimum,max:s.maximum});if(!j.success){f(j.message);return}}f()}}]})},A)};return O(async()=>{var i;const s=await o.validateFields();(i=t.onChange)==null||i.call(t,s),n()}),e.jsx(x,{form:o,submitter:!1,initialValues:xe({...a}),className:V.schema_form,children:e.jsx(C,{gutter:16,children:c.map((s,i)=>l(s,[],c,i))})})},Se=t=>e.jsx("div",{className:V.wrapper,children:e.jsx(P,{width:640,title:"Edit Config",destroyOnHidden:!0,trigger:e.jsx(v,{icon:e.jsx(se,{}),className:"shopify",children:"Edit Config"}),children:e.jsx(be,{...t})})}),X="__",_e=t=>{if(!t)return;const{llm:r,flowSnippet:a,mcpServers:o,agentVersionUuid:n,...c}=t,l=[a==null?void 0:a.flow_snippet_uuid,a==null?void 0:a.flow_snippet_version_uuid].filter(i=>i).join(X),s=o.map(i=>i.mcp_server_uuid);return{...c,mcpServerUuids:s,flowSnippet:l,llmName:r==null?void 0:r.llm_name,llmProvider:r==null?void 0:r.llm_provider,configurationSchema:r==null?void 0:r.configuration_schema}},Ae=t=>{const{flowSnippet:r,...a}=t,[,o]=r.split(X);return{...a,flowSnippetVersionUuid:o,updatedBy:"Admin"}},K=t=>{const{formData:r}=t,a=oe(),o=le(),n=ce(),[c]=x.useForm(),{message:l}=D.useApp(),[s]=E(),i=R.useMemo(()=>_e(r),[r]);return O(async()=>{var h;const m=await c.validateFields(),u=Ae(m);try{await L(u),s(),(h=t.onSuccess)==null||h.call(t),l.success(`Agent ${r?"updated":"created"} successfully.`)}catch{l.error(`Failed to ${r?"updated":"created"} Agent.`)}}),e.jsxs(x,{form:c,submitter:!1,initialValues:i,style:{padding:"24px 0 0 0"},children:[e.jsx(y,{hidden:!0,name:"agentUuid"}),e.jsx(y,{hidden:!0,name:"configurationSchema"}),e.jsx(y,{label:"Agent Name",name:"agentName",rules:[{required:!0}]}),e.jsx(U,{label:"Agent Description",name:"agentDescription",rules:[{required:!0}]}),e.jsxs(C,{gutter:16,children:[e.jsx(g,{span:12,children:e.jsx(b,{label:"LLM Provider",name:"llmProvider",options:a.options,fieldProps:{loading:a.loading,onChange:(m,u)=>{if(!Array.isArray(u)){const h=u==null?void 0:u.realData;c.setFieldsValue({llmName:h==null?void 0:h.llmName,configurationSchema:h.configurationSchema})}}},rules:[{required:!0}]})}),e.jsx(g,{span:12,children:e.jsx(y,{name:"llmName",label:"LLM Name",disabled:!0,rules:[{required:!0}]})}),e.jsx(g,{span:12,children:e.jsx(b,{label:"Flow snippet",name:"flowSnippet",options:o.options,fieldProps:{loading:o.loading,onChange:(m,u)=>{if(u){const S=u.realData.promptTemplate.mcp_servers.map(_=>_.mcp_server_uuid);c.setFieldValue("mcpServerUuids",S)}else c.setFieldValue("mcpServerUuids",i==null?void 0:i.mcpServerUuids)}}})}),e.jsx(g,{span:12,children:e.jsx(y,{label:"Num of Messages",name:"numOfMessages",rules:[{required:!0}]})}),e.jsx(g,{span:12,children:e.jsx(b,{label:"Tool Call Role",name:"toolCallRole",valueEnum:pe,rules:[{required:!0}]})}),e.jsx(g,{span:12,children:e.jsx(T,{name:["flowSnippet"],children:({flowSnippet:m})=>e.jsx(b,{disabled:!!m,label:"MCP Servers",name:"mcpServerUuids",mode:"multiple",options:n.options,fieldProps:{maxTagCount:1,loading:n.loading},rules:[{required:!0}]})})})]}),e.jsx(T,{name:["configurationSchema"],children:({configurationSchema:m})=>m?e.jsx(x.Item,{name:"configuration",label:"Configuration",rules:[{required:!0}],children:e.jsx(Se,{schema:m})}):null}),e.jsx(T,{name:["flowSnippet"],children:({flowSnippet:m})=>e.jsx(U,{disabled:!!m,label:"Instructions",name:"instructions",fieldProps:{rows:10}})})]})},we=t=>{const{formData:r}=t,[a]=x.useForm(),{message:o}=D.useApp(),[n]=E();O(async()=>{var i;const s=await a.validateFields();try{await L({...s,status:q.Active,updatedBy:"Admin"}),n(),(i=t.onSuccess)==null||i.call(t),o.success("The version has been applied successfully.")}catch{o.error("The version application failed.")}});const{options:c,loading:l}=de(r==null?void 0:r.agentUuid);return e.jsxs(x,{form:a,initialValues:r,submitter:!1,style:{padding:"24px 0 0 0"},children:[e.jsx(y,{hidden:!0,name:"agentUuid"}),e.jsx(b,{label:"Versions",name:"agentVersionUuid",options:c,fieldProps:{loading:l},rules:[{required:!0}]})]})},Ne="_icon_btn_18s3k_1",Fe={icon_btn:Ne},Ie=t=>{const{icon:r,className:a,type:o="text",size:n="small",...c}=t;return e.jsx(v,{...c,type:o,icon:e.jsx(re,{component:r}),className:te(Fe.icon_btn,a)})};var J=function(r){return $.createElement("svg",Object.assign({viewBox:"0 0 20 20"},r),$.createElement("path",{fillRule:"evenodd",d:"M15.219 14.708c.47-.314.781-.85.781-1.458v-6.5a1.75 1.75 0 0 0-1.75-1.75h-4.587a3.5 3.5 0 1 0-5.663 3.95v4.3c0 .966.784 1.75 1.75 1.75h2.36l-.508.872a.75.75 0 0 0 .648 1.128h7a.75.75 0 0 0 .648-1.128l-.68-1.164Zm-5.219-8.208a3.5 3.5 0 0 1-4.5 3.355v3.395c0 .138.112.25.25.25h3.236l2.116-3.628a.75.75 0 0 1 1.296 0l2.055 3.524a.248.248 0 0 0 .047-.146v-6.5a.25.25 0 0 0-.25-.25h-4.25Z"}))};J.displayName="IconsFilledIcon";const ze=()=>{const{modal:t,message:r}=D.useApp(),a=ne(),o=R.useRef(null),n=z(()=>{var l;(l=o.current)==null||l.reload()}),c=z(l=>{t.confirm({title:"Are you sure you want to archive?",okText:"Archive",okButtonProps:{danger:!0,className:"shopify"},onOk:async()=>{try{await L({agentUuid:l.agentUuid,agentVersionUuid:l.agentVersionUuid,status:q.Inactive,updatedBy:"Admin"}),n(),r.success("Archiving succeeded")}catch{r.error("Archiving failed")}}})});return e.jsx(ae,{title:"Agents",extra:e.jsxs(W,{size:16,children:[e.jsx(v,{className:"shopify",onClick:()=>a("/coordinations"),children:"Coordinations"}),e.jsx(P,{width:600,className:"shopify",title:"Create agent",trigger:e.jsx(v,{className:"shopify",type:"primary",children:"Create agent"}),children:e.jsx(K,{})})]}),children:e.jsx(ie,{actionRef:o,search:!1,size:"small",options:!1,rowKey:"agentUuid",className:"shopify",scroll:{x:"max-content"},request:async l=>{const{current:s,pageSize:i,...m}=l,{agentList:u}=await ue({limit:i,pageNumber:s,statuses:[q.Active],...m});return{total:u.total,data:u.agentList}},columns:[{title:"Agent Name",dataIndex:"agentName"},{title:"Agent UUID",dataIndex:"agentUuid"},{title:"Status",dataIndex:"status",valueEnum:he,hideInSearch:!0},{title:"Create at",dataIndex:"createdAt",hideInSearch:!0,render:(l,s)=>H(s.createdAt)},{title:"Update at",dataIndex:"updatedAt",hideInSearch:!0,render:(l,s)=>H(s.updatedAt)},{width:"240px",key:"action",title:"Action",align:"center",fixed:"right",hideInSearch:!0,render:(l,s)=>e.jsxs(W,{children:[e.jsx(P,{width:600,destroyOnHidden:!0,className:"shopify",title:"Create agent",trigger:e.jsx(v,{size:"small",type:"primary",className:"shopify",children:"Edit"}),children:e.jsx(K,{formData:s,onSuccess:n})}),e.jsx(P,{width:400,title:"Versions",destroyOnHidden:!0,okText:"Apply",trigger:e.jsx(v,{size:"small",className:"shopify",children:"Versions"}),children:e.jsx(we,{formData:s,onSuccess:n})}),e.jsx(v,{danger:!0,size:"small",className:"shopify",onClick:()=>c(s),children:"Archive"}),e.jsx(Ie,{icon:J,danger:!0})]})}]})})};export{ze as default};
