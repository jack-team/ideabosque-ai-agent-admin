import{y as x,j as e,n as P,o as h,p as B,K as X,b as V,ae as Y,z as b,J as q,W as y,B as J,aq as Z,A as L,a1 as C,f as z,x as ee,P as se,S as re,D as te,F as ne,L as ae}from"./libs-BaOSQqCJ.js";import{f as $}from"./index-DTADpAFe.js";import{T as I}from"./index-DKUEh0z3.js";import{e as ie,f as oe,b as le,i as R,g as ce,h as de}from"./useFetchData-CZvRU8h_.js";import{b as k,u as E}from"./hooks-HQZQxy-z.js";import{_ as W}from"./lodash-DJNnq7lZ.js";import{c as ue}from"./index-Bnn3z9vJ.js";import{T as me,S as pe}from"./map-BPCwAIgA.js";import{S as U}from"./enum-Ct7sVdAK.js";import{I as T}from"./index-CjwgjA-6.js";import fe from"./index-DZHnxU_-.js";import"./index-BMRnIUQf.js";import"./workflow-B_nGYIaA.js";import"./generate-BQHSwzam.js";import"./wizard-BDsquuTS.js";import"./contactProfiles-olU610PY.js";const ge={type:"object",properties:{name:{type:"string"},description:{type:"string"},type:{type:"string",enum:["string","object"]}},required:["name","type","description"]},D=r=>{const t={...r.properties},i=r.required||[];return Object.keys(t).map(l=>{var u;const a=t[l];let n=a.items;const c=i.includes(l),s=(u=a.enum)==null?void 0:u.map(m=>({label:m,value:m})),o={label:l,name:l,required:c,type:a.type,minimum:a.minimum,maximum:a.maximum};if(a.definitions=r.definitions,n&&(n.definitions=r.definitions),"$ref"in a&&(n=ge),s&&(o.options=s),n){const m=D(n);o.items=m}if(a.description&&(o.tip=a.description),a.properties){const m=D(a);o.children=m}return o})};function he(r,t={}){const{min:i,max:l,allowDecimal:a}=t;if(!(a?/^\d+(\.\d+)?$/:/^\d+$/).test(r))return{success:!1,message:"Please enter a number"};const o=parseFloat(r);return i!==void 0&&o<i?{success:!1,message:`The input number cannot be less than ${i}.`}:l!==void 0&&o>l?{success:!1,message:`The input number cannot be greater than ${i}.`}:{success:!0,message:"Success."}}const xe=r=>{r=ue(r);const t=i=>{Object.keys(i).forEach(l=>{const a=i[l];if(a!=null&&a.properties){const n=a.properties;i[l]=Object.keys(n).map(c=>{const s=n[c];return{name:c,type:s.type,description:s.description}});return}W.isObject(a)&&(W.isArray(a)?a.forEach(t):t(a))})};return t(r),r},je="_wrapper_olkgz_1",ye="_schema_form_olkgz_8",be="_del_btn_olkgz_11",M={wrapper:je,schema_form:ye,del_btn:be},H=2,ve=r=>{const{schema:t,value:i}=r,[l]=x.useForm(),[a]=k(),n=D(t),c=(s,o=[],u,m)=>{const f=s.items||[],F=s.options||[],N=s.children||[],v=o.concat(s.name).filter(d=>d),S={name:v,label:s.label,tooltip:s.tip,rules:[{required:s.required}]},A=v.join("");if(f.length)return e.jsx(h,{span:24,children:e.jsx(x.Item,{children:e.jsx(B,{title:s.label,className:"shopify",children:e.jsx(X,{name:s.name,alwaysShowItemLabel:!0,creatorButtonProps:{creatorButtonText:"Add item"},actionRender:()=>[],required:s.required,rules:[{validator(d,p,g){if(s.required&&!p.length){g("Please add item");return}g()}}],children:(d,p,g)=>e.jsxs(V.Fragment,{children:[e.jsx("div",{className:M.del_btn,onClick:()=>g.remove(p),children:e.jsx(Y,{})}),e.jsx(P,{gutter:16,children:f.map((j,Q)=>c(j,[],f,Q))})]})})})})},A);if(N.length)return e.jsx(h,{span:24,children:e.jsx(B,{title:s.label,className:"shopify",style:{marginBottom:24},children:e.jsx(P,{gutter:16,children:N.map((d,p)=>c(d,v,N,p))})})},A);const _=d=>{var p,g,j;return((p=d==null?void 0:d.children)==null?void 0:p.length)||((g=d==null?void 0:d.options)==null?void 0:g.length)||((j=d==null?void 0:d.items)==null?void 0:j.length)||(d==null?void 0:d.type)==="object"||(d==null?void 0:d.type)==="array"};let w=H;const O=u.length;if(!(u.findIndex(_)>-1))O%H!==0&&m===O-1&&(w=1);else{const d=u[m-1],p=u[m+1];(_(d)&&_(p)||_(d)&&!p||!d&&_(p))&&(w=1)}return F.length?e.jsx(h,{span:24,children:e.jsx(b,{...S,options:F})},A):s.type==="object"||s.type==="array"?e.jsx(h,{span:24,children:e.jsx(q,{...S})},A):e.jsx(h,{span:24/w,children:e.jsx(y,{...S,rules:[{validator(d,p,g){if(s.required&&!p){g("Please enter");return}if(s.type==="integer"){const j=he(p,{min:s.minimum,max:s.maximum});if(!j.success){g(j.message);return}}g()}}]})},A)};return E(async()=>{var o;const s=await l.validateFields();(o=r.onChange)==null||o.call(r,s),a()}),e.jsx(x,{form:l,submitter:!1,initialValues:xe({...i}),className:M.schema_form,children:e.jsx(P,{gutter:16,children:n.map((s,o)=>c(s,[],n,o))})})},Se=r=>e.jsx("div",{className:M.wrapper,children:e.jsx(I,{width:640,title:"Edit Config",destroyOnHidden:!0,trigger:e.jsx(J,{icon:e.jsx(Z,{}),className:"shopify",children:"Edit Config"}),children:e.jsx(ve,{...r})})}),G="__",Ae=r=>{if(!r)return;const{llm:t,flowSnippet:i,mcpServers:l,agentVersionUuid:a,...n}=r,c=[i==null?void 0:i.flow_snippet_uuid,i==null?void 0:i.flow_snippet_version_uuid].filter(o=>o).join(G),s=l.map(o=>o.mcp_server_uuid);return{...n,mcpServerUuids:s,flowSnippet:c,llmName:t==null?void 0:t.llm_name,llmProvider:t==null?void 0:t.llm_provider,configurationSchema:t==null?void 0:t.configuration_schema}},_e=r=>{const{flowSnippet:t,...i}=r,[,l]=t.split(G);return{...i,flowSnippetVersionUuid:l,updatedBy:"Admin"}},K=r=>{const{formData:t}=r,i=ie(),l=oe(),a=le(),[n]=x.useForm(),{message:c}=L.useApp(),[s]=k(),o=V.useMemo(()=>Ae(t),[t]);return E(async()=>{var f;const u=await n.validateFields(),m=_e(u);try{await R(m),s(),(f=r.onSuccess)==null||f.call(r),c.success(`Agent ${t?"updated":"created"} successfully.`)}catch{c.error(`Failed to ${t?"updated":"created"} Agent.`)}}),e.jsxs(x,{form:n,submitter:!1,initialValues:o,style:{padding:"24px 0 0 0"},children:[e.jsx(y,{hidden:!0,name:"agentUuid"}),e.jsx(y,{hidden:!0,name:"configurationSchema"}),e.jsx(y,{label:"Agent Name",name:"agentName",rules:[{required:!0}]}),e.jsx(q,{label:"Agent Description",name:"agentDescription",rules:[{required:!0}]}),e.jsx(b,{label:"Tool Call Role",name:"toolCallRole",valueEnum:me,rules:[{required:!0}]}),e.jsxs(P,{gutter:16,children:[e.jsx(h,{span:12,children:e.jsx(b,{label:"LLM Provider",name:"llmProvider",options:i.options,fieldProps:{loading:i.loading,onChange:(u,m)=>{if(!Array.isArray(m)){const f=m==null?void 0:m.realData;n.setFieldsValue({llmName:f==null?void 0:f.llmName,configurationSchema:f.configurationSchema})}}},rules:[{required:!0}]})}),e.jsx(h,{span:12,children:e.jsx(y,{name:"llmName",label:"LLM Name",disabled:!0,rules:[{required:!0}]})}),e.jsx(h,{span:12,children:e.jsx(b,{label:"Connected Workflows",name:"flowSnippet",options:l.options,fieldProps:{loading:l.loading,onChange:(u,m)=>{if(m){const v=m.realData.promptTemplate.mcp_servers.map(S=>S.mcp_server_uuid);n.setFieldValue("mcpServerUuids",v)}else n.setFieldValue("mcpServerUuids",o==null?void 0:o.mcpServerUuids)}}})}),e.jsx(h,{span:12,children:e.jsx(y,{label:"Num of Messages",name:"numOfMessages",rules:[{required:!0}]})})]}),e.jsx(C,{name:["flowSnippet"],children:({flowSnippet:u})=>e.jsx(q,{disabled:!!u,label:"Instructions",name:"instructions",fieldProps:{rows:10}})}),e.jsx(C,{name:["configurationSchema"],children:({configurationSchema:u})=>u?e.jsx(x.Item,{name:"configuration",label:"Configuration",rules:[{required:!0}],children:e.jsx(Se,{schema:u})}):null}),e.jsx(C,{name:["flowSnippet"],children:({flowSnippet:u})=>e.jsx(b,{disabled:!!u,label:"MCP Servers",name:"mcpServerUuids",mode:"multiple",options:a.options,fieldProps:{maxTagCount:1,loading:a.loading},rules:[{required:!0}]})})]})},we=r=>{const{formData:t}=r,[i]=x.useForm(),{message:l}=L.useApp(),[a]=k();E(async()=>{var o;const s=await i.validateFields();try{await R({...s,status:U.Active,updatedBy:"Admin"}),a(),(o=r.onSuccess)==null||o.call(r),l.success("The version has been applied successfully.")}catch{l.error("The version application failed.")}});const{options:n,loading:c}=ce(t==null?void 0:t.agentUuid);return e.jsxs(x,{form:i,initialValues:t,submitter:!1,style:{padding:"24px 0 0 0"},children:[e.jsx(y,{hidden:!0,name:"agentUuid"}),e.jsx(b,{label:"Versions",name:"agentVersionUuid",options:n,fieldProps:{loading:c},rules:[{required:!0}]})]})},Fe=()=>{const{modal:r,message:t}=L.useApp(),i=V.useRef(null),l=z(()=>{var n;(n=i.current)==null||n.reload()}),a=z(n=>{r.confirm({title:"Are you sure you want to archive?",okText:"Archive",okButtonProps:{danger:!0,className:"shopify"},onOk:async()=>{try{await R({agentUuid:n.agentUuid,agentVersionUuid:n.agentVersionUuid,status:U.Inactive,updatedBy:"Admin"}),l(),t.success("Archiving succeeded")}catch{t.error("Archiving failed")}}})});return e.jsx(ee,{title:"Agents",className:"shopify",extra:e.jsx(I,{width:620,className:"shopify",title:"Add agent",trigger:e.jsx(J,{className:"shopify",type:"primary",children:"Add agent"}),children:e.jsx(K,{})}),children:e.jsx(se,{actionRef:i,search:!1,size:"small",options:!1,rowKey:"agentUuid",className:"shopify",pagination:{defaultPageSize:4},scroll:{x:"max-content"},request:async n=>{const{current:c,pageSize:s,...o}=n,{agentList:u}=await de({limit:s,pageNumber:c,statuses:[U.Active],...o});return{total:u.total,data:u.agentList}},columns:[{title:"Status",dataIndex:"status",valueEnum:pe,hideInSearch:!0},{title:"Agent Name",dataIndex:"agentName"},{title:"Agent UUID",dataIndex:"agentUuid"},{title:"Create at",dataIndex:"createdAt",hideInSearch:!0,render:(n,c)=>$(c.createdAt)},{title:"Update at",dataIndex:"updatedAt",hideInSearch:!0,render:(n,c)=>$(c.updatedAt)},{width:"120px",key:"action",title:"Action",fixed:"right",hideInSearch:!0,render:(n,c)=>e.jsxs(re,{children:[e.jsx(I,{width:620,destroyOnHidden:!0,className:"shopify",title:"Create agent",trigger:e.jsx(T,{icon:te}),children:e.jsx(K,{formData:c,onSuccess:l})}),e.jsx(I,{width:400,title:"Versions",destroyOnHidden:!0,okText:"Apply",trigger:e.jsx(T,{icon:ne}),children:e.jsx(we,{formData:c,onSuccess:l})}),e.jsx(T,{icon:ae,onClick:()=>a(c)})]})}]})})},$e=()=>e.jsxs("div",{children:[e.jsx(Fe,{}),e.jsx(fe,{})]});export{$e as default};
