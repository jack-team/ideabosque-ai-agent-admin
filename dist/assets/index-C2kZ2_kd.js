import{j as e,W as i,J as ae,au as oe,av as le,aw as ne,ax as ie,ay as ce,az as de,aA as k,aB as K,y as g,z as I,aC as ue,n as W,o as U,M as me,b as x,h as _,aD as pe,S as J,D as he,L as xe,a1 as N,ao as Q,K as X,V as fe,aE as M,aF as je,aG as _e,v as B,aH as ge,w as be,H as ye,x as Fe,p as P}from"./libs-NYaGYdqa.js";import{p as ve,a as we}from"./index-CD538xby.js";import{T as C}from"./index-DSjh7nxU.js";import{S as $}from"./index-CXsHAlaF.js";import{a as Ne}from"./wizard-CZUEWCOW.js";import{S as Ce}from"./index-Cgdn1q_k.js";import{b as z,u as G}from"./hooks-Dep68YsA.js";import{I as T}from"./index-CCG6JdoO.js";import"./generate-CrLfPIAK.js";const Se=()=>e.jsxs(e.Fragment,{children:[e.jsx(i,{name:"wizardGroupName",label:"Block Group Name",placeholder:"UI Block Group",rules:[{required:!0}]}),e.jsx(ae,{name:"wizardGroupDescription",label:"Description",placeholder:"This is the description of the UI Block Group",rules:[{required:!0}]}),e.jsx(i,{disabled:!0,name:"wizardGroupUuid",label:"Block Group UUID",placeholder:"Block Group UUID",rules:[{required:!0}]}),e.jsx(i,{name:"weight",label:"Weight",initialValue:0,placeholder:"Weight",rules:[{required:!0}]})]});var d=(t=>(t.FormFields="formFields",t.MultipleChoice="multipleChoice",t.FileUploader="fileUploader",t.Scheduler="scheduler",t.ProductCards="productCards",t.Confirmation="confirmation",t))(d||{});const b={formFields:{label:"Form Fields",icon:de},multipleChoice:{label:"Multiple Choice",icon:ce},fileUploader:{label:"File Uploader",icon:ie},scheduler:{label:"Scheduler",icon:ne},productCards:{label:"Product Cards",icon:le},confirmation:{label:"Confirmation",icon:oe}},Ue={String:"String",array:"Array"},Ie={pdf:"PDF",jpeg:"JPEG",png:"PNG"};var Y=(t=>(t.Hubspot="hubspot",t))(Y||{});const Pe={hubspot:"Hubspot"},Te="_creator_btn_jtpjl_1",Ae="_creator_btn_text_jtpjl_14",E={creator_btn:Te,creator_btn_text:Ae},Z=t=>{const{text:r="Add new block"}=t;return e.jsxs("div",{style:t.style,onClick:t.onClick,className:E.creator_btn,children:[e.jsx(k,{component:K}),e.jsx("div",{className:E.creator_btn_text,children:r})]})},ee=t=>{const[r]=g.useForm(),[s]=z();return G(async()=>{var l;const a=await r.validateFields();(l=t.onSubmit)==null||l.call(t,a),s()}),e.jsxs(g,{form:r,submitter:!1,initialValues:t.formData,style:{padding:"16px 0 0 0"},children:[e.jsx(i,{name:"title",label:"Name",rules:[{required:!0}]}),e.jsx(I,{name:"attrType",label:"Attribute type",valueEnum:Ue,rules:[{required:!0}]}),e.jsx(i,{name:"attrName",label:"Attribute Name",rules:[{required:!0}]}),e.jsx(i,{name:"dataType",label:"Data type",rules:[{required:!0}]}),e.jsx(i,{name:"priority",label:"Priority",rules:[{required:!0}]}),e.jsx(ue.Group,{label:"Required status",name:"required",options:[{label:"Required",value:!0}]})]})},H=t=>{const[r]=g.useForm(),[s]=z();return G(async()=>{var l;const a=await r.validateFields();(l=t.onSubmit)==null||l.call(t,a),s()}),e.jsx(g,{form:r,submitter:!1,initialValues:t.formData,style:{padding:"16px 0 0 0"},children:e.jsxs(W,{gutter:16,children:[e.jsx(U,{span:24,children:e.jsx(i,{name:"name",label:"Label",rules:[{required:!0}]})}),e.jsx(U,{span:24,children:e.jsx(i,{name:"value",label:"Value",rules:[{required:!0}]})})]})})},qe=t=>{const s=(t.wizards||[]).map(a=>{const{form_schema:l,elements:n,...p}=a,m=ve(l)||{};return{...p,form_schema:m}});return{...t,wizards:s}};function te(t,r){return r.reduce((s,a)=>s==null?void 0:s[a],t)}const R=(t,r)=>["form_schema",t,...r],De="_form_field_wrapper_15wpb_1",Me="_sub_list_15wpb_4",Be="_form_field_15wpb_1",ke="_field_label_15wpb_20",ze="_drag_handle_15wpb_24",Ge="_options_15wpb_31",Re="_hide_15wpb_35",y={form_field_wrapper:De,sub_list:Me,form_field:Be,field_label:ke,drag_handle:ze,options:Ge,hide:Re},A=["options"],$e=t=>{const{index:r,action:s,floor:a=0,EditForm:l,fields:n=[],editFormTitle:p,showAddBtn:m=!0}=t,f=a===0,[u,o]=me.useModal(),c=x.useRef(void 0),h=_(j=>{var v;(v=c.current)==null||v.add(j)}),F=_(()=>{u.confirm({okText:"Delete",okButtonProps:{danger:!0},cancelButtonProps:{className:"shopify"},title:"Are you sure you want to delete it?",onOk:()=>s.remove(r)})});return e.jsxs("div",{className:y.form_field_wrapper,children:[o,n.map(j=>e.jsx(i,{hidden:!0,name:j},j)),e.jsxs("div",{className:y.form_field,children:[e.jsx("div",{className:y.drag_handle,children:e.jsx(k,{component:pe})}),e.jsx("div",{className:y.field_label,children:t.title}),e.jsxs(J,{size:0,children:[f&&m&&e.jsx(C,{destroyOnHidden:!0,title:"Add option",trigger:e.jsx(T,{icon:K}),children:e.jsx(H,{onSubmit:h})}),e.jsx(C,{destroyOnHidden:!0,title:p,trigger:e.jsx(T,{icon:he}),children:e.jsx(l,{formData:t.formData,onSubmit:s.setCurrentRowData})}),e.jsx(T,{icon:xe,onClick:F})]})]}),f&&m&&e.jsx(N,{name:A,children:j=>{const v=te(j,A),se=Q(y.options,!(v!=null&&v.length)&&y.hide);return e.jsx("div",{className:se,children:e.jsx(re,{floor:a+1,titleField:"name",name:A,actionRef:c,EditForm:H,fields:["name","value"],editFormTitle:"Option details"})})}})]})},re=t=>{const{name:r,fields:s=[],titleField:a,floor:l=0,actionRef:n,EditForm:p,editFormTitle:m,addFormTitle:f,showAddBtn:u=!0}=t,o=_(c=>{var h;console.log(c),(h=n.current)==null||h.add(c)});return e.jsxs(x.Fragment,{children:[e.jsx(X,{name:r,actionRef:n,copyIconProps:!1,deleteIconProps:!1,creatorButtonProps:!1,style:{marginBottom:0},className:y.sub_list,children:(c,h,F)=>{const j=F.getCurrentRowData();return e.jsx($e,{index:h,floor:l,action:F,fields:s,formData:j,EditForm:p,showAddBtn:u,editFormTitle:m,title:j[a]})}}),!l&&e.jsx(N,{name:r,children:c=>{const h=te(c,r),F=h!=null&&h.length?12:0;return e.jsx(C,{destroyOnHidden:!0,title:f,trigger:e.jsx(Z,{text:f,style:{marginTop:F}}),children:e.jsx(ee,{onSubmit:o})})}})]})},Ee="_title_13ce3_1",w={title:Ee},He=["title","attrName","attrType","dataType","priority","required"],O=t=>{const r=x.useRef(void 0);return e.jsxs(x.Fragment,{children:[e.jsx("div",{className:w.title,children:t.title}),e.jsx(re,{fields:He,name:["form_schema","items"],actionRef:r,EditForm:ee,titleField:"title",addFormTitle:"Add menu item",editFormTitle:"Menu Item Details",...t})]})},S=t=>R("uploader",t),Oe=()=>e.jsxs(x.Fragment,{children:[e.jsx("div",{className:w.title,children:"Uploader details"}),e.jsx(i,{label:"Upload CTA",name:S(["cta"]),rules:[{required:!0}]}),e.jsx(i,{label:"Upload description",name:S(["description"]),rules:[{required:!0}]}),e.jsx(I,{mode:"multiple",label:"Accepted file types",valueEnum:Ie}),e.jsxs(W,{gutter:16,children:[e.jsx(U,{span:12,children:e.jsx(i,{label:"Attribute name",name:S(["attrName"]),rules:[{required:!0}],extra:"This name identifies the files uploaded by this component."})}),e.jsx(U,{span:12,children:e.jsx(i,{label:"Attribute type",name:S(["attrType"]),rules:[{required:!0}]})})]})]}),L=t=>R("scheduler",t),Le=()=>e.jsxs(x.Fragment,{children:[e.jsx("div",{className:w.title,children:"Scheduler connection"}),e.jsx(I,{label:"Calendar type",valueEnum:Pe,name:L(["calendarType"]),initialValue:Y.Hubspot,rules:[{required:!0}]}),e.jsx(i,{label:"API Key",name:L(["apiKey"]),rules:[{required:!0}],extra:"Manage calendar setup through your calendar provider."})]}),Ve=`
  query presignedUploadUrl(
    $objectKey: String!, 
  ) {
    presignedUploadUrl(
      objectKey: $objectKey, 
    ) {
      url 
      objectKey
    }
  }
`,Ke=async t=>(await we.graphql({query:Ve,variables:t})).presignedUploadUrl.url,We=async(t,r)=>{const s=`${fe()}_${t.name}`,a=`${r}/${s}`,l=await Ke({objectKey:a});return(await fetch(l,{method:"PUT",redirect:"follow",body:t,headers:{"Content-Type":t.type}})).status===200?Promise.resolve(a):Promise.reject(new Error("Upload fail."))},Je="_container_d1qtg_1",Qe={container:Je},Xe=t=>{let{onChange:r,children:s,maxCount:a=1,disbaled:l=!1,value:n=[],accept:p=".png,.jpg,.pdf"}=t;const m=x.useMemo(()=>`Accepts ${p.split(",").join(" ")}`,[p]),f=_(o=>{if(a===1)n=[o];else if(n.length<a)n=[...n,o];else{const c=`At most ${a} files can be selected.`;return M.error(c),!1}return r==null||r(n),!1}),u=_(o=>{const c=n.indexOf(o),h=n.slice();h.splice(c,1),r==null||r(h)});return e.jsx(je.Dragger,{accept:p,multiple:!1,fileList:n,maxCount:a,onRemove:u,disabled:l,beforeUpload:f,className:Qe.container,children:s||e.jsxs(x.Fragment,{children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(_e,{})}),e.jsx("p",{className:"ant-upload-text",children:"Click or drag to add file."}),e.jsx("p",{className:"ant-upload-hint",children:m})]})})},Ye=t=>{const{value:r,onChange:s,namespace:a}=t,[l,n]=B(!1),[p,m]=B(r?[{name:r}]:[]),f=_(async u=>{const[o]=u;o.status="uploading",m(u),n(!0);try{const c=await We(o,a);o.status="done",s==null||s(c),M.success("File uploaded successfully.")}catch{o.status="error",M.error("File upload failed.")}finally{m([o]),n(!1)}});return e.jsx(Xe,{value:p,disbaled:l,onChange:f})},Ze=t=>R("confirmation",t),et=()=>e.jsxs(x.Fragment,{children:[e.jsx("div",{className:w.title,children:"Confirmation image"}),e.jsx(ge,{name:Ze(["image"]),rules:[{required:!0,message:"Please upload Confirmation image"}],children:e.jsx(Ye,{namespace:"confirmation_image"})})]}),q=["form_schema","blockType"],tt=()=>e.jsxs(x.Fragment,{children:[e.jsx(N,{name:q,children:({form_schema:t})=>{var s;const r=t.blockType;return e.jsxs("div",{className:w.title,children:["Block - ",(s=b[r])==null?void 0:s.label]})}}),e.jsx(i,{name:"wizard_title",label:"Step title",rules:[{required:!0}]}),e.jsx(i,{name:"wizard_description",label:"Step description",rules:[{required:!0}]}),e.jsx(i,{hidden:!0,name:q,label:"Step type",rules:[{required:!0}]}),e.jsx(N,{name:q,children:({form_schema:t})=>{switch(t.blockType){case d.FormFields:return e.jsx(O,{title:"Menu items"});case d.MultipleChoice:return e.jsx(O,{showAddBtn:!1,title:"Multiple choice  items"});case d.FileUploader:return e.jsx(Oe,{});case d.Scheduler:return e.jsx(Le,{});case d.Confirmation:return e.jsx(et,{})}}}),e.jsx("div",{className:w.title,children:"Bottom actions"}),e.jsx(i,{label:"CTA button",name:["form_schema","ctaButton"],rules:[{required:!0}]})]}),rt="_option_item_qseag_1",st={option_item:rt},at=[{value:d.FormFields,...b[d.FormFields]},{value:d.MultipleChoice,...b[d.MultipleChoice]},{value:d.FileUploader,...b[d.FileUploader]},{value:d.Scheduler,...b[d.Scheduler]},{value:d.ProductCards,...b[d.ProductCards]},{value:d.Confirmation,...b[d.Confirmation]}],V=t=>{const[r]=g.useForm(),[s]=z();return G(async()=>{const a=await r.validateFields();t.onChange(a.type),s()}),e.jsx(g,{form:r,submitter:!1,style:{padding:"16px 0 0 0"},children:e.jsx(I,{name:"type",label:"UI Block type",rules:[{required:!0}],options:at,fieldProps:{optionItemRender:a=>e.jsxs("div",{className:st.option_item,children:[e.jsx(k,{component:a.icon}),a.label]})}})})},ot="_page_content_3zojf_1",lt="_form_list_3zojf_4",nt="_step_card_3zojf_4",D={page_content:ot,form_list:lt,step_card:nt},jt=()=>{const t=be(),[r]=g.useForm(),{uid:s}=ye(),[a,l]=B(!!s),n=x.useRef(void 0),p=_(async u=>{l(!0);try{const o=await Ne({wizardGroupUuid:u}),c=qe(o.wizardGroup);console.log(c),r.setFieldsValue(c)}catch(o){console.log(o)}finally{l(!1)}});x.useEffect(()=>{s&&p(s)},[s]);const m=_(u=>{var o;(o=n.current)==null||o.add({wizard_type:u,form_schema:{blockType:u}})}),f=_(async()=>{console.log(r.getFieldsValue())});return e.jsx(Ce,{loading:a,children:e.jsx(Fe,{title:"Onboarding Block Group",className:"shopify full-screen",onBack:()=>t(-1),extra:e.jsxs(J,{children:[e.jsx($,{className:"gray",onClick:f,children:"Save"}),e.jsx(C,{destroyOnHidden:!0,title:"New UI Block",trigger:e.jsx($,{type:"primary",children:"Add new block"}),children:e.jsx(V,{onChange:m})})]}),children:e.jsxs(g,{form:r,submitter:!1,className:D.page_content,children:[e.jsx(P,{className:"shopify",title:"UI Block Group",style:{marginBottom:24},children:e.jsx(Se,{})}),e.jsx(X,{name:"wizards",initialValue:[],alwaysShowItemLabel:!0,copyIconProps:!1,actionRef:n,deleteIconProps:!1,creatorButtonProps:!1,className:D.form_list,style:{marginBottom:0},itemContainerRender:(u,{index:o})=>e.jsx(P,{children:u,title:`Step ${o+1}`,className:Q(D.step_card,"shopify")}),children:e.jsx(tt,{})}),e.jsx(N,{name:["wizards"],children:({wizards:u=[]})=>{const o=u.length?24:0;return e.jsx(P,{className:"shopify",style:{marginTop:o},children:e.jsx(C,{destroyOnHidden:!0,title:"New UI Block",trigger:e.jsx(Z,{}),children:e.jsx(V,{onChange:m})})})}})]})})})};export{jt as default};
