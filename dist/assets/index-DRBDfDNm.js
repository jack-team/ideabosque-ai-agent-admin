import{b as x,e as _,H as O,J as B,K as R,L as De,Q as ne,v as K,j as t,S as $e,U as Pe,V as We,X as Ae,Y as Re,Z as se,_ as oe,W as b,w as E,F as S,$ as X,a0 as qe,a1 as re,G as Y,l as ae,m as q,a2 as Be,a3 as Me,a4 as He,a5 as Ve,a6 as Le,a7 as Ue,a8 as Oe,a9 as Xe,aa as Ye,ab as ze,ac as Ge,ad as Je,ae as Ze,af as Ke,ag as Qe,ah as et,ai as tt,aj as nt,M as st,ak as ot,al as ce,s as z,f as rt,am as at,n as ct,A as lt,u as it,D as dt,d as ut,t as mt}from"./libs-Da1xhxe8.js";import{k as pt,g as ht}from"./workflow-D4Fwjahs.js";import{c as V}from"./index-DZTv9VCO.js";import{T as ft,u as xt}from"./index-azhqWN_S.js";import{S as _t}from"./index-cDxTFrDX.js";import{b as gt,u as jt}from"./hooks-DgQYNG5A.js";import{S as le}from"./index-DOlX-KTV.js";import{S as bt}from"./index-DlY7n4fZ.js";import{I as yt}from"./index-Cm1ycU0f.js";import"./generate-BbxGqW4z.js";function ie(e){return[x.useRef(e).current]}function de(e,n){const s=n(),o=_(()=>{!e||!s||Object.keys(s).forEach(a=>{e[a]=s[a]})});x.useEffect(o,[s,o])}const G="default_source_handle",J="default_target_handle",L="start-id",Nt={id:L,type:"start",data:{formData:{}},position:{x:0,y:0}},ue=x.createContext({}),me=x.createContext({}),vt=()=>ie({getData:()=>null}),pe=()=>ie({getData:()=>null}),y=()=>x.useContext(ue),he=()=>x.useContext(me),fe=()=>{const e=O(),{openDetail:n}=y(),{addEdges:s,addNodes:o,getNodes:a}=B(),c=_(()=>{var u;const i=a().find(h=>h.id===e);let d=(i==null?void 0:i.position.x)||0;const f=(i==null?void 0:i.position.y)||0;return d=d+(((u=i==null?void 0:i.measured)==null?void 0:u.width)||0)+80,{x:d,y:f}});return[_(l=>{const i=R(),d=l.triggerId,f=l.nodeType;o({id:i,data:l,type:f,position:c()}),e&&s({id:R(),source:e,target:i,sourceHandle:d,targetHandle:J}),f==="step"&&n(i)})]},wt=()=>{const{detailId:e}=y();return ne().find(s=>s.id===e)},Ct=()=>{const e=wt();return e==null?void 0:e.data};function St(){const e=O(),n=De(e);return n==null?void 0:n.data}function w(){const e=St();return e==null?void 0:e.formData}const Ft="_form_svv3s_1",It={form:Ft},Tt=e=>{var a;const{onSubmit:n}=e,[s]=gt(),[o]=K.useForm();return jt(async()=>{const c=await(o==null?void 0:o.validateFields());c&&await n(c),s()}),t.jsx(K,{form:o,submitter:!1,className:It.form,initialValues:e.formData,children:(a=e.children)==null?void 0:a.call(e,o)})},xe=e=>{const{children:n,onSubmit:s,formData:o,...a}=e;return t.jsx(ft,{...a,children:t.jsx(Tt,{formData:o,onSubmit:s,children:n})})},Et="_wrapper_fmhpg_4",kt="_tools_fmhpg_4",Dt="_tool_item_fmhpg_15",$t="_inner_fmhpg_26",Pt="_content_fmhpg_34",Wt="_handle_fmhpg_38",At="_handle_source_fmhpg_39",Rt="_branch_fmhpg_59",qt="_branch_item_fmhpg_63",Bt="_branch_label_fmhpg_71",j={wrapper:Et,tools:kt,tool_item:Dt,inner:$t,content:Pt,handle:Wt,handle_source:At,branch:Rt,branch_item:qt,branch_label:Bt},Mt=e=>{const{nodeId:n,tools:s}=e,{editForm:o}=s,{top:a}=he(),{openDetail:c}=y(),{setNodes:r,updateNodeData:l}=B(),i=w(),d=_(()=>{r(m=>m.filter(p=>p.id!==n))}),f=_(async m=>{l(n,{formData:m})}),u=_(()=>{c(n)}),h=m=>o?t.jsx(xe,{centered:!0,okText:"Save",destroyOnHidden:!0,trigger:m,formData:i,width:o.width,onSubmit:f,title:o.title||"Edit Node",children:p=>t.jsx(o.Component,{form:p})}):null;return t.jsxs($e,{size:16,children:[a&&t.jsx("div",{onClick:u,className:j.tool_item,children:t.jsx(Pe,{})}),h(t.jsx("div",{className:j.tool_item,children:t.jsx(Ae,{})})),t.jsx("div",{onClick:d,className:j.tool_item,children:t.jsx(We,{})})]})},Ht="_atom_node_fh105_1",Vt="_atom_icon_fh105_11",Lt="_atom_content_fh105_21",Ut="_atom_title_fh105_24",Ot="_atom_desc_fh105_30",T={atom_node:Ht,atom_icon:Vt,atom_content:Lt,atom_title:Ut,atom_desc:Ot},Q=e=>{const{Icon:n,...s}=e;return t.jsxs("div",{onClick:e.onClick,className:T.atom_node,children:[t.jsx("div",{className:T.atom_icon,children:t.jsx(n,{})}),t.jsxs("div",{className:T.atom_content,children:[t.jsx("div",{className:T.atom_title,children:s.title}),t.jsx("div",{className:T.atom_desc,children:s.desc})]})]})},Xt=e=>{const{triggerId:n,onChange:s,closeDrawer:o}=e,a=ne(),{top:c}=he();return t.jsx(x.Fragment,{children:Se.filter(r=>r.limit!==void 0?a.filter(i=>i.type===r.type).length<r.limit:c?r.top:!r.top).map(r=>{const{type:l,Component:i,...d}=r,f=i.Icon,u=i.Form,h=async(m={})=>{o(),s==null||s({nodeType:l,triggerId:n,formData:m})};return u?t.jsx(xe,{centered:!0,okText:"Add Node",onSubmit:h,width:i.modalWdith,title:`Add ${d.title} Node`,children:m=>t.jsx(u,{form:m}),trigger:t.jsx(Q,{...d,Icon:f})},l):x.createElement(Q,{...d,Icon:f,key:l,onClick:h})})})},_e=e=>{const{children:n,...s}=e,{open:o,trigger:a,onClose:c}=xt(n);return t.jsxs(t.Fragment,{children:[a,t.jsx(Re,{open:o,destroyOnHidden:!0,onClose:c,rootClassName:"shopify",title:"What triggers this workflow?",children:t.jsx(Xt,{...s,closeDrawer:c})})]})},ee=e=>{const{id:n,onChange:s}=e;return t.jsx(_e,{triggerId:n,onChange:s,children:t.jsx(se,{id:n,type:"source",position:oe.Right,className:j.handle_source})})},Yt=e=>{const{branch:n=[],onChange:s}=e;return n.length?t.jsx("div",{className:j.branch,children:n.map(o=>t.jsxs("div",{className:j.branch_item,children:[t.jsx("div",{className:j.branch_label,children:o.label}),t.jsx(ee,{id:o.id,onChange:s})]},o.id))}):t.jsx(ee,{id:G,onChange:s})},C=e=>{const{tools:n,branch:s=[],enableHandle:o}=e,{source:a=!0,target:c=!0}=o||{},r=O(),[l]=fe();return t.jsxs("div",{className:j.wrapper,children:[t.jsx("div",{className:j.tools,children:!!n&&r&&t.jsx(Mt,{nodeId:r,tools:n})}),t.jsxs("div",{className:j.inner,children:[c&&t.jsx(se,{type:"target",id:J,position:oe.Left,className:j.handle,isConnectableStart:!1}),t.jsx("div",{className:j.content,children:e.children}),a&&t.jsx(Yt,{branch:s,onChange:l})]})]})},zt="_title_1tfkx_1",Gt="_description_1tfkx_6",M={title:zt,description:Gt},F=e=>t.jsxs("div",{className:M.node_desc,children:[t.jsx("div",{className:M.title,children:e.title}),t.jsx("div",{className:M.description,children:e.desc})]}),Jt=e=>{const{inputParams:n=[]}=e;return n.map(s=>{const o=s.options,a={label:s.label,name:s.name,disabled:s.disabled,readonly:s.readonly,initialValue:s.initialValue,rules:[{required:s.required}]};return t.jsx(x.Fragment,{children:o!=null&&o.length?t.jsx(E,{...a,options:o}):t.jsx(b,{...a})},s.name)})},ge=e=>{const{uiComponents:n=[]}=y(),s=n.map(c=>({label:c.componentName,value:c.componentTag})),o=c=>n.find(r=>r.componentTag===c),a=_(c=>{var i,d;const r=o(c),l=(i=r==null?void 0:r.input)==null?void 0:i.reduce((f,u)=>({...f,[u.name]:u.initialValue}),{});(d=e.form)==null||d.setFieldsValue(l)});return t.jsxs(x.Fragment,{children:[t.jsx(E,{label:"Component",name:"name",options:s,rules:[{required:!0}],fieldProps:{onChange:a}}),t.jsx(S,{label:"Text",name:"text",rules:[{required:!0}]}),t.jsx(X,{name:["name"],children:({name:c})=>{const r=n.find(l=>l.componentTag===c);return t.jsx(Jt,{inputParams:r==null?void 0:r.input})}})]})},k=()=>{const e=w(),{uiComponents:n=[]}=y(),s=n.find(o=>o.componentTag===(e==null?void 0:e.name));return t.jsx(C,{tools:{editForm:{Component:ge,title:"Edit Ui node",width:k.modalWdith}},children:t.jsx(F,{title:s==null?void 0:s.componentName,desc:e==null?void 0:e.text})})};k.Form=ge;k.modalWdith=400;k.Icon=qe;const Zt="_container_12b9h_1",Kt="_icon_12b9h_7",Qt="_text_12b9h_12",H={container:Zt,icon:Kt,text:Qt},je=()=>t.jsx(C,{enableHandle:{target:!1},children:t.jsxs("div",{className:H.container,children:[t.jsx("div",{className:H.icon,children:t.jsx(re,{})}),t.jsx("div",{className:H.text,children:"Start"})]})});je.Icon=re;const be=()=>{const e=x.useRef(void 0);return t.jsxs(x.Fragment,{children:[t.jsx(b,{name:"name",label:"Name",rules:[{required:!0}]}),t.jsx(S,{label:"Text",name:"text",rules:[{required:!1}]}),t.jsxs(Y,{label:"Condition",name:"branch",copyIconProps:!1,actionRef:e,actionGuard:{beforeAddRow:()=>{var s;const n=R();return(s=e.current)==null||s.add({id:n}),!1}},children:[t.jsx(b,{name:"id",hidden:!0}),t.jsxs(ae,{gutter:16,children:[t.jsx(q,{span:12,children:t.jsx(b,{label:"Label",name:"label",rules:[{required:!0}]})}),t.jsx(q,{span:12,children:t.jsx(b,{label:"Value",name:"value",rules:[{required:!0}]})})]})]})]})},D=()=>{const e=w();return t.jsx(C,{branch:e==null?void 0:e.branch,tools:{editForm:{width:D.modalWdith,title:"Edit Branch node",Component:be}},children:t.jsx(F,{title:e==null?void 0:e.name,desc:e==null?void 0:e.text})})};D.Form=be;D.modalWdith=400;D.Icon=Be;var ye=(e=>(e.Prompt="prompt",e.Text="text",e))(ye||{});const U={prompt:"Prompt",text:"Text"},Ne=()=>t.jsxs(x.Fragment,{children:[t.jsx(Me.Group,{label:"Type",name:"type",initialValue:ye.Prompt,valueEnum:U,rules:[{required:!0}]}),t.jsx(X,{name:["type"],children:({type:e})=>e?t.jsx(S,{label:U[e],name:"text",rules:[{required:!0}]}):null})]}),$=()=>{const e=w(),n=e==null?void 0:e.type;return t.jsx(C,{tools:{editForm:{width:$.modalWdith,title:"Edit Prompt node",Component:Ne}},children:t.jsx(F,{title:n&&U[n],desc:e==null?void 0:e.text})})};$.Form=Ne;$.modalWdith=360;$.Icon=He;const te=["transform","value"],ve=e=>{const{form:n}=e,{actions:s=[],transformTools:o}=y(),a=x.useMemo(()=>s.map(c=>({value:c.name,label:c.description})),[s]);return t.jsxs(x.Fragment,{children:[t.jsx(E,{label:"Action",name:"type",options:a,rules:[{required:!0}]}),t.jsx(S,{label:"Text",name:"text",rules:[{required:!1}]}),t.jsx(X,{name:["type"],children:({type:c})=>c?t.jsxs(x.Fragment,{children:[t.jsx(Ve,{children:"Transform"}),t.jsx(E,{label:"Type",name:["transform","type"],options:o,rules:[{required:!1}],fieldProps:{onChange(r){const l=o==null?void 0:o.find(i=>i.value===r);n==null||n.setFieldValue(te,l==null?void 0:l.subValue)}}}),t.jsx(b,{hidden:!0,name:te}),t.jsx(Y,{name:"attrs",label:"Attributes",creatorButtonProps:{creatorButtonText:"Add Attribute"},children:t.jsx(b,{name:"attr",width:"md",rules:[{required:!1}]})})]}):null})]})},P=()=>{const{actions:e=[]}=y(),n=w(),s=x.useMemo(()=>e.find(o=>(n==null?void 0:n.type)===o.name),[e,n==null?void 0:n.type]);return t.jsx(C,{tools:{editForm:{Component:ve,title:"Edit Action node",width:P.modalWdith}},children:t.jsx(F,{title:s==null?void 0:s.name,desc:n==null?void 0:n.text})})};P.Form=ve;P.modalWdith=400;P.Icon=Le;const we=()=>{const{transformTools:e=[]}=y();return t.jsxs(x.Fragment,{children:[t.jsx(E,{options:e,label:"Type",name:"type",rules:[{required:!0}]}),t.jsx(S,{label:"Text",name:"text",rules:[{required:!0}]}),t.jsx(Y,{name:"attrs",label:"Attributes",creatorButtonProps:{creatorButtonText:"Add Attribute"},children:t.jsxs(ae,{gutter:16,children:[t.jsx(q,{span:12,children:t.jsx(b,{label:"From",name:"from",rules:[{required:!0}]})}),t.jsx(q,{span:12,children:t.jsx(b,{label:"To",name:"to",rules:[{required:!0}]})})]})})]})},W=()=>{const{transformTools:e=[]}=y(),n=w(),s=x.useMemo(()=>e.find(o=>o.value===(n==null?void 0:n.type)),[e,n==null?void 0:n.type]);return t.jsx(C,{tools:{editForm:{width:W.modalWdith,title:"Edit Transform node",Component:we}},children:t.jsx(F,{title:s==null?void 0:s.label,desc:n==null?void 0:n.text})})};W.Form=we;W.modalWdith=450;W.Icon=Ue;const Ce=()=>t.jsxs(x.Fragment,{children:[t.jsx(b,{label:"Name",name:"name",rules:[{required:!0}]}),t.jsx(S,{label:"Description",name:"description",rules:[{required:!1}]}),t.jsx(b,{name:"branch",hidden:!0})]}),A=()=>{const e=w();return t.jsx(C,{branch:e==null?void 0:e.branch,tools:{editForm:{Component:Ce,title:"Edit Step node",width:A.modalWdith}},children:t.jsx(F,{title:e==null?void 0:e.name,desc:e==null?void 0:e.description})})};A.Form=Ce;A.modalWdith=380;A.Icon=Oe;const Se=[{limit:1,top:!0,type:"start",title:"Start",desc:"The starting node of a workflow.",Component:je},{top:!0,type:"step",title:"Step",desc:"Execute the corresponding process according to the different branches created.",Component:A},{type:"ui",title:"UI",desc:"The UI components within the AI assistant can be used as a data source to obtain data.",Component:k},{type:"branch",title:"Branch",desc:"Execute the corresponding process according to the different branches created.",Component:D},{type:"message",title:"Prompt",desc:"Prompt the AI what to do or say.",Component:$},{type:"action",title:"Action",desc:"Execute the corresponding process according to the different branches created.",Component:P},{type:"transform",title:"Transform",desc:"Convert the input data.",Component:W}],en=e=>{const{stroke:n}=e;return t.jsx("defs",{children:t.jsx("marker",{id:e.id,refX:"0",refY:"0",markerWidth:"12.5",markerHeight:"12.5",viewBox:"-10 -10 20 20",markerUnits:"strokeWidth",orient:"auto-start-reverse",style:{stroke:n,fill:n,strokeWidth:1},children:t.jsx("polyline",{strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})})})},tn="_del_btn_7471i_1",nn={del_btn:tn},sn=e=>{const{id:n,selected:s,sourceX:o,sourceY:a,targetX:c,targetY:r,sourcePosition:l,targetPosition:i}=e,{setEdges:d}=B(),[f,u,h]=Xe({sourceX:o,sourceY:a,targetX:c,targetY:r}),m=x.useMemo(()=>`translate(-50%, -50%) 
      translate(${u}px,${h}px)`,[u,h]),p=s?"#f40":"#0143EC",g=_(()=>{d(N=>N.filter(I=>I.id!==n))});return t.jsxs(x.Fragment,{children:[t.jsx(en,{stroke:p,id:n}),t.jsx(Ye,{sourceX:o,sourceY:a,targetX:c,targetY:r,markerEnd:`url(#${n})`,sourcePosition:l,targetPosition:i,style:{stroke:p,strokeWidth:2}}),t.jsx(ze,{children:s?t.jsx("div",{style:{transform:m},onClick:g,className:nn.del_btn,children:t.jsx(Ge,{})}):null})]})},on={"step-edge":sn},rn="_add_button_1ocve_1",an={add_button:rn},cn=()=>{const[e]=fe();return t.jsx(_e,{onChange:e,children:t.jsx("div",{className:an.add_button,children:t.jsx(Je,{})})})},ln=e=>{const{fromX:n,fromY:s,toX:o,toY:a}=e,c=(n+o)/2,r=`M${n},${s} H${c} V${a} H${o}`;return t.jsxs("g",{children:[t.jsx("path",{fill:"none",stroke:"#0143EC",strokeWidth:2,className:"animated",d:r}),t.jsx("circle",{cx:o,cy:a,fill:"#fff",r:3,stroke:"#0143EC",strokeWidth:2})]})},dn=Se.reduce((e,n)=>({...e,[n.type]:n.Component}),{}),Fe=e=>{const{canvas:n,top:s=!0,defaultNodes:o=[],defaultEdges:a=[]}=e,c=x.useMemo(()=>o.length?o:[V(Nt)],[o]),[r,l,i]=Ze(a),[d,f,u]=Ke(c),h=r.map(g=>({...g,type:"step-edge"})),m=_(g=>l(N=>Qe(g,N))),p=_(()=>V({edges:r,nodes:d,_v_:1}));return de(n,()=>({getData:p})),t.jsx(me,{value:{top:s},children:t.jsxs(et,{fitView:!0,minZoom:.5,nodes:d,edges:h,edgeTypes:on,nodeTypes:dn,onConnect:m,onNodesChange:u,onEdgesChange:i,onBeforeDelete:async g=>!g.nodes.length,connectionLineComponent:ln,children:[t.jsx(tt,{size:2,color:"#ccc",bgColor:"#f6f6f6"}),t.jsx(nt,{}),t.jsx(cn,{})]})})},Ie=e=>{const n=new Map;for(const s of e){const o=s.source,a=n.get(o)||[];n.set(o,[...a,s])}return n},un=(e,n="")=>({id:R(),source:e,target:n,sourceHandle:G,targetHandle:J}),mn=e=>{const n=[];for(const s of e){n.push(s);const o=s.target;e.find(a=>a.source===o)||n.push(un(o))}return n};function pn(e){e=mn(e);const n=e.find(r=>r.source===L);if(!n)return e;const s=Ie(e),o=[n];let a=n.target;const c=r=>s.get(r)||[];for(;c(a).length;){const[r]=c(a);o.push(r),a=r.target;const l=c(a).filter(i=>i.id!==r.id);s.set(a,l)}for(const r of e)o.some(l=>l.id===r.id)||o.push(r);return o.filter(r=>r.source!==L)}const hn=(e,n)=>[...Ie(e)].map(([o,a])=>{const[c]=a,r=c.target,l=n(c.source);let i=[];const d={id:o,node:l},f=u=>{var m,p;return(((p=(m=l==null?void 0:l.data)==null?void 0:m.formData)==null?void 0:p.branch)||[]).find(g=>g.id===u)};return a.forEach(u=>{const h=u.target,m=u.sourceHandle;if(m===G)d.nextStep=h;else if(l){const p=f(m);p&&i.push({id:p.id,label:p.label,condition:p.value,nextStep:h})}}),i.length?d.conditions=i:d.nextStep=r,d});function Z(e,n=[]){const s=new Map,o=e.nodes||[],a=e.edges||[];for(const i of o)s.set(i.id,i);const c=i=>s.get(i),r=pn(a);return hn(r,c).map(i=>{const{node:d,...f}=i,u=d==null?void 0:d.data,{branch:h,...m}={...u==null?void 0:u.formData},p={...V(f),type:d==null?void 0:d.type,formData:m};if(h!=null&&h.length){const g=i.conditions||n;p.conditions=h.map(N=>{const I=g.find(ke=>ke.id===N.id);return{id:N.id,label:N.label,condition:N.value,nextStep:I==null?void 0:I.nextStep}})}return u!=null&&u.details&&(p.details=Z(u==null?void 0:u.details,p.conditions)),p})}const fn=e=>{var a;const n=[],o=Z(e).filter(c=>!c.nextStep);for(const c of o)(a=c.conditions)!=null&&a.length&&c.conditions.forEach(r=>{r.nextStep||n.push({id:r.id,label:r.label,value:r.condition})});return n},xn="_detail_1b2w4_1",_n="_show_1b2w4_14",gn="_layer_1b2w4_19",jn="_layer_content_1b2w4_25",bn="_layer_header_1b2w4_28",yn="_close_btn_1b2w4_35",Nn="_title_1b2w4_38",v={detail:xn,show:_n,layer:gn,layer_content:jn,layer_header:bn,close_btn:yn,title:Nn},vn=()=>{var h;const e=Ct(),[n]=pe(),{updateNodeData:s}=B(),[o,a]=st.useModal(),{closeDetail:c,detailId:r}=y(),l=e==null?void 0:e.details,i=l==null?void 0:l.nodes,d=l==null?void 0:l.edges,f=_(()=>{const m=n.getData(),p=fn(m),g={...e==null?void 0:e.formData,branch:p};s(r,{details:m,formData:g}),c()}),u=_(()=>{o.confirm({title:"Are you sure you want to leave?",content:"The data on this page will be lost after leaving.",okText:"Yes",okButtonProps:{className:"shopify"},cancelButtonProps:{className:"shopify"},onOk:c})});return t.jsxs("div",{className:v.layer,children:[t.jsxs("div",{className:v.layer_header,children:[t.jsx(yt,{children:"Back",icon:ot,onClick:u,className:v.close_btn}),t.jsx("div",{className:v.title,children:(h=e==null?void 0:e.formData)==null?void 0:h.name}),t.jsx(le,{type:"primary",onClick:f,children:"Save"})]}),t.jsx("div",{className:v.layer_content,children:t.jsx(ce,{children:t.jsx(Fe,{top:!1,canvas:n,defaultNodes:i,defaultEdges:d})})}),a]})},wn=()=>{const{detailId:e}=y(),[n,s]=z(!1),o=_(()=>s(!0)),a=_(()=>s(!1));rt(()=>{e?o():setTimeout(a,400)},[e]);const c=at(v.detail,!!e&&v.show);return t.jsx("div",{className:c,children:n&&t.jsx(vn,{})})},Cn=e=>{const{children:n,...s}=e,[o,a]=z(),c=_(l=>{a(l)}),r=_(()=>{a(void 0)});return t.jsx(ue.Provider,{value:{...s,detailId:o,openDetail:c,closeDetail:r},children:n})},Sn=e=>{const[n]=pe(),s=_(()=>{const o=n.getData();return{realDetails:o,assembleData:Z(o)}});return de(e.flow,()=>({getData:s})),t.jsx(ce,{children:t.jsxs(Cn,{...e,children:[t.jsx(Fe,{...e,canvas:n}),t.jsx(wn,{})]})})},Fn=(e={})=>Object.keys(e).reduce((n,s)=>{var a,c;let o=(a=e[s])==null?void 0:a.value;if(s==="conditions"){s="branch";const r=o;o=(c=r==null?void 0:r.map)==null?void 0:c.call(r,l=>({label:l.condition,value:l.condition}))}return{...n,[s]:o}},{}),Te=e=>{if(e!=null&&e._v_)return e;let n=(e==null?void 0:e.nodes)||[];return n=n.map(s=>{var a;const o=(a=s==null?void 0:s.data)==null?void 0:a.values;return{...s,data:{nodeType:o==null?void 0:o.nodeType,formData:Fn(o==null?void 0:o.formData),details:Te(o==null?void 0:o.stepRealData)}}}),{...e,nodes:n}},In=e=>e.map(n=>{const s=[...n.parameters,{name:"waitFor",parameter:n.wait_for}];return console.log(n),{componentName:n.tag_name,componentTag:n.tag_name,componentId:n.ui_component_uuid,componentType:n.ui_component_type,input:s.map(o=>{let a=o.parameter;return a&&(a=`{${a}}`),{required:!0,label:o.name,name:o.name,initialValue:a}})}}),Tn=e=>e.reduce((s,o)=>[...s,...o.tools],[]).map(s=>({name:s.name,description:s.description})),En=()=>[{label:"Summarize",value:"summarize"},{label:"Full content",value:"full_content"},{label:"Structure input",value:"structure_input",subValue:"data_collect_dataset"}],kn="_loading_1cv3a_1",Dn="_container_1cv3a_7",Ee={loading:kn,container:Dn},$n=e=>{const{promptTemplate:n,flowRelationship:s}=e.detail;console.log(n);const o=Tn(n.mcp_servers),a=En(),c=In(n.ui_components),r=x.useMemo(()=>{const l=s?JSON.parse(s):{};return Te(l)},[s,c]);return t.jsx(ct,{className:"shopify full-content",children:t.jsx("div",{className:Ee.container,children:t.jsx(Sn,{flow:e.flow,actions:o,uiComponents:c,transformTools:a,defaultEdges:r.edges,defaultNodes:r.nodes})})})};function Un(){var d;const{message:e}=lt.useApp(),[n]=vt(),[s]=it(),o=dt(),[a,c]=z(!1),{data:r}=ut(async()=>(await pt({flowSnippetUuid:o.uid,flowSnippetVersionUuid:o.vid})).flowSnippet),l=(d=r==null?void 0:r.promptTemplate)==null?void 0:d.prompt_uuid,i=_(async()=>{const f=n.getData();console.log(f);const{flowSnippetVersionUuid:u,...h}=r,m=s.get("type"),p={};m==="new"&&(p.flowSnippetVersionUuid=u),await ht({...h,...p,promptUuid:l,flowContext:JSON.stringify(f.assembleData),flowRelationship:JSON.stringify(f.realDetails)}),e.success("Workflow saved successfully"),c(!1)});return t.jsx(mt,{title:r==null?void 0:r.flowName,className:"shopify full-screen",loading:!r&&t.jsx("div",{className:Ee.loading,children:t.jsx(_t,{size:36})}),extra:r?t.jsx(le,{type:"primary",className:"shopify",onClick:i,children:"Save"}):null,children:t.jsx(bt,{loading:a,children:!!r&&t.jsx($n,{flow:n,detail:r})})})}export{Un as default};
