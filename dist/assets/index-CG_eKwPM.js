import{b as f,f as _,Q as X,U as H,V as B,X as Ee,Y as ne,y as Q,j as t,S as De,Z as $e,_ as Pe,$ as Ae,a0 as We,a1 as se,a2 as oe,W as y,z as k,J as S,a3 as q,a4 as Re,a5 as re,K as M,n as ae,o as L,a6 as Be,a7 as qe,a8 as Me,a9 as Le,aa as He,ab as ze,ac as Ve,ad as Ue,ae as Ye,af as Oe,ag as Xe,ah as Je,ai as Ge,aj as Ze,ak as Ke,al as Qe,am as et,an as tt,M as nt,ao as st,ap as ce,v as J,h as ot,aq as rt,p as at,A as ct,u as lt,H as it,w as dt,e as ut,x as mt,i as pt}from"./libs-D2z24ZcL.js";import{k as ht,g as xt}from"./workflow-CwAyf86c.js";import{c as U}from"./index-Yq6-F7Ao.js";import{T as ft,u as _t}from"./index-C_oswNc6.js";import{S as gt}from"./index-CjVHxAwp.js";import{b as jt,u as bt}from"./hooks-B7ID31SS.js";import{S as le}from"./index-CVzXAJsn.js";import{S as yt}from"./index-BDELTMpI.js";import{I as vt}from"./index-QK4s8deF.js";import"./generate-CSGT65a3.js";function ie(e){return[f.useRef(e).current]}function de(e,n){const s=n(),o=_(()=>{!e||!s||Object.keys(s).forEach(r=>{e[r]=s[r]})});f.useEffect(o,[s,o])}const G="default_source_handle",Z="default_target_handle",Y="start-id",Nt={id:Y,type:"start",data:{formData:{}},position:{x:0,y:0}},ue=f.createContext({}),me=f.createContext({}),wt=()=>ie({getData:()=>null}),pe=()=>ie({getData:()=>null}),v=()=>f.useContext(ue),he=()=>f.useContext(me),xe=()=>{const e=X(),{openDetail:n}=v(),{addEdges:s,addNodes:o,getNodes:r}=H(),l=_(()=>{var u;const i=r().find(m=>m.id===e);let d=(i==null?void 0:i.position.x)||0;const h=(i==null?void 0:i.position.y)||0;return d=d+(((u=i==null?void 0:i.measured)==null?void 0:u.width)||0)+80,{x:d,y:h}});return[_(c=>{const i=B(),d=c.triggerId,h=c.nodeType;o({id:i,data:c,type:h,position:l()}),e&&s({id:B(),source:e,target:i,sourceHandle:d,targetHandle:Z}),h==="step"&&n(i)})]},Ct=()=>{const{detailId:e}=v();return ne().find(s=>s.id===e)},St=()=>{const e=Ct();return e==null?void 0:e.data};function It(){const e=X(),n=Ee(e);return n==null?void 0:n.data}function w(){const e=It();return e==null?void 0:e.formData}const Ft="_form_svv3s_1",Tt={form:Ft},kt=e=>{var r;const{onSubmit:n}=e,[s]=jt(),[o]=Q.useForm();return bt(async()=>{const l=await(o==null?void 0:o.validateFields());l&&await n(l),s()}),t.jsx(Q,{form:o,submitter:!1,className:Tt.form,initialValues:e.formData,children:(r=e.children)==null?void 0:r.call(e,o)})},fe=e=>{const{children:n,onSubmit:s,formData:o,...r}=e;return t.jsx(ft,{...r,children:t.jsx(kt,{formData:o,onSubmit:s,children:n})})},Et="_wrapper_vzoll_4",Dt="_tools_vzoll_4",$t="_tool_item_vzoll_15",Pt="_inner_vzoll_26",At="_content_vzoll_34",Wt="_handle_vzoll_38",Rt="_handle_source_vzoll_39",Bt="_branch_vzoll_59",qt="_branch_item_vzoll_63",Mt="_branch_label_vzoll_71",j={wrapper:Et,tools:Dt,tool_item:$t,inner:Pt,content:At,handle:Wt,handle_source:Rt,branch:Bt,branch_item:qt,branch_label:Mt},Lt=e=>{const{nodeId:n,tools:s}=e,{editForm:o}=s,{top:r}=he(),{openDetail:l}=v(),{setNodes:a,updateNodeData:c}=H(),i=w(),d=_(()=>{a(p=>p.filter(x=>x.id!==n))}),h=_(async p=>{c(n,{formData:p})}),u=_(()=>{l(n)}),m=p=>o?t.jsx(fe,{centered:!0,okText:"Save",destroyOnHidden:!0,trigger:p,formData:i,width:o.width,onSubmit:h,title:o.title||"Edit Node",children:x=>t.jsx(o.Component,{form:x})}):null;return t.jsxs(De,{size:16,children:[r&&t.jsx("div",{onClick:u,className:j.tool_item,children:t.jsx($e,{})}),m(t.jsx("div",{className:j.tool_item,children:t.jsx(Ae,{})})),t.jsx("div",{onClick:d,className:j.tool_item,children:t.jsx(Pe,{})})]})},Ht="_atom_node_fh105_1",zt="_atom_icon_fh105_11",Vt="_atom_content_fh105_21",Ut="_atom_title_fh105_24",Yt="_atom_desc_fh105_30",T={atom_node:Ht,atom_icon:zt,atom_content:Vt,atom_title:Ut,atom_desc:Yt},ee=e=>{const{Icon:n,...s}=e;return t.jsxs("div",{onClick:e.onClick,className:T.atom_node,children:[t.jsx("div",{className:T.atom_icon,children:t.jsx(n,{})}),t.jsxs("div",{className:T.atom_content,children:[t.jsx("div",{className:T.atom_title,children:s.title}),t.jsx("div",{className:T.atom_desc,children:s.desc})]})]})},Ot=e=>{const{triggerId:n,onChange:s,closeDrawer:o}=e,r=ne(),{top:l}=he();return t.jsx(f.Fragment,{children:Se.filter(a=>a.limit!==void 0?r.filter(i=>i.type===a.type).length<a.limit:l?a.top:!a.top).map(a=>{const{type:c,Component:i,...d}=a,h=i.Icon,u=i.Form,m=async(p={})=>{o(),s==null||s({nodeType:c,triggerId:n,formData:p})};return u?t.jsx(fe,{centered:!0,okText:"Add Node",onSubmit:m,width:i.modalWdith,title:`Add ${d.title} Node`,children:p=>t.jsx(u,{form:p}),trigger:t.jsx(ee,{...d,Icon:h})},c):f.createElement(ee,{...d,Icon:h,key:c,onClick:m})})})},_e=e=>{const{children:n,...s}=e,{open:o,trigger:r,onClose:l}=_t(n);return t.jsxs(t.Fragment,{children:[r,t.jsx(We,{open:o,destroyOnHidden:!0,onClose:l,rootClassName:"shopify",title:"What triggers this workflow?",children:t.jsx(Ot,{...s,closeDrawer:l})})]})},te=e=>{const{id:n,onChange:s}=e;return t.jsx(_e,{triggerId:n,onChange:s,children:t.jsx(se,{id:n,type:"source",position:oe.Right,className:j.handle_source})})},Xt=e=>{const{branch:n=[],onChange:s}=e;return n.length?t.jsx("div",{className:j.branch,children:n.map(o=>t.jsxs("div",{className:j.branch_item,children:[t.jsx("div",{className:j.branch_label,children:o.label}),t.jsx(te,{id:o.id,onChange:s})]},o.id))}):t.jsx(te,{id:G,onChange:s})},C=e=>{const{tools:n,branch:s=[],enableHandle:o}=e,{source:r=!0,target:l=!0}=o||{},a=X(),[c]=xe();return t.jsxs("div",{className:j.wrapper,children:[t.jsx("div",{className:j.tools,children:!!n&&a&&t.jsx(Lt,{nodeId:a,tools:n})}),t.jsxs("div",{className:j.inner,children:[l&&t.jsx(se,{type:"target",id:Z,position:oe.Left,className:j.handle,isConnectableStart:!1}),t.jsx("div",{className:j.content,children:e.children}),r&&t.jsx(Xt,{branch:s,onChange:c})]})]})},Jt="_title_1tfkx_1",Gt="_description_1tfkx_6",z={title:Jt,description:Gt},I=e=>t.jsxs("div",{className:z.node_desc,children:[t.jsx("div",{className:z.title,children:e.title}),t.jsx("div",{className:z.description,children:e.desc})]}),Zt=e=>{const{inputParams:n=[]}=e;return n.map(s=>{const o=s.options,r={label:s.label,name:s.name,disabled:s.disabled,readonly:s.readonly,initialValue:s.initialValue,rules:[{required:s.required}]};return t.jsx(f.Fragment,{children:o!=null&&o.length?t.jsx(k,{...r,options:o}):t.jsx(y,{...r})},s.name)})},ge=e=>{const{uiComponents:n=[]}=v(),s=n.map(l=>({label:l.componentName,value:l.componentTag})),o=l=>n.find(a=>a.componentTag===l),r=_(l=>{var i,d;const a=o(l),c=(i=a==null?void 0:a.input)==null?void 0:i.reduce((h,u)=>({...h,[u.name]:u.initialValue}),{});(d=e.form)==null||d.setFieldsValue(c)});return t.jsxs(f.Fragment,{children:[t.jsx(k,{label:"Component",name:"name",options:s,rules:[{required:!0}],fieldProps:{onChange:r}}),t.jsx(S,{label:"Text",name:"text",rules:[{required:!0}]}),t.jsx(q,{name:["name"],children:({name:l})=>{const a=n.find(c=>c.componentTag===l);return t.jsx(Zt,{inputParams:a==null?void 0:a.input})}})]})},E=()=>{const e=w(),{uiComponents:n=[]}=v(),s=n.find(o=>o.componentTag===(e==null?void 0:e.name));return t.jsx(C,{tools:{editForm:{Component:ge,title:"Edit Ui node",width:E.modalWdith}},children:t.jsx(I,{title:s==null?void 0:s.componentName,desc:e==null?void 0:e.text})})};E.Form=ge;E.modalWdith=560;E.Icon=Re;const Kt="_container_12b9h_1",Qt="_icon_12b9h_7",en="_text_12b9h_12",V={container:Kt,icon:Qt,text:en},je=()=>t.jsx(C,{enableHandle:{target:!1},children:t.jsxs("div",{className:V.container,children:[t.jsx("div",{className:V.icon,children:t.jsx(re,{})}),t.jsx("div",{className:V.text,children:"Start"})]})});je.Icon=re;const be=()=>{const e=f.useRef(void 0);return t.jsxs(f.Fragment,{children:[t.jsx(y,{name:"name",label:"Name",rules:[{required:!0}]}),t.jsx(S,{label:"Text",name:"text",rules:[{required:!1}]}),t.jsxs(M,{label:"Condition",name:"branch",copyIconProps:!1,actionRef:e,alwaysShowItemLabel:!0,className:"custom_form_list",actionGuard:{beforeAddRow:()=>{var s;const n=B();return(s=e.current)==null||s.add({id:n}),!1}},children:[t.jsx(y,{name:"id",hidden:!0}),t.jsxs(ae,{gutter:16,children:[t.jsx(L,{span:12,children:t.jsx(y,{label:"Label",name:"label",rules:[{required:!0}]})}),t.jsx(L,{span:12,children:t.jsx(y,{label:"Value",name:"value",rules:[{required:!0}]})})]})]})]})},D=()=>{const e=w();return t.jsx(C,{branch:e==null?void 0:e.branch,tools:{editForm:{width:D.modalWdith,title:"Edit Branch node",Component:be}},children:t.jsx(I,{title:e==null?void 0:e.name,desc:e==null?void 0:e.text})})};D.Form=be;D.modalWdith=560;D.Icon=Be;var ye=(e=>(e.Prompt="prompt",e.Text="text",e))(ye||{});const O={prompt:"Prompt",text:"Text"},ve=()=>t.jsxs(f.Fragment,{children:[t.jsx(qe.Group,{label:"Type",name:"type",initialValue:ye.Prompt,valueEnum:O,rules:[{required:!0}]}),t.jsx(q,{name:["type"],children:({type:e})=>e?t.jsx(S,{label:O[e],name:"text",rules:[{required:!0}]}):null})]}),$=()=>{const e=w(),n=e==null?void 0:e.type;return t.jsx(C,{tools:{editForm:{width:$.modalWdith,title:"Edit Prompt node",Component:ve}},children:t.jsx(I,{title:n&&O[n],desc:e==null?void 0:e.text})})};$.Form=ve;$.modalWdith=560;$.Icon=Me;const Ne=()=>{const{actions:e=[],transformTools:n}=v(),s=f.useMemo(()=>e.map(r=>({value:r.name,label:r.description})),[e]),o=r=>n==null?void 0:n.find(l=>l.value===r);return t.jsxs(f.Fragment,{children:[t.jsx(k,{label:"Action",name:"type",options:s,rules:[{required:!0}]}),t.jsx(S,{label:"Text",name:"text",rules:[{required:!1}]}),t.jsx(q,{name:["type"],children:({type:r})=>r?t.jsxs(f.Fragment,{children:[t.jsx(Le,{children:"Transform"}),t.jsx(M,{name:"transform",alwaysShowItemLabel:!0,className:"custom_form_list",creatorButtonProps:{creatorButtonText:"Add Transform"},children:(l,a,c)=>t.jsxs(t.Fragment,{children:[t.jsx(k,{label:"Type",name:"type",options:n,rules:[{required:!0}],fieldProps:{onChange(i){const d=o(i);c.setCurrentRowData({attrs:[],value:d==null?void 0:d.subValue})}}}),t.jsx(y,{hidden:!0,name:"value"}),t.jsx(q,{name:["attrs"],children:({attrs:i=[]})=>{const d=c.getCurrentRowData(),h=o(d.type),u=(h==null?void 0:h.maxAttrs)??100,m=i.length>=u;return t.jsx(M,{name:"attrs",label:"Attributes",alwaysShowItemLabel:!0,className:"custom_form_list",creatorButtonProps:{disabled:m,creatorButtonText:"Add Attribute"},children:t.jsx(y,{name:"attr",label:"Attribute",rules:[{required:!0}]})})}})]})})]}):null})]})},P=()=>{const{actions:e=[]}=v(),n=w(),s=f.useMemo(()=>e.find(o=>(n==null?void 0:n.type)===o.name),[e,n==null?void 0:n.type]);return t.jsx(C,{tools:{editForm:{Component:Ne,title:"Edit Action node",width:P.modalWdith}},children:t.jsx(I,{title:s==null?void 0:s.name,desc:n==null?void 0:n.text})})};P.Form=Ne;P.modalWdith=560;P.Icon=He;const we=()=>{const{transformTools:e=[]}=v();return t.jsxs(f.Fragment,{children:[t.jsx(k,{options:e,label:"Type",name:"type",rules:[{required:!0}]}),t.jsx(S,{label:"Text",name:"text",rules:[{required:!0}]}),t.jsx(M,{name:"attrs",label:"Attributes",creatorButtonProps:{creatorButtonText:"Add Attribute"},children:t.jsxs(ae,{gutter:16,children:[t.jsx(L,{span:12,children:t.jsx(y,{label:"From",name:"from",rules:[{required:!0}]})}),t.jsx(L,{span:12,children:t.jsx(y,{label:"To",name:"to",rules:[{required:!0}]})})]})})]})},A=()=>{const{transformTools:e=[]}=v(),n=w(),s=f.useMemo(()=>e.find(o=>o.value===(n==null?void 0:n.type)),[e,n==null?void 0:n.type]);return t.jsx(C,{tools:{editForm:{width:A.modalWdith,title:"Edit Transform node",Component:we}},children:t.jsx(I,{title:s==null?void 0:s.label,desc:n==null?void 0:n.text})})};A.Form=we;A.modalWdith=560;A.Icon=ze;const Ce=()=>t.jsxs(f.Fragment,{children:[t.jsx(y,{label:"Name",name:"name",rules:[{required:!0}]}),t.jsx(S,{label:"Description",name:"description",rules:[{required:!1}]}),t.jsx(y,{name:"branch",hidden:!0})]}),W=()=>{const e=w();return t.jsx(C,{branch:e==null?void 0:e.branch,tools:{editForm:{Component:Ce,title:"Edit Step node",width:W.modalWdith}},children:t.jsx(I,{title:e==null?void 0:e.name,desc:e==null?void 0:e.description})})};W.Form=Ce;W.modalWdith=560;W.Icon=Ve;const Se=[{limit:1,top:!0,type:"start",title:"Start",desc:"The starting node of a workflow.",Component:je},{top:!0,type:"step",title:"Step",desc:"Execute the corresponding process according to the different branches created.",Component:W},{type:"ui",title:"UI",desc:"The UI components within the AI assistant can be used as a data source to obtain data.",Component:E},{type:"branch",title:"Branch",desc:"Execute the corresponding process according to the different branches created.",Component:D},{type:"message",title:"Prompt",desc:"Prompt the AI what to do or say.",Component:$},{type:"action",title:"Action",desc:"Execute the corresponding process according to the different branches created.",Component:P},{type:"transform",title:"Transform",desc:"Convert the input data.",Component:A}],tn=e=>{const{stroke:n}=e;return t.jsx("defs",{children:t.jsx("marker",{id:e.id,refX:"0",refY:"0",markerWidth:"12.5",markerHeight:"12.5",viewBox:"-10 -10 20 20",markerUnits:"strokeWidth",orient:"auto-start-reverse",style:{stroke:n,fill:n,strokeWidth:1},children:t.jsx("polyline",{strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})})})},nn="_del_btn_1ph8o_1",sn={del_btn:nn},on=e=>{const{id:n,selected:s,sourceX:o,sourceY:r,targetX:l,targetY:a,sourcePosition:c,targetPosition:i}=e,{setEdges:d}=H(),[h,u,m]=Ue({sourceX:o,sourceY:r,targetX:l,targetY:a}),p=f.useMemo(()=>`translate(-50%, -50%) 
      translate(${u}px,${m}px)`,[u,m]),x=s?"#f40":"#0143EC",g=_(()=>{d(b=>b.filter(F=>F.id!==n))});return t.jsxs(f.Fragment,{children:[t.jsx(tn,{stroke:x,id:n}),t.jsx(Ye,{sourceX:o,sourceY:r,targetX:l,targetY:a,markerEnd:`url(#${n})`,sourcePosition:c,targetPosition:i,style:{stroke:x,strokeWidth:2}}),t.jsx(Oe,{children:s?t.jsx("div",{style:{transform:p},onClick:g,className:sn.del_btn,children:t.jsx(Xe,{})}):null})]})},rn={"step-edge":on},an="_add_button_cw4d1_1",cn={add_button:an},ln=()=>{const[e]=xe();return t.jsx(_e,{onChange:e,children:t.jsx("div",{className:cn.add_button,children:t.jsx(Je,{})})})},dn=e=>{const{fromX:n,fromY:s,toX:o,toY:r}=e,l=(n+o)/2,a=`M${n},${s} H${l} V${r} H${o}`;return t.jsxs("g",{children:[t.jsx("path",{fill:"none",stroke:"#0143EC",strokeWidth:2,className:"animated",d:a}),t.jsx("circle",{cx:o,cy:r,fill:"#fff",r:3,stroke:"#0143EC",strokeWidth:2})]})},un=Se.reduce((e,n)=>({...e,[n.type]:n.Component}),{}),Ie=e=>{const{canvas:n,top:s=!0,defaultNodes:o=[],defaultEdges:r=[]}=e,l=f.useMemo(()=>o.length?o:[U(Nt)],[o]),[a,c,i]=Ge(r),[d,h,u]=Ze(l),m=a.map(g=>({...g,type:"step-edge"})),p=_(g=>c(b=>Ke(g,b))),x=_(()=>U({edges:a,nodes:d,_v_:1}));return de(n,()=>({getData:x})),t.jsx(me,{value:{top:s},children:t.jsxs(Qe,{fitView:!0,minZoom:.5,nodes:d,edges:m,edgeTypes:rn,nodeTypes:un,onConnect:p,onNodesChange:u,onEdgesChange:i,onBeforeDelete:async g=>!g.nodes.length,connectionLineComponent:dn,children:[t.jsx(et,{size:2,color:"#ccc",bgColor:"#f6f6f6"}),t.jsx(tt,{}),t.jsx(ln,{})]})})},Fe=e=>{const n=new Map;for(const s of e){const o=s.source,r=n.get(o)||[];n.set(o,[...r,s])}return n},mn=(e,n="")=>({id:B(),source:e,target:n,sourceHandle:G,targetHandle:Z}),pn=e=>{const n=[];for(const s of e){n.push(s);const o=s.target;e.find(r=>r.source===o)||n.push(mn(o))}return n};function hn(e){e=pn(e);const n=e.find(a=>a.source===Y);if(!n)return e;const s=Fe(e),o=[n];let r=n.target;const l=a=>s.get(a)||[];for(;l(r).length;){const[a]=l(r);o.push(a),r=a.target;const c=l(r).filter(i=>i.id!==a.id);s.set(r,c)}for(const a of e)o.some(c=>c.id===a.id)||o.push(a);return o.filter(a=>a.source!==Y)}const xn=(e,n)=>[...Fe(e)].map(([o,r])=>{const[l]=r,a=l.target,c=n(l.source);let i=[];const d={id:o,node:c},h=u=>{var p,x;return(((x=(p=c==null?void 0:c.data)==null?void 0:p.formData)==null?void 0:x.branch)||[]).find(g=>g.id===u)};return r.forEach(u=>{const m=u.target,p=u.sourceHandle;if(p===G)d.nextStep=m;else if(c){const x=h(p);x&&i.push({id:x.id,label:x.label,condition:x.value,nextStep:m})}}),i.length?d.conditions=i:d.nextStep=a,d});function K(e,n=[]){const s=new Map,o=e.nodes||[],r=e.edges||[];for(const i of o)s.set(i.id,i);const l=i=>s.get(i),a=hn(r);return xn(a,l).map(i=>{const{node:d,...h}=i,u=d==null?void 0:d.data,{branch:m,...p}={...u==null?void 0:u.formData},x={...U(h),type:d==null?void 0:d.type,formData:p};if(m!=null&&m.length){const g=i.conditions||n;x.conditions=m.map(b=>{const F=g.find(ke=>ke.id===b.id);return{id:b.id,label:b.label,condition:b.value,nextStep:F==null?void 0:F.nextStep}})}return u!=null&&u.details&&(x.details=K(u==null?void 0:u.details,x.conditions)),x})}const fn=e=>{var r;const n=[],o=K(e).filter(l=>!l.nextStep);for(const l of o)(r=l.conditions)!=null&&r.length&&l.conditions.forEach(a=>{a.nextStep||n.push({id:a.id,label:a.label,value:a.condition})});return n},_n="_detail_1b2w4_1",gn="_show_1b2w4_14",jn="_layer_1b2w4_19",bn="_layer_content_1b2w4_25",yn="_layer_header_1b2w4_28",vn="_close_btn_1b2w4_35",Nn="_title_1b2w4_38",N={detail:_n,show:gn,layer:jn,layer_content:bn,layer_header:yn,close_btn:vn,title:Nn},wn=()=>{var m;const e=St(),[n]=pe(),{updateNodeData:s}=H(),[o,r]=nt.useModal(),{closeDetail:l,detailId:a}=v(),c=e==null?void 0:e.details,i=c==null?void 0:c.nodes,d=c==null?void 0:c.edges,h=_(()=>{const p=n.getData(),x=fn(p),g={...e==null?void 0:e.formData,branch:x};s(a,{details:p,formData:g}),l()}),u=_(()=>{o.confirm({title:"Are you sure you want to leave?",content:"The data on this page will be lost after leaving.",okText:"Yes",okButtonProps:{className:"shopify"},cancelButtonProps:{className:"shopify gray"},onOk:l})});return t.jsxs("div",{className:N.layer,children:[t.jsxs("div",{className:N.layer_header,children:[t.jsx(vt,{children:"Back",icon:st,onClick:u,className:N.close_btn}),t.jsx("div",{className:N.title,children:(m=e==null?void 0:e.formData)==null?void 0:m.name}),t.jsx(le,{type:"primary",onClick:h,children:"Save"})]}),t.jsx("div",{className:N.layer_content,children:t.jsx(ce,{children:t.jsx(Ie,{top:!1,canvas:n,defaultNodes:i,defaultEdges:d})})}),r]})},Cn=()=>{const{detailId:e}=v(),[n,s]=J(!1),o=_(()=>s(!0)),r=_(()=>s(!1));ot(()=>{e?o():setTimeout(r,400)},[e]);const l=rt(N.detail,!!e&&N.show);return t.jsx("div",{className:l,children:n&&t.jsx(wn,{})})},Sn=e=>{const{children:n,...s}=e,[o,r]=J(),l=_(c=>{r(c)}),a=_(()=>{r(void 0)});return t.jsx(ue.Provider,{value:{...s,detailId:o,openDetail:l,closeDetail:a},children:n})},In=e=>{const[n]=pe(),s=_(()=>{const o=n.getData();return{realDetails:o,assembleData:K(o)}});return de(e.flow,()=>({getData:s})),t.jsx(ce,{children:t.jsxs(Sn,{...e,children:[t.jsx(Ie,{...e,canvas:n}),t.jsx(Cn,{})]})})},Fn=(e={})=>Object.keys(e).reduce((n,s)=>{var r,l;let o=(r=e[s])==null?void 0:r.value;if(s==="conditions"){s="branch";const a=o;o=(l=a==null?void 0:a.map)==null?void 0:l.call(a,c=>({label:c.condition,value:c.condition}))}return{...n,[s]:o}},{}),Te=e=>{if(e!=null&&e._v_)return e;let n=(e==null?void 0:e.nodes)||[];return n=n.map(s=>{var r;const o=(r=s==null?void 0:s.data)==null?void 0:r.values;return{...s,data:{nodeType:o==null?void 0:o.nodeType,formData:Fn(o==null?void 0:o.formData),details:Te(o==null?void 0:o.stepRealData)}}}),{...e,nodes:n}},Tn=e=>e.map(n=>{const s=[...n.parameters,{name:"waitFor",parameter:n.wait_for}];return{componentName:n.tag_name,componentTag:n.tag_name,componentId:n.ui_component_uuid,componentType:n.ui_component_type,input:s.map(o=>{let r=o.parameter;return r&&(r=`{${r}}`),{required:!0,label:o.name,name:o.name,initialValue:r}})}}),kn=e=>e.reduce((s,o)=>[...s,...o.tools],[]).map(s=>({name:s.name,description:s.description})),En=()=>[{label:"Summarize",value:"summarize",maxAttrs:1},{label:"Full content",value:"full_content",maxAttrs:1},{label:"Structure input",value:"structure_input",subValue:"data_collect_dataset"}],Dn="_loading_1rv3u_1",$n="_container_1rv3u_7",Pn="_page_title_1rv3u_12",An="_update_time_1rv3u_15",R={loading:Dn,container:$n,page_title:Pn,update_time:An},Wn=e=>{const{promptTemplate:n,flowRelationship:s}=e.detail,o=kn(n.mcp_servers),r=En(),l=Tn(n.ui_components),a=f.useMemo(()=>{const c=s?JSON.parse(s):{};return Te(c)},[s,l]);return t.jsx(at,{className:"shopify full-content",children:t.jsx("div",{className:R.container,children:t.jsx(In,{flow:e.flow,actions:o,uiComponents:l,transformTools:r,defaultEdges:a.edges,defaultNodes:a.nodes})})})};function On(){var u;const{message:e}=ct.useApp(),[n]=wt(),[s]=lt(),o=it(),r=dt(),[l,a]=J(!1),{data:c}=ut(async()=>(await ht({flowSnippetUuid:o.uid,flowSnippetVersionUuid:o.vid})).flowSnippet),i=(u=c==null?void 0:c.promptTemplate)==null?void 0:u.prompt_uuid,d=_(async()=>{const m=n.getData(),{flowSnippetVersionUuid:p,...x}=c,g=s.get("type"),b={};g==="new"&&(b.flowSnippetVersionUuid=p),a(!0),await xt({...x,...b,promptUuid:i,flowContext:JSON.stringify(m.assembleData),flowRelationship:JSON.stringify(m.realDetails)}),e.success("Workflow saved successfully"),a(!1)}),h=()=>{if(!c)return"";const m=c.updatedAt;return`Last updated on ${pt(m).format("YYYY/MM/DD HH:mm:ss")}`};return t.jsx(mt,{title:t.jsxs("div",{className:R.page_title,children:[(c==null?void 0:c.flowName)||"Workflow Details",t.jsx("div",{className:R.update_time,children:h()})]}),className:"shopify full-screen",loading:!c&&t.jsx("div",{className:R.loading,children:t.jsx(gt,{size:36})}),onBack:()=>r(-1),extra:c?t.jsx(le,{type:"primary",className:"shopify",onClick:d,children:"Save"}):null,children:t.jsx(yt,{loading:l,children:!!c&&t.jsx(Wn,{flow:n,detail:c})})})}export{On as default};
