import{b as x,e as _,H as O,J as B,K as R,L as $e,Q as ne,v as K,j as t,S as Pe,U as We,V as Ae,X as Re,Y as qe,Z as se,_ as oe,W as b,w as E,F as S,$ as X,a0 as Be,a1 as re,G as Y,l as ae,m as q,a2 as Me,a3 as He,a4 as Le,a5 as Ve,a6 as Ue,a7 as Oe,a8 as Xe,a9 as Ye,aa as ze,ab as Ge,ac as ce,ad as Je,ae as Ze,af as Ke,ag as Qe,ah as et,ai as tt,aj as nt,M as st,ak as le,s as z,f as ot,al as rt,n as at,A as ct,u as lt,D as it,d as dt,t as ut}from"./libs-CZ9azTWP.js";import{k as mt,g as pt}from"./workflow-AomR6_A5.js";import{c as L}from"./index-CpYUBmIE.js";import{T as ht,u as xt}from"./index-BkcFZ6V9.js";import{S as ft}from"./index-4w9JELLy.js";import{b as _t,u as gt}from"./hooks-BFUUFmjP.js";import{S as ie}from"./index-D8jLKQFW.js";import{S as jt}from"./index-DXeQc5BJ.js";import"./generate-fRrcnwPE.js";function de(e){return[x.useRef(e).current]}function ue(e,n){const s=n(),o=_(()=>{!e||!s||Object.keys(s).forEach(a=>{e[a]=s[a]})});x.useEffect(o,[s,o])}const G="default_source_handle",J="default_target_handle",V="start-id",bt={id:V,type:"start",data:{formData:{}},position:{x:0,y:0}},me=x.createContext({}),pe=x.createContext({}),yt=()=>de({getData:()=>null}),he=()=>de({getData:()=>null}),y=()=>x.useContext(me),xe=()=>x.useContext(pe),fe=()=>{const e=O(),{openDetail:n}=y(),{addEdges:s,addNodes:o,getNodes:a}=B(),c=_(()=>{var u;const i=a().find(h=>h.id===e);let d=(i==null?void 0:i.position.x)||0;const f=(i==null?void 0:i.position.y)||0;return d=d+(((u=i==null?void 0:i.measured)==null?void 0:u.width)||0)+80,{x:d,y:f}});return[_(l=>{const i=R(),d=l.triggerId,f=l.nodeType;o({id:i,data:l,type:f,position:c()}),e&&s({id:R(),source:e,target:i,sourceHandle:d,targetHandle:J}),f==="step"&&n(i)})]},Nt=()=>{const{detailId:e}=y();return ne().find(s=>s.id===e)},vt=()=>{const e=Nt();return e==null?void 0:e.data};function wt(){const e=O(),n=$e(e);return n==null?void 0:n.data}function w(){const e=wt();return e==null?void 0:e.formData}const Ct="_form_svv3s_1",St={form:Ct},Ft=e=>{var a;const{onSubmit:n}=e,[s]=_t(),[o]=K.useForm();return gt(async()=>{const c=await(o==null?void 0:o.validateFields());c&&await n(c),s()}),t.jsx(K,{form:o,submitter:!1,className:St.form,initialValues:e.formData,children:(a=e.children)==null?void 0:a.call(e,o)})},_e=e=>{const{children:n,onSubmit:s,formData:o,...a}=e;return t.jsx(ht,{...a,children:t.jsx(Ft,{formData:o,onSubmit:s,children:n})})},It="_wrapper_fmhpg_4",Tt="_tools_fmhpg_4",Et="_tool_item_fmhpg_15",kt="_inner_fmhpg_26",Dt="_content_fmhpg_34",$t="_handle_fmhpg_38",Pt="_handle_source_fmhpg_39",Wt="_branch_fmhpg_59",At="_branch_item_fmhpg_63",Rt="_branch_label_fmhpg_71",j={wrapper:It,tools:Tt,tool_item:Et,inner:kt,content:Dt,handle:$t,handle_source:Pt,branch:Wt,branch_item:At,branch_label:Rt},qt=e=>{const{nodeId:n,tools:s}=e,{editForm:o}=s,{top:a}=xe(),{openDetail:c}=y(),{setNodes:r,updateNodeData:l}=B(),i=w(),d=_(()=>{r(m=>m.filter(p=>p.id!==n))}),f=_(async m=>{l(n,{formData:m})}),u=_(()=>{c(n)}),h=m=>o?t.jsx(_e,{centered:!0,okText:"Save",destroyOnHidden:!0,trigger:m,formData:i,width:o.width,onSubmit:f,title:o.title||"Edit Node",children:p=>t.jsx(o.Component,{form:p})}):null;return t.jsxs(Pe,{size:16,children:[a&&t.jsx("div",{onClick:u,className:j.tool_item,children:t.jsx(We,{})}),h(t.jsx("div",{className:j.tool_item,children:t.jsx(Re,{})})),t.jsx("div",{onClick:d,className:j.tool_item,children:t.jsx(Ae,{})})]})},Bt="_atom_node_fh105_1",Mt="_atom_icon_fh105_11",Ht="_atom_content_fh105_21",Lt="_atom_title_fh105_24",Vt="_atom_desc_fh105_30",T={atom_node:Bt,atom_icon:Mt,atom_content:Ht,atom_title:Lt,atom_desc:Vt},Q=e=>{const{Icon:n,...s}=e;return t.jsxs("div",{onClick:e.onClick,className:T.atom_node,children:[t.jsx("div",{className:T.atom_icon,children:t.jsx(n,{})}),t.jsxs("div",{className:T.atom_content,children:[t.jsx("div",{className:T.atom_title,children:s.title}),t.jsx("div",{className:T.atom_desc,children:s.desc})]})]})},Ut=e=>{const{triggerId:n,onChange:s,closeDrawer:o}=e,a=ne(),{top:c}=xe();return t.jsx(x.Fragment,{children:Fe.filter(r=>r.limit!==void 0?a.filter(i=>i.type===r.type).length<r.limit:c?r.top:!r.top).map(r=>{const{type:l,Component:i,...d}=r,f=i.Icon,u=i.Form,h=async(m={})=>{o(),s==null||s({nodeType:l,triggerId:n,formData:m})};return u?t.jsx(_e,{centered:!0,okText:"Add Node",onSubmit:h,width:i.modalWdith,title:`Add ${d.title} Node`,children:m=>t.jsx(u,{form:m}),trigger:t.jsx(Q,{...d,Icon:f})},l):x.createElement(Q,{...d,Icon:f,key:l,onClick:h})})})},ge=e=>{const{children:n,...s}=e,{open:o,trigger:a,onClose:c}=xt(n);return t.jsxs(t.Fragment,{children:[a,t.jsx(qe,{open:o,destroyOnHidden:!0,onClose:c,rootClassName:"shopify",title:"What triggers this workflow?",children:t.jsx(Ut,{...s,closeDrawer:c})})]})},ee=e=>{const{id:n,onChange:s}=e;return t.jsx(ge,{triggerId:n,onChange:s,children:t.jsx(se,{id:n,type:"source",position:oe.Right,className:j.handle_source})})},Ot=e=>{const{branch:n=[],onChange:s}=e;return n.length?t.jsx("div",{className:j.branch,children:n.map(o=>t.jsxs("div",{className:j.branch_item,children:[t.jsx("div",{className:j.branch_label,children:o.label}),t.jsx(ee,{id:o.id,onChange:s})]},o.id))}):t.jsx(ee,{id:G,onChange:s})},C=e=>{const{tools:n,branch:s=[],enableHandle:o}=e,{source:a=!0,target:c=!0}=o||{},r=O(),[l]=fe();return t.jsxs("div",{className:j.wrapper,children:[t.jsx("div",{className:j.tools,children:!!n&&r&&t.jsx(qt,{nodeId:r,tools:n})}),t.jsxs("div",{className:j.inner,children:[c&&t.jsx(se,{type:"target",id:J,position:oe.Left,className:j.handle,isConnectableStart:!1}),t.jsx("div",{className:j.content,children:e.children}),a&&t.jsx(Ot,{branch:s,onChange:l})]})]})},Xt="_title_1tfkx_1",Yt="_description_1tfkx_6",M={title:Xt,description:Yt},F=e=>t.jsxs("div",{className:M.node_desc,children:[t.jsx("div",{className:M.title,children:e.title}),t.jsx("div",{className:M.description,children:e.desc})]}),zt=e=>{const{inputParams:n=[]}=e;return n.map(s=>{const o=s.options,a={label:s.label,name:s.name,disabled:s.disabled,readonly:s.readonly,initialValue:s.initialValue,rules:[{required:s.required}]};return t.jsx(x.Fragment,{children:o!=null&&o.length?t.jsx(E,{...a,options:o}):t.jsx(b,{...a})},s.name)})},je=()=>{const{uiComponents:e=[]}=y(),n=e.map(s=>({label:s.componentName,value:s.componentTag}));return t.jsxs(x.Fragment,{children:[t.jsx(E,{label:"Component",name:"name",options:n,rules:[{required:!0}]}),t.jsx(S,{label:"Text",name:"text",rules:[{required:!0}]}),t.jsx(X,{name:["name"],children:({name:s})=>{const o=e.find(a=>a.componentTag===s);return t.jsx(zt,{inputParams:o==null?void 0:o.input})}})]})},k=()=>{const e=w(),{uiComponents:n=[]}=y(),s=n.find(o=>o.componentTag===(e==null?void 0:e.name));return t.jsx(C,{tools:{editForm:{Component:je,title:"Edit Ui node",width:k.modalWdith}},children:t.jsx(F,{title:s==null?void 0:s.componentName,desc:e==null?void 0:e.text})})};k.Form=je;k.modalWdith=400;k.Icon=Be;const Gt="_container_12b9h_1",Jt="_icon_12b9h_7",Zt="_text_12b9h_12",H={container:Gt,icon:Jt,text:Zt},be=()=>t.jsx(C,{enableHandle:{target:!1},children:t.jsxs("div",{className:H.container,children:[t.jsx("div",{className:H.icon,children:t.jsx(re,{})}),t.jsx("div",{className:H.text,children:"Start"})]})});be.Icon=re;const ye=()=>{const e=x.useRef(void 0);return t.jsxs(x.Fragment,{children:[t.jsx(b,{name:"name",label:"Name",rules:[{required:!0}]}),t.jsx(S,{label:"Text",name:"text",rules:[{required:!1}]}),t.jsxs(Y,{label:"Condition",name:"branch",copyIconProps:!1,actionRef:e,actionGuard:{beforeAddRow:()=>{var s;const n=R();return(s=e.current)==null||s.add({id:n}),!1}},children:[t.jsx(b,{name:"id",hidden:!0}),t.jsxs(ae,{gutter:16,children:[t.jsx(q,{span:12,children:t.jsx(b,{label:"Label",name:"label",rules:[{required:!0}]})}),t.jsx(q,{span:12,children:t.jsx(b,{label:"Value",name:"value",rules:[{required:!0}]})})]})]})]})},D=()=>{const e=w();return t.jsx(C,{branch:e==null?void 0:e.branch,tools:{editForm:{width:D.modalWdith,title:"Edit Branch node",Component:ye}},children:t.jsx(F,{title:e==null?void 0:e.name,desc:e==null?void 0:e.text})})};D.Form=ye;D.modalWdith=400;D.Icon=Me;var Ne=(e=>(e.Prompt="prompt",e.Text="text",e))(Ne||{});const U={prompt:"Prompt",text:"Text"},ve=()=>t.jsxs(x.Fragment,{children:[t.jsx(He.Group,{label:"Type",name:"type",initialValue:Ne.Prompt,valueEnum:U,rules:[{required:!0}]}),t.jsx(X,{name:["type"],children:({type:e})=>e?t.jsx(S,{label:U[e],name:"text",rules:[{required:!0}]}):null})]}),$=()=>{const e=w(),n=e==null?void 0:e.type;return t.jsx(C,{tools:{editForm:{width:$.modalWdith,title:"Edit Prompt node",Component:ve}},children:t.jsx(F,{title:n&&U[n],desc:e==null?void 0:e.text})})};$.Form=ve;$.modalWdith=360;$.Icon=Le;const te=["transform","value"],we=e=>{const{form:n}=e,{actions:s=[],transformTools:o}=y(),a=x.useMemo(()=>s.map(c=>({value:c.name,label:c.description})),[s]);return t.jsxs(x.Fragment,{children:[t.jsx(E,{label:"Action",name:"type",options:a,rules:[{required:!0}]}),t.jsx(S,{label:"Text",name:"text",rules:[{required:!1}]}),t.jsx(X,{name:["type"],children:({type:c})=>c?t.jsxs(x.Fragment,{children:[t.jsx(Ve,{children:"Transform"}),t.jsx(E,{label:"Type",name:["transform","type"],options:o,rules:[{required:!1}],fieldProps:{onChange(r){const l=o==null?void 0:o.find(i=>i.value===r);n==null||n.setFieldValue(te,l==null?void 0:l.subValue)}}}),t.jsx(b,{hidden:!0,name:te}),t.jsx(Y,{name:"attrs",label:"Attributes",creatorButtonProps:{creatorButtonText:"Add Attribute"},children:t.jsx(b,{name:"attr",width:"md",rules:[{required:!1}]})})]}):null})]})},P=()=>{const{actions:e=[]}=y(),n=w(),s=x.useMemo(()=>e.find(o=>(n==null?void 0:n.type)===o.name),[e,n==null?void 0:n.type]);return t.jsx(C,{tools:{editForm:{Component:we,title:"Edit Action node",width:P.modalWdith}},children:t.jsx(F,{title:s==null?void 0:s.name,desc:n==null?void 0:n.text})})};P.Form=we;P.modalWdith=400;P.Icon=Ue;const Ce=()=>{const{transformTools:e=[]}=y();return t.jsxs(x.Fragment,{children:[t.jsx(E,{options:e,label:"Type",name:"type",rules:[{required:!0}]}),t.jsx(S,{label:"Text",name:"text",rules:[{required:!0}]}),t.jsx(Y,{name:"attrs",label:"Attributes",creatorButtonProps:{creatorButtonText:"Add Attribute"},children:t.jsxs(ae,{gutter:16,children:[t.jsx(q,{span:12,children:t.jsx(b,{label:"From",name:"from",rules:[{required:!0}]})}),t.jsx(q,{span:12,children:t.jsx(b,{label:"To",name:"to",rules:[{required:!0}]})})]})})]})},W=()=>{const{transformTools:e=[]}=y(),n=w(),s=x.useMemo(()=>e.find(o=>o.value===(n==null?void 0:n.type)),[e,n==null?void 0:n.type]);return t.jsx(C,{tools:{editForm:{width:W.modalWdith,title:"Edit Transform node",Component:Ce}},children:t.jsx(F,{title:s==null?void 0:s.label,desc:n==null?void 0:n.text})})};W.Form=Ce;W.modalWdith=450;W.Icon=Oe;const Se=()=>t.jsxs(x.Fragment,{children:[t.jsx(b,{label:"Name",name:"name",rules:[{required:!0}]}),t.jsx(S,{label:"Description",name:"description",rules:[{required:!1}]}),t.jsx(b,{name:"branch",hidden:!0})]}),A=()=>{const e=w();return t.jsx(C,{branch:e==null?void 0:e.branch,tools:{editForm:{Component:Se,title:"Edit Step node",width:A.modalWdith}},children:t.jsx(F,{title:e==null?void 0:e.name,desc:e==null?void 0:e.description})})};A.Form=Se;A.modalWdith=380;A.Icon=Xe;const Fe=[{limit:1,top:!0,type:"start",title:"Start",desc:"The starting node of a workflow.",Component:be},{top:!0,type:"step",title:"Step",desc:"Execute the corresponding process according to the different branches created.",Component:A},{type:"ui",title:"UI",desc:"The UI components within the AI assistant can be used as a data source to obtain data.",Component:k},{type:"branch",title:"Branch",desc:"Execute the corresponding process according to the different branches created.",Component:D},{type:"message",title:"Prompt",desc:"Prompt the AI what to do or say.",Component:$},{type:"action",title:"Action",desc:"Execute the corresponding process according to the different branches created.",Component:P},{type:"transform",title:"Transform",desc:"Convert the input data.",Component:W}],Kt=e=>{const{stroke:n}=e;return t.jsx("defs",{children:t.jsx("marker",{id:e.id,refX:"0",refY:"0",markerWidth:"12.5",markerHeight:"12.5",viewBox:"-10 -10 20 20",markerUnits:"strokeWidth",orient:"auto-start-reverse",style:{stroke:n,fill:n,strokeWidth:1},children:t.jsx("polyline",{strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})})})},Qt="_del_btn_7471i_1",en={del_btn:Qt},tn=e=>{const{id:n,selected:s,sourceX:o,sourceY:a,targetX:c,targetY:r,sourcePosition:l,targetPosition:i}=e,{setEdges:d}=B(),[f,u,h]=Ye({sourceX:o,sourceY:a,targetX:c,targetY:r}),m=x.useMemo(()=>`translate(-50%, -50%) 
      translate(${u}px,${h}px)`,[u,h]),p=s?"#f40":"#0143EC",g=_(()=>{d(N=>N.filter(I=>I.id!==n))});return t.jsxs(x.Fragment,{children:[t.jsx(Kt,{stroke:p,id:n}),t.jsx(ze,{sourceX:o,sourceY:a,targetX:c,targetY:r,markerEnd:`url(#${n})`,sourcePosition:l,targetPosition:i,style:{stroke:p,strokeWidth:2}}),t.jsx(Ge,{children:s?t.jsx("div",{style:{transform:m},onClick:g,className:en.del_btn,children:t.jsx(ce,{})}):null})]})},nn={"step-edge":tn},sn="_add_button_1ocve_1",on={add_button:sn},rn=()=>{const[e]=fe();return t.jsx(ge,{onChange:e,children:t.jsx("div",{className:on.add_button,children:t.jsx(Je,{})})})},an=e=>{const{fromX:n,fromY:s,toX:o,toY:a}=e,c=(n+o)/2,r=`M${n},${s} H${c} V${a} H${o}`;return t.jsxs("g",{children:[t.jsx("path",{fill:"none",stroke:"#0143EC",strokeWidth:2,className:"animated",d:r}),t.jsx("circle",{cx:o,cy:a,fill:"#fff",r:3,stroke:"#0143EC",strokeWidth:2})]})},cn=Fe.reduce((e,n)=>({...e,[n.type]:n.Component}),{}),Ie=e=>{const{canvas:n,top:s=!0,defaultNodes:o=[],defaultEdges:a=[]}=e,c=x.useMemo(()=>o.length?o:[L(bt)],[o]),[r,l,i]=Ze(a),[d,f,u]=Ke(c),h=r.map(g=>({...g,type:"step-edge"})),m=_(g=>l(N=>Qe(g,N))),p=_(()=>L({edges:r,nodes:d,_v_:1}));return ue(n,()=>({getData:p})),t.jsx(pe,{value:{top:s},children:t.jsxs(et,{fitView:!0,minZoom:.5,nodes:d,edges:h,edgeTypes:nn,nodeTypes:cn,onConnect:m,onNodesChange:u,onEdgesChange:i,onBeforeDelete:async g=>!g.nodes.length,connectionLineComponent:an,children:[t.jsx(tt,{size:2,color:"#ccc",bgColor:"#f6f6f6"}),t.jsx(nt,{}),t.jsx(rn,{})]})})},Te=e=>{const n=new Map;for(const s of e){const o=s.source,a=n.get(o)||[];n.set(o,[...a,s])}return n},ln=(e,n="")=>({id:R(),source:e,target:n,sourceHandle:G,targetHandle:J}),dn=e=>{const n=[];for(const s of e){n.push(s);const o=s.target;e.find(a=>a.source===o)||n.push(ln(o))}return n};function un(e){e=dn(e);const n=e.find(r=>r.source===V);if(!n)return e;const s=Te(e),o=[n];let a=n.target;const c=r=>s.get(r)||[];for(;c(a).length;){const[r]=c(a);o.push(r),a=r.target;const l=c(a).filter(i=>i.id!==r.id);s.set(a,l)}for(const r of e)o.some(l=>l.id===r.id)||o.push(r);return o.filter(r=>r.source!==V)}const mn=(e,n)=>[...Te(e)].map(([o,a])=>{const[c]=a,r=c.target,l=n(c.source);let i=[];const d={id:o,node:l},f=u=>{var m,p;return(((p=(m=l==null?void 0:l.data)==null?void 0:m.formData)==null?void 0:p.branch)||[]).find(g=>g.id===u)};return a.forEach(u=>{const h=u.target,m=u.sourceHandle;if(m===G)d.nextStep=h;else if(l){const p=f(m);p&&i.push({id:p.id,label:p.label,condition:p.value,nextStep:h})}}),i.length?d.conditions=i:d.nextStep=r,d});function Z(e,n=[]){const s=new Map,o=e.nodes||[],a=e.edges||[];for(const i of o)s.set(i.id,i);const c=i=>s.get(i),r=un(a);return mn(r,c).map(i=>{const{node:d,...f}=i,u=d==null?void 0:d.data,{branch:h,...m}={...u==null?void 0:u.formData},p={...L(f),type:d==null?void 0:d.type,formData:m};if(h!=null&&h.length){const g=i.conditions||n;p.conditions=h.map(N=>{const I=g.find(De=>De.id===N.id);return{id:N.id,label:N.label,condition:N.value,nextStep:I==null?void 0:I.nextStep}})}return u!=null&&u.details&&(p.details=Z(u==null?void 0:u.details,p.conditions)),p})}const pn=e=>{var a;const n=[],o=Z(e).filter(c=>!c.nextStep);for(const c of o)(a=c.conditions)!=null&&a.length&&c.conditions.forEach(r=>{r.nextStep||n.push({id:r.id,label:r.label,value:r.condition})});return n},hn="_detail_1hmmw_1",xn="_show_1hmmw_14",fn="_layer_1hmmw_19",_n="_layer_content_1hmmw_25",gn="_layer_header_1hmmw_28",jn="_close_btn_1hmmw_33",bn="_title_1hmmw_46",v={detail:hn,show:xn,layer:fn,layer_content:_n,layer_header:gn,close_btn:jn,title:bn},yn=()=>{var h;const e=vt(),[n]=he(),{updateNodeData:s}=B(),[o,a]=st.useModal(),{closeDetail:c,detailId:r}=y(),l=e==null?void 0:e.details,i=l==null?void 0:l.nodes,d=l==null?void 0:l.edges,f=_(()=>{const m=n.getData(),p=pn(m),g={...e==null?void 0:e.formData,branch:p};s(r,{details:m,formData:g}),c()}),u=_(()=>{o.confirm({title:"Are you sure you want to leave?",content:"The data on this page will be lost after leaving.",okText:"Yes",okButtonProps:{className:"shopify"},cancelButtonProps:{className:"shopify"},onOk:c})});return t.jsxs("div",{className:v.layer,children:[t.jsxs("div",{className:v.layer_header,children:[t.jsx("div",{onClick:u,className:v.close_btn,children:t.jsx(ce,{})}),t.jsx("div",{className:v.title,children:(h=e==null?void 0:e.formData)==null?void 0:h.name}),t.jsx(ie,{type:"primary",onClick:f,children:"Save"})]}),t.jsx("div",{className:v.layer_content,children:t.jsx(le,{children:t.jsx(Ie,{top:!1,canvas:n,defaultNodes:i,defaultEdges:d})})}),a]})},Nn=()=>{const{detailId:e}=y(),[n,s]=z(!1),o=_(()=>s(!0)),a=_(()=>s(!1));ot(()=>{e?o():setTimeout(a,400)},[e]);const c=rt(v.detail,!!e&&v.show);return t.jsx("div",{className:c,children:n&&t.jsx(yn,{})})},vn=e=>{const{children:n,...s}=e,[o,a]=z(),c=_(l=>{a(l)}),r=_(()=>{a(void 0)});return t.jsx(me.Provider,{value:{...s,detailId:o,openDetail:c,closeDetail:r},children:n})},wn=e=>{const[n]=he(),s=_(()=>{const o=n.getData();return{realDetails:o,assembleData:Z(o)}});return ue(e.flow,()=>({getData:s})),t.jsx(le,{children:t.jsxs(vn,{...e,children:[t.jsx(Ie,{...e,canvas:n}),t.jsx(Nn,{})]})})},Cn=(e={})=>Object.keys(e).reduce((n,s)=>{var a,c;let o=(a=e[s])==null?void 0:a.value;if(s==="conditions"){s="branch";const r=o;o=(c=r==null?void 0:r.map)==null?void 0:c.call(r,l=>({label:l.condition,value:l.condition}))}return{...n,[s]:o}},{}),Ee=e=>{if(e!=null&&e._v_)return e;let n=(e==null?void 0:e.nodes)||[];return n=n.map(s=>{var a;const o=(a=s==null?void 0:s.data)==null?void 0:a.values;return{...s,data:{nodeType:o==null?void 0:o.nodeType,formData:Cn(o==null?void 0:o.formData),details:Ee(o==null?void 0:o.stepRealData)}}}),{...e,nodes:n}},Sn=e=>e.map(n=>({componentName:n.tag_name,componentTag:n.tag_name,componentId:n.ui_component_uuid,componentType:n.ui_component_type,input:n.parameters.map(s=>{let o=s.parameter;return o&&(o=`{${o}}`),{required:!0,label:s.name,name:s.name,initialValue:o}})})),Fn=e=>e.reduce((s,o)=>[...s,...o.tools],[]).map(s=>({name:s.name,description:s.description})),In=()=>[{label:"Summarize",value:"summarize"},{label:"Full content",value:"full_content"},{label:"Structure input",value:"structure_input",subValue:"data_collect_dataset"}],Tn="_loading_1cv3a_1",En="_container_1cv3a_7",ke={loading:Tn,container:En},kn=e=>{const{promptTemplate:n,flowRelationship:s}=e.detail,o=Fn(n.mcp_servers),a=In(),c=Sn(n.ui_components),r=x.useMemo(()=>{const l=s?JSON.parse(s):{};return Ee(l)},[s,c]);return t.jsx(at,{className:"shopify full-content",children:t.jsx("div",{className:ke.container,children:t.jsx(wn,{flow:e.flow,actions:o,uiComponents:c,transformTools:a,defaultEdges:r.edges,defaultNodes:r.nodes})})})};function Hn(){var d;const{message:e}=ct.useApp(),[n]=yt(),[s]=lt(),o=it(),[a,c]=z(!1),{data:r}=dt(async()=>(await mt({flowSnippetUuid:o.uid,flowSnippetVersionUuid:o.vid})).flowSnippet),l=(d=r==null?void 0:r.promptTemplate)==null?void 0:d.prompt_uuid,i=_(async()=>{const f=n.getData();console.log(f);const{flowSnippetVersionUuid:u,...h}=r,m=s.get("type"),p={};m==="new"&&(p.flowSnippetVersionUuid=u),await pt({...h,...p,promptUuid:l,flowContext:JSON.stringify(f.assembleData),flowRelationship:JSON.stringify(f.realDetails)}),e.success("Workflow saved successfully"),c(!1)});return t.jsx(ut,{title:r==null?void 0:r.flowName,className:"shopify full-screen",loading:!r&&t.jsx("div",{className:ke.loading,children:t.jsx(ft,{size:36})}),extra:r?t.jsx(ie,{type:"primary",className:"shopify",onClick:i,children:"Save"}):null,children:t.jsx(jt,{loading:a,children:!!r&&t.jsx(kn,{flow:n,detail:r})})})}export{Hn as default};
