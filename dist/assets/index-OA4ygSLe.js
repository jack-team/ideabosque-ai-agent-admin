import{b as _,A as L,u as m,j as e,n as J,h as Q,V as ee,o as z,X as U,U as te,y as ne,S as oe,Y as se,Z as ae,_ as re,$ as de,a0 as P,a1 as F,F as D,a2 as ie,a3 as ce,a4 as le,a5 as _e,a6 as me,a7 as ue,a8 as pe,a9 as he,aa as xe,ab as ye}from"./libs-C65raxhD.js";import{c as V}from"./index-Dfix4K0A.js";import{b as B,c as fe,T as M,u as Y,a as ve,d as je}from"./index-CqkYvDSZ.js";import"./index-CFiK8WbN.js";import{g as ge,a as Ne,b as be,t as we,c as Se}from"./index-BL_I_RWT.js";import{S as Ce}from"./index-BmuJcdsb.js";import"./workflow-Cw9nkl8g.js";import"./request-DncSvQ2C.js";import"./index-tMld6ZHS.js";const Te=n=>{const{uiComponents:t}=n,o=t.reduce((s,r)=>({...s,[r.tag_name]:r.tag_name}),{});return{type:"ui",title:"UI",icon:"KubernetesOutlined",desc:"The UI components within the AI assistant can be used as a data source to obtain data.",modalWidth:420,formSchema:[{name:"name",valueType:"select",title:"Component",valueEnum:o,rules:[{required:!0,message:"Please select Component"}]},{dependencys:[{name:"name",values:Object.keys(o),renders:[{title:"Text",name:"text",tooltip:"Description information of the selection component."}]},...t.map(s=>({name:"name",values:[s.tag_name],renders:s.parameters.map(r=>({title:r.name,name:r.parameter,tooltip:"Description information of the selection component.",rules:[{required:!0}]}))}))]}]}},ke=()=>({type:"step",icon:"StepForwardOutlined",title:"Step",modalWidth:420,desc:"Execute the corresponding process according to the different branches created.",formSchema:[{title:"Name",name:"name",rules:[{required:!0}]},{title:"Description",name:"description",rules:[{required:!0}]},{name:"conditions",valueType:"formList",fieldProps:{creatorButtonProps:{creatorButtonText:"Add condition"}},columns:[{valueType:"group",columns:[{title:"Condition",name:"condition",fieldProps:{placeholder:"Please enter a condition"},width:"md",rules:[{required:!0}]}]}]}]}),Ee=()=>({type:"prompt",title:"Prompt",icon:"SendOutlined",modalWidth:420,desc:"Prompt the AI what to do or say.",formSchema:[{title:"Type",name:"type",valueType:"radio",valueEnum:{prompt:"Prompt",text:"Text"},initialValue:"prompt",rules:[{required:!0}]},{dependencys:[{name:"type",values:["text"],renders:[{title:"Text",name:"text",rules:[{required:!0}]}]},{name:"type",values:["prompt"],renders:[{title:"Prompt",name:"prompt",rules:[{required:!0}]}]}]}]}),$e=()=>({type:"branch",icon:"BranchesOutlined",title:"Branch",modalWidth:420,desc:"Execute the corresponding process according to the different branches created.",formSchema:[{title:"Name",name:"name",rules:[{required:!0}]},{title:"Text",name:"text",rules:[{required:!0}]},{name:"conditions",valueType:"formList",fieldProps:{creatorButtonProps:{creatorButtonText:"Add condition"}},columns:[{valueType:"group",columns:[{title:"Condition",name:"condition",fieldProps:{placeholder:"Please enter a condition"},width:"md",rules:[{required:!0}]}]}]}]}),Pe=n=>{const{mcpServers:t}=n;return{type:"action",icon:"FunctionOutlined",title:"Action",modalWidth:420,desc:"Obtain or process data by calling backend interfaces or methods.",formSchema:[{title:"Type",name:"type",valueType:"select",valueEnum:t.reduce((s,r)=>[...s,...r.tools],[]).reduce((s,r)=>({...s,[r.name]:r.description}),{}),rules:[{required:!0}]},{title:"Text",name:"text",rules:[{required:!0}]}]}},Fe=()=>({type:"transform",icon:"BlockOutlined",title:"Transform",modalWidth:420,desc:"Convert the input data",formSchema:[{title:"Type",name:"type",valueType:"select",valueEnum:{summarize:"summarize",full_content:"full_content",structure_input:"structure_input"},rules:[{required:!0}]},{title:"Value",name:"text",rules:[{required:!0}]}]}),Me=n=>[Te,ke,Ee,Pe,$e,Fe].map(t=>t(n)),X=_.createContext({}),g=()=>_.useContext(X),qe="_edit_step_modal_v2k9j_1",Ie="_flow_work_v2k9j_16",Z={edit_step_modal:qe,flow_work:Ie},Oe=n=>{const{message:t}=L.useApp(),[o]=B(),{modal:a}=L.useApp(),s=_.useRef(null),{uiComponents:r=[],mcpServers:l=[]}=g(),c=m(()=>s.current.getData()),i=m(()=>{var y;const d=c();if(!d.edges.length){t.error("The current flowchart is not completed.");return}(y=n.onSave)==null||y.call(n,d),o()}),u=m(()=>{a.confirm({rootClassName:"shopify",title:"Are you sure you want to leave?",content:"The data on this page will be lost after leaving.",okButtonProps:{className:"shopify"},cancelButtonProps:{className:"shopify"},okText:"Yes",onOk:()=>o()})});return fe(async()=>Promise.reject()),e.jsx(J,{title:n.title,onBack:u,className:"shopify full-screen",extra:[e.jsx(Ce,{type:"primary",onClick:i,children:"Save"})],children:e.jsx(Q,{className:"shopify full-content",children:e.jsx("div",{className:Z.flow_work,children:e.jsx(Wt,{role:"child",ref:s,initialEdges:n.edges,initialNodes:n.nodes,uiComponents:r,mcpServers:l})})})})},Ae=n=>{const{trigger:t,modal:o,...a}=n;return e.jsx(M,{centered:!0,modal:o,width:"100vw",closable:!1,hasFooter:!1,trigger:t,className:Z.edit_step_modal,children:e.jsx(Oe,{...a})})},We={type:"step",style:{stroke:"#0143EC",strokeWidth:2},markerEnd:{color:"#0143EC",type:ee.ArrowClosed}},q={target:"Target",source:"Source"},De=[{title:"Connection setting",valueType:"group",columns:[{title:"Enable",valueType:"switch",initialValue:!0,dataIndex:"connectionEnable"},{valueType:"dependency",name:["connectionEnable"],columns:({connectionEnable:n})=>{const t=[];return n&&t.push({title:"Types",valueType:"select",valueEnum:q,dataIndex:"connectionTypes",fieldProps:{mode:"multiple"},initialValue:Object.keys(q)}),t}}]}],Be=n=>{const[t]=z.useForm(),[o]=B();return Y(async()=>{var s;const a=await t.validateFields();(s=n.onSave)==null||s.call(n,a),o()}),e.jsx("div",{style:{padding:"24px 0 0 0"},children:e.jsx(U,{form:t,layout:"horizontal",columns:De,submitter:!1,initialValues:n.formData})})},Re="_dynamic_form_1eu5x_1",Le={dynamic_form:Re},K=n=>{const{schemas:t=[],formData:o}=n,[a]=z.useForm(),[s]=B(),r=_.useMemo(()=>t.map(ge),[t]),l=_.useMemo(()=>Ne(t),[t]),c=_.useMemo(()=>be(t),[t]);return Y(async()=>{var u;let i=await a.validateFields();i=we(i,c,l),await((u=n.onSubmit)==null?void 0:u.call(n,{formData:i})),s()}),e.jsx("div",{className:Le.dynamic_form,children:e.jsx(U,{form:a,submitter:!1,columns:r,initialValues:o})})},Ve="_tool_bar_container_122m1_1",He="_tool_bar_action_122m1_5",N={tool_bar_container:Ve,tool_bar_action:He},ze=n=>{var T;const{data:t}=n,o=t.values,{nodeType:a,formData:s,autoOpenStepCanvas:r=!0}=o,{role:l,deleteNode:c,updateNodeData:i}=g(),[u]=ve(),d=m(async h=>{i(n.id,Object.assign(t,h))}),y=m(async h=>{t.values=Object.assign(t.values,h),d(t)}),I=m(async h=>{d(h)}),C=m(h=>{t.values.stepRealData=h,d(t)}),O=m(()=>{l==="parent"&&a==="step"&&r&&(o.autoOpenStepCanvas=!1,requestAnimationFrame(()=>{u.openModal(),d(t)}))}),A=te("ai-node-tool-bar",N.tool_bar_container);return ne(O),e.jsx("div",{className:A,children:e.jsxs(oe,{size:12,children:[e.jsx("div",{className:N.tool_bar_action,onClick:()=>c(n.id),children:e.jsx(se,{})}),l==="parent"&&e.jsx(Ae,{...o.stepRealData,modal:u,title:(T=s.name)==null?void 0:T.value,onSave:C,trigger:e.jsx("div",{className:N.tool_bar_action,children:e.jsx(ae,{})})}),e.jsx(M,{title:"Edit Node",okText:"Save",width:n.editModalWidth,trigger:e.jsx("div",{className:N.tool_bar_action,children:e.jsx(re,{})}),children:e.jsx(K,{...n,onSubmit:y})}),e.jsx(M,{title:"Settings",okText:"Save",trigger:e.jsx("div",{className:N.tool_bar_action,children:e.jsx(de,{})}),children:e.jsx(Be,{formData:n.data,onSave:I})})]})})},Ue=n=>{const{connectionEnable:t=!0,connectionTypes:o=Object.keys(q)}=n.data,a=o.includes("target"),s=o.includes("source");return e.jsxs(_.Fragment,{children:[t&&a&&e.jsx("div",{className:"flow_handle_left",children:e.jsx(P,{type:"target",position:F.Left,className:"flow_handle",isConnectable:n.isConnectable})}),t&&s&&e.jsxs("div",{className:"flow_handle_right",children:[e.jsx(P,{type:"source",position:F.Right,className:"flow_handle",isConnectable:n.isConnectable}),e.jsx(D,{})]})]})},Ye="_node_layout_wrapper_xpd8g_1",Xe="_tool_bar_xpd8g_13",Ze="_node_layout_xpd8g_1",Ke="_node_layout_body_xpd8g_29",k={node_layout_wrapper:Ye,tool_bar:Xe,node_layout:Ze,node_layout_body:Ke};function S(n){const{data:t,children:o,handler:a=!0}=n,s=t.values,r=s.nodeType,{schemas:l=[]}=g(),c=_.useMemo(()=>Se(s.formData),[s.formData]),i=_.useMemo(()=>l.find(d=>d.type===r),[l]),u=()=>{const d=e.jsx(Ue,{...n});if(a===!0)return d;if(typeof a=="function")return(a==null?void 0:a(c))??d};return e.jsxs("div",{className:k.node_layout_wrapper,children:[e.jsx("div",{className:k.tool_bar,children:e.jsx(ze,{id:n.id,data:t,formData:c,schemas:i==null?void 0:i.formSchema,editModalWidth:i==null?void 0:i.modalWidth})}),e.jsxs("div",{className:k.node_layout,children:[e.jsx("div",{className:k.node_layout_body,children:o==null?void 0:o(c)}),u()]})]})}const Ge="_ui_node_ciuuw_1",Je="_ui_node_header_ciuuw_1",Qe="_ui_node_body_ciuuw_7",et="_ui_node_text_ciuuw_10",E={ui_node:Ge,ui_node_header:Je,ui_node_body:Qe,ui_node_text:et},tt=n=>e.jsx(S,{...n,children:t=>e.jsxs("div",{className:E.ui_node,children:[e.jsx("div",{className:E.ui_node_header,children:t.name}),e.jsx("div",{className:E.ui_node_body,children:e.jsx("div",{className:E.ui_node_text,children:t.text})})]})}),nt="_action_node_14v0w_1",ot="_action_node_header_14v0w_1",st="_action_node_body_14v0w_7",at="_action_node_text_14v0w_10",b={action_node:nt,action_node_header:ot,action_node_body:st,action_node_text:at},rt=n=>e.jsx(S,{...n,children:t=>e.jsxs("div",{className:b.action_node,children:[e.jsx("div",{className:b.action_node_header,children:"Action Node"}),e.jsxs("div",{className:b.action_node_body,children:[e.jsx("div",{className:b.action_node_text,children:t.type}),e.jsx("div",{className:b.action_node_text,children:t.text})]})]})}),dt="_transform_node_1u43d_1",it="_transform_node_header_1u43d_1",ct="_transform_node_body_1u43d_7",lt="_transform_node_text_1u43d_10",w={transform_node:dt,transform_node_header:it,transform_node_body:ct,transform_node_text:lt},_t=n=>e.jsx(S,{...n,children:t=>e.jsxs("div",{className:w.transform_node,children:[e.jsx("div",{className:w.transform_node_header,children:"Transform Node"}),e.jsxs("div",{className:w.transform_node_body,children:[e.jsx("div",{className:w.transform_node_text,children:t.type}),e.jsx("div",{className:w.transform_node_text,children:t.text})]})]})}),mt="_step_node_1riik_1",ut="_step_node_header_1riik_1",pt="_step_node_body_1riik_7",ht="_step_node_text_1riik_11",xt="_conditions_1riik_19",yt="_condition_handle_1riik_25",j={step_node:mt,step_node_header:ut,step_node_body:pt,step_node_text:ht,conditions:xt,condition_handle:yt},ft=n=>{const{conditions:t=[],isConnectable:o}=n,{connectionEnable:a=!0,connectionTypes:s=Object.keys(q)}=n.data,r=s.includes("target"),l=s.includes("source");return e.jsxs(_.Fragment,{children:[a&&r&&e.jsx("div",{className:"flow_handle_left",children:e.jsx(P,{type:"target",position:F.Left,className:"flow_handle",isConnectable:o})}),a&&l&&e.jsx("div",{className:j.conditions,children:t.map((c,i)=>e.jsxs("div",{className:j.condition_handle,children:[e.jsx("span",{children:c.condition}),e.jsxs("div",{className:"flow_handle_right",children:[e.jsx(P,{type:"source",id:c.condition,position:F.Right,className:"flow_handle",isConnectable:o}),e.jsx(D,{})]})]},`key_${c.condition}_${i}`))})]})},H=n=>e.jsx(S,{...n,handler:t=>{const o=t.conditions;if(o!=null&&o.length)return e.jsx(ft,{...n,conditions:t.conditions})},children:t=>e.jsxs("div",{className:j.step_node,children:[e.jsx("div",{className:j.step_node_header,children:t.name}),e.jsx("div",{className:j.step_node_body,children:e.jsx("div",{className:j.step_node_text,children:t.text||t.description})})]})}),vt="_prompt_node_syq2g_1",jt="_prompt_node_header_syq2g_1",gt="_prompt_node_body_syq2g_7",Nt="_prompt_node_text_syq2g_10",$={prompt_node:vt,prompt_node_header:jt,prompt_node_body:gt,prompt_node_text:Nt},bt={text:"Text",prompt:"Prompt"},wt=n=>e.jsx(S,{...n,children:t=>e.jsxs("div",{className:$.prompt_node,children:[e.jsxs("div",{className:$.prompt_node_header,children:[bt[t.type]," Node"]}),e.jsx("div",{className:$.prompt_node_body,children:e.jsx("div",{className:$.prompt_node_text,children:t.text||t.prompt})})]})}),St={ui:tt,action:rt,transform:_t,step:H,branch:H,prompt:wt},Ct=n=>{const{fromX:t,fromY:o,toX:a,toY:s}=n;return e.jsxs("g",{children:[e.jsx("path",{fill:"none",stroke:"#0143EC",strokeWidth:2,className:"animated",d:`M${t},${o} C ${t} ${s} ${t} ${s} ${a},${s}`}),e.jsx("circle",{cx:a,cy:s,fill:"#fff",r:3,stroke:"#0143EC",strokeWidth:2})]})},Tt="_nodes_1mo0o_1",kt="_node_item_1mo0o_4",Et="_node_icon_1mo0o_14",$t="_node_item_body_1mo0o_17",Pt="_node_title_1mo0o_25",Ft="_node_desc_1mo0o_30",v={nodes:Tt,node_item:kt,node_icon:Et,node_item_body:$t,node_title:Pt,node_desc:Ft},Mt=n=>{const{onNodeClick:t}=n,{role:o,schemas:a=[]}=g(),s=_.useMemo(()=>a.filter(r=>o==="parent"?r.type==="step":r.type!=="step"),[o,a]);return e.jsx("div",{className:v.nodes,children:s.map(r=>{const l=ie[r.icon];return e.jsx(M,{title:`Add ${r.title} Node`,width:r.modalWidth,destroyOnHidden:!0,okText:"Add Node",trigger:e.jsxs("div",{className:v.node_item,children:[e.jsx("div",{className:v.node_icon,children:e.jsx(l,{})}),e.jsxs("div",{className:v.node_item_body,children:[e.jsx("div",{className:v.node_title,children:r.title}),e.jsx("div",{className:v.node_desc,children:r.desc})]})]}),children:e.jsx(K,{schemas:r.formSchema,onSubmit:async c=>{const i=r.type;t==null||t({...c,nodeType:i})}})},r.type)})})},qt=n=>{const{open:t,trigger:o,onClose:a}=je(n.trigger),s=m(r=>{var l;a(),(l=n.onChange)==null||l.call(n,r)});return e.jsxs(_.Fragment,{children:[e.jsx(ce,{open:t,width:320,destroyOnHidden:!0,title:n.title,onClose:a,rootClassName:"shopify",children:e.jsx(Mt,{onNodeClick:s})}),o]})},It="_add_btn_z3xq6_1",Ot={add_btn:It},At=()=>{const{insertNodes:n}=g(),t=m(o=>{const{nodeType:a}=o,s=`${a}_${le()}`;n([{id:s,type:a,data:{values:o},position:{x:0,y:0}}])});return e.jsx(qt,{title:"What triggers this workflow?",onChange:t,trigger:e.jsx("div",{className:Ot.add_btn,children:e.jsx(D,{})})})},Wt=_.forwardRef((n,t)=>{const{role:o="parent",initialNodes:a=[],initialEdges:s=[],mcpServers:r=[],uiComponents:l=[]}=n,{uiComponents:c=l,mcpServers:i=r}=g(),u=_.useMemo(()=>Me({uiComponents:c,mcpServers:i}),[c,i]),[d,y,I]=_e(a),[C,O,A]=me(s),T=m(f=>{for(const x of f){if(d.length){const p=d.map(W=>W.position.x);x.position.x=Math.max(...p)+280}else{const p=x.data;p.connectionTypes||(p.connectionTypes=["source"])}d.push(x)}y([...d])}),h=m((f,x)=>{const p=d.findIndex(W=>W.id===f);p>-1&&(d[p].data=x,y(V(d)))}),R=m(f=>{const x=d.findIndex(p=>p.id===f);x>-1&&(d.splice(x,1),y([...d]))}),G=m(f=>{O(x=>ue(f,x).map(p=>({...p,...We})))});return _.useImperativeHandle(t,()=>({getData:()=>V({nodes:d,edges:C})})),e.jsx(X.Provider,{value:{role:o,schemas:u,mcpServers:i,uiComponents:c,insertNodes:T,deleteNode:R,updateNodeData:h},children:e.jsx("div",{className:"ai_work_flow",children:e.jsx(pe,{children:e.jsxs(he,{fitView:!0,nodes:d,edges:C,minZoom:.5,nodeTypes:St,onConnect:G,onNodesChange:I,onEdgesChange:A,connectionLineComponent:Ct,children:[e.jsx(xe,{size:2,color:"#ccc",bgColor:"#f6f6f6"}),e.jsx(At,{}),e.jsx(ye,{})]})})})})});export{Wt as default};
