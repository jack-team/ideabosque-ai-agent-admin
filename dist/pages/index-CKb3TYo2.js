import{D as p,r as U,k as e,K as B}from"../chunks/vendor-BASRo5BV.js";import{f}from"../assets/index-BGypb0Zl.js";import{T as x}from"../chunks/index-D0EwFrhZ.js";import{g as h,A as z,W as u,h as y,k as g,f as P,P as A,S as I,i as D,m as S,B as w}from"../chunks/ui-CrIkMfD8.js";import{I as j}from"../chunks/index-CNAIOIDt.js";import{b as T,u as F}from"../chunks/hooks-Dww1omTl.js";import{b,c as N,e as C}from"../chunks/wizard-CgjGpvtt.js";import{k as E}from"../chunks/useFetchData-Dprt-tp1.js";import{W}from"../chunks/map-BPCwAIgA.js";import"../chunks/utils-BMDVF5td.js";import"../chunks/index-CTOi45Ex.js";import"../chunks/generate-BFVzGyhc.js";import"../chunks/workflow-Bz6wcki2.js";import"../chunks/enum-Ct7sVdAK.js";const v=r=>{if(!r)return;const{elements:s,...i}=r,o=s.map(n=>n.element_uuid);return{...i,elementUuids:o}},M=r=>({...r,updatedBy:"Admin"}),k=r=>{const{formData:s}=r,[i]=h.useForm(),{message:o}=z.useApp(),[n]=T(),l=E(),a=p(()=>{i.setFieldsValue(v(s))});return U.useEffect(()=>{s&&a()},[s]),F(async()=>{var d;const t=await i.validateFields(),c=M(t);try{await b(c),n(),(d=r.onSuccess)==null||d.call(r),o.success(`UI Block ${s?"updated":"created"} successfully.`)}catch{o.error(`Failed to ${s?"update":"create"} UI Block.`)}}),e.jsxs(h,{form:i,submitter:!1,style:{padding:"24px 0 0 0"},children:[e.jsx(u,{hidden:!0,name:"wizardUuid"}),e.jsx(u,{label:"UI Block name",name:"wizardTitle",rules:[{required:!0}]}),e.jsx(y,{label:"UI Block Type",name:"wizardType",valueEnum:W,rules:[{required:!0}]}),e.jsx(g,{label:"UI Block description",name:"wizardDescription",fieldProps:{rows:8},rules:[{required:!0}]}),e.jsx(u,{label:"Priority",name:"priority",fieldProps:{type:"number"},rules:[{required:!0}]}),e.jsx(y,{label:"Elements",name:"elementUuids",mode:"multiple",options:l.options,fieldProps:{maxTagCount:1,loading:l.loading}}),e.jsx(g,{label:"Form Schema",name:"formSchema",fieldProps:{rows:8}})]})},Z=()=>{const{modal:r,message:s}=z.useApp(),i=B(),o=U.useRef(null),n=p(()=>{var a;(a=o.current)==null||a.reload()}),l=p(a=>{r.confirm({title:"Are you sure you want to delete?",okText:"Delete",okButtonProps:{danger:!0,className:"shopify"},cancelButtonProps:{className:"shopify gray"},onOk:async()=>{try{await N({wizardUuid:a.wizardUuid}),n(),s.success("Deletion successful.")}catch(t){return s.success("Deletion failed."),Promise.reject(t)}}})});return e.jsx(P,{title:"UI Blocks",onBack:()=>i(-1),extra:e.jsxs(I,{size:16,children:[e.jsx(w,{className:"shopify gray",onClick:()=>i("/elements"),children:"Elements"}),e.jsx(x,{width:600,className:"shopify",title:"Create new UI Block",trigger:e.jsx(w,{className:"shopify",type:"primary",children:"Create new UI Block"}),children:e.jsx(k,{})})]}),children:e.jsx(A,{actionRef:o,search:!1,options:!1,scroll:{x:"max-content"},rowKey:"wizardUuid",className:"shopify",request:async a=>{const{current:t,pageSize:c,...d}=a,{wizardList:m}=await C({limit:c,pageNumber:t,...d});return{total:m.total,data:m.wizardList}},columns:[{title:"UI Block Name",dataIndex:"wizardTitle"},{title:"UI Block UUID",dataIndex:"wizardUuid",hideInSearch:!0},{title:"Priority",dataIndex:"priority",hideInSearch:!0},{title:"Create at",dataIndex:"createdAt",hideInSearch:!0,render:(a,t)=>f(t.createdAt)},{title:"Last updated",dataIndex:"updatedAt",hideInSearch:!0,render:(a,t)=>f(t.updatedAt)},{width:"120px",key:"action",title:"Action",align:"center",fixed:"right",hideInSearch:!0,render:(a,t)=>e.jsxs(I,{children:[e.jsx(x,{width:600,destroyOnHidden:!0,className:"shopify",title:"UI Block  Details",trigger:e.jsx(j,{icon:D}),children:e.jsx(k,{formData:t,onSuccess:n})}),e.jsx(j,{icon:S,onClick:()=>l(t)})]})}]})})};export{Z as default};
