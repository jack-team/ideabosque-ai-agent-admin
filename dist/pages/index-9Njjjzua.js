import{k as e,r as A,D as f,K as v}from"../chunks/vendor-BASRo5BV.js";import{f as p}from"../assets/index-BJk3dTtz.js";import{T as w}from"../chunks/index-CDz1kTjP.js";import{S as m}from"../chunks/index-7RUIiB2k.js";import{g as d,A as x,W as g,h as S,P as F,T as N,S as C,i as U,j as T,m as P,f as W}from"../chunks/ui-CrIkMfD8.js";import{g as y,h as b,j as I}from"../chunks/workflow-DA-StHqY.js";import{I as c}from"../chunks/index-CNAIOIDt.js";import{S as V}from"../chunks/index-RQNN36hI.js";import{c as B,d as O}from"../chunks/useFetchData-DNBsODhI.js";import{b as _,u as h}from"../chunks/hooks-Doi3GEEB.js";import{S as j}from"../chunks/enum-Ct7sVdAK.js";import"../chunks/utils-BMDVF5td.js";import"../chunks/generate-C_joZJHY.js";import"../chunks/wizard-BpbQcMfp.js";const D=s=>{const{formData:a}=s,[i]=d.useForm(),{message:r}=x.useApp(),[o]=_();h(async()=>{var u;const l=await i.validateFields();try{await y({...l,status:j.Active,updatedBy:"Admin"}),o(),(u=s.onSuccess)==null||u.call(s),r.success("The version has been applied successfully.")}catch{r.error("The version application failed.")}});const{data:t,loading:n}=B({flowSnippetUuid:a==null?void 0:a.flowSnippetUuid}),k=t==null?void 0:t.map(l=>({label:`${l.flowSnippetVersionUuid}(${l.flowName})`,value:l.flowSnippetVersionUuid}));return e.jsx(V,{loading:n,children:e.jsxs(d,{form:i,initialValues:a,submitter:!1,style:{padding:"24px 0 0 0"},children:[e.jsx(g,{hidden:!0,name:"flowSnippetUuid"}),e.jsx(S,{label:"Versions",name:"flowSnippetVersionUuid",options:k,fieldProps:{loading:n},rules:[{required:!0}]})]})})},E=s=>{const{modal:a}=x.useApp(),i=A.useRef(null),r=f(async o=>{a.confirm({rootClassName:"shopify",okButtonProps:{className:"shopify",danger:!0},cancelButtonProps:{className:"shopify gray"},title:"Are you sure you want to delete this record?",onOk:async()=>{var t;await b(o),(t=i.current)==null||t.reload()}})});return e.jsx(F,{className:"shopify",options:!1,search:!1,actionRef:i,rowKey:"flowSnippetUuid",pagination:{pageSize:5},request:async()=>{const{flowSnippetList:o}=await I({pageNumber:1,limit:100,statuses:[j.Active]});return{total:o.total,data:o.flowSnippetList}},columns:[{title:"Workflow",dataIndex:"flowName"},{title:"Status",dataIndex:"status",render:(o,t)=>e.jsx(N,{children:t.status})},{title:"Create at",dataIndex:"createdAt",render:(o,t)=>p(t.createdAt)},{title:"Update at",dataIndex:"updatedAt",render:(o,t)=>p(t.updatedAt)},{key:"action",title:"Action",width:"120px",render:(o,t)=>e.jsxs(C,{children:[e.jsx(c,{icon:U,onClick:()=>{var n;return(n=s.onEdit)==null?void 0:n.call(s,t,"edit")}}),e.jsx(w,{width:400,title:"Versions",destroyOnHidden:!0,okText:"Apply",trigger:e.jsx(c,{icon:T}),children:e.jsx(D,{formData:t})}),e.jsx(c,{icon:P,onClick:()=>r(t)})]})}]})},q="_form_19wg4_1",M={form:q},R=s=>{const[a]=d.useForm(),{options:i,loading:r}=O();return h(async()=>{var n;const o=await a.validateFields(),{insertUpdateFlowSnippet:t}=await y({...o,updatedBy:"admin",flowContext:JSON.stringify({}),flowRelationship:JSON.stringify({})});(n=s.onSuccess)==null||n.call(s,t.flowSnippet)}),e.jsxs(d,{form:a,submitter:!1,className:M.form,children:[e.jsx(g,{label:"Workflow name",name:"flowName",rules:[{required:!0}]}),e.jsx(S,{label:"Template",name:"promptUuid",options:i,fieldProps:{loading:r},rules:[{required:!0}]})]})},ae=()=>{const s=v(),a=f((i,r="new")=>{const{flowSnippetUuid:o,flowSnippetVersionUuid:t}=i;s(`/agent-workflows/detail/${o}/${t}?type=${r}`)});return e.jsx(W,{title:"workflows",className:"shopify",extra:[e.jsx(m,{className:"gray",onClick:()=>s("/workflow-templates"),children:"Featured templates"},"mange"),e.jsx(w,{width:400,destroyOnHidden:!0,title:"Create workflow",okText:"Create",trigger:e.jsx(m,{type:"primary",children:"Create workflow"}),children:e.jsx(R,{onSuccess:a})},"add")],children:e.jsx(E,{onEdit:a})})};export{ae as default};
