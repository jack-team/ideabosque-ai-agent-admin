import{k as e,r as f,D as _,J as k,K as ae,M as oe}from"../chunks/vendor-BASRo5BV.js";import{W as i,k as le,L as ne,N as ie,O as ce,Q as de,U as ue,V as me,X as B,Y as K,g,h as I,Z as pe,R as W,a as U,M as he,_ as fe,S as J,i as xe,m as je,o as N,G as Q,l as X,$ as D,a0 as _e,a1 as ge,a2 as be,f as ye,b as P}from"../chunks/ui-CrIkMfD8.js";import{p as Fe,a as ve}from"../assets/index-BJk3dTtz.js";import{T as S}from"../chunks/index-CDz1kTjP.js";import{S as $}from"../chunks/index-7RUIiB2k.js";import{a as we}from"../chunks/wizard-BpbQcMfp.js";import{S as Ne}from"../chunks/index-RQNN36hI.js";import{b as z,u as R}from"../chunks/hooks-Doi3GEEB.js";import{I as T}from"../chunks/index-CNAIOIDt.js";import{v as Se}from"../chunks/utils-BMDVF5td.js";import"../chunks/generate-C_joZJHY.js";const Ce=()=>e.jsxs(e.Fragment,{children:[e.jsx(i,{name:"wizardGroupName",label:"Block Group Name",placeholder:"UI Block Group",rules:[{required:!0}]}),e.jsx(le,{name:"wizardGroupDescription",label:"Description",placeholder:"This is the description of the UI Block Group",rules:[{required:!0}]}),e.jsx(i,{disabled:!0,name:"wizardGroupUuid",label:"Block Group UUID",placeholder:"Block Group UUID",rules:[{required:!0}]}),e.jsx(i,{name:"weight",label:"Weight",initialValue:0,placeholder:"Weight",rules:[{required:!0}]})]});var d=(t=>(t.FormFields="formFields",t.MultipleChoice="multipleChoice",t.FileUploader="fileUploader",t.Scheduler="scheduler",t.ProductCards="productCards",t.Confirmation="confirmation",t))(d||{});const b={formFields:{label:"Form Fields",icon:me},multipleChoice:{label:"Multiple Choice",icon:ue},fileUploader:{label:"File Uploader",icon:de},scheduler:{label:"Scheduler",icon:ce},productCards:{label:"Product Cards",icon:ie},confirmation:{label:"Confirmation",icon:ne}},Ue={String:"String",array:"Array"},Ie={pdf:"PDF",jpeg:"JPEG",png:"PNG"};var Y=(t=>(t.Hubspot="hubspot",t))(Y||{});const Pe={hubspot:"Hubspot"},Te="_creator_btn_jtpjl_1",qe="_creator_btn_text_jtpjl_14",E={creator_btn:Te,creator_btn_text:qe},Z=t=>{const{text:r="Add new block"}=t;return e.jsxs("div",{style:t.style,onClick:t.onClick,className:E.creator_btn,children:[e.jsx(B,{component:K}),e.jsx("div",{className:E.creator_btn_text,children:r})]})},ee=t=>{const[r]=g.useForm(),[s]=z();return R(async()=>{var l;const a=await r.validateFields();(l=t.onSubmit)==null||l.call(t,a),s()}),e.jsxs(g,{form:r,submitter:!1,initialValues:t.formData,style:{padding:"16px 0 0 0"},children:[e.jsx(i,{name:"title",label:"Name",rules:[{required:!0}]}),e.jsx(I,{name:"attrType",label:"Attribute type",valueEnum:Ue,rules:[{required:!0}]}),e.jsx(i,{name:"attrName",label:"Attribute Name",rules:[{required:!0}]}),e.jsx(i,{name:"dataType",label:"Data type",rules:[{required:!0}]}),e.jsx(i,{name:"priority",label:"Priority",rules:[{required:!0}]}),e.jsx(pe.Group,{label:"Required status",name:"required",options:[{label:"Required",value:!0}]})]})},O=t=>{const[r]=g.useForm(),[s]=z();return R(async()=>{var l;const a=await r.validateFields();(l=t.onSubmit)==null||l.call(t,a),s()}),e.jsx(g,{form:r,submitter:!1,initialValues:t.formData,style:{padding:"16px 0 0 0"},children:e.jsxs(W,{gutter:16,children:[e.jsx(U,{span:24,children:e.jsx(i,{name:"name",label:"Label",rules:[{required:!0}]})}),e.jsx(U,{span:24,children:e.jsx(i,{name:"value",label:"Value",rules:[{required:!0}]})})]})})},Ae=t=>{const s=(t.wizards||[]).map(a=>{const{form_schema:l,elements:n,...p}=a,m=Fe(l)||{};return{...p,form_schema:m}});return{...t,wizards:s}};function te(t,r){return r.reduce((s,a)=>s==null?void 0:s[a],t)}const G=(t,r)=>["form_schema",t,...r],Me="_form_field_wrapper_15wpb_1",ke="_sub_list_15wpb_4",De="_form_field_15wpb_1",Be="_field_label_15wpb_20",ze="_drag_handle_15wpb_24",Re="_options_15wpb_31",Ge="_hide_15wpb_35",y={form_field_wrapper:Me,sub_list:ke,form_field:De,field_label:Be,drag_handle:ze,options:Re,hide:Ge},q=["options"],$e=t=>{const{index:r,action:s,floor:a=0,EditForm:l,fields:n=[],editFormTitle:p,showAddBtn:m=!0}=t,x=a===0,[u,o]=he.useModal(),c=f.useRef(void 0),h=_(j=>{var v;(v=c.current)==null||v.add(j)}),F=_(()=>{u.confirm({okText:"Delete",okButtonProps:{danger:!0},cancelButtonProps:{className:"shopify"},title:"Are you sure you want to delete it?",onOk:()=>s.remove(r)})});return e.jsxs("div",{className:y.form_field_wrapper,children:[o,n.map(j=>e.jsx(i,{hidden:!0,name:j},j)),e.jsxs("div",{className:y.form_field,children:[e.jsx("div",{className:y.drag_handle,children:e.jsx(B,{component:fe})}),e.jsx("div",{className:y.field_label,children:t.title}),e.jsxs(J,{size:0,children:[x&&m&&e.jsx(S,{destroyOnHidden:!0,title:"Add option",trigger:e.jsx(T,{icon:K}),children:e.jsx(O,{onSubmit:h})}),e.jsx(S,{destroyOnHidden:!0,title:p,trigger:e.jsx(T,{icon:xe}),children:e.jsx(l,{formData:t.formData,onSubmit:s.setCurrentRowData})}),e.jsx(T,{icon:je,onClick:F})]})]}),x&&m&&e.jsx(N,{name:q,children:j=>{const v=te(j,q),se=Q(y.options,!(v!=null&&v.length)&&y.hide);return e.jsx("div",{className:se,children:e.jsx(re,{floor:a+1,titleField:"name",name:q,actionRef:c,EditForm:O,fields:["name","value"],editFormTitle:"Option details"})})}})]})},re=t=>{const{name:r,fields:s=[],titleField:a,floor:l=0,actionRef:n,EditForm:p,editFormTitle:m,addFormTitle:x,showAddBtn:u=!0}=t,o=_(c=>{var h;console.log(c),(h=n.current)==null||h.add(c)});return e.jsxs(f.Fragment,{children:[e.jsx(X,{name:r,actionRef:n,copyIconProps:!1,deleteIconProps:!1,creatorButtonProps:!1,style:{marginBottom:0},className:y.sub_list,children:(c,h,F)=>{const j=F.getCurrentRowData();return e.jsx($e,{index:h,floor:l,action:F,fields:s,formData:j,EditForm:p,showAddBtn:u,editFormTitle:m,title:j[a]})}}),!l&&e.jsx(N,{name:r,children:c=>{const h=te(c,r),F=h!=null&&h.length?12:0;return e.jsx(S,{destroyOnHidden:!0,title:x,trigger:e.jsx(Z,{text:x,style:{marginTop:F}}),children:e.jsx(ee,{onSubmit:o})})}})]})},Ee="_title_13ce3_1",w={title:Ee},Oe=["title","attrName","attrType","dataType","priority","required"],H=t=>{const r=f.useRef(void 0);return e.jsxs(f.Fragment,{children:[e.jsx("div",{className:w.title,children:t.title}),e.jsx(re,{fields:Oe,name:["form_schema","items"],actionRef:r,EditForm:ee,titleField:"title",addFormTitle:"Add menu item",editFormTitle:"Menu Item Details",...t})]})},C=t=>G("uploader",t),He=()=>e.jsxs(f.Fragment,{children:[e.jsx("div",{className:w.title,children:"Uploader details"}),e.jsx(i,{label:"Upload CTA",name:C(["cta"]),rules:[{required:!0}]}),e.jsx(i,{label:"Upload description",name:C(["description"]),rules:[{required:!0}]}),e.jsx(I,{mode:"multiple",label:"Accepted file types",valueEnum:Ie}),e.jsxs(W,{gutter:16,children:[e.jsx(U,{span:12,children:e.jsx(i,{label:"Attribute name",name:C(["attrName"]),rules:[{required:!0}],extra:"This name identifies the files uploaded by this component."})}),e.jsx(U,{span:12,children:e.jsx(i,{label:"Attribute type",name:C(["attrType"]),rules:[{required:!0}]})})]})]}),L=t=>G("scheduler",t),Le=()=>e.jsxs(f.Fragment,{children:[e.jsx("div",{className:w.title,children:"Scheduler connection"}),e.jsx(I,{label:"Calendar type",valueEnum:Pe,name:L(["calendarType"]),initialValue:Y.Hubspot,rules:[{required:!0}]}),e.jsx(i,{label:"API Key",name:L(["apiKey"]),rules:[{required:!0}],extra:"Manage calendar setup through your calendar provider."})]}),Ve=`
  query presignedUploadUrl(
    $objectKey: String!, 
  ) {
    presignedUploadUrl(
      objectKey: $objectKey, 
    ) {
      url 
      objectKey
    }
  }
`,Ke=async t=>(await ve.graphql({query:Ve,variables:t})).presignedUploadUrl.url,We=async(t,r)=>{const s=`${Se()}_${t.name}`,a=`${r}/${s}`,l=await Ke({objectKey:a});return(await fetch(l,{method:"PUT",redirect:"follow",body:t,headers:{"Content-Type":t.type}})).status===200?Promise.resolve(a):Promise.reject(new Error("Upload fail."))},Je="_container_d1qtg_1",Qe={container:Je},Xe=t=>{let{onChange:r,children:s,maxCount:a=1,disbaled:l=!1,value:n=[],accept:p=".png,.jpg,.pdf"}=t;const m=f.useMemo(()=>`Accepts ${p.split(",").join(" ")}`,[p]),x=_(o=>{if(a===1)n=[o];else if(n.length<a)n=[...n,o];else{const c=`At most ${a} files can be selected.`;return D.error(c),!1}return r==null||r(n),!1}),u=_(o=>{const c=n.indexOf(o),h=n.slice();h.splice(c,1),r==null||r(h)});return e.jsx(_e.Dragger,{accept:p,multiple:!1,fileList:n,maxCount:a,onRemove:u,disabled:l,beforeUpload:x,className:Qe.container,children:s||e.jsxs(f.Fragment,{children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(ge,{})}),e.jsx("p",{className:"ant-upload-text",children:"Click or drag to add file."}),e.jsx("p",{className:"ant-upload-hint",children:m})]})})},Ye=t=>{const{value:r,onChange:s,namespace:a}=t,[l,n]=k(!1),[p,m]=k(r?[{name:r}]:[]),x=_(async u=>{const[o]=u;o.status="uploading",m(u),n(!0);try{const c=await We(o,a);o.status="done",s==null||s(c),D.success("File uploaded successfully.")}catch{o.status="error",D.error("File upload failed.")}finally{m([o]),n(!1)}});return e.jsx(Xe,{value:p,disbaled:l,onChange:x})},Ze=t=>G("confirmation",t),et=()=>e.jsxs(f.Fragment,{children:[e.jsx("div",{className:w.title,children:"Confirmation image"}),e.jsx(be,{name:Ze(["image"]),rules:[{required:!0,message:"Please upload Confirmation image"}],children:e.jsx(Ye,{namespace:"confirmation_image"})})]}),A=["form_schema","blockType"],tt=()=>e.jsxs(f.Fragment,{children:[e.jsx(N,{name:A,children:({form_schema:t})=>{var s;const r=t.blockType;return e.jsxs("div",{className:w.title,children:["Block - ",(s=b[r])==null?void 0:s.label]})}}),e.jsx(i,{name:"wizard_title",label:"Step title",rules:[{required:!0}]}),e.jsx(i,{name:"wizard_description",label:"Step description",rules:[{required:!0}]}),e.jsx(i,{hidden:!0,name:A,label:"Step type",rules:[{required:!0}]}),e.jsx(N,{name:A,children:({form_schema:t})=>{switch(t.blockType){case d.FormFields:return e.jsx(H,{title:"Menu items"});case d.MultipleChoice:return e.jsx(H,{showAddBtn:!1,title:"Multiple choice  items"});case d.FileUploader:return e.jsx(He,{});case d.Scheduler:return e.jsx(Le,{});case d.Confirmation:return e.jsx(et,{})}}}),e.jsx("div",{className:w.title,children:"Bottom actions"}),e.jsx(i,{label:"CTA button",name:["form_schema","ctaButton"],rules:[{required:!0}]})]}),rt="_option_item_qseag_1",st={option_item:rt},at=[{value:d.FormFields,...b[d.FormFields]},{value:d.MultipleChoice,...b[d.MultipleChoice]},{value:d.FileUploader,...b[d.FileUploader]},{value:d.Scheduler,...b[d.Scheduler]},{value:d.ProductCards,...b[d.ProductCards]},{value:d.Confirmation,...b[d.Confirmation]}],V=t=>{const[r]=g.useForm(),[s]=z();return R(async()=>{const a=await r.validateFields();t.onChange(a.type),s()}),e.jsx(g,{form:r,submitter:!1,style:{padding:"16px 0 0 0"},children:e.jsx(I,{name:"type",label:"UI Block type",rules:[{required:!0}],options:at,fieldProps:{optionItemRender:a=>e.jsxs("div",{className:st.option_item,children:[e.jsx(B,{component:a.icon}),a.label]})}})})},ot="_page_content_3zojf_1",lt="_form_list_3zojf_4",nt="_step_card_3zojf_4",M={page_content:ot,form_list:lt,step_card:nt},gt=()=>{const t=ae(),[r]=g.useForm(),{uid:s}=oe(),[a,l]=k(!!s),n=f.useRef(void 0),p=_(async u=>{l(!0);try{const o=await we({wizardGroupUuid:u}),c=Ae(o.wizardGroup);console.log(c),r.setFieldsValue(c)}catch(o){console.log(o)}finally{l(!1)}});f.useEffect(()=>{s&&p(s)},[s]);const m=_(u=>{var o;(o=n.current)==null||o.add({wizard_type:u,form_schema:{blockType:u}})}),x=_(async()=>{console.log(r.getFieldsValue())});return e.jsx(Ne,{loading:a,children:e.jsx(ye,{title:"Onboarding Block Group",className:"shopify full-screen",onBack:()=>t(-1),extra:e.jsxs(J,{children:[e.jsx($,{className:"gray",onClick:x,children:"Save"}),e.jsx(S,{destroyOnHidden:!0,title:"New UI Block",trigger:e.jsx($,{type:"primary",children:"Add new block"}),children:e.jsx(V,{onChange:m})})]}),children:e.jsxs(g,{form:r,submitter:!1,className:M.page_content,children:[e.jsx(P,{className:"shopify",title:"UI Block Group",style:{marginBottom:24},children:e.jsx(Ce,{})}),e.jsx(X,{name:"wizards",initialValue:[],alwaysShowItemLabel:!0,copyIconProps:!1,actionRef:n,deleteIconProps:!1,creatorButtonProps:!1,className:M.form_list,style:{marginBottom:0},itemContainerRender:(u,{index:o})=>e.jsx(P,{children:u,title:`Step ${o+1}`,className:Q(M.step_card,"shopify")}),children:e.jsx(tt,{})}),e.jsx(N,{name:["wizards"],children:({wizards:u=[]})=>{const o=u.length?24:0;return e.jsx(P,{className:"shopify",style:{marginTop:o},children:e.jsx(S,{destroyOnHidden:!0,title:"New UI Block",trigger:e.jsx(Z,{}),children:e.jsx(V,{onChange:m})})})}})]})})})};export{gt as default};
